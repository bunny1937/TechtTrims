This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.mjs
jsconfig.json
next.config.js
next.config.mjs
package.json
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
src/components/Layout/Layout.js
src/components/Maps/LocationMap.js
src/components/Maps/LocationPicker.js
src/components/Maps/SalonMap.js
src/components/OwnerSidebar.js
src/components/Salon/SalonCard.js
src/components/Salon/SalonDashboard.js
src/components/Salon/SalonRegisterForm.js
src/lib/auth.js
src/lib/constants.js
src/lib/maps.js
src/lib/middleware/requireRole.js
src/lib/mongodb.js
src/lib/userData.js
src/lib/utils.js
src/lib/validators.js
src/models/Barber.js
src/models/Booking.js
src/models/Feedback.js
src/models/Salon.js
src/models/Service.js
src/models/Staff.js
src/models/User.js
src/pages/_app.js
src/pages/api/auth/salon/login.js
src/pages/api/auth/salon/register.js
src/pages/api/auth/send-otp.js
src/pages/api/auth/user/login.js
src/pages/api/auth/user/register.js
src/pages/api/auth/verify-otp.js
src/pages/api/bookings.js
src/pages/api/bookings/[id].js
src/pages/api/bookings/create.js
src/pages/api/bookings/update-status.js
src/pages/api/bookings/update.js
src/pages/api/maps/geocode.js
src/pages/api/maps/reverse.js
src/pages/api/salon/notifications.js
src/pages/api/salons/[id].js
src/pages/api/salons/barbers/[id].js
src/pages/api/salons/barbers/available.js
src/pages/api/salons/barbers/index.js
src/pages/api/salons/bookings.js
src/pages/api/salons/bookings/[id].js
src/pages/api/salons/bookings/today.js
src/pages/api/salons/bookings/update-status.js
src/pages/api/salons/index.js
src/pages/api/salons/nearby.js
src/pages/api/salons/profile.js
src/pages/api/salons/services/[id].js
src/pages/api/salons/services/index.js
src/pages/api/salons/staff/[id].js
src/pages/api/salons/staff/index.js
src/pages/api/user/bookings.js
src/pages/api/user/payments.js
src/pages/api/user/profile.js
src/pages/api/user/register.js
src/pages/api/user/sync-booking-history.js
src/pages/auth/salon/login.js
src/pages/auth/salon/register.js
src/pages/auth/user/login.js
src/pages/auth/user/register.js
src/pages/booking/confirmed.js
src/pages/feedback.js
src/pages/index.js
src/pages/onboarding.js
src/pages/salon-details/[id].js
src/pages/salons/[id].js
src/pages/salons/barbers/index.js
src/pages/salons/book.js
src/pages/salons/bookings/[id].js
src/pages/salons/bookings/index.js
src/pages/salons/dashboard.js
src/pages/salons/profile.js
src/pages/salons/register.js
src/pages/salons/services/[id].js
src/pages/salons/services/index.js
src/pages/salons/staff/[id].js
src/pages/salons/staff/index.js
src/pages/styles/globals.css
src/pages/styles/Home.module.css
src/pages/styles/Onboarding.module.css
src/pages/styles/Owner.module.css
src/pages/user/dashboard.js
src/styles/Auth.module.css
src/styles/Booking.module.css
src/styles/globals.css
src/styles/Home.module.css
src/styles/Onboarding.module.css
src/styles/Owner.module.css
src/styles/SalonDetail.module.css
src/styles/SalonDetails.module.css
src/styles/SalonMap.module.css
src/styles/User.module.css
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="eslint.config.mjs">
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals"),
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "build/**",
      "next-env.d.ts",
    ],
  },
];

export default eslintConfig;
</file>

<file path="jsconfig.json">
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
</file>

<file path="next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  experimental: {
    swcTraceProfiling: false, // 🚫 disables trace file
  },
  images: {
    domains: [
      "localhost",
      "your-domain.com",
      "tile.openstreetmap.org",
      "images.unsplash.com",
    ],
    unoptimized: true,
  },
  env: {
    MONGODB_URI: process.env.MONGODB_URI,
    JWT_SECRET: process.env.JWT_SECRET,
  },
  webpack: (config) => {
    // Handle Leaflet in SSR
    config.resolve.fallback = {
      ...config.resolve.fallback,
      fs: false,
      net: false,
      tls: false,
    };
    return config;
  },
};

export default nextConfig;
</file>

<file path="next.config.mjs">
/** @type {import('next').NextConfig} */
const nextConfig = {};

export default nextConfig;
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.js`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="src/components/Salon/SalonDashboard.js">
// components/salons/SalonDashboard.js
import React, { useEffect, useState } from "react";
import BookingList from "./dashboard/BookingList";
import BookingForm from "./dashboard/BookingForm";
import StaffList from "./dashboard/StaffList";
import ServiceList from "./dashboard/ServiceList";

/**
 * NOTE: Replace this salonId with actual salonId from your auth/session.
 * For testing, you can hardcode a salonId string (ObjectId) from your DB.
 */
const DEFAULT_SALON_ID = process.env.NEXT_PUBLIC_SALON_ID || "";

export default function SalonDashboard() {
  const [salonId] = useState(DEFAULT_SALON_ID);

  if (!salonId) {
    return (
      <div className="p-8">
        <h2 className="text-xl font-semibold">Salon Dashboard</h2>
        <p className="mt-4 text-red-600">
          No salonId configured. Set NEXT_PUBLIC_SALON_ID or connect to auth
          session.
        </p>
      </div>
    );
  }

  return (
    <main className="p-6 space-y-6">
      <header className="flex items-center justify-between">
        <h1 className="text-2xl font-bold">Salon Owner Dashboard</h1>
        <div>
          Salon ID: <code className="bg-gray-100 p-1 rounded">{salonId}</code>
        </div>
      </header>

      <section className="grid md:grid-cols-3 gap-4">
        <div className="md:col-span-2 bg-white p-4 rounded shadow">
          <h2 className="font-semibold mb-2">Today&#39;s Bookings</h2>
          <BookingList salonId={salonId} />
        </div>

        <div className="bg-white p-4 rounded shadow">
          <h2 className="font-semibold mb-2">Create Booking</h2>
          <BookingForm salonId={salonId} />
        </div>
      </section>

      <section className="grid md:grid-cols-2 gap-4">
        <div className="bg-white p-4 rounded shadow">
          <h2 className="font-semibold mb-2">Staff</h2>
          <StaffList salonId={salonId} />
        </div>

        <div className="bg-white p-4 rounded shadow">
          <h2 className="font-semibold mb-2">Services</h2>
          <ServiceList salonId={salonId} />
        </div>
      </section>
    </main>
  );
}
</file>

<file path="src/lib/constants.js">
export const USER_ROLES = {
  USER: "user",
  SALON_OWNER: "salon_owner",
  ADMIN: "admin",
  SUPER_ADMIN: "super_admin",
};

export const BOOKING_STATUS = {
  CONFIRMED: "confirmed",
  COMPLETED: "completed",
  CANCELLED: "cancelled",
  NO_SHOW: "no_show",
};

export const PAYMENT_STATUS = {
  PENDING: "pending",
  PAID: "paid",
  FAILED: "failed",
  REFUNDED: "refunded",
};

export const GENDER_OPTIONS = [
  { value: "male", label: "Male" },
  { value: "female", label: "Female" },
  { value: "other", label: "Other" },
];

export const SERVICE_CATEGORIES = {
  HAIR: "hair",
  BEARD: "beard",
  SKIN: "skin",
  NAIL: "nail",
  MASSAGE: "massage",
};

export const RATING_CATEGORIES = [
  { key: "serviceQuality", label: "Service Quality" },
  { key: "timing", label: "Timing/Punctuality" },
  { key: "barberPerformance", label: "Staff Performance" },
  { key: "salonAmbience", label: "Salon Ambience" },
  { key: "overall", label: "Overall Experience" },
];

export const TIME_SLOTS = [
  "09:00",
  "09:30",
  "10:00",
  "10:30",
  "11:00",
  "11:30",
  "12:00",
  "12:30",
  "13:00",
  "13:30",
  "14:00",
  "14:30",
  "15:00",
  "15:30",
  "16:00",
  "16:30",
  "17:00",
  "17:30",
  "18:00",
  "18:30",
  "19:00",
  "19:30",
  "20:00",
  "20:30",
];

export const SEARCH_RADIUS = 5000; // 5km in meters for nearby salon search

export const DEFAULT_SALON_IMAGE = "/images/salon-placeholder.jpg";
export const DEFAULT_BARBER_IMAGE = "/images/barber-placeholder.jpg";
</file>

<file path="src/lib/maps.js">
// src/lib/maps.js (only the reverseGeocode part shown)
export const geocodeAddress = async (address) => {
  try {
    const res = await fetch("/api/maps/geocode", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ address }),
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.error || "Geocoding failed");
    }

    const data = await res.json();
    return data; // { coordinates: [lng, lat], formattedAddress: string }
  } catch (error) {
    console.error("Geocoding error:", error);
    throw error;
  }
};

export const reverseGeocode = async (lat, lng) => {
  try {
    const res = await fetch("/api/maps/reverse", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ lat, lng }),
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.error || "Reverse geocoding failed");
    }

    const data = await res.json();
    return data.address; // string or null
  } catch (error) {
    console.error("Reverse geocoding error:", error);
    throw error;
  }
};
</file>

<file path="src/lib/middleware/requireRole.js">
// lib/middleware/requireRole.js
const jwt = require('jsonwebtoken');
function requireRole(handler, allowedRoles = []) {
  return async (req, res) => {
    try {
      const auth = req.headers.authorization || '';
      const token = auth.replace('Bearer ', '');
      if (!token) return res.status(401).json({ message: 'Token required' });
      const payload = jwt.verify(token, process.env.JWT_SECRET || 'dev_jwt_secret');
      if (!allowedRoles.includes(payload.role)) {
        return res.status(403).json({ message: 'Insufficient privileges' });
      }
      req.user = payload;
      return handler(req, res);
    } catch (err) {
      return res.status(401).json({ message: 'Invalid or missing token', error: String(err) });
    }
  };
}
module.exports = { requireRole };
</file>

<file path="src/lib/userData.js">
// lib/userData.js
export class UserDataManager {
  static getStoredUserData() {
    if (typeof window === "undefined") return null;

    try {
      // First try to get authenticated user data
      const userToken = localStorage.getItem("userToken");
      if (userToken) {
        const storedUserData = localStorage.getItem("authenticatedUserData");
        if (storedUserData) {
          return JSON.parse(storedUserData);
        }
      }

      // Fallback to onboarding data
      const onboardingData = localStorage.getItem("userOnboardingData");
      if (onboardingData) {
        return JSON.parse(onboardingData);
      }

      return null;
    } catch (error) {
      console.error("Error getting stored user data:", error);
      return null;
    }
  }

  static async fetchAndStoreUserData() {
    if (typeof window === "undefined") return null;

    const userToken = localStorage.getItem("userToken");
    if (!userToken) {
      return this.getStoredUserData();
    }

    try {
      const response = await fetch("/api/user/profile", {
        headers: { Authorization: `Bearer ${userToken}` },
      });

      if (response.ok) {
        const userData = await response.json();
        console.log("API user data:", userData);

        // Always merge with onboarding data to preserve location and other fields
        const onboardingData = localStorage.getItem("userOnboardingData");
        console.log("Raw onboarding data:", onboardingData);

        let mergedData = userData;

        if (onboardingData) {
          try {
            const onboarding = JSON.parse(onboardingData);
            console.log("Parsed onboarding data:", onboarding);

            // Start with API data, then carefully add onboarding fields that are missing
            mergedData = {
              ...userData,
              // Only override if API data doesn't have these fields or they're undefined/null
              ...(onboarding.location &&
                !userData.location && { location: onboarding.location }),
              ...(onboarding.gender &&
                !userData.gender && { gender: onboarding.gender }),
              // Always preserve onboarding location if it exists (API likely doesn't have coordinates)
              location: onboarding.location || userData.location,
            };

            console.log("Merged data result:", mergedData);
          } catch (parseError) {
            console.error("Error parsing onboarding data:", parseError);
            mergedData = userData;
          }
        }

        // Store the merged data
        localStorage.setItem(
          "authenticatedUserData",
          JSON.stringify(mergedData)
        );
        return mergedData;
      } else {
        // If API fails, return stored data
        return this.getStoredUserData();
      }
    } catch (error) {
      console.error("Error fetching user data:", error);
      return this.getStoredUserData();
    }
  }

  static clearUserData() {
    if (typeof window === "undefined") return;

    localStorage.removeItem("userToken");
    localStorage.removeItem("authenticatedUserData");
    // Keep onboarding data for future use
  }

  static isLoggedIn() {
    if (typeof window === "undefined") return false;
    return !!localStorage.getItem("userToken");
  }

  static hasOnboarded() {
    if (typeof window === "undefined") return false;
    return localStorage.getItem("hasOnboarded") === "true";
  }
}
</file>

<file path="src/lib/utils.js">
export const formatPrice = (price) => {
  return `₹${price.toLocaleString("en-IN")}`;
};

export const formatTime = (time) => {
  return new Date(`2000-01-01 ${time}`).toLocaleString("en-US", {
    hour: "numeric",
    minute: "2-digit",
    hour12: true,
  });
};

export const formatDate = (date) => {
  return new Date(date).toLocaleDateString("en-IN", {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  });
};

export const calculateDistance = (lat1, lon1, lat2, lon2) => {
  const R = 6371; // Radius of the Earth in kilometers
  const dLat = ((lat2 - lat1) * Math.PI) / 180;
  const dLon = ((lon2 - lon1) * Math.PI) / 180;
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos((lat1 * Math.PI) / 180) *
      Math.cos((lat2 * Math.PI) / 180) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  const distance = R * c; // Distance in kilometers
  return distance;
};

export const generateUniqueId = () => {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
};

export const debounce = (func, wait) => {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
};
</file>

<file path="src/lib/validators.js">
export const validateEmail = (email) => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
};

export const validateMobile = (mobile) => {
  const mobileRegex = /^(\+91[\-\s]?)?[0]?(91)?[6789]\d{9}$/;
  return mobileRegex.test(mobile);
};

export const validatePassword = (password) => {
  return password && password.length >= 6;
};

export const validateSalonRegistration = (data) => {
  const errors = {};

  // Owner Details Validation
  if (!data.fullName || data.fullName.trim().length < 2) {
    errors.fullName = "Full name must be at least 2 characters";
  }

  if (!validateMobile(data.mobileNumber)) {
    errors.mobileNumber = "Invalid mobile number format";
  }

  if (!validateEmail(data.email)) {
    errors.email = "Invalid email format";
  }

  if (!validatePassword(data.password)) {
    errors.password = "Password must be at least 6 characters";
  }

  // Salon Details Validation
  if (!data.salonName || data.salonName.trim().length < 2) {
    errors.salonName = "Salon name must be at least 2 characters";
  }

  if (!data.address || data.address.trim().length < 10) {
    errors.address = "Address must be at least 10 characters";
  }

  // Services Validation
  const enabledServices = Object.entries(data.services || {})
    .filter(([_, service]) => service.enabled)
    .map(([key, service]) => ({ key, ...service }));

  if (enabledServices.length === 0) {
    errors.services = "At least one service must be enabled";
  }

  enabledServices.forEach((service) => {
    if (!service.price || service.price < 1) {
      errors[`service_${service.key}`] = "Service price must be greater than 0";
    }
  });

  return {
    isValid: Object.keys(errors).length === 0,
    errors,
  };
};

export const validateBooking = (data) => {
  const errors = {};

  if (!data.salonId) {
    errors.salonId = "Salon selection is required";
  }

  if (!data.barberName) {
    errors.barberName = "Barber selection is required";
  }

  if (!data.service) {
    errors.service = "Service selection is required";
  }
  if (!data.scheduledTime && !data.timeSlot) {
    errors.scheduledTime = "Time slot selection is required";
  } else if (!data.scheduledTime && data.timeSlot) {
    // normalize: if client sent timeSlot, map it to scheduledTime for downstream code
    data.scheduledTime = data.timeSlot;
  }

  if (!data.userDetails?.name) {
    errors.userName = "Name is required";
  }

  if (!validateMobile(data.userDetails?.mobile)) {
    errors.userMobile = "Valid mobile number is required";
  }

  return {
    isValid: Object.keys(errors).length === 0,
    errors,
  };
};
</file>

<file path="src/models/Feedback.js">
// models/Feedback.js
export class Feedback {
  constructor(data) {
    this.bookingId = data.bookingId;
    this.userId = data.userId;
    this.salonId = data.salonId;
    this.ratings = {
      serviceQuality: data.ratings.serviceQuality,
      timing: data.ratings.timing,
      barberPerformance: data.ratings.barberPerformance,
      salonAmbience: data.ratings.salonAmbience,
      overall: data.ratings.overall,
    };
    this.comment = data.comment || "";
    this.isPublic = data.isPublic !== undefined ? data.isPublic : true;
    this.createdAt = new Date();
  }

  static async create(feedbackData) {
    const { db } = await connectToDatabase();
    const feedback = new Feedback(feedbackData);
    const result = await db.collection("feedback").insertOne(feedback);
    return { ...feedback, _id: result.insertedId };
  }

  static async findBySalonId(salonId, options = {}) {
    const { db } = await connectToDatabase();
    const query = {
      salonId,
      isPublic: true,
    };

    let cursor = db.collection("feedback").find(query);

    if (options.sort) {
      cursor = cursor.sort(options.sort);
    } else {
      cursor = cursor.sort({ createdAt: -1 });
    }

    if (options.limit) {
      cursor = cursor.limit(options.limit);
    }

    return await cursor.toArray();
  }

  static async getSalonAverageRatings(salonId) {
    const { db } = await connectToDatabase();

    const pipeline = [
      {
        $match: {
          salonId,
          isPublic: true,
        },
      },
      {
        $group: {
          _id: null,
          avgServiceQuality: { $avg: "$ratings.serviceQuality" },
          avgTiming: { $avg: "$ratings.timing" },
          avgBarberPerformance: { $avg: "$ratings.barberPerformance" },
          avgSalonAmbience: { $avg: "$ratings.salonAmbience" },
          avgOverall: { $avg: "$ratings.overall" },
          totalReviews: { $sum: 1 },
        },
      },
    ];

    const result = await db
      .collection("feedback")
      .aggregate(pipeline)
      .toArray();
    return result[0] || null;
  }
}
</file>

<file path="src/models/Salon.js">
// models/Salon.js
export class Salon {
  constructor(data) {
    this.ownerDetails = {
      name: data.ownerDetails.name,
      mobile: data.ownerDetails.mobile,
      email: data.ownerDetails.email,
      password: data.ownerDetails.password, // Should be hashed
    };
    this.salonDetails = {
      name: data.salonDetails.name,
      address: data.salonDetails.address,
      location: data.salonDetails.location || {
        type: "Point",
        coordinates: [0, 0],
      },
      openingHours: data.salonDetails.openingHours || {
        open: "09:00",
        close: "21:00",
      },
      images: data.salonDetails.images || [],
      description: data.salonDetails.description || "",
    };
    this.services = data.services || [];
    this.barbers = data.barbers || [];
    this.ratings = data.ratings || {
      overall: 5.0,
      totalReviews: 0,
      serviceQuality: 5.0,
      timing: 5.0,
      cleanliness: 5.0,
      ambience: 5.0,
    };
    this.stats = data.stats || {
      totalBookings: 0,
      repeatCustomers: 0,
      averageWaitTime: 10,
    };
    this.isActive = data.isActive !== undefined ? data.isActive : true;
    this.createdAt = new Date();
    this.updatedAt = new Date();
  }

  static async create(salonData) {
    const { db } = await connectToDatabase();
    const salon = new Salon(salonData);

    // Create geospatial index for location-based queries
    await db
      .collection("salons")
      .createIndex({ "salonDetails.location": "2dsphere" });

    const result = await db.collection("salons").insertOne(salon);
    return { ...salon, _id: result.insertedId };
  }

  static async findById(id) {
    const { db } = await connectToDatabase();
    return await db.collection("salons").findOne({ _id: new ObjectId(id) });
  }

  static async findByOwnerEmail(email) {
    const { db } = await connectToDatabase();
    return await db
      .collection("salons")
      .findOne({ "ownerDetails.email": email });
  }

  static async findNearby(coordinates, radius = 5000, options = {}) {
    const { db } = await connectToDatabase();

    const pipeline = [
      {
        $geoNear: {
          near: {
            type: "Point",
            coordinates: coordinates, // [longitude, latitude]
          },
          distanceField: "distance",
          maxDistance: radius,
          spherical: true,
        },
      },
      {
        $match: { isActive: true },
      },
    ];

    // Add gender-based service filtering if specified
    if (options.gender) {
      pipeline.push({
        $addFields: {
          relevantServices: {
            $filter: {
              input: "$services",
              cond: {
                $or: [
                  { $eq: ["$$this.genderSpecific", "unisex"] },
                  { $eq: ["$$this.genderSpecific", options.gender] },
                ],
              },
            },
          },
        },
      });
    }

    pipeline.push(
      {
        $addFields: {
          topServices: { $slice: ["$relevantServices", 4] },
          distanceKm: { $round: [{ $divide: ["$distance", 1000] }, 1] },
        },
      },
      {
        $project: {
          "ownerDetails.password": 0,
        },
      },
      { $limit: options.limit || 20 }
    );

    return await db.collection("salons").aggregate(pipeline).toArray();
  }

  static async updateById(id, updateData) {
    const { db } = await connectToDatabase();
    const result = await db.collection("salons").updateOne(
      { _id: new ObjectId(id) },
      {
        $set: {
          ...updateData,
          updatedAt: new Date(),
        },
      }
    );
    return result.modifiedCount > 0;
  }

  static async incrementBookingCount(id) {
    const { db } = await connectToDatabase();
    return await db.collection("salons").updateOne(
      { _id: new ObjectId(id) },
      {
        $inc: { "stats.totalBookings": 1 },
        $set: { updatedAt: new Date() },
      }
    );
  }

  static async updateRatings(id, newRatings) {
    const { db } = await connectToDatabase();
    return await db.collection("salons").updateOne(
      { _id: new ObjectId(id) },
      {
        $set: {
          "ratings.overall": newRatings.overall,
          "ratings.serviceQuality": newRatings.serviceQuality,
          "ratings.timing": newRatings.timing,
          "ratings.cleanliness": newRatings.cleanliness,
          "ratings.ambience": newRatings.ambience,
          "ratings.totalReviews": newRatings.totalReviews,
          updatedAt: new Date(),
        },
      }
    );
  }
}
</file>

<file path="src/models/Service.js">
// models/Service.js
import mongoose from "mongoose";

const ServiceSchema = new mongoose.Schema(
  {
    salonId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Salon",
      required: true,
      index: true,
    },
    title: { type: String, required: true },
    description: { type: String, default: "" },
    durationMinutes: { type: Number, default: 30 },
    price: { type: Number, required: true },
    isActive: { type: Boolean, default: true },
    createdAt: { type: Date, default: Date.now },
  },
  { timestamps: true }
);

export default mongoose.models.Service ||
  mongoose.model("Service", ServiceSchema);
</file>

<file path="src/models/Staff.js">
// models/Staff.js
import mongoose from "mongoose";

const StaffSchema = new mongoose.Schema(
  {
    salonId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Salon",
      required: true,
      index: true,
    },
    name: { type: String, required: true },
    skills: [{ type: String }],
    workingHours: {
      start: { type: String, default: "09:00" },
      end: { type: String, default: "21:00" },
    },
    photo: { type: String, default: "" },
    bio: { type: String, default: "" },
    isAvailable: { type: Boolean, default: true },
    earnings: { type: Number, default: 0 },
  },
  { timestamps: true }
);

export default mongoose.models.Staff || mongoose.model("Staff", StaffSchema);
</file>

<file path="src/models/User.js">
// models/User.js
import { connectToDatabase } from "../lib/mongodb";
import { ObjectId } from "mongodb";

export class User {
  constructor(data) {
    this.name = data.name;
    this.mobile = data.mobile;
    this.email = data.email || null;
    this.gender = data.gender || "male";
    this.location = data.location || null;
    this.preferences = data.preferences || {
      favoriteServices: [],
      preferredPriceRange: { min: 0, max: 2000 },
    };
    this.bookingHistory = data.bookingHistory || [];
    this.createdAt = new Date();
    this.updatedAt = new Date();
  }

  static async create(userData) {
    const { db } = await connectToDatabase();
    const user = new User(userData);
    const result = await db.collection("users").insertOne(user);
    return { ...user, _id: result.insertedId };
  }

  static async findById(id) {
    const { db } = await connectToDatabase();
    return await db.collection("users").findOne({ _id: new ObjectId(id) });
  }

  static async findByMobile(mobile) {
    const { db } = await connectToDatabase();
    return await db.collection("users").findOne({ mobile });
  }

  static async findByEmail(email) {
    const { db } = await connectToDatabase();
    return await db.collection("users").findOne({ email });
  }

  static async updateById(id, updateData) {
    const { db } = await connectToDatabase();
    const result = await db.collection("users").updateOne(
      { _id: new ObjectId(id) },
      {
        $set: {
          ...updateData,
          updatedAt: new Date(),
        },
      }
    );
    return result.modifiedCount > 0;
  }

  static async addBookingToHistory(userId, bookingId) {
    const { db } = await connectToDatabase();
    return await db.collection("users").updateOne(
      { _id: new ObjectId(userId) },
      {
        $push: { bookingHistory: bookingId },
        $set: { updatedAt: new Date() },
      }
    );
  }
}
</file>

<file path="src/pages/_app.js">
// pages/_app.js
import "leaflet/dist/leaflet.css";
import "../styles/globals.css";

function MyApp({ Component, pageProps }) {
  return <Component {...pageProps} />;
}

export default MyApp;
</file>

<file path="src/pages/api/auth/salon/login.js">
import { connectToDatabase } from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";
import bcrypt from "bcryptjs";
import jwt from "jsonwebtoken";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { db } = await connectToDatabase();
    const { email, password } = req.body;

    if (!email || !password) {
      return res.status(400).json({ message: "Email and password required" });
    }

    // Find salon
    const salon = await db.collection("salons").findOne({
      $or: [
        { email: email.toLowerCase() },
        { "ownerDetails.email": email },
        { "salonDetails.ownerEmail": email },
      ],
    });

    if (!salon) {
      return res.status(401).json({ message: "Invalid credentials" });
    }

    // Debug log to see your data structure
    console.log("Found salon:", JSON.stringify(salon, null, 2));

    // Check password - handle both hashed and plain text passwords
    // Check password - always use hashedPassword
    let isValidPassword = false;

    if (salon.hashedPassword) {
      isValidPassword = await bcrypt.compare(password, salon.hashedPassword);
    } else if (salon.password) {
      // Fallback in case old records stored plain password
      isValidPassword = password === salon.password;
    } else if (salon.ownerDetails?.password) {
      // If you had an old schema with ownerDetails.password
      isValidPassword = await bcrypt.compare(
        password,
        salon.ownerDetails.password
      );
    }

    // Generate token
    const token = jwt.sign(
      { salonId: salon._id, email: salon.email },
      process.env.JWT_SECRET || "fallback_secret",
      { expiresIn: "30d" }
    );

    // Remove password from response
    const { password: _, ...salonData } = salon;

    res.status(200).json({
      success: true,
      message: "Login successful",
      salon: salonData,
      token,
    });
  } catch (error) {
    console.error("Login error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/auth/send-otp.js">
// pages/api/auth/send-otp.js
// Generates a 6-digit OTP and stores in 'otps' collection (expires in 5 minutes).
// NOTE: No SMS provider integrated. Replace sendSms() with your provider.
import { connectToDatabase } from "../../../lib/mongodb";
import { nanoid } from "nanoid";

function generateOtp() {
  return Math.floor(100000 + Math.random() * 900000).toString();
}

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ message: "Method not allowed" });
  try {
    const { mobile } = req.body || {};
    if (!mobile) return res.status(400).json({ message: "Missing mobile" });
    const { db } = await connectToDatabase();
    const otp = generateOtp();
    const expiresAt = new Date(Date.now() + 5 * 60 * 1000); // 5 mins
    await db.collection("otps").updateOne({ mobile }, { $set: { otp, expiresAt } }, { upsert: true });
    // TODO: Integrate SMS provider here. For now we return OTP in response for testing.
    return res.status(200).json({ message: "OTP sent (dev)", otp });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ message: e.message });
  }
}
</file>

<file path="src/pages/api/auth/verify-otp.js">
// pages/api/auth/verify-otp.js
// Verifies OTP and returns a temporary token (or creates/returns user).
// For demo returns user info if found or indicates success.
import { connectToDatabase } from "../../../lib/mongodb";

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ message: "Method not allowed" });
  try {
    const { mobile, otp } = req.body || {};
    if (!mobile || !otp) return res.status(400).json({ message: "Missing fields" });
    const { db } = await connectToDatabase();
    const record = await db.collection("otps").findOne({ mobile });
    if (!record) return res.status(400).json({ message: "No OTP found" });
    if (new Date(record.expiresAt) < new Date()) return res.status(400).json({ message: "OTP expired" });
    if (String(record.otp) !== String(otp)) return res.status(400).json({ message: "Invalid OTP" });
    // OTP ok — optionally find/create user
    const user = await db.collection("users").findOne({ mobile });
    // delete OTP after use
    await db.collection("otps").deleteOne({ mobile });
    return res.status(200).json({ message: "Verified", user: user || null });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ message: e.message });
  }
}
</file>

<file path="src/pages/api/bookings.js">
// pages/api/bookings.js
import { connectToDatabase, clientPromise } from "../../lib/mongodb";
import { ObjectId } from "mongodb";

/**
 * This version uses a MongoDB transaction (when available) to insert booking,
 * update salon, and create/find user atomically. It also publishes a simple
 * in-memory SSE notification for subscribed salon dashboards.
 */

// simple in-memory pubsub for SSE (dev only)
const subscribers = {}; // { salonId: [res, ...] }

function publishNotification(salonId, payload) {
  // store for any connected subscribers
  const list = subscribers[salonId] || [];
  list.forEach((res) => {
    try {
      res.write(`data: ${JSON.stringify(payload)}\n\n`);
    } catch (e) {
      // ignore writes errors
    }
  });
}

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ message: "Method not allowed" });
  try {
    const body = req.body || {};
    const { salonId, service, barber, date, time, user } = body;

    if (!salonId || !service || !date || !time) {
      return res.status(400).json({ message: "Missing required fields" });
    }

    const { db, client } = await connectToDatabase();
    const session = client.startSession ? client.startSession() : null;
    let bookingId = null;
    let userId = null;

    const bookingDate = new Date(date);
    if (isNaN(bookingDate.getTime())) return res.status(400).json({ message: "Invalid date" });

    const bookingDoc = {
      salonId: ObjectId.isValid(salonId) ? new ObjectId(salonId) : salonId,
      service,
      barber: barber || null,
      date,
      time,
      customerName: user?.name || body.customerName || "Guest",
      customerPhone: user?.mobile || body.customerPhone || "Unknown",
      price: body.price || 0,
      paymentStatus: "pending",
      status: "confirmed",
      createdAt: new Date()
    };

    const transactionFn = async (session) => {
      // double booking check inside transaction
      const existing = await db.collection("bookings").findOne({
        salonId: bookingDoc.salonId,
        date,
        time,
        barber: bookingDoc.barber,
        status: { $ne: "cancelled" }
      }, { session });
      if (existing) throw new Error("Slot already booked");

      const insertResult = await db.collection("bookings").insertOne(bookingDoc, { session });
      bookingId = insertResult.insertedId;

      if (user && user.mobile) {
        let existingUser = await db.collection("users").findOne({ mobile: user.mobile }, { session });
        if (!existingUser) {
          const newUser = {
            name: user.name || "Guest",
            mobile: user.mobile,
            email: user.email || null,
            gender: user.gender || "other",
            location: user.location || null,
            bookingHistory: [bookingId],
            createdAt: new Date()
          };
          const ur = await db.collection("users").insertOne(newUser, { session });
          userId = ur.insertedId;
        } else {
          userId = existingUser._id;
          await db.collection("users").updateOne({ _id: userId }, { $push: { bookingHistory: bookingId }, $set: { updatedAt: new Date() } }, { session });
        }
        await db.collection("bookings").updateOne({ _id: bookingId }, { $set: { userId } }, { session });
      }

      // update salon bookings array
      await db.collection("salons").updateOne(
        { _id: bookingDoc.salonId },
        { $push: { bookings: { _id: bookingId, date, time, service, barber } }, $set: { updatedAt: new Date() } },
        { session }
      );
    };

    if (session) {
      try {
        await session.withTransaction(async () => {
          await transactionFn(session);
        });
      } finally {
        await session.endSession();
      }
    } else {
      // fallback: not a replica set / no sessions available
      await transactionFn(null);
    }

    // Publish SSE notification (dev-time)
    try {
      publishNotification(String(salonId), { type: "new_booking", bookingId: String(bookingId), date, time, service, barber });
    } catch (e) {
      console.warn("Publish failed", e.message);
    }

    return res.status(201).json({ bookingId, userId: userId || null });
  } catch (e) {
    if (e.message && e.message.includes("Slot already booked")) {
      return res.status(409).json({ message: "Slot already booked" });
    }
    console.error("Booking API error:", e);
    return res.status(500).json({ message: e.message || "Internal server error" });
  }
}

// Expose a helper to allow SSE subscription (imported by /api/salon/notifications)
export function _subscribe(salonId, res) {
  subscribers[salonId] = subscribers[salonId] || [];
  subscribers[salonId].push(res);
  // Remove on close
  reqClose(res);
}

function reqClose(res) {
  res.on("close", () => {
    for (const sid of Object.keys(subscribers)) {
      subscribers[sid] = subscribers[sid].filter(r => r !== res);
    }
  });
}
</file>

<file path="src/pages/api/bookings/[id].js">
// pages/api/bookings/[id].js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const { id } = req.query;
  if (!id) return res.status(400).json({ message: "Missing id" });
  if (req.method !== "GET")
    return res.status(405).json({ message: "Method not allowed" });
  try {
    const { db } = await connectToDatabase();
    const b = await db
      .collection("bookings")
      .findOne({ _id: ObjectId.isValid(id) ? new ObjectId(id) : id });
    if (!b) return res.status(404).json({ message: "Not found" });
    return res.status(200).json({ booking: b });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ message: e.message });
  }
}
</file>

<file path="src/pages/api/bookings/update-status.js">
// src/pages/api/bookings/update-status.js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "PUT") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { bookingId, status } = req.body;

    if (!bookingId || !status) {
      return res
        .status(400)
        .json({ error: "Booking ID and status are required" });
    }

    const { client, db } = await connectToDatabase();

    // Update booking status
    const result = await db.collection("bookings").updateOne(
      { _id: new ObjectId(bookingId) },
      {
        $set: {
          status,
          updatedAt: new Date(),
          // Add completion timestamp when service is done
          ...(status === "completed" && { completedAt: new Date() }),
        },
      }
    );

    if (result.matchedCount === 0) {
      return res.status(404).json({ error: "Booking not found" });
    }

    // Get updated booking to return
    const updatedBooking = await db.collection("bookings").findOne({
      _id: new ObjectId(bookingId),
    });

    res.status(200).json({
      success: true,
      message: "Booking status updated successfully",
      booking: updatedBooking,
    });
  } catch (error) {
    console.error("Error updating booking status:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/bookings/update.js">
// pages/api/bookings/update.js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "PUT") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { bookingId, status, feedback } = req.body;

    if (!ObjectId.isValid(bookingId)) {
      return res.status(400).json({ error: "Invalid booking ID" });
    }

    const { db } = await connectToDatabase();

    const updateData = { updatedAt: new Date() };

    if (status) {
      updateData.status = status;
    }

    if (feedback) {
      updateData.feedback = {
        submitted: true,
        ...feedback,
        submittedAt: new Date(),
      };
    }

    const result = await db
      .collection("bookings")
      .updateOne({ _id: new ObjectId(bookingId) }, { $set: updateData });

    if (result.matchedCount === 0) {
      return res.status(404).json({ error: "Booking not found" });
    }

    // If feedback is submitted, update salon ratings
    if (feedback && feedback.ratings) {
      const booking = await db.collection("bookings").findOne({
        _id: new ObjectId(bookingId),
      });

      if (booking) {
        await updateSalonRatings(db, booking.salonId, feedback.ratings);
      }
    }

    res.status(200).json({
      success: true,
      message: "Booking updated successfully",
    });
  } catch (error) {
    console.error("Booking update error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}

// Helper function to update salon ratings
async function updateSalonRatings(db, salonId, newRatings) {
  try {
    // Get all feedback for this salon
    const allFeedback = await db
      .collection("bookings")
      .find({
        salonId,
        "feedback.submitted": true,
      })
      .toArray();

    if (allFeedback.length === 0) return;

    // Calculate average ratings
    const totalRatings = allFeedback.reduce((acc, booking) => {
      const ratings = booking.feedback.ratings;
      Object.keys(ratings).forEach((key) => {
        acc[key] = (acc[key] || 0) + ratings[key];
      });
      return acc;
    }, {});

    const avgRatings = {};
    Object.keys(totalRatings).forEach((key) => {
      avgRatings[key] = parseFloat(
        (totalRatings[key] / allFeedback.length).toFixed(1)
      );
    });

    // Update salon ratings
    await db.collection("salons").updateOne(
      { _id: new ObjectId(salonId) },
      {
        $set: {
          "ratings.overall": avgRatings.overall || 5.0,
          "ratings.serviceQuality": avgRatings.serviceQuality || 5.0,
          "ratings.timing": avgRatings.timing || 5.0,
          "ratings.cleanliness": avgRatings.cleanliness || 5.0,
          "ratings.ambience": avgRatings.ambience || 5.0,
          "ratings.totalReviews": allFeedback.length,
          updatedAt: new Date(),
        },
      }
    );
  } catch (error) {
    console.error("Error updating salon ratings:", error);
  }
}
</file>

<file path="src/pages/api/maps/geocode.js">
// pages/api/maps/geocode.js
export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { address } = req.body;
    const apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;

    if (!address) {
      return res.status(400).json({ error: "Address is required" });
    }

    const response = await fetch(
      `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(
        address
      )}&key=${apiKey}`
    );

    const data = await response.json();

    if (data.status !== "OK" || !data.results || data.results.length === 0) {
      return res.status(400).json({ error: "Address not found" });
    }

    const result = data.results[0];
    const location = result.geometry.location;

    res.status(200).json({
      success: true,
      coordinates: [location.lng, location.lat], // [longitude, latitude] for MongoDB
      formattedAddress: result.formatted_address,
      placeId: result.place_id,
    });
  } catch (error) {
    console.error("Geocoding error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salon/notifications.js">
// pages/api/salon/notifications.js
// Simple Server-Sent Events (SSE) endpoint for salon dashboards to subscribe to live notifications.
// Note: This is a simple in-memory solution for dev. For production use Redis/Message broker.

const subscribers = {}; // { salonId: [res, ...] }

export default async function handler(req, res) {
  const { salonId } = req.query;
  if (!salonId) return res.status(400).json({ message: "Missing salonId" });
  // Set SSE headers
  res.writeHead(200, {
    Connection: "keep-alive",
    "Cache-Control": "no-cache, no-transform",
    "Content-Type": "text/event-stream",
  });
  res.write("\n");

  subscribers[salonId] = subscribers[salonId] || [];
  subscribers[salonId].push(res);

  req.on("close", () => {
    subscribers[salonId] = subscribers[salonId].filter((r) => r !== res);
  });
}

// Provide a small helper to publish (other modules can import this file and call publish)
export function publish(salonId, payload) {
  const list = subscribers[salonId] || [];
  list.forEach((res) => {
    try {
      res.write(`data: ${JSON.stringify(payload)}\n\n`);
    } catch (e) {}
  });
}
</file>

<file path="src/pages/api/salons/[id].js">
// pages/api/salons/[id].js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const { id } = req.query;

  if (!ObjectId.isValid(id)) {
    return res.status(400).json({ error: "Invalid salon ID" });
  }

  try {
    const { db } = await connectToDatabase();

    if (req.method === "GET") {
      const salon = await db
        .collection("salons")
        .findOne(
          { _id: new ObjectId(id) },
          { projection: { "ownerDetails.password": 0 } }
        );

      if (!salon) {
        return res.status(404).json({ error: "Salon not found" });
      }

      // Get recent reviews/feedback
      const recentFeedback = await db
        .collection("bookings")
        .find({
          salonId: id,
          "feedback.submitted": true,
        })
        .sort({ updatedAt: -1 })
        .limit(5)
        .toArray();

      res.status(200).json({
        success: true,
        salon: {
          ...salon,
          recentFeedback: recentFeedback.map((booking) => ({
            userName: booking.userDetails.name,
            rating: booking.feedback.ratings.overall,
            comment: booking.feedback.comment,
            service: booking.service.name,
            date: booking.updatedAt,
          })),
        },
      });
    } else if (req.method === "PUT") {
      // Update salon details (protected route - needs authentication)
      const updateData = {
        ...req.body,
        updatedAt: new Date(),
      };

      const result = await db
        .collection("salons")
        .updateOne({ _id: new ObjectId(id) }, { $set: updateData });

      if (result.matchedCount === 0) {
        return res.status(404).json({ error: "Salon not found" });
      }

      res.status(200).json({
        success: true,
        message: "Salon updated successfully",
      });
    } else {
      res.status(405).json({ error: "Method not allowed" });
    }
  } catch (error) {
    console.error("Salon API error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/barbers/[id].js">
// pages/api/salons/barbers/[id].js
import clientPromise from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const { method } = req;
  const { id } = req.query;

  if (!ObjectId.isValid(id)) {
    return res.status(400).json({ error: "Invalid barber ID" });
  }

  try {
    const client = await clientPromise;
    const db = client.db("techtrims");
    const barbersCollection = db.collection("barbers");

    if (method === "GET") {
      const barber = await barbersCollection.findOne({ _id: new ObjectId(id) });
      if (!barber) return res.status(404).json({ error: "Barber not found" });
      return res.status(200).json(barber);
    }

    if (method === "PUT") {
      const updateData = { ...req.body, updatedAt: new Date() };

      const result = await barbersCollection.findOneAndUpdate(
        { _id: new ObjectId(id) },
        { $set: updateData },
        { returnDocument: "after" }
      );

      if (!result.value)
        return res.status(404).json({ error: "Barber not found" });
      return res.status(200).json(result.value);
    }

    if (method === "DELETE") {
      const result = await barbersCollection.deleteOne({
        _id: new ObjectId(id),
      });
      if (result.deletedCount === 0)
        return res.status(404).json({ error: "Barber not found" });
      return res.status(204).end();
    }

    return res.setHeader("Allow", ["GET", "PUT", "DELETE"]).status(405).end();
  } catch (err) {
    console.error("api/barbers/[id] error:", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/barbers/index.js">
// pages/api/salons/barbers/index.js
import clientPromise from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const { method } = req;

  // Extract salonId from query parameters or request body
  const salonId = req.query.salonId || req.body.salonId;

  console.log("=== BARBERS API DEBUG ===");
  console.log("Method:", method);
  console.log("Raw salonId:", salonId);
  console.log("SalonId type:", typeof salonId);

  if (!salonId) {
    return res.status(400).json({ error: "salonId required" });
  }

  try {
    const client = await clientPromise;
    const db = client.db("techtrims");
    const barbersCollection = db.collection("barbers");

    console.log("Database connected successfully");

    if (method === "GET") {
      // Get all barbers for salon
      console.log("Fetching barbers for salon:", salonId);

      // Convert salonId to ObjectId - ADD VALIDATION
      let salonObjectId;
      try {
        salonObjectId = new ObjectId(salonId);
        console.log("Converted to ObjectId:", salonObjectId);
      } catch (objIdError) {
        console.error("Invalid ObjectId:", salonId, objIdError);
        return res.status(400).json({ error: "Invalid salonId format" });
      }

      const barbers = await barbersCollection
        .find({
          salonId: salonObjectId,
        })
        .sort({ name: 1 })
        .toArray();

      console.log("Found barbers:", barbers.length);
      console.log("Barbers data:", barbers);

      return res.status(200).json(barbers);
    }

    if (method === "POST") {
      // Create new barber
      let salonObjectId;
      try {
        salonObjectId = new ObjectId(salonId);
      } catch (objIdError) {
        return res.status(400).json({ error: "Invalid salonId format" });
      }

      const barberData = {
        ...req.body,
        salonId: salonObjectId,
        totalBookings: 0,
        rating: 5.0,
        isAvailable: req.body.isAvailable !== false,
        workingHours: {
          start: "09:00",
          end: "21:00",
        },
        accomplishments: [],
        earnings: 0,
        lastActiveAt: new Date(),
        createdAt: new Date(),
        updatedAt: new Date(),
      };

      console.log("Creating barber:", barberData);

      const result = await barbersCollection.insertOne(barberData);
      const createdBarber = await barbersCollection.findOne({
        _id: result.insertedId,
      });

      console.log("Barber created:", result.insertedId);
      return res.status(201).json(createdBarber);
    }

    return res
      .setHeader("Allow", ["GET", "POST"])
      .status(405)
      .json({ error: "Method not allowed" });
  } catch (err) {
    console.error("=== API ERROR ===");
    console.error("Error name:", err.name);
    console.error("Error message:", err.message);
    console.error("Error stack:", err.stack);
    console.error("=== END ERROR ===");

    return res.status(500).json({
      error: "Internal server error",
      details: err.message,
      name: err.name,
    });
  }
}
</file>

<file path="src/pages/api/salons/bookings/today.js">
import { connectToDatabase } from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { db } = await connectToDatabase();
    const { salonId } = req.query;

    if (!salonId) {
      return res.status(400).json({ message: "Salon ID required" });
    }

    // ✅ define today BEFORE using it
    // get today in local timezone as YYYY-MM-DD
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    const todayStr = `${yyyy}-${mm}-${dd}`;

    console.log("Fetching bookings for salon:", salonId, "date:", todayStr);

    const bookings = await db
      .collection("bookings")
      .find({
        salonId: salonId,
        date: todayStr,
        status: { $ne: "cancelled" },
      })
      .sort({ time: 1 })
      .toArray();

    res.status(200).json({
      success: true,
      bookings,
    });
  } catch (error) {
    console.error("Error fetching today's bookings:", error);
    // expose real error while debugging
    res.status(500).json({ message: error.message, stack: error.stack });
  }
}
</file>

<file path="src/pages/api/salons/bookings/update-status.js">
//pages/api/salons/bookings/today.js
import { connectToDatabase } from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "PUT") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { db } = await connectToDatabase();
    const { bookingId, status } = req.body;

    if (!bookingId || !status) {
      return res
        .status(400)
        .json({ message: "Booking ID and status required" });
    }

    const result = await db.collection("bookings").updateOne(
      { _id: new ObjectId(bookingId) },
      {
        $set: {
          status,
          updatedAt: new Date(),
        },
      }
    );

    if (result.matchedCount === 0) {
      return res.status(404).json({ message: "Booking not found" });
    }

    res.status(200).json({
      success: true,
      message: "Booking status updated successfully",
    });
  } catch (error) {
    console.error("Error updating booking status:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/index.js">
// pages/api/salons/index.js
import { connectToDatabase } from "../../../lib/mongodb";

export default async function handler(req, res) {
  try {
    const { db } = await connectToDatabase();
    const salons = await db.collection("salons").find({}).toArray();
    console.log("Salons fetched from DB:", salons); // debug
    res.status(200).json({ success: true, salons });
  } catch (error) {
    console.error("Error fetching salons:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/profile.js">
// pages/api/salons/profile.js
import clientPromise from "../../../lib/mongodb";

export default async function handler(req, res) {
  try {
    const client = await clientPromise;
    const db = client.db("techtrims");
    const salon = await db.collection("salons").findOne({});
    res.status(200).json(salon);
  } catch (e) {
    console.error(e);
    res.status(500).json({ error: "Failed to load salon profile" });
  }
}
</file>

<file path="src/pages/api/salons/services/[id].js">
// pages/api/salons/services/[id].js
import { connectToDatabase } from "../../../../lib/mongodb";
import Service from "../../../../models/Service";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const { id } = req.query;

  try {
    if (method === "GET") {
      const s = await Service.findById(id);
      if (!s) return res.status(404).json({ error: "Not found" });
      return res.status(200).json(s);
    }
    if (method === "PUT") {
      const update = req.body;
      const s = await Service.findByIdAndUpdate(id, update, { new: true });
      return res.status(200).json(s);
    }
    if (method === "DELETE") {
      await Service.findByIdAndDelete(id);
      return res.status(204).end();
    }
    return res.setHeader("Allow", ["GET", "PUT", "DELETE"]).status(405).end();
  } catch (err) {
    console.error("api/services/[id] error", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/services/index.js">
// pages/api/salons/services/index.js
import { connectToDatabase } from "../../../../lib/mongodb";
import Service from "../../../../models/Service";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const salonId = req.query.salonId || req.body.salonId;
  if (!salonId) return res.status(400).json({ error: "salonId required" });

  try {
    if (method === "GET") {
      const items = await Service.find({ salonId }).sort({ title: 1 });
      return res.status(200).json(items);
    }
    if (method === "POST") {
      const payload = { ...req.body, salonId };
      const s = new Service(payload);
      await s.save();
      return res.status(201).json(s);
    }
    return res.setHeader("Allow", ["GET", "POST"]).status(405).end();
  } catch (err) {
    console.error("api/services error", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/staff/[id].js">
// pages/api/salons/staff/[id].js
import { connectToDatabase } from "../../../../lib/mongodb";
import Staff from "../../../../models/Staff";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const { id } = req.query;

  try {
    if (method === "GET") {
      const s = await Staff.findById(id);
      if (!s) return res.status(404).json({ error: "Not found" });
      return res.status(200).json(s);
    }
    if (method === "PUT") {
      const update = req.body;
      const s = await Staff.findByIdAndUpdate(id, update, { new: true });
      return res.status(200).json(s);
    }
    if (method === "DELETE") {
      await Staff.findByIdAndDelete(id);
      return res.status(204).end();
    }
    return res.setHeader("Allow", ["GET", "PUT", "DELETE"]).status(405).end();
  } catch (err) {
    console.error("api/staff/[id] error", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/staff/index.js">
// pages/api/salons/staff/index.js
import { connectToDatabase } from "../../../../lib/mongodb";
import Staff from "../../../../models/Staff";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const salonId = req.query.salonId || req.body.salonId;

  if (!salonId) return res.status(400).json({ error: "salonId required" });

  try {
    if (method === "GET") {
      const items = await Staff.find({ salonId }).sort({ name: 1 });
      return res.status(200).json(items);
    }
    if (method === "POST") {
      const payload = { ...req.body, salonId };
      const st = new Staff(payload);
      await st.save();
      return res.status(201).json(st);
    }

    return res.setHeader("Allow", ["GET", "POST"]).status(405).end();
  } catch (err) {
    console.error("api/staff error", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/user/bookings.js">
import clientPromise from "../../../lib/mongodb";
import { verifyToken } from "../../../lib/auth";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const token = req.headers.authorization?.replace("Bearer ", "");
    console.log("User bookings API - Token received:", token ? "YES" : "NO");

    if (!token) {
      return res.status(401).json({ message: "No token provided" });
    }

    const decoded = verifyToken(token);
    console.log("User bookings API - Decoded token:", decoded);

    if (!decoded || !decoded.userId) {
      return res.status(401).json({ message: "Invalid token" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");

    const user = await db
      .collection("users")
      .findOne({ _id: new ObjectId(decoded.userId) });
    console.log("User bookings API - Found user:", user ? "YES" : "NO");
    console.log("User phone:", user?.phone);
    console.log("User name:", user?.name);

    if (!user) {
      return res.status(404).json({ message: "User not found" });
    }

    // Debug: Check all bookings first
    const allBookings = await db.collection("bookings").find({}).toArray();
    console.log("Total bookings in database:", allBookings.length);
    console.log("Sample booking:", allBookings[0]);

    // Try multiple search strategies
    const searchQueries = [
      { userId: new ObjectId(decoded.userId) },
      { customerPhone: user.phone },
      { customerName: user.name },
    ];

    console.log("Search queries:", searchQueries);

    // Get bookings by phone number or userId
    const bookings = await db
      .collection("bookings")
      .find({
        $or: searchQueries,
      })
      .sort({ createdAt: -1 })
      .toArray();

    console.log("Found bookings for user:", bookings.length);
    console.log("Bookings:", bookings);

    // Get salon names for bookings
    // If no bookings found, try fallback searches
    let finalBookings = bookings;

    if (bookings.length === 0) {
      console.log(
        "No bookings found with standard search, trying fallback searches..."
      );

      // Try searching by partial phone match
      const phoneSearch = await db
        .collection("bookings")
        .find({ customerPhone: { $regex: user.phone.slice(-10) } })
        .toArray();
      console.log("Phone fallback search found:", phoneSearch.length);

      // Try searching by partial name match
      const nameSearch = await db
        .collection("bookings")
        .find({ customerName: { $regex: user.name, $options: "i" } })
        .toArray();
      console.log("Name fallback search found:", nameSearch.length);

      finalBookings = [...phoneSearch, ...nameSearch];

      // Remove duplicates
      finalBookings = finalBookings.filter(
        (booking, index, self) =>
          index ===
          self.findIndex((b) => b._id.toString() === booking._id.toString())
      );
    }

    // Get salon names for bookings
    const bookingsWithSalons = await Promise.all(
      finalBookings.map(async (booking) => {
        let salonName = "Unknown Salon";
        if (booking.salonId) {
          try {
            const salonObjectId =
              typeof booking.salonId === "string"
                ? new ObjectId(booking.salonId)
                : booking.salonId;

            const salon = await db
              .collection("salons")
              .findOne(
                { _id: salonObjectId },
                { projection: { salonName: 1, "salonDetails.name": 1 } }
              );
            salonName =
              salon?.salonName || salon?.salonDetails?.name || "Unknown Salon";
          } catch (error) {
            console.error(
              "Error fetching salon for booking:",
              booking._id,
              error
            );
          }
        }

        return {
          ...booking,
          _id: booking._id.toString(),
          salonName,
        };
      })
    );

    console.log("Final bookings with salon names:", bookingsWithSalons.length);
    res.status(200).json(bookingsWithSalons);
  } catch (error) {
    console.error("User bookings API error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/user/payments.js">
import clientPromise from "../../../lib/mongodb";
import { verifyToken } from "../../../lib/auth";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const token = req.headers.authorization?.replace("Bearer ", "");
    if (!token) {
      return res.status(401).json({ message: "No token provided" });
    }

    const decoded = verifyToken(token);
    if (!decoded || !decoded.userId) {
      return res.status(401).json({ message: "Invalid token" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");

    // Get user's bookings first
    const user = await db
      .collection("users")
      .findOne({ _id: new ObjectId(decoded.userId) });
    if (!user) {
      return res.status(404).json({ message: "User not found" });
    }

    // Get payments from bookings (since payment data is stored in bookings)
    const bookings = await db
      .collection("bookings")
      .find({
        $or: [
          { userId: new ObjectId(decoded.userId) },
          { customerPhone: user.phone },
        ],
        price: { $gt: 0 }, // Only bookings with payment
      })
      .sort({ createdAt: -1 })
      .toArray();

    // Transform bookings to payment format
    const payments = bookings.map((booking) => ({
      _id: booking._id,
      amount: booking.price || 0,
      bookingId: booking._id,
      status: booking.paymentStatus || "pending",
      createdAt: booking.createdAt,
      service: booking.service,
      date: booking.date,
    }));

    res.status(200).json(payments);
  } catch (error) {
    console.error("User payments API error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/user/profile.js">
import clientPromise from "../../../lib/mongodb";
import { verifyToken } from "../../../lib/auth";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const token = req.headers.authorization?.replace("Bearer ", "");
    if (!token) {
      return res.status(401).json({ message: "No token provided" });
    }

    const decoded = verifyToken(token);
    if (!decoded || !decoded.userId) {
      return res.status(401).json({ message: "Invalid token" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");

    const user = await db
      .collection("users")
      .findOne(
        { _id: new ObjectId(decoded.userId) },
        { projection: { hashedPassword: 0 } }
      );

    if (!user) {
      return res.status(404).json({ message: "User not found" });
    }

    res.status(200).json(user);
  } catch (error) {
    console.error("Profile API error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/user/register.js">
// pages/api/users/register.js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ message: "Method not allowed" });
  try {
    const body = req.body || {};
    const { name, mobile, email, gender, location } = body;
    if (!mobile || !name) return res.status(400).json({ message: "Missing name or mobile" });

    const { db } = await connectToDatabase();
    let existing = await db.collection("users").findOne({ mobile });
    if (existing) {
      return res.status(200).json({ message: "User exists", userId: existing._id });
    }

    const userDoc = {
      name,
      mobile,
      email: email || null,
      gender: gender || "other",
      location: location || null,
      bookingHistory: [],
      createdAt: new Date()
    };

    const r = await db.collection("users").insertOne(userDoc);
    return res.status(201).json({ userId: r.insertedId });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ message: e.message });
  }
}
</file>

<file path="src/pages/api/user/sync-booking-history.js">
import clientPromise from "../../../lib/mongodb";
import { verifyToken } from "../../../lib/auth";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const token = req.headers.authorization?.replace("Bearer ", "");
    if (!token) {
      return res.status(401).json({ message: "No token provided" });
    }

    const decoded = verifyToken(token);
    if (!decoded || !decoded.userId) {
      return res.status(401).json({ message: "Invalid token" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");

    const user = await db
      .collection("users")
      .findOne({ _id: new ObjectId(decoded.userId) });
    if (!user) {
      return res.status(404).json({ message: "User not found" });
    }

    // Find all bookings for this user
    const allBookings = await db
      .collection("bookings")
      .find({
        $or: [
          { userId: new ObjectId(decoded.userId) },
          { customerPhone: user.phone },
          { customerName: { $regex: user.name, $options: "i" } },
        ],
      })
      .toArray();

    // Update bookings with userId if not set
    const bookingsToUpdate = allBookings.filter((b) => !b.userId);
    if (bookingsToUpdate.length > 0) {
      await db
        .collection("bookings")
        .updateMany(
          { _id: { $in: bookingsToUpdate.map((b) => b._id) } },
          { $set: { userId: new ObjectId(decoded.userId) } }
        );
    }

    // Update user's booking history
    const bookingIds = allBookings.map((b) => b._id);
    await db.collection("users").updateOne(
      { _id: new ObjectId(decoded.userId) },
      {
        $set: {
          bookingHistory: bookingIds,
          updatedAt: new Date(),
        },
      }
    );

    res.status(200).json({
      message: "Booking history synced successfully",
      totalBookings: allBookings.length,
      newlyLinked: bookingsToUpdate.length,
    });
  } catch (error) {
    console.error("Sync booking history error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/auth/salon/login.js">
import { useState } from "react";
import { useRouter } from "next/router";
import styles from "../../../styles/Auth.module.css";

export default function SalonLogin() {
  const router = useRouter();
  const [formData, setFormData] = useState({
    email: "",
    password: "",
  });
  const [isLoading, setIsLoading] = useState(false);

  const handleLogin = async (e) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      const response = await fetch("/api/auth/salon/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      const data = await response.json();

      if (response.ok) {
        // Store salon session
        localStorage.setItem("salonSession", JSON.stringify(data.salon));
        localStorage.setItem("salonToken", data.token);
        router.push("/salons/dashboard");
      } else {
        alert(data.message || "Login failed");
      }
    } catch (error) {
      alert("Login error: " + error.message);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.loginCard}>
        <h1>Salon Owner Login</h1>
        <form onSubmit={handleLogin}>
          <input
            type="email"
            placeholder="Email"
            value={formData.email}
            onChange={(e) =>
              setFormData({ ...formData, email: e.target.value })
            }
            required
          />
          <input
            type="password"
            placeholder="Password"
            value={formData.password}
            onChange={(e) =>
              setFormData({ ...formData, password: e.target.value })
            }
            required
          />
          <button type="submit" disabled={isLoading}>
            {isLoading ? "Logging in..." : "Login"}
          </button>
        </form>
        <p>
          Don&#39;t have an account?
          <a onClick={() => router.push("/auth/salon/register")}>
            {" "}
            Register here
          </a>
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/auth/salon/register.js">
import SalonRegisterForm from "../../../components/Salon/SalonRegisterForm";

export default function SalonRegisterPage() {
  return (
    <div style={{ padding: "2rem" }}>
      <h1>Register Your Salon</h1>
      <SalonRegisterForm />
    </div>
  );
}
</file>

<file path="src/pages/auth/user/login.js">
import { useState } from "react";
import { useRouter } from "next/router";
import styles from "../../../styles/Auth.module.css";

export default function UserLoginPage() {
  const router = useRouter();
  const [formData, setFormData] = useState({
    email: "",
    password: "",
  });
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState("");

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);
    setError("");

    try {
      const response = await fetch("/api/auth/user/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (response.ok) {
        const result = await response.json();

        // Store token and user info
        localStorage.setItem("userToken", result.token);
        localStorage.setItem("userData", JSON.stringify(result.user));

        alert(`Welcome back, ${result.user.name}!`);
        router.push("/user/dashboard");
      } else {
        const error = await response.json();
        setError(error.message || "Login failed");
      }
    } catch (error) {
      console.error("Login error:", error);
      setError("Network error. Please try again.");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.authCard}>
        <div className={styles.header}>
          <button
            onClick={() => router.push("/")}
            className={styles.backButton}
          >
            ← Back to Home
          </button>
        </div>

        <h1 className={styles.title}>Welcome Back</h1>
        <p className={styles.subtitle}>Login to your TechTrims account</p>

        {error && (
          <div className={styles.error}>
            <span>⚠️ {error}</span>
          </div>
        )}

        <form onSubmit={handleSubmit} className={styles.form}>
          <div className={styles.formGroup}>
            <label htmlFor="email">Email Address</label>
            <input
              id="email"
              type="email"
              placeholder="Enter your email"
              value={formData.email}
              onChange={(e) =>
                setFormData({ ...formData, email: e.target.value })
              }
              required
            />
          </div>

          <div className={styles.formGroup}>
            <label htmlFor="password">Password</label>
            <input
              id="password"
              type="password"
              placeholder="Enter your password"
              value={formData.password}
              onChange={(e) =>
                setFormData({ ...formData, password: e.target.value })
              }
              required
            />
          </div>

          <button
            type="submit"
            className={styles.submitButton}
            disabled={isLoading}
          >
            {isLoading ? (
              <>
                <span className={styles.spinner}></span>
                Logging in...
              </>
            ) : (
              "Login"
            )}
          </button>
        </form>

        <div className={styles.authLinks}>
          <p className={styles.authLink}>
            Don&#39;t have an account?{" "}
            <button
              type="button"
              onClick={() => router.push("/auth/user/register")}
              className={styles.linkButton}
            >
              Create Account
            </button>
          </p>

          <div className={styles.divider}>
            <span>or</span>
          </div>

          <p className={styles.authLink}>
            Are you a salon owner?{" "}
            <button
              type="button"
              onClick={() => router.push("/auth/salon/login")}
              className={styles.linkButton}
            >
              Login as Salon
            </button>
          </p>
        </div>

        {/* Demo credentials for testing */}
        <div className={styles.demoInfo}>
          <h4>Demo Account:</h4>
          <p>Email: demo@gmail.com</p>
          <p>Password: demo123</p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/auth/user/register.js">
import { useState, useEffect } from "react";
import { useRouter } from "next/router";
import styles from "../../../styles/Auth.module.css";

export default function UserRegisterPage() {
  const router = useRouter();
  const [formData, setFormData] = useState({
    name: "",
    email: "",
    phone: "",
    gender: "",
    password: "",
  });
  const [prefillData, setPrefillData] = useState(null);
  const [isLoading, setIsLoading] = useState(false);

  useEffect(() => {
    // Check for prefill data from feedback or onboarding
    const onboardingData = localStorage.getItem("userOnboardingData");
    const savedPrefillData = localStorage.getItem("userPrefillData");

    console.log("Checking localStorage data:");
    console.log("onboardingData:", onboardingData);
    console.log("savedPrefillData:", savedPrefillData);

    let prefillInfo = null;
    if (savedPrefillData) {
      try {
        const data = JSON.parse(savedPrefillData);
        console.log("Parsed prefill data:", data);

        prefillInfo = {
          name: data.name || "",
          phone: data.phone || "",
          gender: data.gender || "",
          lastBooking: data.lastBooking || {},
          source: "feedback",
        };
        setPrefillData(prefillInfo);
        setFormData((prev) => ({
          ...prev,
          name: data.name || prev.name,
          phone: data.phone || prev.phone,
        }));
      } catch (error) {
        console.error("Error parsing prefill data:", error);
      }
    } else if (onboardingData) {
      try {
        const data = JSON.parse(onboardingData);
        prefillInfo = {
          name: data.name || "",
          gender: data.gender || "",
          location: data.location || null,
          source: "onboarding",
        };

        setPrefillData(prefillInfo);
        setFormData((prev) => ({
          ...prev,
          name: data.name || prev.name,
          phone: data.phone || prev.phone,
        }));
      } catch (error) {
        console.error("Error parsing prefill data:", error);
      }
    }
  }, []);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      const response = await fetch("/api/auth/user/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (response.ok) {
        const result = await response.json();
        localStorage.setItem("userToken", result.token);
        localStorage.removeItem("userPrefillData");
        localStorage.removeItem("userOnboardingData");
        alert("Registration successful! Welcome to TechTrims!");
        router.push("/user/dashboard");
      } else {
        const error = await response.json();
        alert(`Registration failed: ${error.message}`);
      }
    } catch (error) {
      console.error("Registration error:", error);
      alert("Registration failed. Please try again.");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.authCard}>
        <h1 className={styles.title}>Create Account</h1>

        {prefillData && (
          <div className={styles.prefillInfo}>
            <h3>Complete your registration</h3>
            <p>
              {prefillData.source === "onboarding"
                ? "Based on your preferences"
                : `From your recent booking${
                    prefillData.lastBooking
                      ? ` on ${prefillData.lastBooking}`
                      : ""
                  }`}
            </p>
          </div>
        )}

        <form onSubmit={handleSubmit} className={styles.form}>
          <div className={styles.formGroup}>
            <input
              type="text"
              placeholder="Full Name"
              value={formData.name}
              onChange={(e) =>
                setFormData({ ...formData, name: e.target.value })
              }
              required
            />
          </div>

          <div className={styles.formGroup}>
            <input
              type="email"
              placeholder="Email Address"
              value={formData.email}
              onChange={(e) =>
                setFormData({ ...formData, email: e.target.value })
              }
              required
            />
          </div>

          <div className={styles.formGroup}>
            <input
              type="tel"
              placeholder="Phone Number"
              value={formData.phone}
              onChange={(e) =>
                setFormData({ ...formData, phone: e.target.value })
              }
              required
            />
          </div>

          <div className={styles.formGroup}>
            <select
              value={formData.gender}
              onChange={(e) =>
                setFormData({ ...formData, gender: e.target.value })
              }
              required
            >
              <option value="">Select Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div className={styles.formGroup}>
            <input
              type="password"
              placeholder="Password (min 6 characters)"
              value={formData.password}
              onChange={(e) =>
                setFormData({ ...formData, password: e.target.value })
              }
              required
            />
          </div>

          <button
            type="submit"
            className={styles.submitButton}
            disabled={isLoading}
          >
            {isLoading ? "Creating Account..." : "Create Account"}
          </button>
        </form>

        <p className={styles.authLink}>
          Already have an account?{" "}
          <button
            type="button"
            onClick={() => router.push("/auth/user/login")}
            className={styles.linkButton}
          >
            Login here
          </button>
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/bookings/[id].js">
// pages/salons/bookings/[id].jsx
import { useEffect, useState } from "react";
import { useRouter } from "next/router";

export default function BookingDetailPage() {
  const router = useRouter();
  const { id } = router.query;

  const [booking, setBooking] = useState(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);
  const [error, setError] = useState("");
  const [form, setForm] = useState({
    customerName: "",
    customerPhone: "",
    serviceId: "",
    appointmentAt: "",
    status: "",
  });

  // Fetch booking data
  useEffect(() => {
    if (!id) return;
    const fetchBooking = async () => {
      setLoading(true);
      try {
        const res = await fetch(`/api/salons/bookings/${id}`);
        if (!res.ok) throw new Error("Booking not found");
        const data = await res.json();
        setBooking(data);
        setForm({
          customerName: data.customerName || "",
          customerPhone: data.customerPhone || "",
          serviceId: data.serviceId || "",
          appointmentAt: data.appointmentAt
            ? new Date(data.appointmentAt).toISOString().slice(0, 16)
            : "",
          status: data.status || "pending",
        });
      } catch (err) {
        console.error(err);
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };
    fetchBooking();
  }, [id]);

  // Update booking
  const handleUpdate = async (e) => {
    e.preventDefault();
    setSaving(true);
    setError("");
    try {
      const res = await fetch(`/api/salons/bookings/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(form),
      });
      if (!res.ok) {
        const err = await res.json();
        throw new Error(err.error || "Update failed");
      }
      const updated = await res.json();
      setBooking(updated);
      alert("Booking updated successfully!");
    } catch (err) {
      console.error(err);
      setError(err.message);
    } finally {
      setSaving(false);
    }
  };

  // Delete booking
  const handleDelete = async () => {
    if (!confirm("Are you sure you want to delete this booking?")) return;
    setDeleting(true);
    setError("");
    try {
      const res = await fetch(`/api/salons/bookings/${id}`, {
        method: "DELETE",
      });
      if (!res.ok) throw new Error("Delete failed");
      alert("Booking deleted successfully!");
      router.push("/salons/bookings"); // redirect to booking list
    } catch (err) {
      console.error(err);
      setError(err.message);
    } finally {
      setDeleting(false);
    }
  };

  if (loading) return <p className="p-4">Loading booking...</p>;
  if (!booking)
    return <p className="p-4 text-red-500">{error || "Booking not found"}</p>;

  return (
    <div className="p-6 max-w-xl mx-auto space-y-6">
      <h1 className="text-2xl font-bold">Booking Details</h1>

      {error && <p className="text-red-500">{error}</p>}

      <form
        onSubmit={handleUpdate}
        className="grid gap-4 bg-white p-6 rounded shadow-md"
      >
        <div>
          <label className="block font-semibold">Customer Name</label>
          <input
            type="text"
            value={form.customerName}
            onChange={(e) => setForm({ ...form, customerName: e.target.value })}
            required
            className="w-full border rounded px-3 py-2"
          />
        </div>

        <div>
          <label className="block font-semibold">Customer Phone</label>
          <input
            type="text"
            value={form.customerPhone}
            onChange={(e) =>
              setForm({ ...form, customerPhone: e.target.value })
            }
            required
            className="w-full border rounded px-3 py-2"
          />
        </div>

        <div>
          <label className="block font-semibold">Service ID</label>
          <input
            type="text"
            value={form.serviceId}
            onChange={(e) => setForm({ ...form, serviceId: e.target.value })}
            required
            className="w-full border rounded px-3 py-2"
          />
        </div>

        <div>
          <label className="block font-semibold">Appointment Date & Time</label>
          <input
            type="datetime-local"
            value={form.appointmentAt}
            onChange={(e) =>
              setForm({ ...form, appointmentAt: e.target.value })
            }
            required
            className="w-full border rounded px-3 py-2"
          />
        </div>

        <div>
          <label className="block font-semibold">Status</label>
          <select
            value={form.status}
            onChange={(e) => setForm({ ...form, status: e.target.value })}
            className="w-full border rounded px-3 py-2"
          >
            <option value="pending">Pending</option>
            <option value="confirmed">Confirmed</option>
            <option value="completed">Completed</option>
            <option value="canceled">Canceled</option>
          </select>
        </div>

        <div className="flex justify-between items-center mt-4">
          <button
            type="submit"
            disabled={saving}
            className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50"
          >
            {saving ? "Saving..." : "Update Booking"}
          </button>
          <button
            type="button"
            onClick={handleDelete}
            disabled={deleting}
            className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 disabled:opacity-50"
          >
            {deleting ? "Deleting..." : "Delete Booking"}
          </button>
        </div>
      </form>

      <div className="bg-gray-50 p-4 rounded shadow">
        <h2 className="font-semibold mb-2">Current Booking Info:</h2>
        <pre className="text-sm">{JSON.stringify(booking, null, 2)}</pre>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/bookings/index.js">
// src/pages/salons/bookings/index.jsx
import { useEffect, useState } from "react";
import { useRouter } from "next/router";

export default function BookingsPage() {
  const router = useRouter();
  const { salonId } = router.query; // salonId passed via query param
  const [bookings, setBookings] = useState([]);
  const [loading, setLoading] = useState(false);
  const [form, setForm] = useState({
    customerName: "",
    customerPhone: "",
    serviceId: "",
    appointmentAt: "",
  });

  // fetch bookings
  useEffect(() => {
    if (!salonId) return;
    setLoading(true);
    fetch(`/api/salons/bookings?salonId=${salonId}`)
      .then((res) => res.json())
      .then((data) => {
        setBookings(data);
        setLoading(false);
      })
      .catch(() => setLoading(false));
  }, [salonId]);

  // submit booking
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!salonId) return alert("No salon selected");

    const res = await fetch(`/api/salons/bookings?salonId=${salonId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(form),
    });

    if (res.ok) {
      const newBooking = await res.json();
      setBookings((prev) => [...prev, newBooking]);
      setForm({
        customerName: "",
        customerPhone: "",
        serviceId: "",
        appointmentAt: "",
      });
    } else {
      const err = await res.json();
      alert(err.error || "Failed to create booking");
    }
  };

  return (
    <div style={{ padding: "2rem" }}>
      <h1>Bookings</h1>

      {/* Add Booking Form */}
      <form
        onSubmit={handleSubmit}
        style={{
          marginBottom: "2rem",
          display: "grid",
          gap: "0.5rem",
          maxWidth: "400px",
        }}
      >
        <input
          type="text"
          placeholder="Customer Name"
          value={form.customerName}
          onChange={(e) => setForm({ ...form, customerName: e.target.value })}
          required
        />
        <input
          type="text"
          placeholder="Customer Phone"
          value={form.customerPhone}
          onChange={(e) => setForm({ ...form, customerPhone: e.target.value })}
          required
        />
        <input
          type="text"
          placeholder="Service ID"
          value={form.serviceId}
          onChange={(e) => setForm({ ...form, serviceId: e.target.value })}
          required
        />
        <input
          type="datetime-local"
          value={form.appointmentAt}
          onChange={(e) => setForm({ ...form, appointmentAt: e.target.value })}
          required
        />
        <button type="submit">Add Booking</button>
      </form>

      {/* Booking List */}
      {loading ? (
        <p>Loading...</p>
      ) : bookings.length === 0 ? (
        <p>No bookings yet.</p>
      ) : (
        <table
          border="1"
          cellPadding="8"
          style={{ borderCollapse: "collapse" }}
        >
          <thead>
            <tr>
              <th>Customer</th>
              <th>Phone</th>
              <th>Service</th>
              <th>Appointment</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {bookings.map((b) => (
              <tr key={b._id}>
                <td>{b.customerName}</td>
                <td>{b.customerPhone}</td>
                <td>{b.serviceId}</td>
                <td>{new Date(b.appointmentAt).toLocaleString()}</td>
                <td>{b.status || "pending"}</td>
              </tr>
            ))}
          </tbody>
        </table>
      )}
    </div>
  );
}
</file>

<file path="src/pages/salons/profile.js">
// pages/salons/profile.js
import { useEffect, useState } from "react";
import OwnerSidebar from "../../components/OwnerSidebar";

export default function SalonProfilePage() {
  const [salon, setSalon] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function fetchSalon() {
      try {
        const res = await fetch("/api/salons/profile");
        if (!res.ok) throw new Error("Failed to fetch salon profile");
        const data = await res.json();
        setSalon(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }
    fetchSalon();
  }, []);

  return (
    <div className="flex">
      <OwnerSidebar />

      <main className="flex-1 p-6">
        <h1 className="text-3xl font-bold mb-6">Salon Profile</h1>

        {salon && (
          <div className="bg-white shadow rounded-lg p-6 space-y-4">
            <h2 className="text-2xl font-semibold">{salon.salonName}</h2>
            <p>
              <strong>Owner:</strong> {salon.ownerName}
            </p>
            <p>
              <strong>Email:</strong> {salon.email}
            </p>
            <p>
              <strong>Phone:</strong> {salon.phone}
            </p>
            <p>
              <strong>Status:</strong>{" "}
              {salon.isActive ? "✅ Active" : "❌ Inactive"}
            </p>
            <p>
              <strong>Verified:</strong> {salon.isVerified ? "✅ Yes" : "❌ No"}
            </p>
            <p>
              <strong>Amenities:</strong>{" "}
              {salon.amenities?.length
                ? salon.amenities.join(", ")
                : "Not listed"}
            </p>
            <p>
              <strong>Created At:</strong>{" "}
              {new Date(salon.createdAt).toLocaleString()}
            </p>
          </div>
        )}
      </main>
    </div>
  );
}
</file>

<file path="src/pages/salons/register.js">
// pages/salons/register.js
import React from "react";
import SalonRegisterForm from "../../components/Salon/SalonRegisterForm";

const SalonRegisterPage = () => {
  return (
    <div>
      <SalonRegisterForm />
    </div>
  );
};

export default SalonRegisterPage;
</file>

<file path="src/pages/salons/services/[id].js">
// pages/salons/services/[id].jsx
import { useRouter } from "next/router";
import { useEffect, useState } from "react";
import axios from "axios";

export default function ServicePage() {
  const router = useRouter();
  const { id } = router.query;

  const [service, setService] = useState(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [error, setError] = useState("");

  // Fetch the service by ID
  useEffect(() => {
    if (!id) return;

    const fetchService = async () => {
      setLoading(true);
      try {
        const res = await axios.get(`/api/salons/services/${id}`);
        setService(res.data);
        setError("");
      } catch (err) {
        console.error(err);
        setError("Failed to fetch service");
      }
      setLoading(false);
    };

    fetchService();
  }, [id]); // ✅ only depends on `id`

  // Handle form changes
  const handleChange = (e) => {
    const { name, value } = e.target;
    setService({ ...service, [name]: value });
  };

  // Save updated service
  const handleSave = async () => {
    if (!service) return;
    setSaving(true);
    try {
      const res = await axios.put(`/api/salons/services/${id}`, service);
      setService(res.data);
      setError("");
      alert("Service updated successfully!");
    } catch (err) {
      console.error(err);
      setError("Failed to update service");
    }
    setSaving(false);
  };

  // Delete service
  const handleDelete = async () => {
    if (!window.confirm("Are you sure you want to delete this service?"))
      return;
    try {
      await axios.delete(`/api/salons/services/${id}`);
      alert("Service deleted successfully!");
      router.push("/salons/services"); // Redirect after deletion
    } catch (err) {
      console.error(err);
      setError("Failed to delete service");
    }
  };

  if (loading) return <p>Loading service...</p>;
  if (!service) return <p>No service found.</p>;

  return (
    <div className="max-w-2xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-4">Edit Service</h1>
      {error && <p className="text-red-500 mb-4">{error}</p>}

      <div className="mb-4">
        <label className="block font-medium">Name:</label>
        <input
          type="text"
          name="name"
          value={service.name || ""}
          onChange={handleChange}
          className="w-full border rounded px-3 py-2 mt-1"
        />
      </div>

      <div className="mb-4">
        <label className="block font-medium">Description:</label>
        <textarea
          name="description"
          value={service.description || ""}
          onChange={handleChange}
          className="w-full border rounded px-3 py-2 mt-1"
        />
      </div>

      <div className="mb-4">
        <label className="block font-medium">Price:</label>
        <input
          type="number"
          name="price"
          value={service.price || 0}
          onChange={handleChange}
          className="w-full border rounded px-3 py-2 mt-1"
        />
      </div>

      <div className="flex gap-4">
        <button
          onClick={handleSave}
          disabled={saving}
          className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >
          {saving ? "Saving..." : "Save Changes"}
        </button>
        <button
          onClick={handleDelete}
          className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
        >
          Delete Service
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/services/index.js">
// pages/salons/[salonId]/services.jsx
import { useEffect, useState } from "react";
import { useRouter } from "next/router";
import axios from "axios";
import Link from "next/link";

export default function SalonServicesPage() {
  const router = useRouter();
  const { salonId } = router.query;

  const [services, setServices] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");
  const [newService, setNewService] = useState({
    title: "",
    description: "",
    price: 0,
  });
  const [creating, setCreating] = useState(false);

  // Fetch services
  useEffect(() => {
    if (!salonId) return;

    const fetchServices = async () => {
      setLoading(true);
      try {
        const res = await axios.get(`/api/salons/services?salonId=${salonId}`);
        setServices(res.data);
        setError("");
      } catch (err) {
        console.error(err);
        setError("Failed to fetch services");
      }
      setLoading(false);
    };

    fetchServices();
  }, [salonId]);

  // Handle input changes
  const handleChange = (e) => {
    const { name, value } = e.target;
    setNewService({ ...newService, [name]: value });
  };

  // Create new service
  const handleCreate = async () => {
    if (!newService.title) return alert("Title is required");
    setCreating(true);
    try {
      const res = await axios.post("/api/salons/services", {
        ...newService,
        salonId,
      });
      setServices([...services, res.data]);
      setNewService({ title: "", description: "", price: 0 });
      setError("");
    } catch (err) {
      console.error(err);
      setError("Failed to create service");
    }
    setCreating(false);
  };

  if (loading) return <p className="p-6">Loading services...</p>;

  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">Services for Salon {salonId}</h1>

      {error && <p className="text-red-500 mb-4">{error}</p>}

      {/* New Service Form */}
      <div className="mb-8 p-4 border rounded shadow">
        <h2 className="text-xl font-semibold mb-2">Add New Service</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input
            type="text"
            name="title"
            placeholder="Title"
            value={newService.title}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="number"
            name="price"
            placeholder="Price"
            value={newService.price}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="text"
            name="description"
            placeholder="Description"
            value={newService.description}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
        </div>
        <button
          onClick={handleCreate}
          disabled={creating}
          className="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
        >
          {creating ? "Creating..." : "Add Service"}
        </button>
      </div>

      {/* Services List */}
      <div>
        <h2 className="text-xl font-semibold mb-2">Existing Services</h2>
        {services.length === 0 ? (
          <p>No services yet.</p>
        ) : (
          <div className="overflow-x-auto">
            <table className="min-w-full border rounded">
              <thead className="bg-gray-100">
                <tr>
                  <th className="px-4 py-2 border">Title</th>
                  <th className="px-4 py-2 border">Description</th>
                  <th className="px-4 py-2 border">Price</th>
                  <th className="px-4 py-2 border">Actions</th>
                </tr>
              </thead>
              <tbody>
                {services.map((s) => (
                  <tr key={s._id} className="hover:bg-gray-50">
                    <td className="px-4 py-2 border">{s.title}</td>
                    <td className="px-4 py-2 border">{s.description}</td>
                    <td className="px-4 py-2 border">{s.price}</td>
                    <td className="px-4 py-2 border">
                      <Link
                        href={`/salons/services/${s._id}`}
                        className="text-blue-600 hover:underline mr-3"
                      >
                        Edit
                      </Link>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/staff/[id].js">
// pages/salons/staff/[id].js
import { useRouter } from "next/router";
import { useEffect, useState } from "react";

export default function StaffPage() {
  const router = useRouter();
  const { id } = router.query;

  const [staff, setStaff] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!id) return;
    const fetchStaff = async () => {
      try {
        const res = await fetch(`/api/salons/staff/${id}`);
        if (!res.ok) throw new Error("Failed to fetch staff");
        const data = await res.json();
        setStaff(data);
      } catch (err) {
        console.error(err);
      } finally {
        setLoading(false);
      }
    };
    fetchStaff();
  }, [id]);

  if (loading) return <p>Loading...</p>;
  if (!staff) return <p>Staff not found</p>;

  return (
    <div>
      <h1>{staff.name}</h1>
      <p>Email: {staff.email}</p>
      <p>Role: {staff.role}</p>
    </div>
  );
}
</file>

<file path="src/pages/salons/staff/index.js">
// pages/salons/[salonId]/staff.jsx
import { useEffect, useState } from "react";
import { useRouter } from "next/router";
import axios from "axios";
import Link from "next/link";

export default function SalonStaffPage() {
  const router = useRouter();
  const { salonId } = router.query;

  const [staffList, setStaffList] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");
  const [newStaff, setNewStaff] = useState({
    name: "",
    email: "",
    phone: "",
    role: "",
  });
  const [creating, setCreating] = useState(false);

  // Fetch staff
  useEffect(() => {
    if (!salonId) return;

    const fetchStaff = async () => {
      setLoading(true);
      try {
        const res = await axios.get(`/api/salons/staff?salonId=${salonId}`);
        setStaffList(res.data);
        setError("");
      } catch (err) {
        console.error(err);
        setError("Failed to fetch staff");
      }
      setLoading(false);
    };

    fetchStaff();
  }, [salonId]);

  // Handle input changes
  const handleChange = (e) => {
    const { name, value } = e.target;
    setNewStaff({ ...newStaff, [name]: value });
  };

  // Create new staff
  const handleCreate = async () => {
    if (!newStaff.name) return alert("Name is required");
    setCreating(true);
    try {
      const res = await axios.post("/api/salons/staff", {
        ...newStaff,
        salonId,
      });
      setStaffList([...staffList, res.data]);
      setNewStaff({ name: "", email: "", phone: "", role: "" });
      setError("");
    } catch (err) {
      console.error(err);
      setError("Failed to create staff");
    }
    setCreating(false);
  };

  if (loading) return <p className="p-6">Loading staff...</p>;

  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">Staff for Salon {salonId}</h1>

      {error && <p className="text-red-500 mb-4">{error}</p>}

      {/* New Staff Form */}
      <div className="mb-8 p-4 border rounded shadow">
        <h2 className="text-xl font-semibold mb-2">Add New Staff</h2>
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <input
            type="text"
            name="name"
            placeholder="Name"
            value={newStaff.name}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="email"
            name="email"
            placeholder="Email"
            value={newStaff.email}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="text"
            name="phone"
            placeholder="Phone"
            value={newStaff.phone}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="text"
            name="role"
            placeholder="Role"
            value={newStaff.role}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
        </div>
        <button
          onClick={handleCreate}
          disabled={creating}
          className="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
        >
          {creating ? "Adding..." : "Add Staff"}
        </button>
      </div>

      {/* Staff List */}
      <div>
        <h2 className="text-xl font-semibold mb-2">Existing Staff</h2>
        {staffList.length === 0 ? (
          <p>No staff yet.</p>
        ) : (
          <div className="overflow-x-auto">
            <table className="min-w-full border rounded">
              <thead className="bg-gray-100">
                <tr>
                  <th className="px-4 py-2 border">Name</th>
                  <th className="px-4 py-2 border">Email</th>
                  <th className="px-4 py-2 border">Phone</th>
                  <th className="px-4 py-2 border">Role</th>
                  <th className="px-4 py-2 border">Actions</th>
                </tr>
              </thead>
              <tbody>
                {staffList.map((st) => (
                  <tr key={st._id} className="hover:bg-gray-50">
                    <td className="px-4 py-2 border">{st.name}</td>
                    <td className="px-4 py-2 border">{st.email}</td>
                    <td className="px-4 py-2 border">{st.phone}</td>
                    <td className="px-4 py-2 border">{st.role}</td>
                    <td className="px-4 py-2 border">
                      <Link
                        href={`/salons/staff/${st._id}`}
                        className="text-blue-600 hover:underline"
                      >
                        Edit
                      </Link>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/pages/styles/globals.css">
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  /* Light Mode Colors */
  --gold-primary: #d4af37;
  --gold-dark: #b8941f;
  --gold-light: #f5e99b;
  --contrast-dark: #1a1a1a;
  --contrast-medium: #333333;
  --contrast-light: #666666;
  --background-primary: #ffffff;
  --background-secondary: #f8f8f8;
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --border-color: #e5e5e5;
  --success: #22c55e;
  --error: #ef4444;
  --warning: #f59e0b;

  /* Dark Mode Colors */
  --dark-gold-primary: #ffd700;
  --dark-gold-dark: #e6c200;
  --dark-gold-light: #fff4b3;
  --dark-contrast-dark: #ffffff;
  --dark-contrast-medium: #cccccc;
  --dark-contrast-light: #999999;
  --dark-background-primary: #121212;
  --dark-background-secondary: #1e1e1e;
  --dark-text-primary: #ffffff;
  --dark-text-secondary: #cccccc;
  --dark-border-color: #333333;
}

[data-theme="dark"] {
  --gold-primary: var(--dark-gold-primary);
  --gold-dark: var(--dark-gold-dark);
  --gold-light: var(--dark-gold-light);
  --contrast-dark: var(--dark-contrast-dark);
  --contrast-medium: var(--dark-contrast-medium);
  --contrast-light: var(--dark-contrast-light);
  --background-primary: var(--dark-background-primary);
  --background-secondary: var(--dark-background-secondary);
  --text-primary: var(--dark-text-primary);
  --text-secondary: var(--dark-text-secondary);
  --border-color: var(--dark-border-color);
}

html,
body {
  font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
    sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--background-primary);
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Luxury scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--background-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--gold-primary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--gold-dark);
}

/* Common button styles */
.btn {
  padding: 12px 24px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.btn-secondary {
  background: transparent;
  color: var(--text-primary);
  border: 2px solid var(--border-color);
}

.btn-secondary:hover {
  border-color: var(--gold-primary);
  color: var(--gold-primary);
}

/* Form styles */
.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--text-primary);
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background-color: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
}

.form-select {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background-color: var(--background-primary);
  color: var(--text-primary);
  cursor: pointer;
}

/* Card styles */
.card {
  background: var(--background-primary);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

/* Animation keyframes */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes shimmer {
  0% {
    background-position: -200px 0;
  }
  100% {
    background-position: calc(200px + 100%) 0;
  }
}

.animate-fadeIn {
  animation: fadeIn 0.6s ease-out;
}

.animate-slideIn {
  animation: slideIn 0.6s ease-out;
}

/* Luxury gold gradient text */
.gold-gradient-text {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Loading spinner */
.spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--border-color);
  border-top: 3px solid var(--gold-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .btn {
    width: 100%;
    padding: 14px 20px;
  }

  .card {
    padding: 20px;
    margin-bottom: 16px;
  }

  .form-input,
  .form-select {
    font-size: 18px; /* Prevents zoom on iOS */
  }
}
</file>

<file path="src/pages/styles/Home.module.css">
.container {
  min-height: 100vh;
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
}

.loadingContainer {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--border-color);
  border-top: 4px solid var(--gold-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

/* Header */
.header {
  background: var(--background-primary);
  border-bottom: 1px solid var(--border-color);
  padding: 16px 0;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
}

.headerContent {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
}

.goldText {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.headerActions {
  display: flex;
  align-items: center;
  gap: 16px;
}

.themeToggle {
  padding: 8px;
  border: none;
  background: transparent;
  border-radius: 8px;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.3s ease;
}

.themeToggle:hover {
  background: var(--background-secondary);
}

.ownerButton {
  padding: 10px 20px;
  background: transparent;
  color: var(--gold-primary);
  border: 2px solid var(--gold-primary);
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.ownerButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.loginButton {
  padding: 10px 20px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.loginButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

/* Welcome Section */
.welcomeSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px 40px;
  text-align: center;
}

.welcomeContent {
  margin-bottom: 40px;
}

.welcomeTitle {
  font-size: 48px;
  font-weight: 700;
  margin-bottom: 16px;
  color: var(--text-primary);
  line-height: 1.2;
}

.welcomeSubtitle {
  font-size: 18px;
  color: var(--text-secondary);
  margin-bottom: 0;
}

.quickStats {
  display: flex;
  justify-content: center;
  gap: 60px;
  margin-top: 40px;
}

.stat {
  text-align: center;
}

.statNumber {
  display: block;
  font-size: 32px;
  font-weight: 700;
  color: var(--gold-primary);
  margin-bottom: 4px;
}

.statLabel {
  font-size: 14px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Search Section */
.searchSection {
  max-width: 800px;
  margin: 0 auto;
  padding: 0 20px 40px;
}

.searchContainer {
  text-align: center;
}

.searchBox {
  position: relative;
  margin-bottom: 24px;
}

.searchInput {
  width: 100%;
  padding: 16px 60px 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: 50px;
  font-size: 16px;
  background: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.searchInput:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
}

.searchButton {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 44px;
  height: 44px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 18px;
  transition: all 0.3s ease;
}

.searchButton:hover {
  transform: translateY(-50%) scale(1.05);
}

.quickFilters {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}

.filterChip {
  padding: 8px 16px;
  background: var(--background-primary);
  border: 2px solid var(--border-color);
  border-radius: 25px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.filterChip:hover {
  border-color: var(--gold-primary);
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

/* Services Section */
.servicesSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px;
}

.sectionTitle {
  font-size: 32px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 40px;
  color: var(--text-primary);
}

.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 24px;
}

.serviceCard {
  background: var(--background-primary);
  border-radius: 16px;
  padding: 32px 24px;
  text-align: center;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  cursor: pointer;
}

.serviceCard:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  border-color: var(--gold-primary);
}

.serviceIcon {
  font-size: 48px;
  margin-bottom: 16px;
}

.serviceName {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.servicePrice {
  font-size: 24px;
  font-weight: 700;
  color: var(--gold-primary);
  margin-bottom: 4px;
}

.serviceDuration {
  font-size: 14px;
  color: var(--text-secondary);
}

/* Salons Section */
.salonsSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px;
}

.sectionHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
}

.viewAllButton {
  padding: 10px 20px;
  background: transparent;
  color: var(--gold-primary);
  border: 2px solid var(--gold-primary);
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.viewAllButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.salonsCarousel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
}

.salonCard {
  background: var(--background-primary);
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  cursor: pointer;
}

.salonCard:hover {
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  border-color: var(--gold-primary);
}

.salonImage {
  position: relative;
  height: 200px;
  overflow: hidden;
}

.salonImage img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.salonCard:hover .salonImage img {
  transform: scale(1.05);
}

.salonBadge {
  position: absolute;
  top: 12px;
  right: 12px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.salonInfo {
  padding: 20px;
}

.salonName {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
  color: var(--text-primary);
}

.salonLocation {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 12px;
}

.salonStats {
  display: flex;
  gap: 16px;
  margin-bottom: 16px;
}

.rating,
.bookings {
  font-size: 14px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 4px;
}

.rating {
  color: var(--gold-primary);
  font-weight: 600;
}

.salonServices {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
}

.serviceTag {
  background: var(--background-secondary);
  color: var(--text-secondary);
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  white-space: nowrap;
}

.bookButton {
  width: 100%;
  padding: 12px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.bookButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

/* Footer */
.footer {
  background: var(--contrast-dark);
  color: var(--background-primary);
  padding: 60px 0 20px;
  margin-top: 80px;
}

.footerContent {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 40px;
}

.footerSection h4 {
  color: var(--gold-primary);
  font-size: 24px;
  margin-bottom: 16px;
}

.footerSection h5 {
  color: var(--background-primary);
  font-size: 18px;
  margin-bottom: 12px;
}

.footerSection ul {
  list-style: none;
  padding: 0;
}

.footerSection ul li {
  margin-bottom: 8px;
}

.footerSection ul li a {
  color: var(--contrast-light);
  text-decoration: none;
  transition: color 0.3s ease;
}

.footerSection ul li a:hover {
  color: var(--gold-primary);
}

.footerBottom {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  text-align: center;
  border-top: 1px solid var(--contrast-medium);
  margin-top: 40px;
}

.loadingSalons {
  text-align: center;
  padding: 60px 20px;
}

.loadingSalons p {
  margin-top: 16px;
  color: var(--text-secondary);
}

.noSalons {
  text-align: center;
  padding: 60px 20px;
  background: var(--background-secondary);
  border-radius: 16px;
}

.noSalons p {
  color: var(--text-secondary);
  font-size: 16px;
  margin-bottom: 24px;
}

.registerSalonButton {
  padding: 12px 24px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.registerSalonButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.distanceBadge {
  position: absolute;
  top: 12px;
  left: 12px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 10px;
  font-weight: 600;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
  .headerContent {
    padding: 0 16px;
  }

  .headerActions {
    gap: 8px;
  }

  .ownerButton,
  .loginButton {
    padding: 8px 12px;
    font-size: 14px;
  }

  .welcomeTitle {
    font-size: 32px;
  }

  .quickStats {
    gap: 30px;
  }

  .statNumber {
    font-size: 24px;
  }

  .servicesGrid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
  }

  .serviceCard {
    padding: 24px 16px;
  }

  .salonsCarousel {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .sectionHeader {
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }

  .footerContent {
    grid-template-columns: 1fr;
    gap: 30px;
    text-align: center;
  }
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
</file>

<file path="src/pages/styles/Onboarding.module.css">
.container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  position: relative;
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
}

.background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: 0;
}

.goldOrb {
  position: absolute;
  border-radius: 50%;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  opacity: 0.1;
  filter: blur(60px);
}

.goldOrb:first-child {
  width: 300px;
  height: 300px;
  top: -150px;
  right: -150px;
  animation: float 8s ease-in-out infinite;
}

.goldOrb:last-child {
  width: 200px;
  height: 200px;
  bottom: -100px;
  left: -100px;
  animation: float 8s ease-in-out infinite reverse;
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-20px) rotate(180deg);
  }
}

.onboardingCard {
  background: var(--background-primary);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
  padding: 40px;
  width: 100%;
  max-width: 500px;
  position: relative;
  z-index: 1;
  border: 1px solid var(--border-color);
}

.header {
  text-align: center;
  margin-bottom: 40px;
}

.title {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.goldText {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.subtitle {
  color: var(--text-secondary);
  font-size: 16px;
  margin-bottom: 30px;
}

.progressBar {
  display: flex;
  align-items: center;
  gap: 12px;
}

.progressTrack {
  flex: 1;
  height: 6px;
  background: var(--border-color);
  border-radius: 3px;
  overflow: hidden;
}

.progressFill {
  height: 100%;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  border-radius: 3px;
  transition: width 0.3s ease;
}

.progressText {
  font-size: 14px;
  font-weight: 600;
  color: var(--gold-primary);
  min-width: 30px;
}

.stepContent {
  min-height: 300px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.step {
  text-align: center;
}

.stepIcon {
  font-size: 64px;
  margin-bottom: 24px;
}

.step h2 {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text-primary);
}

.step p {
  color: var(--text-secondary);
  margin-bottom: 32px;
  line-height: 1.5;
}

.formGroup {
  margin-bottom: 24px;
}

.input {
  width: 100%;
  padding: 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  font-size: 16px;
  background: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
  text-align: center;
}

.input:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
}

.genderOptions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 16px;
  margin-bottom: 20px;
}

.genderButton {
  padding: 20px 16px;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  background: var(--background-primary);
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.genderButton:hover {
  border-color: var(--gold-primary);
  transform: translateY(-2px);
}

.genderButton.selected {
  border-color: var(--gold-primary);
  background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
  color: var(--contrast-dark);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3);
}

.genderIcon {
  font-size: 32px;
}

.genderButton span {
  font-weight: 600;
  font-size: 14px;
}

.locationSection {
  margin-bottom: 20px;
}

.locationButton {
  width: 100%;
  padding: 16px 20px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 20px;
}

.locationButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.divider {
  text-align: center;
  margin: 20px 0;
  position: relative;
}

.divider::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--border-color);
}

.divider span {
  background: var(--background-primary);
  padding: 0 16px;
  color: var(--text-secondary);
  font-size: 14px;
  position: relative;
  z-index: 1;
}

.loadingLocation {
  text-align: center;
  padding: 40px 20px;
}

.loadingLocation p {
  margin-top: 16px;
  color: var(--text-secondary);
}

.locationSuccess {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  background: rgba(34, 197, 94, 0.1);
  border: 2px solid var(--success);
  border-radius: 12px;
}

.locationIcon {
  font-size: 24px;
}

.locationSuccess div {
  flex: 1;
}

.locationSuccess h4 {
  color: var(--success);
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 4px;
}

.locationSuccess p {
  color: var(--text-secondary);
  font-size: 14px;
  margin: 0;
}

.changeLocationButton {
  padding: 8px 16px;
  background: transparent;
  color: var(--gold-primary);
  border: 1px solid var(--gold-primary);
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.changeLocationButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.locationError {
  text-align: center;
}

.locationError p {
  color: var(--error);
  margin-bottom: 16px;
}

.navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 40px;
  gap: 16px;
}

.backButton {
  padding: 12px 24px;
  background: transparent;
  color: var(--text-secondary);
  border: 2px solid var(--border-color);
  border-radius: 12px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.backButton:hover {
  border-color: var(--gold-primary);
  color: var(--gold-primary);
}

.nextButton {
  flex: 1;
  padding: 14px 28px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.nextButton:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.nextButton:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Mobile Optimizations */
@media (max-width: 768px) {
  .container {
    padding: 16px;
  }

  .onboardingCard {
    padding: 24px;
    border-radius: 16px;
  }

  .title {
    font-size: 28px;
  }

  .step h2 {
    font-size: 20px;
  }

  .stepIcon {
    font-size: 48px;
  }

  .genderOptions {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .genderButton {
    flex-direction: row;
    justify-content: flex-start;
    padding: 16px 20px;
  }

  .navigation {
    flex-direction: column;
    gap: 12px;
  }

  .backButton {
    width: 100%;
    order: 2;
  }

  .nextButton {
    order: 1;
  }
}
</file>

<file path="src/pages/styles/Owner.module.css">
.dashboard {
  display: flex;
  min-height: 100vh;
  background: #f5f7fa;
}

.content {
  flex: 1;
  padding: 30px;
  margin-left: 250px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.header h1 {
  font-size: 2rem;
  color: #333;
}

.date {
  color: #666;
  font-size: 1.1rem;
}

.statsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
  margin-bottom: 40px;
}

.statCard {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.statCard h3 {
  color: #666;
  font-size: 0.95rem;
  margin-bottom: 10px;
  font-weight: normal;
}

.statNumber {
  font-size: 2.5rem;
  font-weight: bold;
  color: #333;
  margin-bottom: 10px;
}

.statSubtext {
  color: #999;
  font-size: 0.9rem;
}

.upcomingSection,
.notifications,
.quickActions {
  background: white;
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 25px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.appointmentList {
  margin-top: 20px;
}

.appointmentCard {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  margin-bottom: 12px;
}

.appointmentCard:hover {
  background: #f8f9fa;
}

.time {
  font-weight: bold;
  color: #667eea;
  font-size: 1.1rem;
  min-width: 80px;
}

.customerInfo {
  flex: 1;
  margin-left: 20px;
}

.customerInfo strong {
  display: block;
  margin-bottom: 5px;
}

.customerInfo span {
  color: #666;
  font-size: 0.9rem;
}

.barber {
  color: #999;
  font-size: 0.9rem;
  margin-right: 15px;
}

.actionBtn {
  background: #667eea;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 0.9rem;
}

.actionGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.actionButton {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 10px;
  font-size: 1rem;
  transition: transform 0.2s;
}

.actionButton:hover {
  transform: scale(1.05);
}

.notificationList {
  margin-top: 20px;
}

.notification {
  display: flex;
  align-items: start;
  padding: 15px;
  border-bottom: 1px solid #e0e0e0;
}

.notification:last-child {
  border-bottom: none;
}

.notifIcon {
  font-size: 1.5rem;
  margin-right: 15px;
}

.notifContent {
  flex: 1;
}

.notifContent strong {
  display: block;
  margin-bottom: 5px;
}

.notifContent p {
  color: #666;
  font-size: 0.9rem;
  margin-bottom: 5px;
}

.notifTime {
  color: #999;
  font-size: 0.85rem;
}

/* Forms */
.formOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.formModal {
  background: white;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
}

.formGroup {
  margin-bottom: 20px;
}

.formGroup label {
  display: block;
  margin-bottom: 8px;
  color: #333;
  font-weight: 500;
}

.formGroup input,
.formGroup textarea,
.formGroup select {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
}

.formRow {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
}

.formActions {
  display: flex;
  gap: 15px;
  margin-top: 25px;
}

.saveBtn {
  flex: 1;
  padding: 12px;
  background: #667eea;
  color: white;
  border-radius: 6px;
  font-size: 1rem;
}

.cancelBtn {
  flex: 1;
  padding: 12px;
  background: #e0e0e0;
  color: #333;
  border-radius: 6px;
  font-size: 1rem;
}

.addButton {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 1rem;
}

/* Services */
.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.serviceCard {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.serviceHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.genderBadge {
  background: #f0f0f0;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  color: #666;
}

.serviceDesc {
  color: #666;
  margin-bottom: 15px;
  min-height: 40px;
}

.serviceDetails {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
  padding-top: 15px;
  border-top: 1px solid #f0f0f0;
}

.serviceActions {
  display: flex;
  gap: 10px;
}

.editBtn,
.deleteBtn {
  flex: 1;
  padding: 8px;
  border-radius: 6px;
  font-size: 0.9rem;
}

.editBtn {
  background: #f0f0f0;
  color: #333;
}

.deleteBtn {
  background: #fee;
  color: #c00;
}

.packagesSection {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.addPackageBtn {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  margin-top: 15px;
}

.packageList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.packageCard {
  border: 2px solid #667eea;
  border-radius: 10px;
  padding: 20px;
  background: linear-gradient(
    135deg,
    rgba(102, 126, 234, 0.1) 0%,
    rgba(118, 75, 162, 0.1) 100%
  );
}

.packagePrice {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 15px;
}

.originalPrice {
  text-decoration: line-through;
  color: #999;
}

.discountPrice {
  font-size: 1.5rem;
  font-weight: bold;
  color: #667eea;
}
</file>

<file path="src/styles/Auth.module.css">
.container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.loginCard {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 400px;
}

.loginCard h1 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: #333;
}

.loginCard form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.loginCard input {
  padding: 12px;
  border: 2px solid #e1e5e9;
  border-radius: 8px;
  font-size: 16px;
}

.loginCard input:focus {
  outline: none;
  border-color: #667eea;
}

.loginCard button {
  background: #667eea;
  color: white;
  border: none;
  padding: 12px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s;
}

.loginCard button:hover:not(:disabled) {
  background: #5a6fd8;
}

.loginCard button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.loginCard p {
  text-align: center;
  margin-top: 1rem;
}

.loginCard a {
  color: #667eea;
  cursor: pointer;
  text-decoration: underline;
}
</file>

<file path="src/styles/Booking.module.css">
/* styles/Booking.module.css - replace broken CSS with this clear, modular style set */

/* Overlay for modal */
.modalOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

/* Modal content */
.modalContent {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  min-width: 320px;
  max-width: 560px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

/* Buttons */
.confirmButton {
  background: #0b76ef;
  color: #fff;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}
.cancelButton {
  background: #eee;
  color: #333;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}
.bookNowButton {
  background: #0b76ef;
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
}

/* Time slots grid */
.timeSlotsWrapper {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

/* Each slot */
.timeSlot {
  border: 1px solid #ddd;
  padding: 8px 10px;
  border-radius: 6px;
  margin: 4px;
  cursor: pointer;
  min-width: 90px;
  text-align: center;
  user-select: none;
  transition: transform 0.12s ease, box-shadow 0.12s ease;
  background: #fff;
}

/* Hover effect */
.timeSlot:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.06);
}

/* Disabled / unavailable slot */
.timeSlot.disabled {
  opacity: 0.5;
  pointer-events: none;
  transform: none;
  box-shadow: none;
}

/* Selected slot */
.timeSlot.selected {
  border-color: #0b76ef;
  background: rgba(11, 118, 239, 0.08);
  color: #0b76ef;
  font-weight: 600;
}
</file>

<file path="src/styles/Onboarding.module.css">
.container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  position: relative;
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
}

.background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: 0;
}

.goldOrb {
  position: absolute;
  border-radius: 50%;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  opacity: 0.1;
  filter: blur(60px);
}

.goldOrb:first-child {
  width: 300px;
  height: 300px;
  top: -150px;
  right: -150px;
  animation: float 8s ease-in-out infinite;
}

.goldOrb:last-child {
  width: 200px;
  height: 200px;
  bottom: -100px;
  left: -100px;
  animation: float 8s ease-in-out infinite reverse;
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-20px) rotate(180deg);
  }
}

.onboardingCard {
  background: var(--background-primary);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
  padding: 40px;
  width: 100%;
  max-width: 500px;
  position: relative;
  z-index: 1;
  border: 1px solid var(--border-color);
}

.header {
  text-align: center;
  margin-bottom: 40px;
}

.title {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.goldText {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.subtitle {
  color: var(--text-secondary);
  font-size: 16px;
  margin-bottom: 30px;
}

.progressBar {
  display: flex;
  align-items: center;
  gap: 12px;
}

.progressTrack {
  flex: 1;
  height: 6px;
  background: var(--border-color);
  border-radius: 3px;
  overflow: hidden;
}

.progressFill {
  height: 100%;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  border-radius: 3px;
  transition: width 0.3s ease;
}

.progressText {
  font-size: 14px;
  font-weight: 600;
  color: var(--gold-primary);
  min-width: 30px;
}

.stepContent {
  min-height: 300px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.step {
  text-align: center;
}

.stepIcon {
  font-size: 64px;
  margin-bottom: 24px;
}

.step h2 {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text-primary);
}

.step p {
  color: var(--text-secondary);
  margin-bottom: 32px;
  line-height: 1.5;
}

.formGroup {
  margin-bottom: 24px;
}

.input {
  width: 100%;
  padding: 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  font-size: 16px;
  background: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
  text-align: center;
}

.input:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
}

.genderOptions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 16px;
  margin-bottom: 20px;
}

.genderButton {
  padding: 20px 16px;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  background: var(--background-primary);
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.genderButton:hover {
  border-color: var(--gold-primary);
  transform: translateY(-2px);
}

.genderButton.selected {
  border-color: var(--gold-primary);
  background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
  color: var(--contrast-dark);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3);
}

.genderIcon {
  font-size: 32px;
}

.genderButton span {
  font-weight: 600;
  font-size: 14px;
}

.locationSection {
  margin-bottom: 20px;
}

.locationButton {
  width: 100%;
  padding: 16px 20px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 20px;
}

.locationButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.divider {
  text-align: center;
  margin: 20px 0;
  position: relative;
}

.divider::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--border-color);
}

.divider span {
  background: var(--background-primary);
  padding: 0 16px;
  color: var(--text-secondary);
  font-size: 14px;
  position: relative;
  z-index: 1;
}

.loadingLocation {
  text-align: center;
  padding: 40px 20px;
}

.loadingLocation p {
  margin-top: 16px;
  color: var(--text-secondary);
}

.locationSuccess {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  background: rgba(34, 197, 94, 0.1);
  border: 2px solid var(--success);
  border-radius: 12px;
}

.locationIcon {
  font-size: 24px;
}

.locationSuccess div {
  flex: 1;
}

.locationSuccess h4 {
  color: var(--success);
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 4px;
}

.locationSuccess p {
  color: var(--text-secondary);
  font-size: 14px;
  margin: 0;
}

.changeLocationButton {
  padding: 8px 16px;
  background: transparent;
  color: var(--gold-primary);
  border: 1px solid var(--gold-primary);
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.changeLocationButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.locationError {
  text-align: center;
}

.locationError p {
  color: var(--error);
  margin-bottom: 16px;
}

.navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 40px;
  gap: 16px;
}

.backButton {
  padding: 12px 24px;
  background: transparent;
  color: var(--text-secondary);
  border: 2px solid var(--border-color);
  border-radius: 12px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.backButton:hover {
  border-color: var(--gold-primary);
  color: var(--gold-primary);
}

.nextButton {
  flex: 1;
  padding: 14px 28px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.nextButton:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.nextButton:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Mobile Optimizations */
@media (max-width: 768px) {
  .container {
    padding: 16px;
  }

  .onboardingCard {
    padding: 24px;
    border-radius: 16px;
  }

  .title {
    font-size: 28px;
  }

  .step h2 {
    font-size: 20px;
  }

  .stepIcon {
    font-size: 48px;
  }

  .genderOptions {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .genderButton {
    flex-direction: row;
    justify-content: flex-start;
    padding: 16px 20px;
  }

  .navigation {
    flex-direction: column;
    gap: 12px;
  }

  .backButton {
    width: 100%;
    order: 2;
  }

  .nextButton {
    order: 1;
  }
}
</file>

<file path="src/styles/Owner.module.css">
.dashboard {
  display: flex;
  min-height: 100vh;
  background: #f5f7fa;
}

.content {
  flex: 1;
  padding: 30px;
  margin-left: 250px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.header h1 {
  font-size: 2rem;
  color: #333;
}

.date {
  color: #666;
  font-size: 1.1rem;
}

.statsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
  margin-bottom: 40px;
}

.statCard {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.statCard h3 {
  color: #666;
  font-size: 0.95rem;
  margin-bottom: 10px;
  font-weight: normal;
}

.statNumber {
  font-size: 2.5rem;
  font-weight: bold;
  color: #333;
  margin-bottom: 10px;
}

.statSubtext {
  color: #999;
  font-size: 0.9rem;
}

.upcomingSection,
.notifications,
.quickActions {
  background: white;
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 25px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.appointmentList {
  margin-top: 20px;
}

.appointmentCard {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  margin-bottom: 12px;
}

.appointmentCard:hover {
  background: #f8f9fa;
}

.time {
  font-weight: bold;
  color: #667eea;
  font-size: 1.1rem;
  min-width: 80px;
}

.customerInfo {
  flex: 1;
  margin-left: 20px;
}

.customerInfo strong {
  display: block;
  margin-bottom: 5px;
}

.customerInfo span {
  color: #666;
  font-size: 0.9rem;
}

.barber {
  color: #999;
  font-size: 0.9rem;
  margin-right: 15px;
}

.actionBtn {
  background: #667eea;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 0.9rem;
}

.actionGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.actionButton {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 10px;
  font-size: 1rem;
  transition: transform 0.2s;
}

.actionButton:hover {
  transform: scale(1.05);
}

.notificationList {
  margin-top: 20px;
}

.notification {
  display: flex;
  align-items: start;
  padding: 15px;
  border-bottom: 1px solid #e0e0e0;
}

.notification:last-child {
  border-bottom: none;
}

.notifIcon {
  font-size: 1.5rem;
  margin-right: 15px;
}

.notifContent {
  flex: 1;
}

.notifContent strong {
  display: block;
  margin-bottom: 5px;
}

.notifContent p {
  color: #666;
  font-size: 0.9rem;
  margin-bottom: 5px;
}

.notifTime {
  color: #999;
  font-size: 0.85rem;
}

/* Forms */
.formOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.formModal {
  background: white;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
}

.formGroup {
  margin-bottom: 20px;
}

.formGroup label {
  display: block;
  margin-bottom: 8px;
  color: #333;
  font-weight: 500;
}

.formGroup input,
.formGroup textarea,
.formGroup select {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
}

.formRow {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
}

.formActions {
  display: flex;
  gap: 15px;
  margin-top: 25px;
}

.saveBtn {
  flex: 1;
  padding: 12px;
  background: #667eea;
  color: white;
  border-radius: 6px;
  font-size: 1rem;
}

.cancelBtn {
  flex: 1;
  padding: 12px;
  background: #e0e0e0;
  color: #333;
  border-radius: 6px;
  font-size: 1rem;
}

.addButton {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 1rem;
}

/* Services */
.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.serviceCard {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.serviceHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.genderBadge {
  background: #f0f0f0;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  color: #666;
}

.serviceDesc {
  color: #666;
  margin-bottom: 15px;
  min-height: 40px;
}

.serviceDetails {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
  padding-top: 15px;
  border-top: 1px solid #f0f0f0;
}

.serviceActions {
  display: flex;
  gap: 10px;
}

.editBtn,
.deleteBtn {
  flex: 1;
  padding: 8px;
  border-radius: 6px;
  font-size: 0.9rem;
}

.editBtn {
  background: #f0f0f0;
  color: #333;
}

.deleteBtn {
  background: #fee;
  color: #c00;
}

.packagesSection {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.addPackageBtn {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  margin-top: 15px;
}

.packageList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.packageCard {
  border: 2px solid #667eea;
  border-radius: 10px;
  padding: 20px;
  background: linear-gradient(
    135deg,
    rgba(102, 126, 234, 0.1) 0%,
    rgba(118, 75, 162, 0.1) 100%
  );
}

.packagePrice {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 15px;
}

.originalPrice {
  text-decoration: line-through;
  color: #999;
}

.discountPrice {
  font-size: 1.5rem;
  font-weight: bold;
  color: #667eea;
}
</file>

<file path="src/styles/SalonDetails.module.css">
.container {
  min-height: 100vh;
  background: linear-gradient(135deg, #fef3c7, #fed7aa);
}

.header {
  display: flex;
  align-items: center;
  padding: 20px;
  background: white;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 100;
}

.backBtn {
  background: #f59e0b;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  margin-right: 20px;
}

.heroSection {
  position: relative;
  padding: 40px 20px;
}

.imageGallery {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto 30px;
  border-radius: 20px;
  overflow: hidden;
}

.heroImage {
  width: 100%;
  height: 400px;
  object-fit: cover;
}

.heroContent {
  max-width: 1200px;
  margin: 0 auto;
}

.salonInfo {
  background: white;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.salonName {
  font-size: 32px;
  font-weight: 700;
  color: #1f2937;
  margin: 0 0 10px;
}

.address {
  color: #6b7280;
  font-size: 16px;
  margin: 0 0 20px;
}

.badges {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.badge {
  background: #f59e0b;
  color: white;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
}

.stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.stat {
  text-align: center;
  padding: 20px;
  background: #fef3c7;
  border-radius: 12px;
}

.statNumber {
  display: block;
  font-size: 24px;
  font-weight: 700;
  color: #d97706;
  margin-bottom: 5px;
}

.statLabel {
  font-size: 14px;
  color: #92400e;
}

.actionButtons {
  display: flex;
  gap: 15px;
}

.bookButton {
  flex: 1;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.bookButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
}

.directionsButton {
  background: white;
  color: #f59e0b;
  border: 2px solid #f59e0b;
  padding: 15px 20px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.directionsButton:hover {
  background: #f59e0b;
  color: white;
}

.servicesSection {
  padding: 40px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.servicesSection h2 {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 30px;
  text-align: center;
}

.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.serviceCard {
  background: white;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 15px;
}

.serviceCard:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.serviceIcon {
  font-size: 32px;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fef3c7;
  border-radius: 12px;
}

.serviceDetails h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 5px;
}

.serviceDetails p {
  color: #6b7280;
  font-size: 14px;
  margin: 0 0 10px;
}

.serviceMeta {
  display: flex;
  gap: 15px;
}

.price {
  font-size: 16px;
  font-weight: 700;
  color: #f59e0b;
}

.duration {
  font-size: 14px;
  color: #6b7280;
}

.locationSection {
  padding: 40px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.locationSection h2 {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 20px;
  text-align: center;
}

.reviewsSection {
  padding: 40px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.reviewsSection h2 {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 30px;
  text-align: center;
}

.reviewsList {
  display: grid;
  gap: 20px;
}

.reviewCard {
  background: white;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.reviewHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.userName {
  font-weight: 600;
  color: #1f2937;
}

.rating {
  color: #f59e0b;
  font-weight: 600;
}

.reviewComment {
  color: #4b5563;
  margin: 10px 0;
  line-height: 1.6;
}

.reviewMeta {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  color: #6b7280;
}

.noReviews {
  text-align: center;
  color: #6b7280;
  font-style: italic;
  padding: 40px;
}

.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.bookingModal {
  background: white;
  padding: 30px;
  border-radius: 20px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  position: relative;
  max-height: 90vh;
  overflow-y: auto;
  animation: fadeInScale 0.3s ease-out;
}
@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.closeModalBtn {
  position: absolute;
  top: 15px;
  right: 15px;
  background: #f59e0b;
  color: white;
  border: none;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
.closeModalBtn:hover {
  background: #d97706;
}
.mapContainer {
  position: relative;
  height: 600px;
  margin-top: 40px;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
  background: white;
  padding: 20px;
  box-sizing: border-box;
  margin-bottom: 60px;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  border: 2px solid #f3f4f6;
  background: #f9fafb;
  border-radius: 20px;
}
</file>

<file path="src/styles/User.module.css">
.dashboard {
  display: flex;
  min-height: 100vh;
  background-color: #f8fafc;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

.sidebar {
  width: 280px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 2rem;
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
}

.userProfile {
  text-align: center;
  margin-bottom: 2rem;
  padding-bottom: 1rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2);
}

.userProfile h2 {
  margin: 0 0 0.5rem 0;
  font-size: 1.25rem;
}

.userProfile p {
  margin: 0;
  opacity: 0.8;
  font-size: 0.9rem;
}

.nav {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-bottom: 2rem;
}

.navItem {
  display: block;
  width: 100%;
  padding: 1rem;
  text-align: left;
  border: none;
  background: none;
  color: white;
  cursor: pointer;
  border-radius: 8px;
  transition: all 0.2s;
  font-size: 0.95rem;
}

.navItem:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

.navItem.active {
  background-color: rgba(255, 255, 255, 0.2);
  transform: translateX(4px);
}

.logoutButton {
  width: 100%;
  padding: 1rem;
  border: none;
  background-color: rgba(220, 53, 69, 0.8);
  color: white;
  border-radius: 8px;
  cursor: pointer;
  font-size: 0.95rem;
  transition: background-color 0.2s;
}

.logoutButton:hover {
  background-color: rgba(200, 35, 51, 0.9);
}

.content {
  flex: 1;
  padding: 2rem;
  overflow-y: auto;
}

.loading {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  font-size: 1.1rem;
}

.error {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  color: #dc3545;
}

.overview h1,
.bookings h1,
.payments h1,
.feedback h1,
.profile h1 {
  margin: 0 0 2rem 0;
  color: #1a202c;
  font-size: 2rem;
  font-weight: 700;
}

.stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 3rem;
}

.statCard {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  text-align: center;
  border-left: 4px solid #667eea;
}

.statCard h3 {
  margin: 0 0 1rem 0;
  color: #718096;
  font-size: 0.9rem;
  font-weight: 500;
}

.statCard p {
  margin: 0;
  font-size: 2.5rem;
  font-weight: bold;
  color: #667eea;
}

.recentSection {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.recentSection h2 {
  margin: 0 0 1rem 0;
  color: #2d3748;
  font-size: 1.25rem;
}

.bookingsList,
.paymentsList,
.feedbackList {
  display: grid;
  gap: 1rem;
}

.bookingCard,
.paymentCard,
.feedbackCard {
  background: white;
  padding: 1.5rem;
  border-radius: 12px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  border: 1px solid #e2e8f0;
  transition: transform 0.2s, box-shadow 0.2s;
}

.bookingCard:hover,
.paymentCard:hover,
.feedbackCard:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
}

.bookingHeader,
.paymentHeader,
.feedbackHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.bookingHeader h3,
.paymentHeader h3,
.feedbackHeader h3 {
  margin: 0;
  color: #2d3748;
  font-size: 1.1rem;
}

.statusBadge {
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.statusBadge.confirmed {
  background-color: #bee3f8;
  color: #2b6cb0;
}

.statusBadge.completed {
  background-color: #c6f6d5;
  color: #2f855a;
}

.statusBadge.cancelled {
  background-color: #fed7d7;
  color: #c53030;
}

.statusBadge.pending {
  background-color: #fef5e7;
  color: #d69e2e;
}

.bookingDetails,
.paymentDetails,
.feedbackDetails {
  color: #4a5568;
  line-height: 1.6;
}

.bookingDetails p,
.paymentDetails p,
.feedbackDetails p {
  margin: 0.5rem 0;
}

.feedbackButton,
.bookNowButton {
  margin-top: 1rem;
  padding: 0.5rem 1rem;
  background-color: #667eea;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: background-color 0.2s;
}

.feedbackButton:hover,
.bookNowButton:hover {
  background-color: #5a67d8;
}

.emptyState {
  text-align: center;
  padding: 3rem;
  color: #718096;
}

.emptyState p {
  font-size: 1.1rem;
  margin-bottom: 1rem;
}

.profileCard {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.profileForm {
  display: grid;
  gap: 1.5rem;
}

.formGroup {
  display: flex;
  flex-direction: column;
}

.formGroup label {
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: #2d3748;
  font-size: 0.9rem;
}

.formGroup input {
  padding: 0.75rem;
  border: 1px solid #e2e8f0;
  border-radius: 6px;
  font-size: 0.95rem;
  background-color: #f7fafc;
  color: #4a5568;
}

.profileActions {
  margin-top: 2rem;
  padding-top: 1rem;
  border-top: 1px solid #e2e8f0;
}

.note {
  color: #718096;
  font-style: italic;
  text-align: center;
}

.comment {
  margin-top: 1rem;
  padding: 1rem;
  background-color: #f7fafc;
  border-radius: 6px;
}

.rating {
  display: flex;
  align-items: center;
  font-weight: 600;
  color: #f6ad55;
}

.noData {
  text-align: center;
  color: #718096;
  font-style: italic;
}

.noData a {
  color: #667eea;
  text-decoration: none;
}

.noData a:hover {
  text-decoration: underline;
}

/* Responsive Design */
@media (max-width: 768px) {
  .dashboard {
    flex-direction: column;
  }

  .sidebar {
    width: 100%;
    height: auto;
    position: relative;
  }

  .stats {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }
}
</file>

<file path="package.json">
{
  "name": "techtrims",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start ",
    "lint": "eslint . ",
    "seed": "node scripts/seed.js"
  },
  "dependencies": {
    "bcryptjs": "^2.4.3",
    "cookie": "^1.0.2",
    "dotenv": "^17.2.2",
    "framer-motion": "^12.23.16",
    "jsonwebtoken": "^9.0.2",
    "leaflet": "^1.9.4",
    "mongodb": "^6.20.0",
    "mongoose": "^7.5.0",
    "next": "^14.2.32",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-leaflet": "^4.2.1",
    "swr": "^2.1.0",
    "uuid": "^9.0.0",
    "validator": "^13.9.0"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4.1.13",
    "@types/react": "^19.1.13",
    "autoprefixer": "^10.4.21",
    "eslint": "^9",
    "eslint-config-next": "15.5.3",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.13",
    "typescript": "^5.9.2"
  }
}
</file>

<file path="src/components/Layout/Layout.js">
import Link from "next/link";

export default function Layout({ children }) {
  return (
    <div className={"layout"}>
      <header className={"header"}>
        <div className={"logo"}>
          <h2>💈 SalonBook</h2>
        </div>
        <nav>
          <Link href="/">Home</Link>
          <Link href="/bookings">My Bookings</Link>
          <Link href="/profile">Profile</Link>
        </nav>
      </header>
      <main className={"main"}>{children}</main>
      <footer className={"footer"}>
        <p>&copy; 2024 SalonBook. All rights reserved.</p>
      </footer>
    </div>
  );
}
</file>

<file path="src/components/Maps/LocationMap.js">
// techtrims/src/components/Maps/LocationMap.js
import React, { useEffect, useState } from "react";
import {
  MapContainer,
  TileLayer,
  Marker,
  Popup,
  Polyline,
} from "react-leaflet";
import L from "leaflet";
import "leaflet/dist/leaflet.css";
import styles from "../../styles/LocationMap.module.css";

// Fix for default markers
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",
  iconUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",
  shadowUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
});

// Custom icons
const salonIcon = new L.Icon({
  iconUrl:
    "data:image/svg+xml;base64," +
    btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f59e0b" width="35" height="35">
      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
    </svg>
  `),
  iconSize: [35, 35],
  iconAnchor: [17.5, 35],
  popupAnchor: [0, -35],
});

const userIcon = new L.Icon({
  iconUrl:
    "data:image/svg+xml;base64," +
    btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#3b82f6" width="25" height="25">
      <circle cx="12" cy="12" r="8" stroke="#fff" stroke-width="2"/>
      <circle cx="12" cy="12" r="4"/>
    </svg>
  `),
  iconSize: [25, 25],
  iconAnchor: [12.5, 12.5],
});

const LocationMap = ({ salonLocation, userLocation, salonName, address }) => {
  const [routeCoordinates, setRouteCoordinates] = useState([]);
  const [distance, setDistance] = useState(null);
  const [duration, setDuration] = useState(null);
  const [loading, setLoading] = useState(false);

  const center = salonLocation || [19.076, 72.8777];

  const calculateDirectRoute = useCallback(() => {
    if (userLocation && salonLocation) {
      const route = [
        [userLocation.lat, userLocation.lng],
        [salonLocation[0], salonLocation[1]],
      ];
      setRouteCoordinates(route);

      const R = 6371;
      const dLat = ((salonLocation[0] - userLocation.lat) * Math.PI) / 180;
      const dLon = ((salonLocation[1] - userLocation.lng) * Math.PI) / 180;
      const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos((userLocation.lat * Math.PI) / 180) *
          Math.cos((salonLocation[0] * Math.PI) / 180) *
          Math.sin(dLon / 2) *
          Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      const dist = R * c;

      setDistance(dist.toFixed(1));
      setDuration(Math.round(dist * 3));
    }
  }, [userLocation, salonLocation]);

  const getAdvancedDirections = async () => {
    if (!userLocation || !salonLocation) return;

    setLoading(true);
    try {
      // Using OpenRouteService for routing (free alternative to Google)
      const response = await fetch(
        `https://api.openrouteservice.org/v2/directions/driving-car?api_key=YOUR_API_KEY&start=${userLocation.lng},${userLocation.lat}&end=${salonLocation[1]},${salonLocation[0]}`
      );

      if (response.ok) {
        const data = await response.json();
        const coordinates = data.features[0].geometry.coordinates.map(
          (coord) => [coord[1], coord[0]]
        );
        setRouteCoordinates(coordinates);

        const route = data.features[0].properties.segments[0];
        setDistance((route.distance / 1000).toFixed(1));
        setDuration(Math.round(route.duration / 60));
      } else {
        // Fallback to direct route
        calculateDirectRoute();
      }
    } catch (error) {
      console.log("Advanced routing failed, using direct route");
      calculateDirectRoute();
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    if (userLocation && salonLocation) {
      calculateDirectRoute();
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [calculateDirectRoute]);

  // In SalonMap.js or LocationMap.js
  const openInGoogleMaps = () => {
    if (salonLocation) {
      const [salonLat, salonLng] = salonLocation;
      let url;

      if (userLocation) {
        // Directions from user location to salon
        url = `https://www.google.com/maps/dir/${userLocation.lat},${userLocation.lng}/${salonLat},${salonLng}`;
      } else {
        // Just show salon location
        url = `https://www.google.com/maps/search/?api=1&query=${salonLat},${salonLng}`;
      }

      // Use location.href instead of window.open for better mobile compatibility
      window.location.href = url;
    }
  };

  return (
    <div className={styles.mapContainer}>
      <div className={styles.mapHeader}>
        <div className={styles.mapInfo}>
          <h3>{salonName}</h3>
          <p>{address}</p>
          {distance && (
            <div className={styles.routeInfo}>
              <span>📍 {distance} km</span>
              {duration && <span>🕐 ~{duration} min</span>}
            </div>
          )}
        </div>
        <div className={styles.mapActions}>
          <button className={styles.directionsBtn} onClick={openInGoogleMaps}>
            Get Directions
          </button>
          {userLocation && (
            <button
              className={styles.routeBtn}
              onClick={getAdvancedDirections}
              disabled={loading}
            >
              {loading ? "Loading..." : "Show Route"}
            </button>
          )}
        </div>
      </div>

      <MapContainer
        center={center}
        zoom={userLocation ? 13 : 15}
        className={styles.map}
      >
        <TileLayer
          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        />

        {/* Salon marker */}
        {salonLocation && (
          <Marker position={salonLocation} icon={salonIcon}>
            <Popup>
              <div className={styles.popupContent}>
                <strong>{salonName}</strong>
                <p>{address}</p>
                <button onClick={openInGoogleMaps} className={styles.popupBtn}>
                  Get Directions
                </button>
              </div>
            </Popup>
          </Marker>
        )}

        {/* User location marker */}
        {userLocation && (
          <Marker
            position={[userLocation.lat, userLocation.lng]}
            icon={userIcon}
          >
            <Popup>
              <div className={styles.popupContent}>
                <strong>Your Location</strong>
              </div>
            </Popup>
          </Marker>
        )}

        {/* Route polyline */}
        {routeCoordinates.length > 0 && (
          <Polyline
            positions={routeCoordinates}
            color="#f59e0b"
            weight={4}
            opacity={0.7}
            dashArray="10, 10"
          />
        )}
      </MapContainer>
    </div>
  );
};

export default LocationMap;
</file>

<file path="src/components/Maps/LocationPicker.js">
// components/Maps/LocationPicker.js - Leaflet location picker
import React, { useState, useEffect, useRef } from "react";
import {
  MapContainer,
  TileLayer,
  Marker,
  Popup,
  useMapEvents,
} from "react-leaflet";
import { MapPin, Search, Navigation } from "lucide-react";
import { geocodeAddress, reverseGeocode } from "../../lib/maps";

// Fix for Leaflet icons in Next.js
import L from "leaflet";
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",
  iconUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",
  shadowUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",
});

// Custom marker icon for salons
const salonIcon = new L.Icon({
  iconUrl:
    "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIuNSAxNi41QzIuNSAxNi41IDYuNSAxMi41IDEyIDEyLjVTMjEuNSAxNi41IDIxLjUgMTYuNSIgc3Ryb2tlPSIjRjU5RTBCIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8cGF0aCBkPSJNMTIgMjJWMTIuNSIgc3Ryb2tlPSIjRjU5RTBCIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K",
  iconSize: [32, 32],
  iconAnchor: [16, 32],
  popupAnchor: [0, -32],
});

function LocationMarker({ position, setPosition, setAddress, isDarkMode }) {
  const map = useMapEvents({
    click(e) {
      const newPos = [e.latlng.lat, e.latlng.lng];
      setPosition(newPos);

      // Get address for the clicked position
      reverseGeocode(e.latlng.lat, e.latlng.lng)
        .then((address) => setAddress(address))
        .catch(console.error);
    },
  });

  return position ? (
    <Marker position={position}>
      <Popup>
        <div
          className={`p-2 ${isDarkMode ? "text-gray-800" : "text-gray-900"}`}
        >
          📍 Selected Location
        </div>
      </Popup>
    </Marker>
  ) : null;
}

const LocationPicker = ({
  onLocationSelect = () => {
    console.log("Location selected");
  },
  initialPosition = [19.076, 72.8777], // Mumbai center
  isDarkMode = false,
}) => {
  const [position, setPosition] = useState(initialPosition);
  const [address, setAddress] = useState("");
  const [searchQuery, setSearchQuery] = useState("");
  const [loading, setLoading] = useState(false);
  const mapRef = useRef();

  const handleSearch = async () => {
    if (!searchQuery.trim()) return;

    setLoading(true);
    try {
      const result = await geocodeAddress(searchQuery);
      const newPos = [result.coordinates[1], result.coordinates[0]]; // lat, lng for Leaflet
      setPosition(newPos);
      setAddress(result.formattedAddress);

      // Fly to the new position
      if (mapRef.current) {
        mapRef.current.flyTo(newPos, 15);
      }
    } catch (error) {
      alert("Location not found. Please try a different search term.");
    } finally {
      setLoading(false);
    }
  };

  const getCurrentLocation = () => {
    if (navigator.geolocation) {
      setLoading(true);
      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const newPos = [pos.coords.latitude, pos.coords.longitude];
          setPosition(newPos);

          try {
            const address = await reverseGeocode(
              pos.coords.latitude,
              pos.coords.longitude
            );
            setAddress(address);
          } catch (error) {
            console.error("Error getting address:", error);
          }

          if (mapRef.current) {
            mapRef.current.flyTo(newPos, 15);
          }
          setLoading(false);
        },
        (error) => {
          console.error("Geolocation error:", error);
          alert("Unable to get your location");
          setLoading(false);
        }
      );
    }
  };

  const handleConfirm = () => {
    if (position && address && onLocationSelect) {
      console.log("Confirming location:", {
        lat: position[0],
        lng: position[1],
        address: address,
      });
      onLocationSelect({
        lat: position[0],
        lng: position[1],
        address: address,
      });
    } else {
      console.log("Missing data:", { position, address, onLocationSelect });
    }
  };

  return (
    <div className="space-y-4">
      {/* Search Controls */}
      <div className="space-y-3">
        <div className="flex space-x-2">
          <div className="flex-1 relative">
            <Search
              className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                isDarkMode ? "text-gray-400" : "text-gray-500"
              }`}
            />
            <input
              type="text"
              placeholder="Search for an address..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              onKeyPress={(e) => e.key === "Enter" && handleSearch()}
              className={`w-full pl-10 pr-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                isDarkMode
                  ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                  : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
              }`}
            />
          </div>
          <button
            onClick={handleSearch}
            disabled={loading}
            className={`px-4 py-3 rounded-xl font-medium transition-all duration-300 ${
              isDarkMode
                ? "bg-yellow-500 text-gray-900 hover:bg-yellow-400"
                : "bg-amber-500 text-white hover:bg-amber-600"
            } disabled:opacity-50`}
          >
            {loading ? "..." : "Search"}
          </button>
        </div>

        <button
          onClick={getCurrentLocation}
          disabled={loading}
          className={`w-full py-3 px-4 rounded-xl border-2 border-dashed transition-all duration-300 flex items-center justify-center ${
            isDarkMode
              ? "border-gray-600 text-gray-300 hover:border-gray-500"
              : "border-gray-300 text-gray-600 hover:border-gray-400"
          } disabled:opacity-50`}
        >
          <Navigation className="w-5 h-5 mr-2" />
          {loading ? "Getting location..." : "Use Current Location"}
        </button>
      </div>

      {/* Map Container */}
      <div
        className={`rounded-xl overflow-hidden border-2 ${
          isDarkMode ? "border-gray-600" : "border-gray-300"
        }`}
        style={{ height: "400px" }}
      >
        <MapContainer
          center={position}
          zoom={13}
          style={{ height: "100%", width: "100%" }}
          ref={mapRef}
        >
          <TileLayer
            attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          />
          <LocationMarker
            position={position}
            setPosition={setPosition}
            setAddress={setAddress}
            isDarkMode={isDarkMode}
          />
        </MapContainer>
      </div>

      {/* Selected Address Display */}
      {address && (
        <div
          className={`p-4 rounded-xl ${
            isDarkMode ? "bg-gray-700" : "bg-gray-100"
          }`}
        >
          <div className="flex items-start">
            <MapPin
              className={`w-5 h-5 mr-3 mt-0.5 flex-shrink-0 ${
                isDarkMode ? "text-yellow-400" : "text-amber-600"
              }`}
            />
            <div>
              <p
                className={`font-medium ${
                  isDarkMode ? "text-white" : "text-gray-900"
                }`}
              >
                Selected Location:
              </p>
              <p
                className={`text-sm mt-1 ${
                  isDarkMode ? "text-gray-300" : "text-gray-600"
                }`}
              >
                {address}
              </p>
            </div>
          </div>
        </div>
      )}

      {/* Confirm Button */}
      <button
        onClick={handleConfirm}
        disabled={!position || !address}
        className={`w-full py-3 px-6 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 disabled:transform-none disabled:opacity-50 ${
          isDarkMode
            ? "bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-400 hover:to-amber-400"
            : "bg-gradient-to-r from-amber-500 to-yellow-600 text-white hover:from-amber-600 hover:to-yellow-700"
        }`}
      >
        Confirm Location
      </button>
    </div>
  );
};

export default LocationPicker;
</file>

<file path="src/components/Salon/SalonCard.js">
import { useRouter } from "next/router";
import styles from "../styles/SalonCard.module.css";
import Image from "next/image";

export default function SalonCard({ salon, gender }) {
  const router = useRouter();
  if (!salon) {
    return null; // or return a loading/error placeholder
  }

  const handleBookNow = () => {
    router.push(`/salons/${salon.id}`);
  };

  return (
    <div className={styles.card}>
      <div className={styles.imageContainer}>
        <Image
          src={salon.images?.front || "/salon-placeholder.jpg"}
          alt={salon.name}
        />
        <div className={styles.popularityBadge}>
          {salon.totalBookings > 100 && "🔥 Most Booked"}
        </div>
      </div>

      <div className={styles.content}>
        <h3>{salon.name}</h3>

        <div className={styles.metrics}>
          <span>⭐ {salon.rating}/5</span>
          <span>📍 {salon.location?.distance || "1.2"} km</span>
          <span>🎯 {salon.customerServiceScore}% satisfaction</span>
        </div>

        <div className={styles.services}>
          <h4>Popular Services</h4>
          <div className={styles.serviceList}>
            {salon.topServices?.map((service, index) => (
              <div key={index} className={styles.serviceItem}>
                <span>{service.name}</span>
                <span className={styles.price}>₹{service.price}</span>
              </div>
            ))}
          </div>
        </div>

        <button onClick={handleBookNow} className={styles.bookBtn}>
          Book Now →
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/lib/auth.js">
import bcrypt from "bcryptjs";
import jwt from "jsonwebtoken";

export const hashPassword = async (password) => {
  const saltRounds = 12;
  return await bcrypt.hash(password, saltRounds);
};

export const verifyPassword = async (password, hashedPassword) => {
  return await bcrypt.compare(password, hashedPassword);
};

export const generateToken = (userId, role, email) => {
  return jwt.sign({ userId, role, email }, process.env.JWT_SECRET, {
    expiresIn: "7d",
  });
};

export const verifyToken = (token) => {
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    console.log("Token decoded successfully:", decoded);
    return decoded;
  } catch (error) {
    console.error("Token verification failed:", error.message);
    return null;
  }
};

export const getLocationFromCoordinates = async (lat, lng) => {
  try {
    // Using reverse geocoding - you might want to use a proper service like Google Maps API
    const response = await fetch(
      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`
    );
    const data = await response.json();
    return {
      address: data.display_name,
      city: data.address?.city || data.address?.town || data.address?.village,
      state: data.address?.state,
      country: data.address?.country,
      postcode: data.address?.postcode,
    };
  } catch (error) {
    console.error("Error getting location:", error);
    return null;
  }
};
</file>

<file path="src/lib/mongodb.js">
// lib/mongodb.js
import { MongoClient, ServerApiVersion } from "mongodb";

const uri = process.env.MONGODB_URI;

const options = {
  serverApi: {
    version: ServerApiVersion.v1,
    strict: true,
    deprecationErrors: true,
  },
  maxPoolSize: 10,
  serverSelectionTimeoutMS: 5000,
  socketTimeoutMS: 45000,
  connectTimeoutMS: 5000,
  maxIdleTimeMS: 30000,
  // REMOVED: bufferMaxEntries - this option is deprecated/not supported
};

if (!uri) {
  throw new Error("Please add your Mongo URI to .env.local (MONGODB_URI)");
}

let client;
let clientPromise;

if (process.env.NODE_ENV === "development") {
  if (!global._mongoClientPromise) {
    client = new MongoClient(uri, options);
    global._mongoClientPromise = client.connect();
  }
  clientPromise = global._mongoClientPromise;
} else {
  client = new MongoClient(uri, options);
  clientPromise = client.connect();
}

export default clientPromise;

export async function connectToDatabase() {
  try {
    const client = await clientPromise;
    const db = client.db(process.env.MONGODB_DB);

    // Test the connection
    await client.db("admin").command({ ping: 1 });
    console.log("✅ Connected to MongoDB!");

    return { client, db };
  } catch (error) {
    console.error("❌ Database connection failed:", error.message);

    // Reset global cache on connection failure
    if (process.env.NODE_ENV === "development") {
      global._mongoClientPromise = null;
    }

    throw error;
  }
}
</file>

<file path="src/models/Barber.js">
// models/Barber.js
import mongoose from "mongoose";

const BarberSchema = new mongoose.Schema(
  {
    salonId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Salon",
      required: true,
      index: true,
    },
    name: { type: String, required: true },
    experience: { type: Number, default: 0 }, // years
    skills: [{ type: String }], // specializations
    bio: { type: String, default: "" },
    photo: { type: String, default: "" },
    isAvailable: { type: Boolean, default: true },
    workingHours: {
      start: { type: String, default: "09:00" },
      end: { type: String, default: "21:00" },
    },
    totalBookings: { type: Number, default: 0 },
    rating: { type: Number, default: 5.0, min: 0, max: 5 },
    accomplishments: [{ type: String }],
    earnings: { type: Number, default: 0 },
    lastActiveAt: { type: Date, default: Date.now },
  },
  { timestamps: true }
);

export default mongoose.models.Barber || mongoose.model("Barber", BarberSchema);
</file>

<file path="src/models/Booking.js">
// src/models/Booking.js - Match your actual database structure
import mongoose from "mongoose";

const BookingSchema = new mongoose.Schema(
  {
    salonId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Salon",
      required: true,
      index: true,
    },
    customerName: { type: String, required: true },
    customerPhone: { type: String, required: true },
    service: { type: String, required: true }, // Change from serviceId to service (string)
    barber: { type: String, default: null }, // Change from staffId to barber (string)
    date: { type: String, required: true }, // Your DB uses string dates like "2025-09-25"
    time: { type: String, required: true }, // Your DB uses string times like "14:00"
    price: { type: Number, default: 0 },
    paymentStatus: {
      type: String,
      enum: ["pending", "partial", "paid"],
      default: "pending",
    },
    status: {
      type: String,
      enum: [
        "requested",
        "confirmed", // Your DB uses "confirmed" not "accepted"
        "completed",
        "cancelled",
      ],
      default: "confirmed",
    },
    userId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "User",
      default: null,
    },
    feedback: {
      type: mongoose.Schema.Types.Mixed,
      default: {},
    },
  },
  { timestamps: true }
);

export default mongoose.models.Booking ||
  mongoose.model("Booking", BookingSchema);
</file>

<file path="src/pages/api/auth/user/login.js">
import clientPromise from "../../../../lib/mongodb";
import bcrypt from "bcryptjs";
import jwt from "jsonwebtoken";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { email, password } = req.body;

    if (!email || !password) {
      return res
        .status(400)
        .json({ message: "Email and password are required" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");

    // Find user by email
    const user = await db.collection("users").findOne({
      email: email.toLowerCase(),
      role: "user",
    });

    if (!user) {
      return res.status(401).json({ message: "Invalid email or password" });
    }

    // Check if account is active
    if (!user.isActive) {
      return res.status(401).json({ message: "Account is deactivated" });
    }

    // Verify password
    const isValidPassword = await bcrypt.compare(password, user.hashedPassword);
    if (!isValidPassword) {
      return res.status(401).json({ message: "Invalid email or password" });
    }

    // Update last login
    await db.collection("users").updateOne(
      { _id: user._id },
      {
        $set: {
          lastLogin: new Date(),
          updatedAt: new Date(),
        },
      }
    );

    // Create JWT token
    const token = jwt.sign(
      {
        userId: user._id,
        email: user.email,
        role: user.role,
        name: user.name,
      },
      process.env.JWT_SECRET,
      { expiresIn: "7d" }
    );

    // Return user data without sensitive info
    const userResponse = {
      _id: user._id,
      name: user.name,
      email: user.email,
      phone: user.phone,
      gender: user.gender,
      role: user.role,
      bookingHistory: user.bookingHistory || [],
      preferences: user.preferences || {},
      createdAt: user.createdAt,
      lastLogin: new Date(),
    };

    res.status(200).json({
      message: "Login successful",
      token,
      user: userResponse,
    });
  } catch (error) {
    console.error("User login error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/auth/user/register.js">
import clientPromise from "../../../../lib/mongodb";
import { hashPassword, generateToken } from "../../../../lib/auth";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { name, email, phone, gender, password } = req.body;

    // Validate required fields
    if (!name || !email || !phone || !gender || !password) {
      return res.status(400).json({
        message: "All fields are required",
        required: ["name", "email", "phone", "gender", "password"],
      });
    }

    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      return res.status(400).json({ message: "Invalid email format" });
    }

    // Validate phone format (Indian format)
    const phoneRegex = /^[6-9]\d{9}$/;
    if (!phoneRegex.test(phone)) {
      return res
        .status(400)
        .json({ message: "Invalid phone number. Use 10-digit Indian format" });
    }

    // Validate password strength
    if (password.length < 6) {
      return res
        .status(400)
        .json({ message: "Password must be at least 6 characters long" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");
    const users = db.collection("users");

    // Check if user already exists
    const existingUser = await users.findOne({
      $or: [{ email: email.toLowerCase() }, { phone: phone }],
    });

    if (existingUser) {
      return res.status(409).json({
        message: "User already exists with this email or phone number",
      });
    }

    // Hash password
    const hashedPassword = await hashPassword(password);

    // Create new user
    // Check for existing bookings by phone/name before creating user
    const existingBookings = await db
      .collection("bookings")
      .find({
        $or: [
          { customerPhone: phone },
          { customerName: { $regex: name, $options: "i" } },
        ],
      })
      .toArray();

    console.log(
      `Found ${existingBookings.length} existing bookings for this user`
    );

    const newUser = {
      name,
      email,
      phone,
      gender,
      role: "user",
      hashedPassword,
      bookingHistory: existingBookings.map((booking) => booking._id), // Store booking IDs
      preferences: {},
      createdAt: new Date(),
      updatedAt: new Date(),
      isActive: true,
    };

    const result = await db.collection("users").insertOne(newUser);

    // Update existing bookings with userId
    if (existingBookings.length > 0) {
      await db
        .collection("bookings")
        .updateMany(
          { _id: { $in: existingBookings.map((b) => b._id) } },
          { $set: { userId: result.insertedId } }
        );
      console.log(
        `Updated ${existingBookings.length} bookings with new userId`
      );
    }

    // Generate JWT token
    const token = generateToken(result.insertedId, "user", email);

    // Remove password from response
    const { hashedPassword: _, ...userResponse } = newUser;
    userResponse._id = result.insertedId;

    res.status(201).json({
      message: "User registered successfully",
      user: userResponse,
      token,
    });
  } catch (error) {
    console.error("User registration error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/bookings/create.js">
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { db } = await connectToDatabase();
    const {
      salonId,
      service,
      barber,
      date,
      time,
      user,
      price,
      customerName,
      customerPhone,
    } = req.body;

    if (!salonId || !service || !date || !time) {
      return res.status(400).json({ error: "Missing required fields" });
    }

    // Check for existing booking
    const existingBooking = await db.collection("bookings").findOne({
      salonId: ObjectId.isValid(salonId) ? new ObjectId(salonId) : salonId,
      date,
      time,
      status: { $ne: "cancelled" },
    });

    if (existingBooking) {
      return res.status(409).json({ error: "Time slot already booked" });
    }

    const bookingData = {
      salonId: ObjectId.isValid(salonId) ? new ObjectId(salonId) : salonId,
      service,
      barber: barber || null,
      date,
      time,
      customerName: customerName || "Guest",
      customerPhone: customerPhone || "",
      price: price || 0,
      paymentStatus: "pending",
      status: "confirmed",
      userId: user?._id || user?.id || null,
      createdAt: new Date(),
      updatedAt: new Date(),
      feedback: {
        submitted: false,
        ratings: {},
        comment: "",
      },
    };

    const result = await db.collection("bookings").insertOne(bookingData);

    res.status(201).json({
      success: true,
      message: "Booking created successfully",
      bookingId: result.insertedId,
      _id: result.insertedId,
    });
  } catch (error) {
    console.error("Booking creation error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/maps/reverse.js">
export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  const { lat, lng } = req.body ?? {};

  if (lat === undefined || lng === undefined) {
    return res.status(400).json({ error: "lat and lng are required" });
  }

  try {
    const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${encodeURIComponent(
      lat
    )}&lon=${encodeURIComponent(lng)}&addressdetails=1`;

    const response = await fetch(url, {
      headers: {
        "User-Agent": "TechTrims/1.0 (techtrims1@gmail.com)",
        "Accept-Language": "en-US,en;q=0.9",
      },
    });

    if (!response.ok) {
      const body = await response.text().catch(() => "");
      console.error("Nominatim returned non-OK:", response.status, body);
      return res
        .status(response.status)
        .json({ error: "Reverse geocoding provider error" });
    }

    const data = await response.json();
    const displayName = data.display_name || null;

    return res.status(200).json({
      address: displayName,
      raw: data,
    });
  } catch (err) {
    console.error("Reverse geocoding error:", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/barbers/available.js">
// pages/api/salons/barbers/available.js
import clientPromise from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  const { salonId, service } = req.query;

  console.log("=== AVAILABLE BARBERS API (SALON-BASED) ===");
  console.log("SalonId:", salonId);
  console.log("Service requested:", service);

  if (!salonId) {
    return res.status(400).json({ error: "salonId required" });
  }

  try {
    const client = await clientPromise;
    const db = client.db("techtrims");

    // Convert salonId to ObjectId
    let salonObjectId;
    try {
      salonObjectId = new ObjectId(salonId);
    } catch (objIdError) {
      console.error("Invalid salonId format:", objIdError);
      return res.status(400).json({ error: "Invalid salonId format" });
    }

    // STEP 1: Get the salon and its barber IDs
    const salon = await db
      .collection("salons")
      .findOne(
        { _id: salonObjectId },
        { projection: { barbers: 1, salonName: 1 } }
      );

    if (!salon) {
      console.log("Salon not found");
      return res.status(404).json({ error: "Salon not found" });
    }

    console.log("Found salon:", salon.salonName);
    console.log("Salon barber IDs:", salon.barbers);

    if (!salon.barbers || salon.barbers.length === 0) {
      console.log("No barbers assigned to this salon");
      return res.status(200).json([]);
    }

    // STEP 2: Get barber details using the salon's barber array
    const barberObjectIds = salon.barbers.map((id) =>
      typeof id === "string" ? new ObjectId(id) : id
    );

    const barberQuery = {
      _id: { $in: barberObjectIds },
      isAvailable: true,
    };

    console.log("Barber query:", JSON.stringify(barberQuery, null, 2));

    const allBarbers = await db
      .collection("barbers")
      .find(barberQuery)
      .toArray();

    console.log("Found available barbers:", allBarbers.length);
    allBarbers.forEach((barber) => {
      console.log(
        `- ${barber.name}: skills = [${barber.skills?.join(", ") || "none"}]`
      );
    });

    // If no service specified, return all available barbers
    if (!service) {
      return res
        .status(200)
        .json(allBarbers.sort((a, b) => b.rating - a.rating));
    }

    // STEP 3: Filter by skills if service is specified
    const getMatchingSkills = (serviceName) => {
      const serviceMap = {
        haircut: ["Haircut"],
        Shave: ["Shaving"],
        HairStyling: ["Hair Styling"],
        HairColor: ["Hair Color"],
        Facial: ["Facial"],
        HairWash: ["Hair Wash"],
      };

      // Try exact match first
      if (serviceMap[serviceName]) {
        return serviceMap[serviceName];
      }

      // Try case-insensitive match
      const lowerService = serviceName.toLowerCase();
      for (const [key, skills] of Object.entries(serviceMap)) {
        if (key.toLowerCase() === lowerService) {
          return skills;
        }
      }

      return [serviceName];
    };

    const matchingSkills = getMatchingSkills(service);
    console.log(`Service "${service}" mapped to skills:`, matchingSkills);

    const filteredBarbers = allBarbers.filter((barber) => {
      if (!barber.skills || !Array.isArray(barber.skills)) {
        return false;
      }

      const hasMatchingSkill = barber.skills.some((skill) =>
        matchingSkills.some(
          (reqSkill) =>
            skill.toLowerCase().includes(reqSkill.toLowerCase()) ||
            reqSkill.toLowerCase().includes(skill.toLowerCase())
        )
      );

      console.log(
        `Barber ${barber.name} has matching skill for "${service}":`,
        hasMatchingSkill
      );
      return hasMatchingSkill;
    });

    // Return skilled barbers first, or all barbers if none skilled
    const result = filteredBarbers.length > 0 ? filteredBarbers : allBarbers;

    console.log("Returning barbers:", result.length);
    return res.status(200).json(result.sort((a, b) => b.rating - a.rating));
  } catch (err) {
    console.error("Available barbers API error:", err);
    return res.status(500).json({
      error: "Internal server error",
      details: err.message,
    });
  }
}
</file>

<file path="src/pages/api/salons/bookings.js">
import clientPromise from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { salonId, date, from } = req.query;

    if (!salonId) {
      return res.status(400).json({ message: "Salon ID is required" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");

    let query = { salonId: new ObjectId(salonId) };

    // Add date filtering
    if (date) {
      // Specific date
      query.date = date;
    } else if (from) {
      // From a specific date onwards
      query.date = { $gte: from };
    }

    const bookings = await db
      .collection("bookings")
      .find(query)
      .sort({ date: 1, time: 1 }) // Sort by date and time
      .toArray();

    // Format bookings with additional info
    const formattedBookings = bookings.map((booking) => ({
      ...booking,
      _id: booking._id.toString(),
      salonId: booking.salonId.toString(),
      userId: booking.userId?.toString(),
    }));

    res.status(200).json(formattedBookings);
  } catch (error) {
    console.error("Error fetching salon bookings:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/bookings/[id].js">
// src/pages/api/salons/bookings/[id].js - Only handle specific booking IDs
import connectToDatabase from "../../../../lib/mongodb";
import Booking from "../../../../models/Booking";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const { id } = req.query;

  // Check if id is actually a valid ObjectId
  if (!ObjectId.isValid(id)) {
    return res.status(400).json({ error: "Invalid booking ID format" });
  }

  try {
    if (method === "GET") {
      const booking = await Booking.findById(id);
      if (!booking) {
        return res.status(404).json({ error: "Booking not found" });
      }
      return res.status(200).json(booking);
    }

    if (method === "PUT") {
      const update = req.body;
      const booking = await Booking.findByIdAndUpdate(id, update, {
        new: true,
      });
      if (!booking) {
        return res.status(404).json({ error: "Booking not found" });
      }
      return res.status(200).json(booking);
    }

    if (method === "DELETE") {
      await Booking.findByIdAndDelete(id);
      return res.status(204).end();
    }

    return res
      .setHeader("Allow", ["GET", "PUT", "DELETE"])
      .status(405)
      .end(`Method ${method} Not Allowed`);
  } catch (err) {
    console.error("api/bookings/[id] error:", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/booking/confirmed.js">
import { useRouter } from "next/router";
import { useEffect, useState } from "react";

export default function BookingConfirmed() {
  const router = useRouter();
  const { id } = router.query;
  const [booking, setBooking] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!id) return;

    const loadBooking = async () => {
      try {
        const res = await fetch("/api/bookings/" + id);
        if (res.ok) {
          const data = await res.json();
          setBooking(data.booking);
        }
      } catch (error) {
        console.error("Error loading booking:", error);
      } finally {
        setLoading(false);
      }
    };

    loadBooking();
    const interval = setInterval(loadBooking, 10000);
    return () => clearInterval(interval);
  }, [id]);

  const proceedToFeedback = () => {
    router.push(`/feedback?bookingId=${id}`);
  };

  if (loading) return <div style={{ padding: 20 }}>Loading...</div>;
  if (!booking) return <div style={{ padding: 20 }}>Booking not found.</div>;

  return (
    <div style={{ padding: 20, maxWidth: 600, margin: "0 auto" }}>
      <h2>Booking Status</h2>

      <div
        style={{
          background: "#f8f9fa",
          color: "black",
          padding: 20,
          borderRadius: 8,
          marginBottom: 20,
        }}
      >
        <p>
          <strong>Booking ID:</strong> {booking._id}
        </p>
        <p>
          <strong>Service:</strong> {booking.service}
        </p>
        {booking.barber && (
          <p>
            <strong>Barber:</strong> {booking.barber}
          </p>
        )}
        <p>
          <strong>Date:</strong> {booking.date}
        </p>
        <p>
          <strong>Time:</strong> {booking.time}
        </p>
        <p>
          <strong>Customer:</strong> {booking.customerName}
        </p>
      </div>

      <div style={{ marginBottom: 20 }}>
        <h3>Service Status</h3>
        <div
          style={{
            display: "flex",
            justifyContent: "space-between",
            margin: "20px 0",
          }}
        >
          <StatusStep
            label="Confirmed"
            active={true}
            completed={booking.status !== "confirmed"}
          />
          <StatusStep
            label="Customer Arrived"
            active={
              booking.status === "arrived" ||
              isAfterStatus("arrived", booking.status)
            }
            completed={isAfterStatus("arrived", booking.status)}
          />
          <StatusStep
            label="Service Started"
            active={
              booking.status === "started" ||
              isAfterStatus("started", booking.status)
            }
            completed={isAfterStatus("started", booking.status)}
          />
          <StatusStep
            label="Service Done"
            active={booking.status === "completed"}
            completed={booking.status === "completed"}
          />
        </div>
      </div>

      {booking.status === "completed" && (
        <div
          style={{
            background: "#d4edda",
            color: "black",
            border: "1px solid #c3e6cb",
            padding: 15,
            borderRadius: 5,
            marginBottom: 20,
          }}
        >
          <h3 style={{ color: "black", margin: 0 }}>Service Completed!</h3>
          <p style={{ color: "black", margin: "10px 0 0 0" }}>
            Your service has been completed. Please provide feedback.
          </p>
          <button
            onClick={proceedToFeedback}
            style={{
              background: "#28a745",
              color: "white",
              border: "none",
              padding: "10px 20px",
              borderRadius: 5,
              cursor: "pointer",
              marginTop: 10,
            }}
          >
            Give Feedback
          </button>
        </div>
      )}

      {booking.status !== "completed" && (
        <div
          style={{
            background: "#fff3cd",
            border: "1px solid #ffeaa7",
            padding: 15,
            borderRadius: 5,
          }}
        >
          <p style={{ margin: 0 }}>{getStatusMessage(booking.status)}</p>
        </div>
      )}
    </div>
  );
}

function StatusStep({ label, active, completed }) {
  return (
    <div
      style={{
        textAlign: "center",
        opacity: active || completed ? 1 : 0.4,
      }}
    >
      <div
        style={{
          width: 30,
          height: 30,
          borderRadius: "50%",
          background: completed ? "#28a745" : active ? "#ffc107" : "#6c757d",
          margin: "0 auto 5px",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          color: "white",
          fontSize: 12,
          fontWeight: "bold",
        }}
      >
        {completed ? "✓" : active ? "⏳" : "⏸"}
      </div>
      <div style={{ fontSize: 12 }}>{label}</div>
    </div>
  );
}

function isAfterStatus(checkStatus, currentStatus) {
  const statusOrder = ["confirmed", "arrived", "started", "completed"];
  return statusOrder.indexOf(currentStatus) > statusOrder.indexOf(checkStatus);
}

function getStatusMessage(status) {
  switch (status) {
    case "confirmed":
      return "Your booking is confirmed. Please arrive on time.";
    case "arrived":
      return "You have arrived. Waiting for service to start.";
    case "started":
      return "Your service is in progress. Please wait.";
    case "completed":
      return "Service completed! Please provide feedback.";
    default:
      return "Unknown status";
  }
}
</file>

<file path="src/pages/salon-details/[id].js">
// pages/salon-details/[id].js - CHANGE FROM basic details TO comprehensive details page
import { useState, useEffect, useCallback, useMemo } from "react";
import { useRouter } from "next/router";
import { motion } from "framer-motion";
import dynamic from "next/dynamic";
import {
  MapPin,
  Clock,
  Phone,
  Star,
  Navigation,
  Share2,
  Heart,
} from "lucide-react";

// Dynamic imports to avoid SSR issues
const LocationMap = dynamic(() => import("../../components/Maps/LocationMap"), {
  ssr: false,
  loading: () => (
    <div className="animate-pulse bg-gray-300 h-64 rounded-xl"></div>
  ),
});

export default function SalonDetailsPage() {
  const router = useRouter();
  const { id } = router.query;
  const [salon, setSalon] = useState(null);
  const [loading, setLoading] = useState(true);
  const [userLocation, setUserLocation] = useState(null);
  const [showBooking, setShowBooking] = useState(false);
  const [selectedService, setSelectedService] = useState(null);
  const [activeTab, setActiveTab] = useState("overview");
  const [isFavorite, setIsFavorite] = useState(false);
  const services = useMemo(() => {
    if (!salon) return [];

    // Check if salon has services array
    if (salon.services && Array.isArray(salon.services)) {
      return salon.services;
    }

    // Check if salon has services object (convert to array)
    if (salon.services && typeof salon.services === "object") {
      return Object.entries(salon.services).map(([key, value]) => ({
        name: key,
        price: value.price || 0,
        duration: value.duration || 30,
        enabled: value.enabled || true,
        ...value,
      }));
    }

    // Fallback to gender-based services
    return getGenderServices(salon.targetGender || "Male");
  }, [salon]);

  const salonCoords = useMemo(() => {
    if (!salon?.location?.coordinates) return null;

    // Handle different coordinate formats
    const coords = salon.location.coordinates;
    if (Array.isArray(coords) && coords.length >= 2) {
      // GeoJSON format [lng, lat] -> Leaflet format [lat, lng]
      return [coords[1], coords[0]];
    }
    return null;
  }, [salon]);

  const fetchSalonDetails = useCallback(async () => {
    if (!id) return;

    try {
      const response = await fetch(`/api/salons/${id}`);
      const data = await response.json();

      if (data.success) {
        setSalon(data.salon);
      } else {
        console.error("Failed to fetch salon details");
      }
    } catch (error) {
      console.error("Error fetching salon details:", error);
    } finally {
      setLoading(false);
    }
  }, [id]);

  useEffect(() => {
    if (id) {
      fetchSalonDetails();
    }
    getUserLocation();
  }, [id, fetchSalonDetails]);

  const getUserLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setUserLocation({
            lat: position.coords.latitude,
            lng: position.coords.longitude,
          });
        },
        (error) => {
          console.log("Location access denied");
        }
      );
    }
  };
  const getGenderServices = (gender) => {
    const maleServices = [
      {
        name: "Haircut",
        price: 200,
        duration: 30,
        icon: "✂️",
        description: "Professional haircut with styling",
      },
      {
        name: "Beard Trim",
        price: 150,
        duration: 20,
        icon: "🧔",
        description: "Beard shaping and trimming",
      },
      {
        name: "Hair Styling",
        price: 250,
        duration: 25,
        icon: "💇‍♂️",
        description: "Hair styling with premium products",
      },
      {
        name: "Face Cleanup",
        price: 300,
        duration: 45,
        icon: "🧴",
        description: "Deep face cleansing treatment",
      },
      {
        name: "Hair Wash",
        price: 100,
        duration: 15,
        icon: "🚿",
        description: "Professional hair wash",
      },
      {
        name: "Massage",
        price: 400,
        duration: 60,
        icon: "💆‍♂️",
        description: "Relaxing head and shoulder massage",
      },
    ];

    const femaleServices = [
      {
        name: "Haircut & Style",
        price: 400,
        duration: 60,
        icon: "💇‍♀️",
        description: "Cut and professional styling",
      },
      {
        name: "Hair Coloring",
        price: 800,
        duration: 120,
        icon: "🎨",
        description: "Professional hair coloring service",
      },
      {
        name: "Facial Treatment",
        price: 600,
        duration: 75,
        icon: "✨",
        description: "Deep cleansing facial treatment",
      },
      {
        name: "Manicure",
        price: 350,
        duration: 45,
        icon: "💅",
        description: "Complete nail care and polish",
      },
      {
        name: "Pedicure",
        price: 400,
        duration: 50,
        icon: "🦶",
        description: "Foot care and nail treatment",
      },
      {
        name: "Hair Treatment",
        price: 500,
        duration: 60,
        icon: "🌿",
        description: "Nourishing hair treatment",
      },
    ];

    return gender === "Male" ? maleServices : femaleServices;
  };
  const getDirections = () => {
    if (salon?.location?.coordinates && userLocation) {
      const [lng, lat] = salon.location.coordinates;
      const url = `https://www.google.com/maps/dir/${userLocation.lat},${userLocation.lng}/${lat},${lng}`;
      window.open(url, "_blank");
    } else if (salon?.location?.coordinates) {
      const [lng, lat] = salon.location.coordinates;
      const url = `https://www.google.com/maps/place/${lat},${lng}`;
      window.open(url, "_blank");
    }
  };

  const handleBookNow = () => {
    router.push(`/salons/${id}`);
  };

  const handleShare = async () => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: salon.salonName,
          text: `Check out ${salon.salonName} - a great salon near you!`,
          url: window.location.href,
        });
      } catch (error) {
        console.log("Error sharing:", error);
      }
    } else {
      // Fallback: copy to clipboard
      navigator.clipboard.writeText(window.location.href);
      alert("Link copied to clipboard!");
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4"></div>
          <p className="text-gray-600">Loading salon details...</p>
        </div>
      </div>
    );
  }

  if (!salon) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-gray-900 mb-4">
            Salon not found
          </h2>
          <button
            onClick={() => router.back()}
            className="bg-amber-600 text-white px-6 py-2 rounded-lg hover:bg-amber-700 transition-colors"
          >
            Go Back
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white shadow-sm sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <button
              onClick={() => router.back()}
              className="flex items-center text-gray-600 hover:text-gray-900 transition-colors"
            >
              <svg
                className="w-5 h-5 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M15 19l-7-7 7-7"
                />
              </svg>
              Back
            </button>

            <div className="flex items-center space-x-3">
              <button
                onClick={handleShare}
                className="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <Share2 className="w-5 h-5" />
              </button>
              <button
                onClick={() => setIsFavorite(!isFavorite)}
                className={`p-2 rounded-lg transition-colors ${
                  isFavorite
                    ? "text-red-500 bg-red-50"
                    : "text-gray-600 hover:text-red-500 hover:bg-gray-100"
                }`}
              >
                <Heart
                  className={`w-5 h-5 ${isFavorite ? "fill-current" : ""}`}
                />
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Hero Section */}
      <section className="bg-white">
        <div className="max-w-7xl mx-auto px-4 py-6">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Image Gallery */}
            <div className="space-y-4">
              <div className="aspect-video bg-gray-200 rounded-xl overflow-hidden">
                <img
                  src={
                    salon.salonImages?.[0]?.url ||
                    salon.salonImages?.[0] ||
                    "https://images.unsplash.com/photo-1560066984-138dadb4c035?w=800&h=400&fit=crop"
                  }
                  alt={salon.salonName}
                  className="w-full h-full object-cover"
                />
              </div>

              {/* Additional images */}
              {salon.salonImages && salon.salonImages.length > 1 && (
                <div className="grid grid-cols-3 gap-4">
                  {salon.salonImages.slice(1, 4).map((image, index) => (
                    <div
                      key={index}
                      className="aspect-square bg-gray-200 rounded-lg overflow-hidden"
                    >
                      <img
                        src={typeof image === "string" ? image : image.url}
                        alt={`${salon.salonName} ${index + 2}`}
                        className="w-full h-full object-cover"
                      />
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Salon Info */}
            <div className="space-y-6">
              <div>
                <div className="flex items-start justify-between mb-2">
                  <h1 className="text-3xl font-bold text-gray-900">
                    {salon.salonName}
                  </h1>
                  {salon.isVerified && (
                    <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                      ✓ Verified
                    </span>
                  )}
                </div>

                <div className="flex items-center text-gray-600 mb-4">
                  <MapPin className="w-5 h-5 mr-2" />
                  <span>{salon.location?.address}</span>
                </div>

                <div className="flex items-center space-x-6 text-sm">
                  <div className="flex items-center">
                    <Star className="w-5 h-5 text-yellow-400 mr-1" />
                    <span className="font-medium">
                      {(salon.ratings?.overall || 4.5).toFixed(1)}
                    </span>
                    <span className="text-gray-500 ml-1">
                      ({salon.ratings?.totalReviews || 0} reviews)
                    </span>
                  </div>
                  <div className="flex items-center text-gray-500">
                    <span>{salon.stats?.totalBookings || 0} bookings</span>
                  </div>
                  <div className="flex items-center text-gray-500">
                    <span>{salon.distance?.toFixed(1) || "1.2"} km away</span>
                  </div>
                </div>
              </div>

              {/* Contact Info */}
              <div className="bg-gray-50 rounded-lg p-4">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div className="flex items-center">
                    <Phone className="w-5 h-5 text-gray-400 mr-3" />
                    <span>{salon.phone || "Not available"}</span>
                  </div>
                  <div className="flex items-center">
                    <Clock className="w-5 h-5 text-gray-400 mr-3" />
                    <span>
                      {salon.openingTime || "09:00"} -{" "}
                      {salon.closingTime || "21:00"}
                    </span>
                  </div>
                </div>
              </div>

              {/* Action Buttons */}
              <div className="flex space-x-4">
                <button
                  onClick={handleBookNow}
                  className="flex-1 bg-amber-600 text-white px-6 py-3 rounded-lg hover:bg-amber-700 transition-colors font-medium"
                >
                  Book Appointment
                </button>
                <button
                  onClick={getDirections}
                  className="flex items-center justify-center px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <Navigation className="w-5 h-5 mr-2" />
                  Directions
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Tabs Navigation */}
      <div className="bg-white border-b">
        <div className="max-w-7xl mx-auto px-4">
          <nav className="flex space-x-8">
            {[
              { id: "overview", label: "Overview" },
              { id: "services", label: "Services" },
              { id: "reviews", label: "Reviews" },
              { id: "location", label: "Location" },
            ].map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${
                  activeTab === tab.id
                    ? "border-amber-500 text-amber-600"
                    : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
                }`}
              >
                {tab.label}
              </button>
            ))}
          </nav>
        </div>
      </div>

      {/* Tab Content */}
      <div className="max-w-7xl mx-auto px-4 py-8">
        {activeTab === "overview" && (
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div className="lg:col-span-2 space-y-6">
              {/* About */}
              <div className="bg-white rounded-lg shadow-sm p-6">
                <h3 className="text-xl font-semibold mb-4">
                  About {salon.salonName}
                </h3>
                <p className="text-gray-600 leading-relaxed">
                  {salon.description ||
                    `Welcome to ${salon.salonName}, your premier destination for professional grooming and beauty services. Our experienced team is dedicated to providing top-quality treatments in a comfortable and hygienic environment.`}
                </p>
              </div>

              {/* Popular Services Preview */}
              <div className="bg-white rounded-lg shadow-sm p-6">
                <h3 className="text-xl font-semibold mb-4">Popular Services</h3>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  {(services || []).slice(0, 4).map((service, index) => (
                    <div
                      key={index}
                      className="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
                    >
                      <div className="flex items-center">
                        <span className="text-2xl mr-3">{service.icon}</span>
                        <div>
                          <h4 className="font-medium">{service.name}</h4>
                          <p className="text-sm text-gray-500">
                            {service.duration} min
                          </p>
                        </div>
                      </div>
                      <span className="font-semibold text-amber-600">
                        ₹{service.price}
                      </span>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {/* Sidebar */}
            <div className="space-y-6">
              {/* Quick Stats */}
              <div className="bg-white rounded-lg shadow-sm p-6">
                <h3 className="text-lg font-semibold mb-4">Quick Stats</h3>
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-gray-600">Average Wait Time</span>
                    <span className="font-medium">
                      {salon.stats?.averageWaitTime || 15} min
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Repeat Customers</span>
                    <span className="font-medium">
                      {salon.stats?.repeatCustomers || 85}%
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Total Bookings</span>
                    <span className="font-medium">
                      {salon.stats?.totalBookings || 0}
                    </span>
                  </div>
                </div>
              </div>

              {/* Amenities */}
              {salon.amenities && salon.amenities.length > 0 && (
                <div className="bg-white rounded-lg shadow-sm p-6">
                  <h3 className="text-lg font-semibold mb-4">Amenities</h3>
                  <div className="space-y-2">
                    {salon.amenities.map((amenity, index) => (
                      <div key={index} className="flex items-center">
                        <span className="text-green-500 mr-2">✓</span>
                        <span>{amenity}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === "services" && (
          <div className="bg-white rounded-lg shadow-sm p-6">
            <h3 className="text-2xl font-semibold mb-6">All Services</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {services.map((service, index) => (
                <motion.div
                  key={index}
                  className="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer"
                  onClick={() => setSelectedService(service)}
                  whileHover={{ scale: 1.02 }}
                >
                  <div className="text-3xl mb-3">{service.icon}</div>
                  <h4 className="text-lg font-semibold mb-2">{service.name}</h4>
                  <p className="text-gray-600 text-sm mb-4">
                    {service.description}
                  </p>
                  <div className="flex justify-between items-center">
                    <span className="text-2xl font-bold text-amber-600">
                      ₹{service.price}
                    </span>
                    <span className="text-sm text-gray-500">
                      {service.duration} min
                    </span>
                  </div>
                </motion.div>
              ))}
            </div>
          </div>
        )}

        {activeTab === "reviews" && (
          <div className="bg-white rounded-lg shadow-sm p-6">
            <h3 className="text-2xl font-semibold mb-6">Customer Reviews</h3>
            {salon.recentFeedback && salon.recentFeedback.length > 0 ? (
              <div className="space-y-6">
                {salon.recentFeedback.map((review, index) => (
                  <div key={index} className="border-b border-gray-200 pb-6">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <h4 className="font-semibold">{review.userName}</h4>
                        <div className="flex items-center mt-1">
                          {[...Array(5)].map((_, i) => (
                            <Star
                              key={i}
                              className={`w-4 h-4 ${
                                i < review.rating
                                  ? "text-yellow-400 fill-current"
                                  : "text-gray-300"
                              }`}
                            />
                          ))}
                          <span className="ml-2 text-sm text-gray-500">
                            {new Date(review.date).toLocaleDateString()}
                          </span>
                        </div>
                      </div>
                      <span className="text-sm text-gray-500">
                        {review.service}
                      </span>
                    </div>
                    <p className="text-gray-700">{review.comment}</p>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-12">
                <div className="text-gray-400 text-6xl mb-4">💬</div>
                <h4 className="text-lg font-medium text-gray-900 mb-2">
                  No reviews yet
                </h4>
                <p className="text-gray-500">
                  Be the first to review this salon!
                </p>
              </div>
            )}
          </div>
        )}

        {activeTab === "location" && (
          <div className="bg-white rounded-lg shadow-sm overflow-hidden">
            <div className="p-6 border-b">
              <h3 className="text-2xl font-semibold mb-4">
                Location & Directions
              </h3>
              <div className="flex items-center text-gray-600">
                <MapPin className="w-5 h-5 mr-2" />
                <span>{salon.location?.address}</span>
              </div>
            </div>

            {salonCoords && (
              <div style={{ height: "400px" }}>
                <LocationMap
                  salonLocation={salonCoords}
                  userLocation={userLocation}
                  salonName={salon.salonName}
                  address={salon.location?.address}
                />
              </div>
            )}

            <div className="p-6">
              <button
                onClick={getDirections}
                className="w-full bg-amber-600 text-white px-6 py-3 rounded-lg hover:bg-amber-700 transition-colors font-medium flex items-center justify-center"
              >
                <Navigation className="w-5 h-5 mr-2" />
                Get Directions
              </button>
            </div>
          </div>
        )}
      </div>

      {/* Service Detail Modal */}
      {selectedService && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <motion.div
            className="bg-white rounded-xl p-6 max-w-md w-full"
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            exit={{ opacity: 0, scale: 0.9 }}
          >
            <div className="text-center mb-6">
              <div className="text-6xl mb-4">{selectedService.icon}</div>
              <h3 className="text-2xl font-bold mb-2">
                {selectedService.name}
              </h3>
              <p className="text-gray-600">{selectedService.description}</p>
            </div>

            <div className="flex justify-between items-center mb-6 p-4 bg-gray-50 rounded-lg">
              <div>
                <span className="text-sm text-gray-500">Price</span>
                <div className="text-2xl font-bold text-amber-600">
                  ₹{selectedService.price}
                </div>
              </div>
              <div className="text-right">
                <span className="text-sm text-gray-500">Duration</span>
                <div className="text-lg font-semibold">
                  {selectedService.duration} min
                </div>
              </div>
            </div>

            <div className="flex space-x-3">
              <button
                onClick={() => setSelectedService(null)}
                className="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Close
              </button>
              <button
                onClick={() => {
                  setSelectedService(null);
                  handleBookNow();
                }}
                className="flex-1 px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors"
              >
                Book Now
              </button>
            </div>
          </motion.div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/pages/salons/barbers/index.js">
// pages/salons/barbers/index.js
import { useEffect, useState } from "react";
import { useRouter } from "next/router";
import axios from "axios";
import Link from "next/link";

export default function SalonBarbersPage() {
  const router = useRouter();
  const [barbers, setBarbers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");
  const [showForm, setShowForm] = useState(false);
  const [salonId, setSalonId] = useState(null);
  const [newBarber, setNewBarber] = useState({
    name: "",
    experience: 0,
    skills: [],
    bio: "",
    photo: "",
  });

  const availableSkills = [
    "Haircut",
    "Shaving",
    "Hair Styling",
    "Beard Trim",
    "Hair Color",
    "Facial",
  ];

  // Get salonId from localStorage (salon session)
  useEffect(() => {
    if (typeof window !== "undefined") {
      console.log("Checking localStorage for salon session...");

      // Check all possible keys
      const salonSession = localStorage.getItem("salonSession");
      const salonToken = localStorage.getItem("salonToken");

      console.log("Raw salonSession:", salonSession);
      console.log("Raw salonToken:", salonToken);

      if (salonSession) {
        try {
          const salonData = JSON.parse(salonSession);
          console.log("Parsed salon data:", salonData);

          // Try multiple possible id fields
          const id = salonData.id || salonData._id || salonData.salonId;

          if (id) {
            setSalonId(id);
            console.log("Salon ID loaded from session:", id);
          } else {
            console.error("No ID found in salon session data");
            setError("Invalid salon session data");
          }
        } catch (err) {
          console.error("Failed to parse salon session:", err);
          setError("Failed to parse salon session");
        }
      } else {
        console.error("No salon session found in localStorage");
        setError("No salon session found. Please login first.");
        setTimeout(() => {
          router.push("/auth/salon/login");
        }, 2000);
      }
    }
  }, [router]);

  useEffect(() => {
    if (!salonId) {
      console.log("No salonId yet, waiting...");
      return;
    }

    console.log("Fetching barbers for salon:", salonId);
    const fetchBarbers = async () => {
      setLoading(true);
      try {
        // Use the correct API endpoint
        const res = await axios.get(`/api/salons/barbers?salonId=${salonId}`);
        console.log("Barbers API response:", res.data);
        setBarbers(res.data);
        setError("");
      } catch (err) {
        console.error("Fetch barbers error:", err);
        console.error("Error response:", err.response?.data);
        setError(
          `Failed to fetch barbers: ${err.response?.data?.error || err.message}`
        );
      }
      setLoading(false);
    };

    fetchBarbers();
  }, [salonId]);

  // Rest of your component remains the same...
  const handleCreate = async () => {
    if (!newBarber.name) return alert("Name is required");
    if (!salonId) return alert("No salon session found");

    try {
      console.log("Creating barber:", { ...newBarber, salonId });
      const res = await axios.post("/api/salons/barbers", {
        ...newBarber,
        salonId,
      });
      console.log("Create response:", res.data);
      setBarbers([...barbers, res.data]);
      setNewBarber({ name: "", experience: 0, skills: [], bio: "", photo: "" });
      setShowForm(false);
      setError("");
    } catch (err) {
      console.error("Create barber error:", err);
      setError(
        `Failed to create barber: ${err.response?.data?.error || err.message}`
      );
    }
  };

  const handleSkillToggle = (skill) => {
    setNewBarber((prev) => ({
      ...prev,
      skills: prev.skills.includes(skill)
        ? prev.skills.filter((s) => s !== skill)
        : [...prev.skills, skill],
    }));
  };

  const toggleAvailability = async (barberId, currentStatus) => {
    try {
      await axios.put(`/api/salons/barbers/${barberId}`, {
        isAvailable: !currentStatus,
      });
      setBarbers(
        barbers.map((b) =>
          b._id === barberId ? { ...b, isAvailable: !currentStatus } : b
        )
      );
    } catch (err) {
      console.error("Toggle availability error:", err);
      setError("Failed to update barber status");
    }
  };

  // Show debug info while loading
  if (loading || !salonId) {
    return (
      <div className="max-w-6xl mx-auto p-6">
        <div className="mb-4 p-4 bg-blue-50 border border-blue-200 rounded">
          <h3 className="font-semibold text-blue-800 mb-2">
            Loading Barbers...
          </h3>
          <div className="text-sm space-y-1">
            <p>
              <strong>Salon ID:</strong> {salonId || "Loading..."}
            </p>
            <p>
              <strong>Loading:</strong> {loading.toString()}
            </p>
            <p>
              <strong>Error:</strong> {error || "None"}
            </p>
            <p>
              <strong>LocalStorage Keys:</strong>{" "}
              {typeof window !== "undefined"
                ? Object.keys(localStorage).join(", ")
                : "Not available"}
            </p>
            {typeof window !== "undefined" &&
              localStorage.getItem("salonSession") && (
                <p>
                  <strong>Session Data:</strong>{" "}
                  {localStorage.getItem("salonSession")}
                </p>
              )}
          </div>
        </div>
        {error && error.includes("No salon session") && (
          <div className="text-center py-8">
            <p className="text-red-600 mb-4">{error}</p>
            <button
              onClick={() => router.push("/auth/salon/login")}
              className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
            >
              Go to Login
            </button>
          </div>
        )}
      </div>
    );
  }

  return (
    <div className="max-w-6xl mx-auto p-6">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-bold">Barber Management</h1>
        <button
          onClick={() => setShowForm(!showForm)}
          className="bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700"
        >
          {showForm ? "Cancel" : "Add New Barber"}
        </button>
      </div>

      {error && <p className="text-red-500 mb-4">{error}</p>}

      {/* Add Barber Form */}
      {showForm && (
        <div className="mb-8 p-6 border rounded-lg shadow bg-gray-50">
          <h2 className="text-xl font-semibold mb-4">Add New Barber</h2>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <input
              type="text"
              placeholder="Barber Name"
              value={newBarber.name}
              onChange={(e) =>
                setNewBarber({ ...newBarber, name: e.target.value })
              }
              className="border rounded px-3 py-2 w-full"
            />
            <input
              type="number"
              placeholder="Years of Experience"
              value={newBarber.experience}
              onChange={(e) =>
                setNewBarber({
                  ...newBarber,
                  experience: parseInt(e.target.value) || 0,
                })
              }
              className="border rounded px-3 py-2 w-full"
            />
          </div>

          <div className="mb-4">
            <label className="block font-medium mb-2">
              Skills & Specializations
            </label>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
              {availableSkills.map((skill) => (
                <label key={skill} className="flex items-center">
                  <input
                    type="checkbox"
                    checked={newBarber.skills.includes(skill)}
                    onChange={() => handleSkillToggle(skill)}
                    className="mr-2"
                  />
                  {skill}
                </label>
              ))}
            </div>
          </div>

          <div className="mb-4">
            <label className="block font-medium mb-2">
              Bio/Accomplishments
            </label>
            <textarea
              placeholder="Describe achievements, awards, specialties..."
              value={newBarber.bio}
              onChange={(e) =>
                setNewBarber({ ...newBarber, bio: e.target.value })
              }
              rows={3}
              className="w-full border rounded px-3 py-2"
            />
          </div>

          <button
            onClick={handleCreate}
            className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
          >
            Add Barber
          </button>
        </div>
      )}

      {/* Barbers List */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {barbers.map((barber) => (
          <div
            key={barber._id}
            className="bg-white border rounded-lg shadow-md p-6"
          >
            <div className="flex justify-between items-start mb-4">
              <div>
                <h3 className="text-lg font-semibold">{barber.name}</h3>
                <p className="text-gray-600">
                  {barber.experience} years experience
                </p>
                <div className="flex items-center mt-1">
                  <span className="text-yellow-500">⭐</span>
                  <span className="ml-1">{barber.rating}/5</span>
                  <span className="text-gray-500 ml-2">
                    ({barber.totalBookings} bookings)
                  </span>
                </div>
              </div>

              <button
                onClick={() =>
                  toggleAvailability(barber._id, barber.isAvailable)
                }
                className={`px-3 py-1 rounded text-sm ${
                  barber.isAvailable
                    ? "bg-green-100 text-green-800"
                    : "bg-red-100 text-red-800"
                }`}
              >
                {barber.isAvailable ? "Available" : "Unavailable"}
              </button>
            </div>

            {/* Skills */}
            <div className="mb-3">
              <p className="font-medium text-sm mb-2">Specializations:</p>
              <div className="flex flex-wrap gap-1">
                {barber.skills.map((skill) => (
                  <span
                    key={skill}
                    className="bg-amber-100 text-amber-800 px-2 py-1 rounded text-xs"
                  >
                    {skill}
                  </span>
                ))}
              </div>
            </div>

            {/* Bio */}
            {barber.bio && (
              <div className="mb-3">
                <p className="text-gray-700 text-sm">{barber.bio}</p>
              </div>
            )}

            <div className="flex gap-2 mt-4">
              <Link href={`/salons/barbers/${barber._id}`} className="flex-1">
                <button className="w-full bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700">
                  Edit Details
                </button>
              </Link>
            </div>
          </div>
        ))}
      </div>

      {barbers.length === 0 && !loading && (
        <div className="text-center py-12">
          <p className="text-gray-500 mb-4">No barbers found for this salon.</p>
          <button
            onClick={() => setShowForm(true)}
            className="bg-amber-600 text-white px-6 py-3 rounded hover:bg-amber-700"
          >
            Add Your First Barber
          </button>
        </div>
      )}

      {/* Debug Info */}
      <div className="mt-8 p-4 bg-gray-100 rounded">
        <h3 className="font-semibold mb-2">Debug Info:</h3>
        <p>Salon ID: {salonId || "Not loaded"}</p>
        <p>Barbers Count: {barbers.length}</p>
        <p>Loading: {loading.toString()}</p>
        <p>Error: {error || "None"}</p>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/book.js">
// pages/salons/book.js
import { useRouter } from "next/router";
import { useState, useEffect } from "react";
import styles from "../../styles/Booking.module.css";
import Layout from "../../components/Layout/Layout";

export default function BookingPage() {
  const router = useRouter();
  const { salonId, serviceId, serviceName, price } = router.query;

  const [mobile, setMobile] = useState("");
  const [barbers, setBarbers] = useState([]);
  const [selectedBarber, setSelectedBarber] = useState("");
  const [selectedDate, setSelectedDate] = useState("");
  const [selectedSlot, setSelectedSlot] = useState("");
  const [slots, setSlots] = useState([]);
  const [userInfo, setUserInfo] = useState(null);

  useEffect(() => {
    // Get user info from session
    const sessionData = sessionStorage.getItem("userSession");
    if (sessionData) {
      const userData = JSON.parse(sessionData);
      setUserInfo(userData);
    }

    // Fetch barbers
    fetchBarbers();
  }, []);

  useEffect(() => {
    if (selectedBarber && selectedDate) {
      fetchAvailableSlots();
    }
  }, [selectedBarber, selectedDate]);

  const fetchBarbers = async () => {
    // Mock data - in production, fetch from API
    setBarbers([
      {
        id: "1",
        name: "Raj Kumar",
        rating: 4.5,
        specialization: "Hair Styling",
        bookings: 1250,
      },
      {
        id: "2",
        name: "Amit Singh",
        rating: 4.8,
        specialization: "Beard Expert",
        bookings: 980,
      },
      {
        id: "3",
        name: "Priya Sharma",
        rating: 4.7,
        specialization: "Color Specialist",
        bookings: 850,
      },
    ]);
  };

  const fetchAvailableSlots = async () => {
    // Generate time slots
    const allSlots = [];
    for (let hour = 9; hour < 21; hour++) {
      for (let min = 0; min < 60; min += 30) {
        const time = `${hour.toString().padStart(2, "0")}:${min
          .toString()
          .padStart(2, "0")}`;
        allSlots.push({
          time,
          available: Math.random() > 0.3, // Mock availability
          waitTime: Math.floor(Math.random() * 15),
        });
      }
    }
    setSlots(allSlots);
  };

  const handleBooking = async () => {
    if (!mobile || !selectedBarber || !selectedDate || !selectedSlot) {
      alert("Please fill all required fields");
      return;
    }

    const bookingData = {
      salonId,
      serviceId,
      barberId: selectedBarber,
      date: selectedDate,
      timeSlot: selectedSlot,
      userDetails: {
        name: userInfo?.name || "Guest",
        mobile,
        gender: userInfo?.gender || "other",
      },
    };

    try {
      const response = await fetch("/api/bookings/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(bookingData),
      });

      if (response.ok) {
        const result = await response.json();
        // Show success and redirect to confirmation
        alert("Booking Confirmed!");
        const bookingId = result?.booking?.id || result?.bookingId;
        if (bookingId) router.push(`/bookings?id=${bookingId}`);
        else router.push("/bookings");
      } else {
        alert("Booking failed. Please try again.");
      }
    } catch (error) {
      console.error("Booking error:", error);
      alert("Something went wrong. Please try again.");
    }
  };

  return (
    <Layout>
      <div className={styles.container}>
        <h1>Book Appointment</h1>
        <div className={styles.serviceInfo}>
          <h2>{serviceName}</h2>
          <span className={styles.price}>₹{price}</span>
        </div>

        <div className={styles.form}>
          <div className={styles.formGroup}>
            <label>📱 Mobile Number</label>
            <input
              type="tel"
              value={mobile}
              onChange={(e) => setMobile(e.target.value)}
              placeholder="Enter your mobile number"
              maxLength="10"
            />
          </div>

          <div className={styles.formGroup}>
            <label>👨‍🦱 Select Barber</label>
            <div className={styles.barberGrid}>
              {barbers.map((barber) => (
                <div
                  key={barber.id}
                  className={`${styles.barberCard} ${
                    selectedBarber === barber.id ? styles.selected : ""
                  }`}
                  onClick={() => setSelectedBarber(barber.id)}
                >
                  <div className={styles.barberInfo}>
                    <h3>{barber.name}</h3>
                    <p>
                      ⭐ {barber.rating} | {barber.specialization}
                    </p>
                    <p>{barber.bookings} bookings</p>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <div className={styles.formGroup}>
            <label>📅 Select Date</label>
            <input
              type="date"
              value={selectedDate}
              onChange={(e) => setSelectedDate(e.target.value)}
              min={new Date().toISOString().split("T")[0]}
            />
          </div>

          {slots.length > 0 && (
            <div className={styles.formGroup}>
              <label>⏰ Select Time Slot</label>
              <div className={styles.slotGrid}>
                {slots.map((slot) => (
                  <button
                    key={slot.time}
                    className={`${styles.slotBtn} 
                      ${!slot.available ? styles.unavailable : ""} 
                      ${selectedSlot === slot.time ? styles.selected : ""}`}
                    onClick={() => slot.available && setSelectedSlot(slot.time)}
                    disabled={!slot.available}
                  >
                    {slot.time}
                    {slot.available && slot.waitTime > 0 && (
                      <span className={styles.waitTime}>
                        ~{slot.waitTime}min wait
                      </span>
                    )}
                  </button>
                ))}
              </div>
            </div>
          )}

          <div className={styles.userDetails}>
            <p>Booking for: {userInfo?.name || "Guest"}</p>
            <p>Gender: {userInfo?.gender || "Not specified"}</p>
          </div>

          <button className={styles.confirmBtn} onClick={handleBooking}>
            Confirm Booking
          </button>
        </div>
      </div>
    </Layout>
  );
}
</file>

<file path="src/pages/user/dashboard.js">
import { useState, useEffect } from "react";
import { useRouter } from "next/router";
import styles from "../../styles/User.module.css";
import Link from "next/link";
import { UserDataManager } from "../../lib/userData";

export default function UserDashboard() {
  const router = useRouter();
  const [user, setUser] = useState(null);
  const [activeTab, setActiveTab] = useState("overview");
  const [bookings, setBookings] = useState([]);
  const [payments, setPayments] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    const loadUserData = async () => {
      try {
        const token = localStorage.getItem("userToken");

        if (!token) {
          router.push("/auth/user/login");
          return;
        }

        setIsLoading(true);

        // Simple profile load
        try {
          const userRes = await fetch("/api/user/profile", {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (userRes.ok) {
            const userData = await userRes.json();
            setUser(userData);
          }
        } catch (err) {
          console.error("Profile error:", err);
        }

        // Simple bookings load
        try {
          const bookingsRes = await fetch("/api/user/bookings", {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (bookingsRes.ok) {
            const bookingsData = await bookingsRes.json();
            setBookings(Array.isArray(bookingsData) ? bookingsData : []);
          }
        } catch (err) {
          console.error("Bookings error:", err);
          setBookings([]);
        }

        // Simple payments load
        try {
          const paymentsRes = await fetch("/api/user/payments", {
            headers: { Authorization: `Bearer ${token}` },
          });

          if (paymentsRes.ok) {
            const paymentsData = await paymentsRes.json();
            setPayments(Array.isArray(paymentsData) ? paymentsData : []);
          }
        } catch (err) {
          console.error("Payments error:", err);
          setPayments([]);
        }
      } catch (error) {
        console.error("Overall error:", error);
        setError(error.message);
      } finally {
        setIsLoading(false);
      }
    };

    loadUserData();
  }, [router]);

  const handleLogout = () => {
    UserDataManager.clearUserData();
    router.push("/");
  };

  if (isLoading) {
    return (
      <div className={styles.loading}>
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
        <p>Loading dashboard...</p>
      </div>
    );
  }

  if (error) {
    return (
      <div className={styles.error}>
        <p>Error: {error}</p>
        <button onClick={() => window.location.reload()}>Retry</button>
      </div>
    );
  }

  return (
    <div className={styles.dashboard}>
      <div className={styles.sidebar}>
        <div className={styles.userProfile}>
          <h2>Welcome, {user?.name || "User"}</h2>
          <p>{user?.email || "No email"}</p>
        </div>

        <nav className={styles.nav}>
          <button
            className={`${styles.navItem} ${
              activeTab === "overview" ? styles.active : ""
            }`}
            onClick={() => setActiveTab("overview")}
          >
            📊 Overview
          </button>
          <button
            className={`${styles.navItem} ${
              activeTab === "bookings" ? styles.active : ""
            }`}
            onClick={() => setActiveTab("bookings")}
          >
            📅 My Bookings
          </button>
          <button
            className={`${styles.navItem} ${
              activeTab === "payments" ? styles.active : ""
            }`}
            onClick={() => setActiveTab("payments")}
          >
            💳 Payments
          </button>
          <button
            className={`${styles.navItem} ${
              activeTab === "feedback" ? styles.active : ""
            }`}
            onClick={() => setActiveTab("feedback")}
          >
            ⭐ My Reviews
          </button>
          <button
            className={`${styles.navItem} ${
              activeTab === "profile" ? styles.active : ""
            }`}
            onClick={() => setActiveTab("profile")}
          >
            👤 Profile
          </button>
        </nav>

        <button className={styles.logoutButton} onClick={handleLogout}>
          🚪 Logout
        </button>
      </div>

      <div className={styles.content}>
        {activeTab === "overview" && (
          <div>
            <div className={styles.overview}>
              <Link href="/" className={styles.backLink}>
                Home
              </Link>
              <h1>Dashboard Overview</h1>
            </div>
            <div className={styles.stats}>
              <div className={styles.statCard}>
                <h3>Total Bookings</h3>
                <p>{bookings.length}</p>
              </div>
              <div className={styles.statCard}>
                <h3>Upcoming</h3>
                <p>{bookings.filter((b) => b.status === "confirmed").length}</p>
              </div>
              <div className={styles.statCard}>
                <h3>Completed</h3>
                <p>{bookings.filter((b) => b.status === "completed").length}</p>
              </div>
              <div className={styles.statCard}>
                <h3>Total Spent</h3>
                <p>
                  ₹{payments.reduce((total, p) => total + (p.amount || 0), 0)}
                </p>
              </div>
            </div>

            {/* Recent Bookings */}
            <div className={styles.recentSection}>
              <h2>Recent Bookings</h2>
              {bookings.slice(0, 3).map((booking) => (
                <div key={booking._id} className={styles.bookingCard}>
                  <h3>{booking.service}</h3>
                  <p>
                    📅 {booking.date} at {booking.time}
                  </p>
                  <p>🏪 {booking.salonName}</p>
                  <p>
                    Status:{" "}
                    <span className={`status-${booking.status}`}>
                      {booking.status}
                    </span>
                  </p>
                </div>
              ))}
              {bookings.length === 0 && (
                <p className={styles.noData}>
                  No bookings yet.{" "}
                  <Link href="/">Book your first service!</Link>
                </p>
              )}
            </div>
          </div>
        )}

        {activeTab === "bookings" && (
          <div className={styles.bookings}>
            <h1>My Bookings ({bookings.length})</h1>
            <div className={styles.bookingsList}>
              {bookings.map((booking) => (
                <div key={booking._id} className={styles.bookingCard}>
                  <div className={styles.bookingHeader}>
                    <h3>{booking.service}</h3>
                    <span
                      className={`${styles.statusBadge} ${
                        styles[booking.status]
                      }`}
                    >
                      {booking.status}
                    </span>
                  </div>
                  <div className={styles.bookingDetails}>
                    <p>
                      📅 <strong>Date:</strong> {booking.date}
                    </p>
                    <p>
                      🕐 <strong>Time:</strong> {booking.time}
                    </p>
                    <p>
                      🏪 <strong>Salon:</strong> {booking.salonName}
                    </p>
                    {booking.barber && (
                      <p>
                        👤 <strong>Barber:</strong> {booking.barber}
                      </p>
                    )}
                    <p>
                      💰 <strong>Price:</strong> ₹{booking.price || 0}
                    </p>
                    {booking.feedback?.submitted && (
                      <p>
                        ⭐ <strong>Your Rating:</strong>{" "}
                        {booking.feedback.ratings?.overall}/5
                      </p>
                    )}
                  </div>
                  {booking.status === "completed" &&
                    !booking.feedback?.submitted && (
                      <button
                        className={styles.feedbackButton}
                        onClick={() =>
                          router.push(`/feedback?bookingId=${booking._id}`)
                        }
                      >
                        📝 Give Feedback
                      </button>
                    )}
                </div>
              ))}
              {bookings.length === 0 && (
                <div className={styles.emptyState}>
                  <p>📅 No bookings found</p>
                  <button
                    onClick={() => router.push("/")}
                    className={styles.bookNowButton}
                  >
                    Book Your First Service
                  </button>
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === "payments" && (
          <div className={styles.payments}>
            <h1>Payment History ({payments.length})</h1>
            <div className={styles.paymentsList}>
              {payments.map((payment) => (
                <div key={payment._id} className={styles.paymentCard}>
                  <div className={styles.paymentHeader}>
                    <h3>₹{payment.amount}</h3>
                    <span
                      className={`${styles.statusBadge} ${
                        styles[payment.status]
                      }`}
                    >
                      {payment.status}
                    </span>
                  </div>
                  <div className={styles.paymentDetails}>
                    <p>
                      <strong>Service:</strong> {payment.service}
                    </p>
                    <p>
                      <strong>Date:</strong> {payment.date}
                    </p>
                    <p>
                      <strong>Payment Date:</strong>{" "}
                      {new Date(payment.createdAt).toLocaleDateString()}
                    </p>
                  </div>
                </div>
              ))}
              {payments.length === 0 && (
                <div className={styles.emptyState}>
                  <p>💳 No payments found</p>
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === "feedback" && (
          <div className={styles.feedback}>
            <h1>My Reviews</h1>
            <div className={styles.feedbackList}>
              {bookings
                .filter((b) => b.feedback?.submitted)
                .map((booking) => (
                  <div key={booking._id} className={styles.feedbackCard}>
                    <div className={styles.feedbackHeader}>
                      <h3>{booking.service}</h3>
                      <div className={styles.rating}>
                        <span>⭐ {booking.feedback.ratings?.overall}/5</span>
                      </div>
                    </div>
                    <div className={styles.feedbackDetails}>
                      <p>
                        <strong>Salon:</strong> {booking.salonName}
                      </p>
                      <p>
                        <strong>Date:</strong> {booking.date}
                      </p>
                      {booking.feedback.comment && (
                        <div className={styles.comment}>
                          <p>
                            <strong>Your Review:</strong>
                          </p>
                          <p>&quot;{booking.feedback.comment}&quot;</p>
                        </div>
                      )}
                    </div>
                  </div>
                ))}
              {bookings.filter((b) => b.feedback?.submitted).length === 0 && (
                <div className={styles.emptyState}>
                  <p>⭐ No reviews submitted yet</p>
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === "profile" && (
          <div className={styles.profile}>
            <h1>Profile Settings</h1>
            <div className={styles.profileCard}>
              <div className={styles.profileForm}>
                <div className={styles.formGroup}>
                  <label>Name</label>
                  <input type="text" value={user?.name || ""} readOnly />
                </div>
                <div className={styles.formGroup}>
                  <label>Email</label>
                  <input type="email" value={user?.email || ""} readOnly />
                </div>
                <div className={styles.formGroup}>
                  <label>Phone</label>
                  <input type="tel" value={user?.phone || ""} readOnly />
                </div>
                <div className={styles.formGroup}>
                  <label>Gender</label>
                  <input type="text" value={user?.gender || ""} readOnly />
                </div>
                <div className={styles.formGroup}>
                  <label>Member Since</label>
                  <input
                    type="text"
                    value={
                      user?.createdAt
                        ? new Date(user.createdAt).toLocaleDateString()
                        : ""
                    }
                    readOnly
                  />
                </div>
              </div>
              <div className={styles.profileActions}>
                <p className={styles.note}>
                  📝 Profile editing will be available in future updates
                </p>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/styles/globals.css">
@import url("https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700;800;900&display=swap");
@import "tailwindcss";

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  /* Luxury Color Palette */
  --gold-50: #fffbeb;
  --gold-100: #fef3c7;
  --gold-200: #fde68a;
  --gold-300: #fcd34d;
  --gold-400: #fbbf24;
  --gold-500: #f59e0b;
  --gold-600: #d97706;
  --gold-700: #b45309;
  --gold-800: #92400e;
  --gold-900: #78350f;

  --primary: #d4af37;
  --primary-dark: #b8941f;
  --primary-light: #f5e99b;
  --accent: #8b4513;
  --accent-light: #daa520;

  /* Neutral Colors */
  --white: #ffffff;
  --black: #000000;
  --gray-50: #fafafa;
  --gray-100: #f5f5f5;
  --gray-200: #e5e5e5;
  --gray-300: #d4d4d4;
  --gray-400: #a3a3a3;
  --gray-500: #737373;
  --gray-600: #525252;
  --gray-700: #404040;
  --gray-800: #262626;
  --gray-900: #171717;

  /* Semantic Colors */
  --success: #10b981;
  --warning: #f59e0b;
  --error: #ef4444;
  --info: #3b82f6;

  /* Light Theme */
  --background-primary: var(--white);
  --background-secondary: var(--gray-50);
  --background-tertiary: var(--gray-100);
  --text-primary: var(--gray-900);
  --text-secondary: var(--gray-600);
  --text-tertiary: var(--gray-400);
  --border-color: var(--gray-200);
  --border-color-hover: var(--primary);

  /* Typography */
  --font-display: "Playfair Display", serif;
  --font-body: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;

  /* Spacing Scale */
  --space-1: 0.25rem; /* 4px */
  --space-2: 0.5rem; /* 8px */
  --space-3: 0.75rem; /* 12px */
  --space-4: 1rem; /* 16px */
  --space-5: 1.25rem; /* 20px */
  --space-6: 1.5rem; /* 24px */
  --space-8: 2rem; /* 32px */
  --space-10: 2.5rem; /* 40px */
  --space-12: 3rem; /* 48px */
  --space-16: 4rem; /* 64px */
  --space-20: 5rem; /* 80px */
  --space-24: 6rem; /* 96px */
  --space-32: 8rem; /* 128px */

  /* Border Radius */
  --radius-xs: 0.25rem;
  --radius-sm: 0.375rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  --radius-2xl: 1.5rem;
  --radius-3xl: 2rem;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-sm: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
    0 4px 6px -4px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1),
    0 8px 10px -6px rgb(0 0 0 / 0.1);
  --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
  --shadow-luxury: 0 32px 64px -12px rgba(212, 175, 55, 0.25);

  /* Transitions */
  --transition-fast: 0.15s ease-out;
  --transition-normal: 0.3s ease-out;
  --transition-slow: 0.5s ease-out;
  --transition-luxury: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Dark Theme */
[data-theme="dark"] {
  --background-primary: var(--gray-900);
  --background-secondary: var(--gray-800);
  --background-tertiary: var(--gray-700);
  --text-primary: var(--white);
  --text-secondary: var(--gray-300);
  --text-tertiary: var(--gray-500);
  --border-color: var(--gray-700);
  --primary: #ffd700;
  --primary-dark: #e6c200;
  --primary-light: #fff4b3;
}

/* Base Styles */
html {
  scroll-behavior: smooth;
  font-size: 16px;
}

body {
  font-family: var(--font-body);
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--background-primary);
  transition: background-color var(--transition-normal),
    color var(--transition-normal);
  overflow-x: hidden;
}

/* Typography Scale */
.text-xs {
  font-size: 0.75rem;
  line-height: 1rem;
}
.text-sm {
  font-size: 0.875rem;
  line-height: 1.25rem;
}
.text-base {
  font-size: 1rem;
  line-height: 1.5rem;
}
.text-lg {
  font-size: 1.125rem;
  line-height: 1.75rem;
}
.text-xl {
  font-size: 1.25rem;
  line-height: 1.75rem;
}
.text-2xl {
  font-size: 1.5rem;
  line-height: 2rem;
}
.text-3xl {
  font-size: 1.875rem;
  line-height: 2.25rem;
}
.text-4xl {
  font-size: 2.25rem;
  line-height: 2.5rem;
}
.text-5xl {
  font-size: 3rem;
  line-height: 1;
}
.text-6xl {
  font-size: 3.75rem;
  line-height: 1;
}

/* Display Typography */
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: var(--font-display);
  font-weight: 700;
  line-height: 1.2;
  color: var(--text-primary);
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: var(--background-secondary);
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border-radius: var(--radius-full);
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, var(--primary-dark), var(--accent));
}

/* Luxury Button System */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-6);
  border: none;
  border-radius: var(--radius-lg);
  font-family: var(--font-body);
  font-size: 0.875rem;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  transition: all var(--transition-luxury);
  position: relative;
  overflow: hidden;
}

.btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.2),
    transparent
  );
  transition: left 0.5s ease;
}

.btn:hover::before {
  left: 100%;
}

.btn-primary {
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  color: var(--black);
  box-shadow: var(--shadow-lg), 0 0 20px rgba(212, 175, 55, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: var(--shadow-xl), 0 0 30px rgba(212, 175, 55, 0.4);
}

.btn-secondary {
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
}

.btn-secondary:hover {
  background: var(--primary);
  color: var(--black);
  transform: translateY(-2px);
}

.btn-ghost {
  background: rgba(212, 175, 55, 0.1);
  color: var(--primary);
  border: 1px solid rgba(212, 175, 55, 0.2);
}

.btn-ghost:hover {
  background: rgba(212, 175, 55, 0.2);
  transform: translateY(-1px);
}

/* Luxury Card System */
.card {
  background: var(--background-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-2xl);
  padding: var(--space-8);
  box-shadow: var(--shadow-sm);
  transition: all var(--transition-luxury);
  position: relative;
  overflow: hidden;
}

.card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--primary), transparent);
  opacity: 0;
  transition: opacity var(--transition-normal);
}

.card:hover {
  transform: translateY(-4px) scale(1.01);
  box-shadow: var(--shadow-luxury);
  border-color: var(--primary);
}

.card:hover::before {
  opacity: 1;
}

/* Form System */
.form-group {
  margin-bottom: var(--space-6);
}

.form-label {
  display: block;
  margin-bottom: var(--space-2);
  font-weight: 500;
  color: var(--text-primary);
  font-size: 0.875rem;
}

.form-input {
  width: 100%;
  padding: var(--space-4) var(--space-4);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-lg);
  font-size: 1rem;
  background-color: var(--background-primary);
  color: var(--text-primary);
  transition: all var(--transition-normal);
}

.form-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
  transform: scale(1.01);
}

.form-input::placeholder {
  color: var(--text-tertiary);
}

/* Animation Keyframes */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInDown {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-50px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(50px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes shimmer {
  0% {
    background-position: -200px 0;
  }
  100% {
    background-position: calc(200px + 100%) 0;
  }
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-10px);
  }
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Utility Classes */
.animate-fadeInUp {
  animation: fadeInUp 0.6s ease-out;
}
.animate-fadeInDown {
  animation: fadeInDown 0.6s ease-out;
}
.animate-slideInLeft {
  animation: slideInLeft 0.6s ease-out;
}
.animate-slideInRight {
  animation: slideInRight 0.6s ease-out;
}
.animate-scaleIn {
  animation: scaleIn 0.6s ease-out;
}
.animate-float {
  animation: float 3s ease-in-out infinite;
}
.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}
.animate-spin {
  animation: spin 1s linear infinite;
}

/* Gradient Text */
.gradient-text {
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 700;
}

/* Glass Effect */
.glass {
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .glass {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

/* Luxury Spinner */
.luxury-spinner {
  position: relative;
  width: 60px;
  height: 60px;
}

.spinner-ring {
  position: absolute;
  width: 100%;
  height: 100%;
  border: 3px solid transparent;
  border-top: 3px solid var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.spinner-core {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 20px;
  height: 20px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border-radius: 50%;
  animation: pulse 1.5s ease-in-out infinite;
}

/* Responsive Typography */
@media (max-width: 768px) {
  .text-6xl {
    font-size: 2.5rem;
  }
  .text-5xl {
    font-size: 2rem;
  }
  .text-4xl {
    font-size: 1.75rem;
  }
  .text-3xl {
    font-size: 1.5rem;
  }
}

/* Mobile Optimizations */
@media (max-width: 640px) {
  :root {
    --space-4: 0.875rem;
    --space-6: 1.25rem;
    --space-8: 1.75rem;
  }

  .btn {
    width: 100%;
    padding: var(--space-4) var(--space-6);
  }

  .card {
    padding: var(--space-6);
  }

  .form-input {
    font-size: 16px; /* Prevents zoom on iOS */
  }
}

/* Ultra Small Screens */
@media (max-width: 360px) {
  :root {
    --space-4: 0.75rem;
    --space-6: 1rem;
    --space-8: 1.5rem;
  }
}

/* Print Styles */
@media print {
  * {
    background: white !important;
    color: black !important;
    box-shadow: none !important;
  }
}
</file>

<file path="src/styles/SalonMap.module.css">
.mapContainer {
  position: relative;
  height: 600px;
  width: 100%;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}
.custom-popup .leaflet-popup-content-wrapper {
  border-radius: 8px !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
  padding: 0 !important;
  min-width: 50px !important;
}

.custom-popup .leaflet-popup-content {
  margin: 0 !important;
  padding: 0 !important;
  width: auto !important;
}

.custom-popup .leaflet-popup-tip {
  background: white !important;
}

.map {
  height: 100%;
  width: 100%;
  z-index: 1;
}

.mapLoading {
  height: 600px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
  border-radius: 20px;
  font-size: 18px;
  color: #6b7280;
}

/* Side Panel for Selected Salon */
.sidePanel {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 350px;
  max-height: calc(100% - 40px);
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  overflow-y: auto;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.closeButton {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 30px;
  height: 30px;
  border: none;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  z-index: 1001;
  transition: all 0.2s;
}

.closeButton:hover {
  background: rgba(0, 0, 0, 0.2);
  transform: scale(1.1);
}

/* Salon Card Styles */
.salonCard {
  background: white;
  border-radius: 16px;
  overflow: hidden;
}

.cardHeader {
  position: relative;
  height: 180px;
}

.salonImage {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.badges {
  position: absolute;
  top: 12px;
  left: 12px;
  display: flex;
  gap: 8px;
}

.badge {
  background: rgba(245, 158, 11, 0.9);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  backdrop-filter: blur(10px);
}

.cardContent {
  padding: 20px;
}

.salonName {
  font-size: 20px;
  font-weight: 700;
  color: #1f2937;
  margin: 0 0 8px 0;
}

.address {
  color: #6b7280;
  font-size: 14px;
  margin: 0 0 16px 0;
  line-height: 1.4;
}

.stats {
  display: flex;
  gap: 16px;
  margin-bottom: 20px;
}

.stat {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 14px;
  color: #374151;
}

.icon {
  font-size: 16px;
}

.services h4 {
  font-size: 16px;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 12px 0;
}

.serviceGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 20px;
}

.serviceItem {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  background: #f9fafb;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.serviceIcon {
  font-size: 16px;
}

.serviceItem div {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.serviceName {
  font-size: 12px;
  font-weight: 500;
  color: #374151;
}

.servicePrice {
  font-size: 12px;
  font-weight: 700;
  color: #f59e0b;
}

.bookButton {
  width: 100%;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.bookButton:hover {
  background: linear-gradient(135deg, #d97706, #b45309);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
}

/* Popup Styles */
.popupContent {
  min-width: 200px;
  padding: 8px;
}

.popupContent strong {
  display: block;
  margin-bottom: 4px;
  color: #1f2937;
}

.popupContent p {
  margin: 4px 0;
  font-size: 13px;
  color: #6b7280;
}

.popupButton {
  background: #f59e0b;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 8px;
  width: 100%;
  transition: background 0.2s;
}

.popupButton:hover {
  background: #d97706;
}

.userPopup {
  text-align: center;
  padding: 4px;
}

.userPopup strong {
  color: #3b82f6;
  font-size: 14px;
}

/* Dark mode support */
[data-theme="dark"] .salonCard,
[data-theme="dark"] .sidePanel {
  background: #1f2937;
  color: white;
}

[data-theme="dark"] .salonName {
  color: white;
}

[data-theme="dark"] .address {
  color: #9ca3af;
}

[data-theme="dark"] .stat {
  color: #d1d5db;
}

[data-theme="dark"] .services h4 {
  color: white;
}

[data-theme="dark"] .serviceItem {
  background: #374151;
  border-color: #4b5563;
}

[data-theme="dark"] .serviceName {
  color: #d1d5db;
}

[data-theme="dark"] .closeButton {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

[data-theme="dark"] .closeButton:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* Responsive */
@media (max-width: 768px) {
  .sidePanel {
    width: calc(100% - 40px);
    height: 400px;
    top: auto;
    bottom: 20px;
    right: 20px;
    left: 20px;
  }

  .mapContainer {
    height: 500px;
  }

  .serviceGrid {
    grid-template-columns: 1fr;
  }
}
</file>

<file path="src/components/Maps/SalonMap.js">
//pages/src/components/Maps/SalonMap.js
import React, { useEffect, useRef, useState, useMemo } from "react";
import { useRouter } from "next/router";
import { MapContainer, TileLayer, Marker, Popup, useMap } from "react-leaflet";
import L from "leaflet";
import "leaflet/dist/leaflet.css";
import styles from "../../styles/SalonMap.module.css";

// Fix for default markers in react-leaflet
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",
  iconUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",
  shadowUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
});

// Custom salon marker icon
const salonIcon = new L.Icon({
  iconUrl:
    "data:image/svg+xml;base64," +
    btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f59e0b" width="30" height="30">
      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
    </svg>
  `),
  iconSize: [60, 30],
  iconAnchor: [15, 30],
  popupAnchor: [0, -30],
});

// User location marker
const userIcon = new L.Icon({
  iconUrl: "/maps/usericon.jpg", // Put your icon here
  iconSize: [30, 30],
  iconAnchor: [15, 15],
});

const SalonCard = ({
  salon,
  userLocation,
  selectedSalon,
  onSalonSelect,
  onBookNow,
  userGender,
}) => {
  const getGenderServices = (gender) => {
    const maleServices = [
      { name: "Haircut", price: 200, icon: "✂️" },
      { name: "Beard Trim", price: 150, icon: "🧔" },
      { name: "Hair Styling", price: 250, icon: "💇‍♂️" },
      { name: "Face Cleanup", price: 300, icon: "🧴" },
    ];

    const femaleServices = [
      { name: "Haircut & Style", price: 400, icon: "💇‍♀️" },
      { name: "Hair Coloring", price: 800, icon: "🎨" },
      { name: "Facial Treatment", price: 600, icon: "✨" },
      { name: "Manicure", price: 350, icon: "💅" },
    ];

    return gender === "Male" ? maleServices : femaleServices;
  };

  const services =
    salon.topServices?.length > 0
      ? salon.topServices.slice(0, 4)
      : getGenderServices(userGender).slice(0, 4);

  return (
    <div className={styles.salonCard}>
      <div className={styles.cardHeader}>
        <img
          src={
            typeof salon.salonImages?.[0] === "string"
              ? salon.salonImages[0]
              : salon.salonImages?.[0]?.url ||
                "https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop"
          }
          alt={salon.salonName}
          className={styles.salonImage}
        />
        <div className={styles.badges}>
          {salon.distance < 2 && (
            <span className={styles.badge}>Very Close</span>
          )}
          {salon.isVerified && <span className={styles.badge}>Verified</span>}
        </div>
      </div>

      <div className={styles.cardContent}>
        <h3 className={styles.salonName}>{salon.salonName}</h3>
        <p className={styles.address}>{salon.location.address}</p>

        <div className={styles.stats}>
          <div className={styles.stat}>
            <span className={styles.icon}>⭐</span>
            <span>
              {(salon.ratings?.overall ?? salon.rating ?? 4.5).toFixed(1)}
            </span>
          </div>
          <div className={styles.stat}>
            <span className={styles.icon}>📍</span>
            <span>{salon.distance?.toFixed(1) || "1.2"} km</span>
          </div>
          <div className={styles.stat}>
            <span className={styles.icon}>👥</span>
            <span>{salon.stats?.totalBookings || 0} bookings</span>
          </div>
        </div>

        <div className={styles.services}>
          <h4>Popular Services</h4>
          <div className={styles.serviceGrid}>
            {services.map((service, idx) => (
              <div key={idx} className={styles.serviceItem}>
                <span className={styles.serviceIcon}>
                  {service.icon || "✂️"}
                </span>
                <div>
                  <span className={styles.serviceName}>{service.name}</span>
                  <span className={styles.servicePrice}>₹{service.price}</span>
                </div>
              </div>
            ))}
          </div>
        </div>

        <button
          className={styles.bookButton}
          onClick={() => onBookNow(salon._id)}
        >
          Book Now
        </button>
      </div>
    </div>
  );
};

const MapUpdater = ({ selectedSalon, salons }) => {
  const map = useMap();

  useEffect(() => {
    if (selectedSalon) {
      const salon = salons.find((s) => s._id === selectedSalon);
      if (salon && salon.location?.coordinates) {
        map.setView(
          [salon.location.coordinates[1], salon.location.coordinates[0]],
          16
        );
      }
    }
  }, [selectedSalon, salons, map]);

  return null;
};

// const AutoOpenPopup = ({ children, position, ...props }) => {
//   const map = useMap();

//   const popupOptions = useMemo(() => props, [props]);

//   useEffect(() => {
//     const marker = L.marker(position, { icon: salonIcon }).addTo(map);
//     const popup = L.popup(popupOptions).setContent(children);
//     marker.bindPopup(popup).openPopup();

//     return () => {
//       map.removeLayer(marker);
//     };
//   }, [map, position, children, popupOptions]);

//   return null;
// };

const SalonMap = ({
  salons,
  userLocation,
  selectedSalon,
  onSalonSelect,
  onBookNow,
  userGender,
}) => {
  const [mapLoaded, setMapLoaded] = useState(false);
  const selectedSalonData = salons.find((s) => s._id === selectedSalon);
  const router = useRouter();
  const mapRef = useRef(null);
  const [mapTheme, setMapTheme] = useState("standard");

  const mapThemes = {
    standard: {
      url: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      name: "Standard",
    },
    dark: {
      url: "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
      name: "Dark",
    },
    light: {
      url: "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
      name: "Light",
    },
    satellite: {
      url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
      name: "Satellite",
    },
    terrain: {
      url: "https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.png",
      name: "Terrain",
    },
  };

  const defaultCenter =
    userLocation?.lat && userLocation?.lng
      ? [userLocation.lat, userLocation.lng]
      : [19.076, 72.8777]; // Mumbai default
  const ThemeSelector = () => (
    <div className="absolute top-4 right-4 z-[1000] bg-white rounded-lg shadow-lg p-2 text-black">
      <select
        value={mapTheme}
        onChange={(e) => setMapTheme(e.target.value)}
        className="text-sm border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        {Object.entries(mapThemes).map(([key, theme]) => (
          <option key={key} value={key}>
            {theme.name}
          </option>
        ))}
      </select>
    </div>
  );
  // Add this component inside the MapContainer, after TileLayer
  const PopupOpener = ({ salons }) => {
    const map = useMap();

    useEffect(() => {
      const timer = setTimeout(() => {
        map.eachLayer((layer) => {
          if (layer instanceof L.Marker && layer.getPopup()) {
            layer.openPopup();
          }
        });
      }, 100);

      return () => clearTimeout(timer);
    }, [map, salons]);

    return null;
  };

  return (
    <div className={styles.mapContainer}>
      <ThemeSelector />
      <MapContainer
        center={defaultCenter}
        zoom={15}
        maxZoom={20}
        ref={mapRef}
        className={styles.map}
        whenCreated={() => setMapLoaded(true)}
      >
        <TileLayer
          url={mapThemes[mapTheme].url}
          attribution="&copy; Map Data"
        />
        <PopupOpener salons={salons} />
        <MapUpdater selectedSalon={selectedSalon} salons={salons} />

        {/* User location marker */}
        {userLocation?.lat && userLocation?.lng && (
          <Marker
            position={[userLocation.lat, userLocation.lng]}
            icon={userIcon}
          >
            <Popup>
              <div className={styles.userPopup}>
                <strong>Your Location</strong>
              </div>
            </Popup>
          </Marker>
        )}

        {/* Salon markers with always-open popups */}
        {salons.map((salon) => (
          <Marker
            key={salon._id}
            position={[
              salon.location.coordinates[1],
              salon.location.coordinates[0],
            ]}
            icon={salonIcon}
            eventHandlers={{
              click: () => onSalonSelect(salon),
            }}
          >
            <Popup
              autoClose={false}
              closeButton={false}
              closeOnClick={false}
              closeOnEscapeKey={false}
              autoPan={false}
              className="custom-popup"
            >
              <div className="text-center p-2 min-w-[20px]">
                <h3 className="font-bold text-sm mb-1">{salon.salonName}</h3>
                <p className="text-xs font-medium text-blue-600 ">
                  {salon.distance?.toFixed(1)}km away
                </p>
                <div className="flex flex-col gap-1">
                  <button
                    className="text-xs bg-orange-500 text-white rounded px-4 py-1 font-medium hover:bg-orange-600"
                    onClick={() => onSalonSelect(salon)}
                  >
                    View Details
                  </button>
                  <button
                    className="text-xs bg-blue-500 text-white rounded px-2 py-1 font-medium hover:bg-blue-600"
                    onClick={(e) => {
                      e.stopPropagation();
                      window.open(
                        `https://maps.google.com/maps?daddr=${salon.location.coordinates[1]},${salon.location.coordinates[0]}`
                      );
                    }}
                  >
                    Get Directions
                  </button>
                </div>
              </div>
            </Popup>
          </Marker>
        ))}

        {salons.map((salon) => (
          <Marker
            key={`marker-${salon._id}`}
            position={[
              salon.location.coordinates[1],
              salon.location.coordinates[0],
            ]}
            icon={salonIcon}
            eventHandlers={{
              click: () => onSalonSelect(salon),
            }}
          />
        ))}
      </MapContainer>

      {/* Salon Details Card */}
      {selectedSalonData && (
        <div className={styles.sidePanel}>
          <button
            className={styles.closeButton}
            onClick={() => onSalonSelect(null)}
          >
            ×
          </button>
          <SalonCard
            salon={selectedSalonData}
            onBookNow={onBookNow}
            userGender={userGender}
          />
        </div>
      )}
    </div>
  );
};

export default SalonMap;
</file>

<file path="src/components/OwnerSidebar.js">
import { useRouter } from "next/router";

export default function OwnerSidebar({ closeSidebar }) {
  const router = useRouter();

  const menuItems = [
    { icon: "👤", label: "Profile", path: "/salons/profile" },
    { icon: "📊", label: "Dashboard", path: "/salons/dashboard" },
    { icon: "📅", label: "Bookings", path: "/salons/bookings" },
    {
      icon: "👨‍💼",
      label: "Barber Management",
      href: "/salons/barbers",
      path: "/salons/barbers",
    },

    { icon: "👥", label: "Staff", path: "/salons/staff" },
    { icon: "✂️", label: "Services", path: "/salons/services" },
    { icon: "💰", label: "Payments", path: "/salons/payments" },
    { icon: "📈", label: "Analytics", path: "/salons/analytics" },
    { icon: "⚙️", label: "Settings", path: "/salons/settings" },
  ];

  const handleLogout = () => {
    localStorage.removeItem("ownerToken");
    router.push("/salons/login");
  };

  return (
    <div className="flex flex-col h-full bg-white shadow-md">
      {/* Logo */}
      <div className="p-6 border-b flex justify-between items-center">
        <div>
          <h2 className="text-xl font-bold gold-gradient-text">
            💈 SalonBook Pro
          </h2>
          <p className="text-sm text-text-secondary">Owner Dashboard</p>
        </div>
        {/* Mobile close button */}
        {closeSidebar && (
          <button
            onClick={closeSidebar}
            className="md:hidden p-2 rounded-md hover:bg-gray-100"
          >
            ❌
          </button>
        )}
      </div>

      {/* Nav Menu */}
      <nav className="flex-1 overflow-y-auto p-4 space-y-1">
        {menuItems.map((item) => (
          <button
            key={item.path}
            onClick={() => {
              router.push(item.path);
              if (closeSidebar) closeSidebar();
            }}
            className={`w-full flex items-center gap-3 px-4 py-2 rounded-lg transition-all ${
              router.pathname === item.path
                ? "bg-primary text-white shadow-md"
                : "hover:bg-gray-100 text-text-primary"
            }`}
          >
            <span className="text-lg">{item.icon}</span>
            <span className="capitalize">{item.label}</span>
          </button>
        ))}
      </nav>

      {/* Footer */}
      <div className="p-4 border-t">
        <button
          onClick={handleLogout}
          className="btn btn-secondary w-full flex items-center justify-center gap-2"
        >
          🚪 Logout
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/api/auth/salon/register.js">
import clientPromise from "../../../../lib/mongodb";
import {
  hashPassword,
  generateToken,
  getLocationFromCoordinates,
} from "../../../../lib/auth";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }
  const client = await clientPromise;
  const db = client.db("techtrims");
  const salons = db.collection("salons");
  const barbersCollection = db.collection("barbers");

  // ADD DATABASE CONNECTION VERIFICATION
  console.log("=== DATABASE CONNECTION DEBUG ===");
  console.log("Client connected:", !!client);
  console.log("Database name:", db.databaseName);
  console.log("Collections initialized:", !!salons && !!barbersCollection);

  // Test database write access
  try {
    await db.admin().ping();
    console.log("Database ping successful");
  } catch (pingError) {
    console.error("Database ping failed:", pingError);
  }

  console.log("=== END CONNECTION DEBUG ===");
  try {
    let {
      salonName,
      ownerName,
      email,
      phone,
      password,
      address,
      latitude,
      longitude,
      services,
      barbers = [],
      operatingHours,
      description,
      amenities,
      salonImages,
    } = req.body;

    console.log("Registration request:", {
      salonName,
      ownerName,
      barbers: barbers,
      barbersCount: barbers.length,
    });

    // Ensure latitude/longitude are numbers
    latitude = parseFloat(latitude);
    longitude = parseFloat(longitude);

    // Validate required fields
    const requiredFields = {
      salonName: "Salon name",
      ownerName: "Owner name",
      email: "Email",
      phone: "Phone number",
      password: "Password",
      address: "Address",
      latitude: "Location (latitude)",
      longitude: "Location (longitude)",
    };

    for (const [field, label] of Object.entries(requiredFields)) {
      if (!req.body[field]) {
        return res.status(400).json({
          message: `${label} is required`,
        });
      }
    }

    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      return res.status(400).json({ message: "Invalid email format" });
    }

    // Validate phone format (Indian format)
    const phoneRegex = /^[6-9]\d{9}$/;
    if (!phoneRegex.test(phone)) {
      return res
        .status(400)
        .json({ message: "Invalid phone number. Use 10-digit Indian format" });
    }

    // Validate password strength
    if (password.length < 6) {
      return res
        .status(400)
        .json({ message: "Password must be at least 6 characters long" });
    }

    // Validate coordinates
    if (isNaN(latitude) || isNaN(longitude)) {
      return res
        .status(400)
        .json({ message: "Location (latitude) is required" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");
    const salons = db.collection("salons");
    const barbersCollection = db.collection("barbers"); // ADD THIS LINE

    // Check if salon already exists
    const existingSalon = await salons.findOne({
      $or: [
        { email: email.toLowerCase() },
        { phone: phone },
        { salonName: salonName.trim() },
      ],
    });

    if (existingSalon) {
      return res.status(409).json({
        message: "Salon already exists with this email, phone number, or name",
      });
    }

    // Hash password
    const hashedPassword = await hashPassword(password);

    // Get location details from coordinates
    let locationDetails = {};
    try {
      let locationDetails = {};
      try {
        locationDetails = await getLocationFromCoordinates(latitude, longitude);
      } catch (err) {
        console.warn("Geocoding failed:", err.message);
        locationDetails = {
          city: "",
          state: "",
          country: "India",
          postcode: "",
        };
      }
    } catch (err) {
      console.warn("Geocoding failed, falling back to defaults:", err);
      locationDetails = { city: "", state: "", country: "India", postcode: "" };
    }

    // Default services if not provided
    const defaultServices = services || [
      { name: "Haircut", price: 200, duration: 30, gender: ["Male", "Female"] },
      {
        name: "Hair Wash",
        price: 100,
        duration: 15,
        gender: ["Male", "Female"],
      },
      { name: "Beard Trim", price: 150, duration: 20, gender: ["Male"] },
      { name: "Facial", price: 500, duration: 60, gender: ["Female"] },
    ];

    // Default operating hours if not provided
    const defaultOperatingHours = operatingHours || {
      monday: { open: "09:00", close: "20:00", closed: false },
      tuesday: { open: "09:00", close: "20:00", closed: false },
      wednesday: { open: "09:00", close: "20:00", closed: false },
      thursday: { open: "09:00", close: "20:00", closed: false },
      friday: { open: "09:00", close: "20:00", closed: false },
      saturday: { open: "09:00", close: "21:00", closed: false },
      sunday: { open: "10:00", close: "19:00", closed: false },
    };

    // Create new salon
    const newSalon = {
      salonName: salonName.trim(),
      ownerName: ownerName.trim(),
      email: email.toLowerCase(),
      phone: phone,
      hashedPassword,
      role: "salon",
      location: {
        type: "Point",
        coordinates: [parseFloat(longitude), parseFloat(latitude)],
        address: address.trim(),
        city: locationDetails?.city || "",
        state: locationDetails?.state || "",
        country: locationDetails?.country || "India",
        postcode: locationDetails?.postcode || "",
      },
      services: defaultServices,
      operatingHours: defaultOperatingHours,
      description: description || "",
      amenities: amenities || ["WiFi", "Air Conditioning", "Parking"],
      salonImages: salonImages || [],
      barbers: [],
      ratings: {
        overall: 0,
        serviceQuality: 0,
        timing: 0,
        ambience: 0,
        cleanliness: 0,
        totalReviews: 0,
      },
      stats: {
        totalBookings: 0,
        completedBookings: 0,
        repeatCustomers: 0,
        averageWaitTime: 0,
      },
      achievements: [],
      isVerified: false,
      isActive: true,
      createdAt: new Date(),
      updatedAt: new Date(),
    };

    const result = await salons.insertOne(newSalon);
    console.log("Creating salon with data:", newSalon);
    console.log("Salon created with ID:", result.insertedId);

    // CREATE BARBERS IF PROVIDED - ADD THIS SECTION
    let barbersCreatedCount = 0;
    let barberIds = [];

    if (barbers && barbers.length > 0) {
      console.log("Creating barbers for salon:", result.insertedId);

      try {
        const barberDocuments = barbers.map((barber) => ({
          salonId: result.insertedId, // Link to the salon
          name: barber.name || "",
          experience: parseInt(barber.experience) || 0,
          skills: Array.isArray(barber.skills) ? barber.skills : [],
          bio: barber.bio || "",
          photo: barber.photo || "",
          isAvailable: barber.isAvailable !== false, // Default to true
          workingHours: {
            start: "09:00",
            end: "21:00",
          },
          totalBookings: 0,
          rating: 5.0,
          accomplishments: [],
          earnings: 0,
          lastActiveAt: new Date(),
          createdAt: new Date(),
          updatedAt: new Date(),
        }));

        console.log("Inserting barbers:", barberDocuments);

        // Insert all barbers at once
        const barberResult = await barbersCollection.insertMany(
          barberDocuments
        );

        barbersCreatedCount = barberResult.insertedCount || 0;
        barberIds = Object.values(barberResult.insertedIds || {});

        console.log("Barbers created:", barbersCreatedCount);
        console.log("Barber IDs:", barberIds);

        // UPDATE SALON DOCUMENT WITH BARBER IDS
        console.log("Updating salon document with barber IDs...");
        const salonUpdateResult = await salons.updateOne(
          { _id: result.insertedId },
          {
            $set: {
              barbers: barberIds, // Add barber IDs to salon
              updatedAt: new Date(),
            },
          }
        );

        console.log("Salon update result:", salonUpdateResult);
      } catch (barberError) {
        console.error("Error creating barbers:", barberError);
        barbersCreatedCount = 0;
      }
    } else {
      console.log("No barbers provided");
    }

    // Generate JWT token
    const token = generateToken(result.insertedId, "salon", email);

    // Remove password from response
    const { hashedPassword: _, ...salonResponse } = newSalon;
    salonResponse._id = result.insertedId;
    console.log("Final barbersCreatedCount to send:", barbersCreatedCount);

    res.status(201).json({
      message: "Salon registered successfully",
      salon: salonResponse,
      barbersCreated: barbersCreatedCount, // ADD THIS LINE

      token,
    });
  } catch (error) {
    console.error("Salon registration error:", error);
    console.error("Salon registration error:", error.stack || error);
    res.status(500).json({ message: error.message || "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/nearby.js">
import { connectToDatabase } from "../../../lib/mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method Not Allowed" });
  }

  const { latitude, longitude, radius = 30 } = req.query;

  if (!latitude || !longitude) {
    return res.status(400).json({ message: "latitude and longitude required" });
  }

  const lat = parseFloat(latitude);
  const lng = parseFloat(longitude);
  const radiusKm = parseFloat(radius);

  let retryCount = 0;
  const maxRetries = 3;

  while (retryCount < maxRetries) {
    try {
      const { db } = await connectToDatabase();

      console.log("=== DEBUGGING SALON SEARCH ===");
      console.log("Search coordinates:", { lat, lng });
      console.log("Search radius:", radiusKm, "km");

      // Get all salons with timeout
      const allSalons = await db
        .collection("salons")
        .find({})
        .maxTimeMS(30000)
        .toArray();

      console.log(`Found ${allSalons.length} total salons in database`);

      // Filter salons by distance
      const nearbySalons = [];

      for (const salon of allSalons) {
        if (
          !salon.location?.coordinates ||
          salon.location.coordinates.length !== 2
        ) {
          continue;
        }

        const [salonLng, salonLat] = salon.location.coordinates;

        if (isNaN(salonLat) || isNaN(salonLng)) {
          continue;
        }

        const distance = calculateDistance(lat, lng, salonLat, salonLng);

        if (distance <= radiusKm) {
          nearbySalons.push({
            ...salon,
            calculatedDistance: distance,
          });
        }
      }

      // Process salon data
      const processedSalons = nearbySalons.map((salon) => ({
        ...salon,
        id: salon._id.toString(),
        distance: Number(salon.calculatedDistance.toFixed(2)),
        topServices: salon.services
          ? Object.entries(salon.services)
              .filter(([key, service]) => service.enabled)
              .slice(0, 3)
              .map(([key, service]) => ({
                name: key,
                price: Number(service.price || 0),
              }))
          : [],
        stats: {
          ...salon.stats,
          totalBookings: Number(salon.stats?.totalBookings || 0),
          rating: Number(salon.stats?.rating || 4.5),
          totalRatings: Number(salon.stats?.totalRatings || 0),
        },
      }));

      processedSalons.sort((a, b) => a.distance - b.distance);

      return res.status(200).json({
        success: true,
        salons: processedSalons,
      });
    } catch (err) {
      console.error(`Attempt ${retryCount + 1} failed:`, err.message);
      retryCount++;

      if (retryCount >= maxRetries) {
        console.error("Max retries reached. Final error:", err);
        return res.status(500).json({
          message: "Database connection failed after retries",
          error: err.message,
        });
      }

      // Wait before retrying
      await new Promise((resolve) => setTimeout(resolve, 1000 * retryCount));
    }
  }
}

function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = ((lat2 - lat1) * Math.PI) / 180;
  const dLon = ((lon2 - lon1) * Math.PI) / 180;
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos((lat1 * Math.PI) / 180) *
      Math.cos((lat2 * Math.PI) / 180) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}
</file>

<file path="src/pages/onboarding.js">
import { useState, useEffect } from "react";
import { useRouter } from "next/router";
import { motion } from "framer-motion";
import styles from "../styles/Onboarding.module.css";

export default function Onboarding() {
  const router = useRouter();
  const [currentStep, setCurrentStep] = useState(1);
  const [formData, setFormData] = useState({
    name: "",
    gender: "",
    location: {
      latitude: null,
      longitude: null,
      address: "",
    },
  });
  const [isLoading, setIsLoading] = useState(false);
  const [locationStatus, setLocationStatus] = useState("pending"); // pending, loading, success, error

  useEffect(() => {
    // Check if user has already completed onboarding
    const hasOnboarded = localStorage.getItem("hasOnboarded");
    if (hasOnboarded) {
      router.push("/");
    }
  }, [router]);

  const handleInputChange = (field, value) => {
    setFormData((prev) => ({
      ...prev,
      [field]: value,
    }));
  };

  const getCurrentLocation = () => {
    setLocationStatus("loading");

    if (!navigator.geolocation) {
      setLocationStatus("error");
      alert("Geolocation is not supported by this browser.");
      return;
    }

    navigator.geolocation.getCurrentPosition(
      async (position) => {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        console.log("🔍 ACTUAL GPS COORDINATES:", { latitude, longitude });

        try {
          // Reverse geocoding to get address
          const response = await fetch("/api/maps/reverse", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ lat: latitude, lng: longitude }),
          });

          if (!response.ok) {
            throw new Error("Failed to reverse geocode");
          }

          const data = await response.json();

          setFormData((prev) => ({
            ...prev,
            location: {
              latitude,
              longitude,
              address: data.address || `${latitude}, ${longitude}`,
            },
          }));
          setLocationStatus("success");
        } catch (error) {
          console.error("Error getting address:", error);
          setFormData((prev) => ({
            ...prev,
            location: {
              latitude,
              longitude,
              address: `${latitude}, ${longitude}`,
            },
          }));
          setLocationStatus("success");
        }
      },
      (error) => {
        console.error("Error getting location:", error);
        setLocationStatus("error");
        alert(
          "Unable to get your location. Please enter manually or try again."
        );
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 600000,
      }
    );
  };

  const handleManualLocation = (address) => {
    setFormData((prev) => ({
      ...prev,
      location: {
        latitude: null,
        longitude: null,
        address,
      },
    }));
    setLocationStatus("success");
  };

  const nextStep = () => {
    if (currentStep === 1 && formData.name.trim().length < 2) {
      alert("Please enter a valid name");
      return;
    }
    if (currentStep === 2 && !formData.gender) {
      alert("Please select your gender");
      return;
    }
    if (currentStep === 3 && locationStatus !== "success") {
      alert("Please set your location");
      return;
    }

    if (currentStep < 3) {
      setCurrentStep((prev) => prev + 1);
    } else {
      completeOnboarding();
    }
  };

  const prevStep = () => {
    if (currentStep > 1) {
      setCurrentStep((prev) => prev - 1);
    }
  };

  const completeOnboarding = () => {
    setIsLoading(true);

    // Store onboarding data in localStorage
    localStorage.setItem("userOnboardingData", JSON.stringify(formData));
    localStorage.setItem("hasOnboarded", "true");

    setTimeout(() => {
      setIsLoading(false);
      router.push("/");
    }, 1500);
  };

  const stepVariants = {
    hidden: { opacity: 0, x: 50 },
    visible: { opacity: 1, x: 0 },
    exit: { opacity: 0, x: -50 },
  };

  return (
    <div className={styles.container}>
      <div className={styles.background}>
        <div className={styles.goldOrb}></div>
        <div className={styles.goldOrb}></div>
      </div>

      <div className={styles.onboardingCard}>
        <div className={styles.header}>
          <h1 className={styles.title}>
            Welcome to <span className={styles.goldText}>TechTrims</span>
          </h1>
          <p className={styles.subtitle}>
            Let&apos;s personalize your experience
          </p>

          <div className={styles.progressBar}>
            <div className={styles.progressTrack}>
              <div
                className={styles.progressFill}
                style={{ width: `${(currentStep / 3) * 100}%` }}
              ></div>
            </div>
            <span className={styles.progressText}>{currentStep}/3</span>
          </div>
        </div>

        <motion.div
          key={currentStep}
          initial="hidden"
          animate="visible"
          exit="exit"
          variants={stepVariants}
          transition={{ duration: 0.3 }}
          className={styles.stepContent}
        >
          {currentStep === 1 && (
            <div className={styles.step}>
              <div className={styles.stepIcon}>👋</div>
              <h2>What&apos;s your name?</h2>
              <p>We&apos;ll use this to personalize your booking experience</p>

              <div className={styles.formGroup}>
                <input
                  type="text"
                  placeholder="Enter your full name"
                  value={formData.name}
                  onChange={(e) => handleInputChange("name", e.target.value)}
                  className={styles.input}
                  autoFocus
                />
              </div>
            </div>
          )}

          {currentStep === 2 && (
            <div className={styles.step}>
              <div className={styles.stepIcon}>⚧️</div>
              <h2>How do you identify?</h2>
              <p>This helps us show relevant services and pricing</p>

              <div className={styles.genderOptions}>
                {["Male", "Female", "Other"].map((gender) => (
                  <button
                    key={gender}
                    type="button"
                    className={`${styles.genderButton} ${
                      formData.gender === gender ? styles.selected : ""
                    }`}
                    onClick={() => handleInputChange("gender", gender)}
                  >
                    <div className={styles.genderIcon}>
                      {gender === "Male"
                        ? "👨"
                        : gender === "Female"
                        ? "👩"
                        : "🧑"}
                    </div>
                    <span>{gender}</span>
                  </button>
                ))}
              </div>
            </div>
          )}

          {currentStep === 3 && (
            <div className={styles.step}>
              <div className={styles.stepIcon}>📍</div>
              <h2>Where are you located?</h2>
              <p>We&apos;ll find the best salons near you</p>

              <div className={styles.locationSection}>
                {locationStatus === "pending" && (
                  <>
                    <button
                      type="button"
                      className={styles.locationButton}
                      onClick={getCurrentLocation}
                    >
                      <span>📍</span>
                      Use Current Location
                    </button>

                    <div className={styles.divider}>
                      <span>or</span>
                    </div>

                    <input
                      type="text"
                      placeholder="Enter your area/city manually"
                      className={styles.input}
                      onKeyPress={(e) => {
                        if (e.key === "Enter" && e.target.value.trim()) {
                          handleManualLocation(e.target.value.trim());
                        }
                      }}
                      onBlur={(e) => {
                        if (e.target.value.trim()) {
                          handleManualLocation(e.target.value.trim());
                        }
                      }}
                    />
                  </>
                )}

                {locationStatus === "loading" && (
                  <div className={styles.loadingLocation}>
                    <div className={styles.spinner}></div>
                    <p>Getting your location...</p>
                  </div>
                )}

                {locationStatus === "success" && (
                  <div className={styles.locationSuccess}>
                    <div className={styles.locationIcon}>✅</div>
                    <div>
                      <h4>Location Set!</h4>
                      <p>{formData.location.address}</p>
                    </div>
                    <button
                      type="button"
                      className={styles.changeLocationButton}
                      onClick={() => setLocationStatus("pending")}
                    >
                      Change
                    </button>
                  </div>
                )}

                {locationStatus === "error" && (
                  <div className={styles.locationError}>
                    <p>Couldn&apos;t get location. Please enter manually:</p>
                    <input
                      type="text"
                      placeholder="Enter your area/city"
                      className={styles.input}
                      onKeyPress={(e) => {
                        if (e.key === "Enter" && e.target.value.trim()) {
                          handleManualLocation(e.target.value.trim());
                        }
                      }}
                    />
                  </div>
                )}
              </div>
            </div>
          )}
        </motion.div>

        <div className={styles.navigation}>
          {currentStep > 1 && (
            <button
              type="button"
              className={styles.backButton}
              onClick={prevStep}
            >
              ← Back
            </button>
          )}

          <button
            type="button"
            className={styles.nextButton}
            onClick={nextStep}
            disabled={isLoading}
          >
            {isLoading ? (
              <>
                <div className={styles.spinner}></div>
                Setting up...
              </>
            ) : currentStep === 3 ? (
              "Complete Setup"
            ) : (
              "Next →"
            )}
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/styles/Home.module.css">
/* Container & Layout */
.container {
  min-height: 100vh;
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
  position: relative;
  overflow-x: hidden;
}

/* Enhanced Loading */
.loadingContainer {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--space-8);
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
}

.luxurySpinner {
  position: relative;
  width: 80px;
  height: 80px;
}

.spinnerRing {
  position: absolute;
  width: 100%;
  height: 100%;
  border: 4px solid transparent;
  border-top: 4px solid var(--white);
  border-radius: 50%;
  animation: spin 1.2s linear infinite;
}

.spinnerCore {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 30px;
  height: 30px;
  background: var(--white);
  border-radius: 50%;
  animation: pulse 1.8s ease-in-out infinite;
}

.loadingText {
  color: var(--white);
  font-size: 1.25rem;
  font-weight: 600;
  font-family: var(--font-display);
}

/* Enhanced Header */
.header {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--border-color);
  transition: all var(--transition-normal);
}

[data-theme="dark"] .header {
  background: rgba(23, 23, 23, 0.95);
}

.headerContent {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--space-6);
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 80px;
}

.logoContainer {
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.logoIcon {
  font-size: 2rem;
  animation: float 3s ease-in-out infinite;
}

.logo {
  font-family: var(--font-display);
  font-size: 2rem;
  font-weight: 800;
  color: var(--text-primary);
  display: flex;
  align-items: baseline;
  gap: var(--space-1);
}

.goldText {
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.trimText {
  color: var(--text-primary);
}

/* Desktop Navigation */
.desktopNav {
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.navLinks {
  display: flex;
  align-items: center;
  gap: var(--space-6);
}

.navLink {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-weight: 500;
  font-size: 0.95rem;
  cursor: pointer;
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-md);
  transition: all var(--transition-normal);
  position: relative;
}

.navLink::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 0;
  height: 2px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  transition: all var(--transition-normal);
  transform: translateX(-50%);
}

.navLink:hover {
  color: var(--primary);
  transform: translateY(-1px);
}

.navLink:hover::after {
  width: 100%;
}

.headerActions {
  display: flex;
  align-items: center;
  gap: var(--space-4);
}

.themeToggle {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  border: none;
  background: var(--background-secondary);
  border-radius: var(--radius-full);
  cursor: pointer;
  transition: all var(--transition-normal);
  position: relative;
  overflow: hidden;
}

.themeToggle:hover {
  background: var(--primary);
  transform: scale(1.1);
}

.themeIcon {
  font-size: 1.25rem;
  transition: transform var(--transition-normal);
}

.themeToggle:hover .themeIcon {
  transform: rotate(15deg) scale(1.1);
}

.actionButton {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-5);
  border-radius: var(--radius-full);
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all var(--transition-luxury);
  position: relative;
  overflow: hidden;
  border: none;
}

.actionButton::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.2),
    transparent
  );
  transition: left 0.5s ease;
}

.actionButton:hover::before {
  left: 100%;
}

.bookingButton {
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
}

.bookingButton:hover {
  background: var(--primary);
  color: var(--black);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.ownerButton {
  background: rgba(var(--primary), 0.1);
  color: var(--primary);
  border: 1px solid rgba(var(--primary), 0.3);
}

.ownerButton:hover {
  background: var(--primary);
  color: var(--black);
  transform: translateY(-2px);
}

.loginButton {
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  color: var(--black);
  border: none;
  box-shadow: var(--shadow-md);
}

.loginButton:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: var(--shadow-lg);
}

.buttonIcon {
  font-size: 1rem;
}

.dropdownArrow {
  font-size: 0.75rem;
  transition: transform var(--transition-normal);
}

.loginButton:hover .dropdownArrow {
  transform: rotate(180deg);
}

/* Login Dropdown */
.loginDropdown {
  position: relative;
}

.loginMenu {
  position: absolute;
  top: calc(100% + var(--space-2));
  right: 0;
  background: var(--background-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-xl);
  box-shadow: var(--shadow-xl);
  min-width: 200px;
  z-index: 1000;
  overflow: hidden;
}

.loginMenu button {
  width: 100%;
  padding: var(--space-4) var(--space-5);
  text-align: left;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 0.9rem;
  color: var(--text-primary);
  transition: all var(--transition-normal);
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.loginMenu button:hover {
  background: var(--background-secondary);
  color: var(--primary);
}

.loginMenu button:first-child:hover {
  border-radius: var(--radius-xl) var(--radius-xl) 0 0;
}

.loginMenu button:last-child:hover {
  border-radius: 0 0 var(--radius-xl) var(--radius-xl);
}

/* Mobile Menu */
.mobileMenuButton {
  display: none;
  flex-direction: column;
  justify-content: space-around;
  width: 40px;
  height: 40px;
  background: transparent;
  border: none;
  cursor: pointer;
  padding: var(--space-2);
}

.hamburgerLine {
  width: 100%;
  height: 3px;
  background: var(--text-primary);
  border-radius: var(--radius-sm);
  transition: all var(--transition-normal);
  transform-origin: center;
}

.hamburgerLine.active:nth-child(1) {
  transform: rotate(45deg) translateY(8px);
}

.hamburgerLine.active:nth-child(2) {
  opacity: 0;
}

.hamburgerLine.active:nth-child(3) {
  transform: rotate(-45deg) translateY(-8px);
}

.mobileNav {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: var(--background-primary);
  border-top: 1px solid var(--border-color);
  box-shadow: var(--shadow-lg);
  overflow: hidden;
}

.mobileNavLinks {
  padding: var(--space-6);
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.mobileNavLink {
  background: none;
  border: none;
  color: var(--text-primary);
  font-weight: 500;
  font-size: 1rem;
  cursor: pointer;
  padding: var(--space-4);
  text-align: left;
  border-radius: var(--radius-lg);
  transition: all var(--transition-normal);
  display: flex;
  align-items: center;
  gap: var(--space-3);
}

.mobileNavLink:hover {
  background: var(--background-secondary);
  color: var(--primary);
  transform: translateX(var(--space-2));
}

.mobileNavDivider {
  height: 1px;
  background: var(--border-color);
  margin: var(--space-2) 0;
}

/* Hero Section */
.heroSection {
  position: relative;
  min-height: calc(100vh - 80px);
  display: flex;
  align-items: center;
  padding: var(--space-20) 0;
  overflow: hidden;
}

.heroBackground {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -2;
}

.heroPattern {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(
      circle at 25% 25%,
      rgba(212, 175, 55, 0.1) 0%,
      transparent 25%
    ),
    radial-gradient(
      circle at 75% 75%,
      rgba(212, 175, 55, 0.05) 0%,
      transparent 25%
    ),
    radial-gradient(
      circle at 50% 10%,
      rgba(212, 175, 55, 0.08) 0%,
      transparent 20%
    );
  animation: float 8s ease-in-out infinite;
}

.floatingElements {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -1;
}

.floatingElement {
  position: absolute;
  font-size: 2rem;
  opacity: 0.6;
  animation: float 6s ease-in-out infinite;
}

.element1 {
  top: 20%;
  left: 10%;
  animation-delay: 0s;
}

.element2 {
  top: 30%;
  right: 15%;
  animation-delay: 1.5s;
}

.element3 {
  bottom: 30%;
  left: 20%;
  animation-delay: 3s;
}

.element4 {
  bottom: 20%;
  right: 25%;
  animation-delay: 4.5s;
}

.heroContent {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--space-6);
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-16);
  align-items: center;
}

.heroLeft {
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.heroTextContainer {
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.heroTitle {
  font-family: var(--font-display);
  font-size: clamp(2.5rem, 5vw, 4rem);
  font-weight: 800;
  line-height: 1.1;
  color: var(--text-primary);
}

.heroNameHighlight {
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  position: relative;
}

.heroSubtitle {
  font-size: 1.25rem;
  color: var(--text-secondary);
  line-height: 1.6;
  max-width: 90%;
}

.locationHighlight {
  color: var(--primary);
  font-weight: 600;
}

.heroStats {
  display: flex;
  gap: var(--space-8);
  margin: var(--space-6) 0;
}

.heroStat {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-4) var(--space-5);
  background: rgba(212, 175, 55, 0.1);
  border-radius: var(--radius-xl);
  border: 1px solid rgba(212, 175, 55, 0.2);
}

.statIcon {
  font-size: 1.5rem;
}

.statContent {
  display: flex;
  flex-direction: column;
  gap: var(--space-1);
}

.statNumber {
  font-size: 1.5rem;
  font-weight: 800;
  color: var(--primary);
  font-family: var(--font-display);
}

.statLabel {
  font-size: 0.875rem;
  color: var(--text-secondary);
  font-weight: 500;
}

.heroActions {
  display: flex;
  gap: var(--space-4);
}

.heroCta {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-5) var(--space-8);
  border-radius: var(--radius-full);
  font-weight: 700;
  font-size: 1rem;
  cursor: pointer;
  transition: all var(--transition-luxury);
  position: relative;
  overflow: hidden;
  border: none;
}

.heroCta.primary {
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  color: var(--black);
  box-shadow: var(--shadow-lg);
}

.heroCta.primary:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: var(--shadow-xl);
}

.heroCta.secondary {
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
}

.heroCta.secondary:hover {
  background: var(--primary);
  color: var(--black);
  transform: translateY(-3px);
}

.ctaIcon {
  font-size: 1.25rem;
}

/* Hero Right - Visuals */
.heroRight {
  position: relative;
  height: 600px;
}

.heroVisuals {
  position: relative;
  width: 100%;
  height: 100%;
}

.visualsContainer {
  position: relative;
  width: 100%;
  height: 100%;
}

.mainImage {
  position: relative;
  width: 80%;
  height: 70%;
  border-radius: var(--radius-3xl);
  overflow: hidden;
  box-shadow: var(--shadow-2xl);
  margin-left: auto;
}

.heroImage {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform var(--transition-slow);
}

.mainImage:hover .heroImage {
  transform: scale(1.05);
}

.imageGradient {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    45deg,
    rgba(212, 175, 55, 0.2) 0%,
    transparent 50%
  );
  pointer-events: none;
}

.floatingCards {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.floatingCard {
  position: absolute;
  background: var(--background-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-2xl);
  padding: var(--space-4) var(--space-5);
  box-shadow: var(--shadow-xl);
  display: flex;
  align-items: center;
  gap: var(--space-3);
  backdrop-filter: blur(10px);
  min-width: 180px;
}

.card1 {
  top: 10%;
  left: -10%;
  transform: rotate(-5deg);
}

.card2 {
  top: 40%;
  right: -15%;
  transform: rotate(8deg);
}

.card3 {
  bottom: 15%;
  left: 5%;
  transform: rotate(-3deg);
}

.cardIcon {
  font-size: 1.5rem;
}

.cardText {
  display: flex;
  flex-direction: column;
}

.cardTitle {
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.875rem;
}

.cardPrice {
  color: var(--primary);
  font-weight: 700;
  font-size: 0.75rem;
}

.decorativeShapes {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -1;
}

.shape {
  position: absolute;
  border-radius: 50%;
  opacity: 0.6;
}

.shape1 {
  top: 20%;
  right: 10%;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, var(--primary), transparent);
  animation: float 4s ease-in-out infinite;
}

.shape2 {
  bottom: 30%;
  left: 0%;
  width: 40px;
  height: 40px;
  background: linear-gradient(135deg, var(--accent), transparent);
  animation: float 5s ease-in-out infinite reverse;
}

.shape3 {
  top: 60%;
  right: 30%;
  width: 30px;
  height: 30px;
  background: linear-gradient(135deg, var(--primary-light), transparent);
  animation: float 6s ease-in-out infinite;
}

/* Search Section */
.searchSection {
  max-width: 1000px;
  margin: 0 auto;
  padding: var(--space-20) var(--space-6);
}

.searchContainer {
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
  align-items: center;
}

.searchBox {
  width: 100%;
  max-width: 700px;
  position: relative;
}

.searchInputWrapper {
  display: flex;
  align-items: center;
  background: var(--background-primary);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-full);
  padding: var(--space-2);
  box-shadow: var(--shadow-lg);
  transition: all var(--transition-normal);
}

.searchInputWrapper:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-xl);
}

.searchIcon {
  padding: 0 var(--space-4);
  font-size: 1.25rem;
  color: var(--text-secondary);
}

.searchInput {
  flex: 1;
  border: none;
  outline: none;
  padding: var(--space-4) var(--space-2);
  font-size: 1rem;
  color: var(--text-primary);
  background: transparent;
}

.searchInput::placeholder {
  color: var(--text-tertiary);
}

.searchButton {
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  color: var(--black);
  border: none;
  padding: var(--space-4) var(--space-8);
  border-radius: var(--radius-full);
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-luxury);
  box-shadow: var(--shadow-md);
}

.searchButton:hover {
  transform: scale(1.05);
  box-shadow: var(--shadow-lg);
}

.quickFilters {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  flex-wrap: wrap;
  justify-content: center;
}

.filtersLabel {
  font-weight: 600;
  color: var(--text-secondary);
  margin-right: var(--space-2);
}

.filterChip {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-5);
  background: var(--background-primary);
  border: 2px solid var(--border-color);
  border-radius: var(--radius-full);
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all var(--transition-normal);
  position: relative;
  overflow: hidden;
}

.filterChip::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: var(--filter-color, var(--primary));
  opacity: 0.1;
  transition: left var(--transition-normal);
}

.filterChip:hover::before {
  left: 0;
}

.filterChip:hover {
  border-color: var(--filter-color, var(--primary));
  color: var(--filter-color, var(--primary));
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.filterIcon {
  font-size: 1rem;
}

/* Services Section */
.servicesSection {
  max-width: 1400px;
  margin: 0 auto;
  padding: var(--space-24) var(--space-6);
}

.sectionHeader {
  text-align: center;
  margin-bottom: var(--space-16);
}

.sectionTitleContainer {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
  align-items: center;
}

.sectionTitle {
  font-family: var(--font-display);
  font-size: clamp(2rem, 4vw, 3rem);
  font-weight: 800;
  color: var(--text-primary);
  position: relative;
}

.sectionTitle::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 4px;
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  border-radius: var(--radius-sm);
}

.sectionSubtitle {
  font-size: 1.125rem;
  color: var(--text-secondary);
  max-width: 600px;
}

.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-8);
}

.serviceCard {
  position: relative;
  background: var(--background-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-3xl);
  padding: var(--space-10);
  text-align: center;
  transition: all var(--transition-luxury);
  cursor: pointer;
  overflow: hidden;
}

.serviceCardBackground {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    135deg,
    rgba(212, 175, 55, 0.05) 0%,
    transparent 100%
  );
  opacity: 0;
  transition: opacity var(--transition-normal);
}

.serviceCard:hover .serviceCardBackground {
  opacity: 1;
}

.serviceCard:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-luxury);
}

.serviceIcon {
  font-size: 3rem;
  margin-bottom: var(--space-6);
  display: block;
}

.serviceName {
  font-family: var(--font-display);
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: var(--space-4);
  color: var(--text-primary);
}

.serviceDetails {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: var(--space-6);
  margin-bottom: var(--space-6);
}

.servicePrice {
  font-size: 1.75rem;
  font-weight: 800;
  color: var(--primary);
  font-family: var(--font-display);
}

.serviceDuration {
  font-size: 0.875rem;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: var(--space-1);
}

.serviceBookButton {
  width: 100%;
  padding: var(--space-4) var(--space-6);
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
  border-radius: var(--radius-full);
  font-weight: 600;
  cursor: pointer;
  transition: all var(--transition-luxury);
}

.serviceBookButton:hover {
  background: var(--primary);
  color: var(--black);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

/* Salons Section */
.salonsSection {
  max-width: 1400px;
  margin: 0 auto;
  padding: var(--space-24) var(--space-6);
  background: linear-gradient(
    135deg,
    var(--background-secondary) 0%,
    var(--background-primary) 100%
  );
  border-radius: var(--radius-3xl) var(--radius-3xl) 0 0;
  margin-top: var(--space-16);
}

.viewOptions {
  display: flex;
  gap: var(--space-2);
  background: var(--background-secondary);
  padding: var(--space-1);
  border-radius: var(--radius-full);
}

.viewToggle {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  padding: var(--space-3) var(--space-6);
  background: transparent;
  color: var(--text-secondary);
  border: none;
  border-radius: var(--radius-full);
  font-weight: 600;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all var(--transition-normal);
}

.viewToggle.active {
  background: var(--background-primary);
  color: var(--primary);
  box-shadow: var(--shadow-sm);
}

.viewToggle:hover:not(.active) {
  background: rgba(212, 175, 55, 0.1);
  color: var(--primary);
}

.viewIcon {
  font-size: 1rem;
}

.mapContainer {
  margin-top: var(--space-8);
  border-radius: var(--radius-3xl);
  overflow: hidden;
  box-shadow: var(--shadow-xl);
  height: 600px;
}

.loadingSalons {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-20);
  gap: var(--space-6);
}

.loadingSalons p {
  color: var(--text-secondary);
  font-size: 1.125rem;
  font-weight: 500;
}

.salonsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: var(--space-8);
  margin-top: var(--space-8);
}

.salonCard {
  background: var(--background-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-3xl);
  overflow: hidden;
  transition: all var(--transition-luxury);
  cursor: pointer;
  position: relative;
}

.salonCard::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    135deg,
    rgba(212, 175, 55, 0.1) 0%,
    transparent 100%
  );
  opacity: 0;
  transition: opacity var(--transition-normal);
  z-index: 1;
  pointer-events: none;
}

.salonCard:hover::before {
  opacity: 1;
}

.salonCard:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-luxury);
}

.salonImageContainer {
  position: relative;
  height: 240px;
  overflow: hidden;
}

.salonImage {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform var(--transition-slow);
}

.salonCard:hover .salonImage {
  transform: scale(1.05);
}

.salonImageOverlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(45deg, rgba(0, 0, 0, 0.1) 0%, transparent 50%);
}

.salonBadges {
  position: absolute;
  top: var(--space-4);
  left: var(--space-4);
  right: var(--space-4);
  display: flex;
  justify-content: space-between;
  z-index: 2;
}

.salonBadge {
  padding: var(--space-2) var(--space-4);
  border-radius: var(--radius-full);
  font-size: 0.75rem;
  font-weight: 700;
  backdrop-filter: blur(10px);
}

.primaryBadge {
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  color: var(--black);
}

.distanceBadge {
  background: rgba(0, 0, 0, 0.7);
  color: var(--white);
}

.salonInfo {
  padding: var(--space-8);
  position: relative;
  z-index: 2;
}

.salonHeader {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-4);
}

.salonName {
  font-family: var(--font-display);
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0;
  line-height: 1.2;
}

.salonRating {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: var(--space-1);
}

.ratingStars {
  font-size: 0.875rem;
  filter: grayscale(0.7);
  transition: filter var(--transition-normal);
}

.salonCard:hover .ratingStars {
  filter: grayscale(0);
}

.ratingNumber {
  font-size: 0.875rem;
  font-weight: 700;
  color: var(--primary);
}

.salonLocation {
  color: var(--text-secondary);
  font-size: 0.875rem;
  margin-bottom: var(--space-5);
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.salonMetrics {
  display: flex;
  gap: var(--space-6);
  margin-bottom: var(--space-6);
}

.metric {
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.metricIcon {
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.metricValue {
  font-size: 0.875rem;
  color: var(--text-secondary);
  font-weight: 500;
}

.salonServices {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-2);
  margin-bottom: var(--space-8);
}

.serviceTag {
  background: var(--background-secondary);
  color: var(--text-secondary);
  padding: var(--space-2) var(--space-3);
  border-radius: var(--radius-full);
  font-size: 0.75rem;
  font-weight: 500;
  border: 1px solid var(--border-color);
  transition: all var(--transition-normal);
}

.serviceTag:hover {
  background: rgba(212, 175, 55, 0.1);
  border-color: var(--primary);
  color: var(--primary);
}

.serviceTag strong {
  color: var(--primary);
  margin-left: var(--space-1);
}

.salonBookButton {
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-3);
  padding: var(--space-5) var(--space-6);
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  color: var(--black);
  border: none;
  border-radius: var(--radius-full);
  font-weight: 700;
  font-size: 1rem;
  cursor: pointer;
  transition: all var(--transition-luxury);
  position: relative;
  overflow: hidden;
}

.salonBookButton::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  transition: left 0.5s ease;
}

.salonBookButton:hover::before {
  left: 100%;
}

.salonBookButton:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: var(--shadow-xl);
}

.bookButtonIcon {
  font-size: 1.125rem;
}

.bookButtonArrow {
  font-size: 1.125rem;
  transition: transform var(--transition-normal);
}

.salonBookButton:hover .bookButtonArrow {
  transform: translateX(var(--space-1));
}

/* No Salons State */
.noSalons {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--space-20);
  text-align: center;
  background: var(--background-secondary);
  border-radius: var(--radius-3xl);
  border: 2px dashed var(--border-color);
  margin-top: var(--space-8);
}

.noSalonsIcon {
  font-size: 4rem;
  margin-bottom: var(--space-6);
  opacity: 0.6;
}

.noSalonsTitle {
  font-family: var(--font-display);
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-primary);
  margin-bottom: var(--space-4);
}

.noSalonsText {
  color: var(--text-secondary);
  font-size: 1rem;
  margin-bottom: var(--space-8);
  max-width: 400px;
}

.registerSalonButton {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  padding: var(--space-5) var(--space-8);
  background: linear-gradient(
    135deg,
    var(--primary) 0%,
    var(--primary-dark) 100%
  );
  color: var(--black);
  border: none;
  border-radius: var(--radius-full);
  font-weight: 700;
  font-size: 1rem;
  cursor: pointer;
  transition: all var(--transition-luxury);
  box-shadow: var(--shadow-lg);
}

.registerSalonButton:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: var(--shadow-xl);
}

.registerIcon {
  font-size: 1.25rem;
}

/* Testimonials Section */
.testimonialsSection {
  max-width: 1400px;
  margin: 0 auto;
  padding: var(--space-24) var(--space-6);
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
}

.testimonialsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: var(--space-8);
  margin-top: var(--space-12);
}

.testimonialCard {
  background: var(--background-primary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-3xl);
  padding: var(--space-8);
  transition: all var(--transition-luxury);
  position: relative;
  overflow: hidden;
}

.testimonialCard::before {
  content: '"';
  position: absolute;
  top: var(--space-6);
  right: var(--space-6);
  font-size: 4rem;
  color: var(--primary);
  opacity: 0.2;
  font-family: var(--font-display);
  line-height: 1;
}

.testimonialCard:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-luxury);
}

.testimonialHeader {
  display: flex;
  align-items: center;
  gap: var(--space-4);
  margin-bottom: var(--space-6);
}

.testimonialAvatar {
  width: 60px;
  height: 60px;
  border-radius: var(--radius-full);
  object-fit: cover;
  border: 3px solid var(--primary);
}

.testimonialMeta {
  flex: 1;
}

.testimonialName {
  font-family: var(--font-display);
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--text-primary);
  margin: 0 0 var(--space-1) 0;
}

.testimonialService {
  color: var(--text-secondary);
  font-size: 0.875rem;
  margin: 0 0 var(--space-2) 0;
}

.testimonialRating {
  font-size: 0.875rem;
}

.testimonialText {
  color: var(--text-secondary);
  font-size: 1rem;
  line-height: 1.6;
  font-style: italic;
  margin: 0;
}

/* Enhanced Footer */
.footer {
  background: linear-gradient(135deg, var(--gray-900) 0%, var(--black) 100%);
  color: var(--white);
  position: relative;
  overflow: hidden;
}

.footer::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--primary), transparent);
}

.footerContent {
  max-width: 1400px;
  margin: 0 auto;
  padding: var(--space-20) var(--space-6) 0;
}

.footerMain {
  display: grid;
  grid-template-columns: 1fr 2fr;
  gap: var(--space-16);
  margin-bottom: var(--space-16);
}

.footerBrand {
  display: flex;
  flex-direction: column;
  gap: var(--space-6);
}

.footerLogo {
  display: flex;
  align-items: center;
  gap: var(--space-3);
  margin-bottom: var(--space-4);
}

.footerLogoIcon {
  font-size: 2rem;
  animation: float 3s ease-in-out infinite;
}

.footerLogo h4 {
  font-family: var(--font-display);
  font-size: 2rem;
  font-weight: 800;
  color: var(--primary);
  margin: 0;
}

.footerTagline {
  color: var(--gray-300);
  font-size: 1.125rem;
  line-height: 1.6;
  max-width: 300px;
  margin: 0;
}

.footerSocials {
  display: flex;
  gap: var(--space-4);
}

.socialButton {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 44px;
  height: 44px;
  background: rgba(212, 175, 55, 0.1);
  border: 1px solid rgba(212, 175, 55, 0.3);
  border-radius: var(--radius-full);
  font-size: 1.25rem;
  cursor: pointer;
  transition: all var(--transition-normal);
}

.socialButton:hover {
  background: var(--primary);
  transform: translateY(-2px) scale(1.1);
  box-shadow: var(--shadow-lg);
}

.footerLinks {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-10);
}

.footerColumn {
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
}

.footerColumnTitle {
  font-family: var(--font-display);
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--primary);
  margin: 0 0 var(--space-4) 0;
}

.footerList {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.footerList li a {
  color: var(--gray-300);
  text-decoration: none;
  transition: all var(--transition-normal);
  font-size: 0.95rem;
}

.footerList li a:hover {
  color: var(--primary);
  transform: translateX(var(--space-2));
}

.footerContact {
  display: flex;
  flex-direction: column;
  gap: var(--space-3);
}

.footerContact p {
  color: var(--gray-300);
  margin: 0;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  gap: var(--space-2);
}

.footerBottom {
  border-top: 1px solid var(--gray-800);
  padding: var(--space-8) 0;
}

.footerBottomContent {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: var(--space-4);
}

.footerBottomContent p {
  color: var(--gray-400);
  margin: 0;
  font-size: 0.875rem;
}

.footerBadges {
  display: flex;
  gap: var(--space-4);
}

.footerBadge {
  display: flex;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-2) var(--space-3);
  background: rgba(212, 175, 55, 0.1);
  color: var(--primary);
  border-radius: var(--radius-md);
  font-size: 0.75rem;
  font-weight: 600;
}

/* Responsive Design */
@media (max-width: 1024px) {
  .heroContent {
    grid-template-columns: 1fr;
    gap: var(--space-12);
    text-align: center;
  }

  .heroRight {
    height: 500px;
  }

  .heroStats {
    justify-content: center;
    flex-wrap: wrap;
  }

  .footerMain {
    grid-template-columns: 1fr;
    gap: var(--space-12);
    text-align: center;
  }
}

@media (max-width: 768px) {
  .desktopNav {
    display: none;
  }

  .mobileMenuButton {
    display: flex;
  }

  .headerContent {
    height: 70px;
    padding: 0 var(--space-4);
  }

  .heroSection {
    padding: var(--space-12) 0;
  }

  .heroTitle {
    font-size: 2.5rem;
  }

  .heroSubtitle {
    font-size: 1.125rem;
  }

  .heroActions {
    flex-direction: column;
    width: 100%;
  }

  .heroCta {
    width: 100%;
    justify-content: center;
  }

  .heroRight {
    height: 400px;
  }

  .servicesGrid {
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-6);
  }

  .salonsGrid {
    grid-template-columns: 1fr;
    gap: var(--space-6);
  }

  .testimonialsGrid {
    grid-template-columns: 1fr;
    gap: var(--space-6);
  }

  .searchSection {
    padding: var(--space-16) var(--space-4);
  }

  .servicesSection {
    padding: var(--space-16) var(--space-4);
  }

  .salonsSection {
    padding: var(--space-16) var(--space-4);
  }

  .testimonialsSection {
    padding: var(--space-16) var(--space-4);
  }

  .sectionHeader {
    flex-direction: column;
    gap: var(--space-4);
    text-align: center;
  }

  .quickFilters {
    justify-content: center;
  }

  .filtersLabel {
    width: 100%;
    text-align: center;
    margin-bottom: var(--space-2);
  }

  .footerContent {
    padding: var(--space-12) var(--space-4) 0;
  }

  .footerLinks {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: var(--space-8);
    text-align: center;
  }

  .footerBottomContent {
    flex-direction: column;
    text-align: center;
  }
}

@media (max-width: 640px) {
  .heroStats {
    flex-direction: column;
    gap: var(--space-4);
  }

  .heroStat {
    flex-direction: row;
    justify-content: center;
    padding: var(--space-3) var(--space-4);
  }

  .servicesGrid {
    grid-template-columns: 1fr;
  }

  .serviceCard {
    padding: var(--space-8);
  }

  .searchBox {
    margin: 0 var(--space-2);
  }

  .searchInputWrapper {
    padding: var(--space-1);
  }

  .searchInput {
    padding: var(--space-3) var(--space-2);
    font-size: 16px; /* Prevents zoom on iOS */
  }

  .searchButton {
    padding: var(--space-3) var(--space-6);
  }

  .quickFilters {
    gap: var(--space-2);
  }

  .filterChip {
    padding: var(--space-2) var(--space-4);
    font-size: 0.8rem;
  }

  .viewOptions {
    width: 100%;
    justify-content: center;
  }
}

@media (max-width: 420px) {
  .logo {
    font-size: 1.5rem;
  }

  .heroTitle {
    font-size: 2rem;
  }

  .heroSubtitle {
    font-size: 1rem;
  }

  .sectionTitle {
    font-size: 1.75rem;
  }

  .serviceCard {
    padding: var(--space-6);
  }

  .serviceName {
    font-size: 1.25rem;
  }

  .servicePrice {
    font-size: 1.5rem;
  }

  .salonInfo {
    padding: var(--space-6);
  }

  .salonName {
    font-size: 1.25rem;
  }

  .mapContainer {
    height: 400px;
  }
}

@media (max-width: 360px) {
  .headerContent {
    padding: 0 var(--space-3);
  }

  .heroSection {
    padding: var(--space-10) 0;
  }

  .heroTitle {
    font-size: 1.75rem;
  }

  .searchSection {
    padding: var(--space-12) var(--space-3);
  }

  .servicesSection {
    padding: var(--space-12) var(--space-3);
  }

  .salonsSection {
    padding: var(--space-12) var(--space-3);
  }

  .footerContent {
    padding: var(--space-10) var(--space-3) 0;
  }
}

/* Animations */
@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

@keyframes pulse {
  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }
  50% {
    opacity: 0.8;
    transform: scale(0.95);
  }
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0px);
  }
  50% {
    transform: translateY(-8px);
  }
}

/* Print Styles */
@media print {
  .header,
  .footer,
  .mobileMenuButton,
  .themeToggle {
    display: none !important;
  }

  .container {
    background: white !important;
  }

  .container * {
    color: black !important;
    background: white !important;
    box-shadow: none !important;
  }
}
</file>

<file path="src/styles/SalonDetail.module.css">
/* Salon Detail Page Styles - Direct color values for CSS modules */

.container {
  min-height: 100vh;
  background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #0f0f0f 100%);
  color: #ffffff;
  position: relative;
  overflow-x: hidden;
}

.container::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: radial-gradient(
      circle at 20% 80%,
      rgba(212, 175, 55, 0.1) 0%,
      transparent 50%
    ),
    radial-gradient(
      circle at 80% 20%,
      rgba(212, 175, 55, 0.08) 0%,
      transparent 50%
    );
  pointer-events: none;
  z-index: 0;
}

/* Header */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.5rem 2rem;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(20px);
  border-bottom: 1px solid rgba(212, 175, 55, 0.2);
  position: sticky;
  top: 0;
  z-index: 50;
  animation: slideInDown 0.8s ease-out;
}

@keyframes slideInDown {
  from {
    opacity: 0;
    transform: translateY(-30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.backButton {
  background: transparent;
  border: 1px solid rgba(212, 175, 55, 0.3);
  color: #d4af37;
  padding: 0.75rem 1.25rem;
  border-radius: 0.75rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-family: inherit;
}

.backButton:hover {
  background: rgba(212, 175, 55, 0.1);
  border-color: #d4af37;
  transform: translateX(-4px);
  box-shadow: 0 4px 15px rgba(212, 175, 55, 0.2);
}

.salonName {
  font-family: "Playfair Display", serif;
  font-size: 1.5rem;
  font-weight: 700;
  background: linear-gradient(135deg, #d4af37, #ffffff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-align: center;
  flex: 1;
}

.headerActions {
  display: flex;
  gap: 0.75rem;
}

.shareButton,
.favoriteButton {
  background: rgba(212, 175, 55, 0.1);
  border: 1px solid rgba(212, 175, 55, 0.2);
  color: #d4af37;
  width: 44px;
  height: 44px;
  border-radius: 0.75rem;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  font-size: 1.1rem;
}

.shareButton:hover,
.favoriteButton:hover {
  background: rgba(212, 175, 55, 0.2);
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3);
}

/* Hero Section */
.heroSection {
  padding: 2rem;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 3rem;
  align-items: start;
  position: relative;
  z-index: 1;
}

.imageGallery {
  position: relative;
  border-radius: 2rem;
  overflow: hidden;
  box-shadow: 0 32px 64px -12px rgba(212, 175, 55, 0.25);
  animation: fadeInUp 1s ease-out 0.2s both;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.mainImage {
  width: 100%;
  height: 400px;
  object-fit: cover;
  transition: transform 0.5s ease-out;
}

.imageGallery:hover .mainImage {
  transform: scale(1.05);
}

.placeholderImage {
  width: 100%;
  height: 400px;
  background: linear-gradient(
    135deg,
    rgba(212, 175, 55, 0.1),
    rgba(212, 175, 55, 0.05)
  );
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 2px dashed rgba(212, 175, 55, 0.3);
  border-radius: 1.5rem;
  color: #a3a3a3;
}

.placeholderImage span {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.7;
}

.salonBasicInfo {
  display: flex;
  flex-direction: column;
  gap: 2rem;
  animation: fadeInUp 1s ease-out 0.4s both;
}

.ratingSection {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1.5rem;
  background: rgba(212, 175, 55, 0.08);
  border: 1px solid rgba(212, 175, 55, 0.2);
  border-radius: 1.5rem;
  backdrop-filter: blur(10px);
}

.mainRating {
  font-size: 2rem;
  font-weight: 700;
  color: #d4af37;
  font-family: "Playfair Display", serif;
}

.reviewCount {
  color: #737373;
  font-size: 0.9rem;
}

.locationInfo {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.03);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 1.5rem;
  backdrop-filter: blur(10px);
}

.locationInfo p {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  color: #ffffff;
  font-weight: 400;
  margin: 0;
}

.quickStats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
}

.stat {
  text-align: center;
  padding: 1.25rem;
  background: rgba(212, 175, 55, 0.05);
  border: 1px solid rgba(212, 175, 55, 0.15);
  border-radius: 1rem;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.stat:hover {
  background: rgba(212, 175, 55, 0.1);
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.2);
}

.statNumber {
  display: block;
  font-size: 1.5rem;
  font-weight: 700;
  color: #d4af37;
  font-family: "Playfair Display", serif;
  margin-bottom: 0.25rem;
}

.statLabel {
  font-size: 0.8rem;
  color: #737373;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Sections */
.servicesSection,
.barbersSection,
.noBarbersSection,
.bookingSection,
.mapSection {
  padding: 3rem 2rem;
  position: relative;
  z-index: 1;
  animation: fadeInUp 0.8s ease-out both;
}

.servicesSection {
  animation-delay: 0.6s;
}

.barbersSection {
  animation-delay: 0.8s;
}

.bookingSection {
  animation-delay: 1s;
}

.sectionTitle {
  font-family: "Playfair Display", serif;
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 2rem;
  background: linear-gradient(135deg, #d4af37, #ffffff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-align: center;
  position: relative;
}

.sectionTitle::after {
  content: "";
  position: absolute;
  bottom: -1rem;
  left: 50%;
  transform: translateX(-50%);
  width: 60px;
  height: 2px;
  background: linear-gradient(90deg, transparent, #d4af37, transparent);
}

/* Services Grid */
.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 1.5rem;
}

.serviceCard {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 1.5rem;
  padding: 2rem;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
}

.serviceCard::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(212, 175, 55, 0.1),
    transparent
  );
  transition: left 0.6s ease;
}

.serviceCard:hover::before {
  left: 100%;
}

.serviceCard:hover {
  background: rgba(212, 175, 55, 0.08);
  border-color: rgba(212, 175, 55, 0.4);
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 40px rgba(212, 175, 55, 0.2);
}

.serviceCard.selected {
  background: rgba(212, 175, 55, 0.15);
  border-color: #d4af37;
  box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
}

.serviceName {
  font-family: "Playfair Display", serif;
  font-size: 1.3rem;
  font-weight: 600;
  color: #ffffff;
  margin-bottom: 0.75rem;
}

.servicePrice {
  font-size: 1.5rem;
  font-weight: 700;
  color: #d4af37;
  margin-bottom: 0.5rem;
}

.serviceDuration {
  color: #737373;
  font-size: 0.9rem;
  margin-bottom: 0.5rem;
}

.serviceGender {
  color: #a3a3a3;
  font-size: 0.8rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Barbers Grid */
.barbersGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 2rem;
}

.barberCard {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 1.5rem;
  padding: 2rem;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  text-align: center;
  position: relative;
  overflow: hidden;
}

.barberCard::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(212, 175, 55, 0.1),
    transparent
  );
  transition: left 0.6s ease;
}

.barberCard:hover::before {
  left: 100%;
}

.barberCard:hover {
  background: rgba(212, 175, 55, 0.08);
  border-color: rgba(212, 175, 55, 0.4);
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 20px 40px rgba(212, 175, 55, 0.2);
}

.barberCard.selected {
  background: rgba(212, 175, 55, 0.15);
  border-color: #d4af37;
  box-shadow: 0 0 30px rgba(212, 175, 55, 0.3);
}

.barberImage {
  width: 80px;
  height: 80px;
  margin: 0 auto 1rem;
  border-radius: 50%;
  overflow: hidden;
  border: 3px solid rgba(212, 175, 55, 0.3);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.barberCard:hover .barberImage {
  border-color: #d4af37;
  transform: scale(1.05);
}

.barberPhoto {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.defaultBarberImage {
  width: 100%;
  height: 100%;
  background: linear-gradient(
    135deg,
    rgba(212, 175, 55, 0.2),
    rgba(212, 175, 55, 0.1)
  );
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  color: #d4af37;
}

.barberName {
  font-family: "Playfair Display", serif;
  font-size: 1.2rem;
  font-weight: 600;
  color: #ffffff;
  margin-bottom: 0.5rem;
}

.barberExperience {
  color: #737373;
  font-size: 0.9rem;
  margin-bottom: 0.75rem;
}

.barberRating {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  margin-bottom: 1rem;
  color: #737373;
  font-size: 0.9rem;
}

.barberSkills {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
  margin-bottom: 1rem;
}

.skillChip {
  background: rgba(212, 175, 55, 0.1);
  border: 1px solid rgba(212, 175, 55, 0.2);
  color: #d4af37;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.8rem;
  font-weight: 500;
}

.barberBio {
  color: #a3a3a3;
  font-size: 0.85rem;
  line-height: 1.4;
}

/* No Barbers Section */
.noBarbersSection {
  display: flex;
  align-items: center;
  justify-content: center;
}

.noBarbersSection > div {
  background: rgba(255, 193, 7, 0.1);
  border: 1px solid rgba(255, 193, 7, 0.2);
  border-radius: 1.5rem;
  padding: 2rem;
  text-align: center;
  max-width: 500px;
}

/* Date Time Picker */
.dateTimePicker {
  max-width: 800px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.dateInput {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 1rem;
  padding: 1.25rem;
  color: #ffffff;
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  width: 100%;
  max-width: 300px;
  margin: 0 auto;
}

.dateInput:focus {
  outline: none;
  border-color: #d4af37;
  box-shadow: 0 0 20px rgba(212, 175, 55, 0.2);
  background: rgba(212, 175, 55, 0.08);
}

.timeSlots p {
  text-align: center;
  color: #737373;
  font-size: 1rem;
  margin: 2rem 0;
}

.timeSlotsWrapper {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 1rem;
  max-height: 300px;
  overflow-y: auto;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.02);
  border-radius: 1.5rem;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

.timeSlot {
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 0.75rem;
  padding: 1rem;
  color: #ffffff;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  font-weight: 500;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.timeSlot::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(212, 175, 55, 0.1),
    transparent
  );
  transition: left 0.4s ease;
}

.timeSlot:hover:not(.disabled)::before {
  left: 100%;
}

.timeSlot:hover:not(.disabled) {
  background: rgba(212, 175, 55, 0.1);
  border-color: rgba(212, 175, 55, 0.4);
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 8px 20px rgba(212, 175, 55, 0.2);
}

.timeSlot.selected {
  background: rgba(212, 175, 55, 0.2);
  border-color: #d4af37;
  color: #000000;
  font-weight: 600;
  box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
}

.timeSlot.disabled {
  background: rgba(255, 255, 255, 0.02);
  border-color: rgba(255, 255, 255, 0.05);
  color: #a3a3a3;
  cursor: not-allowed;
  opacity: 0.5;
}

/* Map Section */
.mapSection > div:last-child {
  border-radius: 1.5rem;
  overflow: hidden;
  border: 2px solid rgba(212, 175, 55, 0.2);
  box-shadow: 0 32px 64px -12px rgba(212, 175, 55, 0.25);
}

/* Book Button */
.bookButtonContainer {
  position: sticky;
  bottom: 0;
  padding: 1.5rem 2rem;
  background: rgba(0, 0, 0, 0.9);
  backdrop-filter: blur(20px);
  border-top: 1px solid rgba(212, 175, 55, 0.2);
  z-index: 40;
}

.bookButtonContainer button {
  width: 100%;
  background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
  color: #000000;
  border: none;
  padding: 1.25rem 2rem;
  border-radius: 1rem;
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-family: inherit;
}

.bookButtonContainer button::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.2),
    transparent
  );
  transition: left 0.6s ease;
}

.bookButtonContainer button:hover:not(:disabled)::before {
  left: 100%;
}

.bookButtonContainer button:hover:not(:disabled) {
  transform: translateY(-4px) scale(1.02);
  box-shadow: 0 20px 40px rgba(212, 175, 55, 0.4);
  background: linear-gradient(135deg, #ffd700 0%, #d4af37 100%);
}

.bookButtonContainer button:disabled {
  background: rgba(255, 255, 255, 0.1);
  color: #a3a3a3;
  cursor: not-allowed;
  opacity: 0.5;
}

/* Modal Styles */
.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(10px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.modalContent {
  background: linear-gradient(
    135deg,
    rgba(26, 26, 26, 0.95) 0%,
    rgba(15, 15, 15, 0.98) 100%
  );
  border: 2px solid rgba(212, 175, 55, 0.3);
  border-radius: 2rem;
  padding: 3rem;
  max-width: 500px;
  width: 90%;
  box-shadow: 0 32px 64px -12px rgba(212, 175, 55, 0.25);
  animation: scaleIn 0.4s ease-out;
  backdrop-filter: blur(20px);
}

@keyframes scaleIn {
  from {
    opacity: 0;
    transform: scale(0.9);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.modalContent h3 {
  font-family: "Playfair Display", serif;
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 1rem;
  background: linear-gradient(135deg, #d4af37, #ffffff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-align: center;
}

.modalContent p {
  margin-bottom: 1rem;
  color: #737373;
  line-height: 1.5;
}

.modalContent input {
  width: 100%;
  background: rgba(255, 255, 255, 0.05);
  border: 2px solid rgba(255, 255, 255, 0.1);
  border-radius: 0.75rem;
  padding: 1rem;
  color: #ffffff;
  font-size: 1rem;
  margin-bottom: 1rem;
  transition: all 0.3s ease-out;
  font-family: inherit;
}

.modalContent input:focus {
  outline: none;
  border-color: #d4af37;
  background: rgba(212, 175, 55, 0.08);
  box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
}

.modalActions {
  display: flex;
  gap: 1rem;
  margin-top: 1.5rem;
}

.confirmButton {
  flex: 1;
  background: linear-gradient(135deg, #d4af37, #b8941f);
  color: #000000;
  border: none;
  padding: 1rem 1.5rem;
  border-radius: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  font-family: inherit;
}

.confirmButton:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4);
}

.cancelButton {
  flex: 1;
  background: transparent;
  color: #737373;
  border: 2px solid rgba(255, 255, 255, 0.2);
  padding: 1rem 1.5rem;
  border-radius: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease-out;
  font-family: inherit;
}

.cancelButton:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(255, 255, 255, 0.3);
  color: #ffffff;
}

/* Loading States */
.loadingContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #0f0f0f 100%);
  color: #ffffff;
}

.spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(212, 175, 55, 0.2);
  border-top: 4px solid #d4af37;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 1rem;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

.loadingContainer p {
  color: #737373;
  font-size: 1.1rem;
}

/* Error States */
.errorContainer {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
  background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 50%, #0f0f0f 100%);
  color: #ffffff;
  text-align: center;
  padding: 2rem;
}

.errorContainer h2 {
  font-family: "Playfair Display", serif;
  font-size: 2rem;
  font-weight: 700;
  color: #ef4444;
  margin-bottom: 1.5rem;
}

/* Custom scrollbar for time slots */
.timeSlotsWrapper::-webkit-scrollbar {
  width: 6px;
}

.timeSlotsWrapper::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
  border-radius: 3px;
}

.timeSlotsWrapper::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #d4af37, #b8941f);
  border-radius: 3px;
}

.timeSlotsWrapper::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #b8941f, #8b4513);
}

/* Selection states for better UX */
.serviceCard.selected .serviceName,
.barberCard.selected .barberName {
  color: #d4af37;
}

.serviceCard.selected .servicePrice,
.barberCard.selected .barberRating {
  color: #ffffff;
}

/* Responsive Design */
@media (max-width: 1200px) {
  .heroSection {
    grid-template-columns: 1fr;
    gap: 2rem;
  }

  .quickStats {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 768px) {
  .container {
    font-size: 14px;
  }

  .header {
    padding: 1rem 1.25rem;
  }

  .salonName {
    font-size: 1.2rem;
  }

  .heroSection,
  .servicesSection,
  .barbersSection,
  .bookingSection,
  .mapSection {
    padding: 1.5rem 1.25rem;
  }

  .sectionTitle {
    font-size: 1.5rem;
  }

  .servicesGrid {
    grid-template-columns: 1fr;
    gap: 1rem;
  }

  .barbersGrid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }

  .quickStats {
    grid-template-columns: 1fr;
    gap: 0.75rem;
  }

  .timeSlotsWrapper {
    grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
  }

  .modalContent {
    padding: 2rem;
    margin: 1rem;
  }

  .modalActions {
    flex-direction: column;
  }
}

@media (max-width: 480px) {
  .headerActions {
    display: none;
  }

  .imageGallery,
  .mainImage,
  .placeholderImage {
    height: 250px;
  }

  .serviceCard,
  .barberCard {
    padding: 1.25rem;
  }

  .bookButtonContainer {
    padding: 1rem 1.25rem;
  }

  .timeSlotsWrapper {
    grid-template-columns: repeat(2, 1fr);
    max-height: 200px;
  }
}

/* Focus states for accessibility */
.serviceCard:focus-visible,
.barberCard:focus-visible,
.timeSlot:focus-visible,
.backButton:focus-visible,
.shareButton:focus-visible,
.favoriteButton:focus-visible {
  outline: 3px solid #d4af37;
  outline-offset: 2px;
}

.bookButtonContainer button:focus-visible {
  outline: 3px solid #ffffff;
  outline-offset: 2px;
}

/* Hover effects for touch devices */
@media (hover: none) {
  .serviceCard:hover,
  .barberCard:hover,
  .timeSlot:hover,
  .backButton:hover,
  .shareButton:hover,
  .favoriteButton:hover {
    transform: none;
  }

  .serviceCard:active,
  .barberCard:active,
  .timeSlot:active {
    transform: scale(0.98);
  }
}

/* Reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  .container,
  .container *,
  .container *::before,
  .container *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  .serviceCard::before,
  .barberCard::before,
  .timeSlot::before,
  .bookButtonContainer button::before {
    display: none;
  }
}
</file>

<file path="src/components/Salon/SalonRegisterForm.js">
import React, { useState, useEffect } from "react";
import { MapPin, Clock, Store, Scissors, Star } from "lucide-react";
import dynamic from "next/dynamic";
import Link from "next/link";

// Dynamically import LocationPicker to avoid SSR issues with Leaflet
const LocationPicker = dynamic(() => import("../Maps/LocationPicker"), {
  ssr: false,
  loading: () => (
    <div className="animate-pulse bg-gray-300 h-64 rounded-xl"></div>
  ),
});

const SalonRegisterForm = () => {
  const [formData, setFormData] = useState({
    // Owner Details
    fullName: "",
    phone: "",
    email: "",
    password: "",

    // Salon Details
    salonName: "",
    address: "",
    locationData: null,
    latitude: "",
    longitude: "", // Will store coordinates and formatted address
    openingTime: "09:00",
    closingTime: "21:00",

    // Basic Services & Pricing
    services: {
      haircut: { enabled: false, price: "" },
      shave: { enabled: false, price: "" },
      hairWash: { enabled: false, price: "" },
      hairStyling: { enabled: false, price: "" },
      facial: { enabled: false, price: "" },
      hairColor: { enabled: false, price: "" },
    },
    barbers: [],
    services: {
      haircut: { enabled: false, price: "" },
      shave: { enabled: false, price: "" },
      hairWash: { enabled: false, price: "" },
      hairStyling: { enabled: false, price: "" },
      facial: { enabled: false, price: "" },
      hairColor: { enabled: false, price: "" },
    },
  });

  const [currentStep, setCurrentStep] = useState(1);
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [showLocationPicker, setShowLocationPicker] = useState(false);
  const [isClient, setIsClient] = useState(false);
  const [validationErrors, setValidationErrors] = useState({});
  useEffect(() => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((pos) => {
        setFormData((prev) => ({
          ...prev,
          latitude: prev.latitude || pos.coords.latitude,
          longitude: prev.longitude || pos.coords.longitude,
        }));
      });
    }
  }, []);
  useEffect(() => {
    setIsClient(true);
  }, []);

  const validateStep = (step) => {
    const errors = {};

    if (step === 1) {
      if (!formData.fullName) errors.fullName = "Full name is required";
      if (!formData.phone) errors.phone = "Mobile number is required";
      if (!formData.email) errors.email = "Email is required";
      if (!formData.password) errors.password = "Password is required";
      else if (formData.password.length < 6)
        errors.password = "Password must be at least 6 characters";
    }

    if (step === 2) {
      if (!formData.salonName) errors.salonName = "Salon name is required";
      if (!formData.locationData) {
        errors.location = "Please select a location on the map";
      }
      if (!formData.address) errors.address = "Address is required";
    }

    if (step === 3) {
      const enabledServices = Object.values(formData.services).some(
        (service) => service.enabled
      );
      if (!enabledServices)
        errors.services = "Please enable at least one service";
    }

    setValidationErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleInputChange = (field, value) => {
    setFormData((prev) => ({
      ...prev,
      [field]: value,
    }));

    // Clear validation error when field is updated
    if (validationErrors[field]) {
      setValidationErrors((prev) => {
        const newErrors = { ...prev };
        delete newErrors[field];
        return newErrors;
      });
    }
  };

  const handleServiceChange = (service, field, value) => {
    setFormData((prev) => ({
      ...prev,
      services: {
        ...prev.services,
        [service]: {
          ...prev.services[service],
          [field]: value,
        },
      },
    }));
  };

  // Add barber management functions
  const addBarber = () => {
    setFormData((prev) => ({
      ...prev,
      barbers: [
        ...prev.barbers,
        {
          name: "",
          experience: "",
          skills: [],
          bio: "",
          photo: "",
          isAvailable: true,
          totalBookings: 0,
          rating: 5.0,
        },
      ],
    }));
  };

  const removeBarber = (index) => {
    setFormData((prev) => ({
      ...prev,
      barbers: prev.barbers.filter((_, i) => i !== index),
    }));
  };

  const handleBarberChange = (index, field, value) => {
    setFormData((prev) => ({
      ...prev,
      barbers: prev.barbers.map((barber, i) =>
        i === index ? { ...barber, [field]: value } : barber
      ),
    }));
  };

  const handleBarberSkillChange = (index, skill, checked) => {
    setFormData((prev) => ({
      ...prev,
      barbers: prev.barbers.map((barber, i) =>
        i === index
          ? {
              ...barber,
              skills: checked
                ? [...barber.skills, skill]
                : barber.skills.filter((s) => s !== skill),
            }
          : barber
      ),
    }));
  };

  const handleLocationSelect = (locationData) => {
    const lat = locationData.lat ? parseFloat(locationData.lat) : "";
    const lng = locationData.lng ? parseFloat(locationData.lng) : "";

    setFormData((prev) => ({
      ...prev,
      locationData: {
        lat: lat,
        lng: lng,
        address: locationData.address,
      },
      latitude: lat,
      longitude: lng,
      address: locationData.address || prev.address,
    }));
    setShowLocationPicker(false);

    if (validationErrors.location) {
      setValidationErrors((prev) => {
        const newErrors = { ...prev };
        delete newErrors.location;
        return newErrors;
      });
    }
  };

  const handleNextStep = () => {
    if (validateStep(currentStep)) {
      setCurrentStep(currentStep + 1);
    }
  };

  const handlePrevStep = () => {
    setCurrentStep(currentStep - 1);
  };

  const handleSubmit = async () => {
    if (!validateStep(4)) return;

    // Remove this duplicate validation check - it's already in validateStep
    console.log("Location data:", formData.locationData);
    console.log("Form lat/lng:", formData.latitude, formData.longitude);
    console.log("Barbers data:", formData.barbers); // ADD THIS LOG

    const lat = formData.locationData?.lat || parseFloat(formData.latitude);
    const lng = formData.locationData?.lng || parseFloat(formData.longitude);

    try {
      const registrationData = {
        ownerName: formData.fullName,
        phone: formData.phone,
        email: formData.email,
        password: formData.password,
        salonName: formData.salonName,
        address: formData.locationData?.address || formData.address,
        latitude: lat,
        longitude: lng,
        coordinates: [lng, lat],
        openingTime: formData.openingTime,
        closingTime: formData.closingTime,
        services: formData.services,
        barbers: formData.barbers,
      };

      console.log("Salon Registration Data:", registrationData);

      // Here you would send data to your backend API
      const response = await fetch("/api/auth/salon/register", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(registrationData),
      });

      if (response.ok) {
        const result = await response.json();
        console.log("Registration result:", result);

        // Store salon session with proper structure
        const salonSession = {
          id: result.salon._id || result.salon.id,
          salonName: result.salon.salonName,
          ownerName: result.salon.ownerName,
          email: result.salon.email,
        };

        localStorage.setItem("salonSession", JSON.stringify(salonSession));
        localStorage.setItem("salonToken", result.token);
        // alert("Salon registered successfully! Welcome to the platform.");
        alert(
          `Salon registered successfully! ${
            result.barbersCreated || 0
          } barbers added. Welcome!`
        );

        // Redirect to dashboard or login
        // window.location.href = "/salons/dashboard";
      } else {
        const error = await response.json();
        alert(`Registration failed: ${error.message}`);
      }
    } catch (error) {
      console.error("Registration error:", error);
      alert("Registration failed. Please try again.");
    }
  };

  const services = [
    { key: "Haircut", label: "Haircut", icon: Scissors, defaultPrice: "200" },
    { key: "Shave", label: "Shave", icon: Scissors, defaultPrice: "100" },
    {
      key: "Hair Wash",
      label: "Hair Wash",
      icon: Scissors,
      defaultPrice: "150",
    },
    {
      key: "Hair Styling",
      label: "Hair Styling",
      icon: Scissors,
      defaultPrice: "300",
    },
    { key: "Facial", label: "Facial", icon: Star, defaultPrice: "500" },
    {
      key: "Hair Color",
      label: "Hair Color",
      icon: Scissors,
      defaultPrice: "800",
    },
  ];

  // Don't render until client-side to avoid hydration issues
  if (!isClient) {
    return (
      <div className="min-h-screen bg-[var(--background-primary)] flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500"></div>
      </div>
    );
  }

  return (
    <>
      <div
        className={`min-h-screen transition-all duration-500 ${
          isDarkMode
            ? "bg-[var(--dark-background-primary)]"
            : "bg-[var(--background-primary)]"
        }`}
      >
        {/* Dark Mode Toggle */}
        <div className="absolute top-4 right-4 z-50">
          <button
            onClick={() => setIsDarkMode(!isDarkMode)}
            className={`p-3 rounded-full transition-all duration-300 ${
              isDarkMode
                ? "bg-[var(--dark-gold-primary)] text-gray-900 hover:opacity-90"
                : "bg-gray-800 text-white hover:bg-gray-700"
            }`}
          >
            {isDarkMode ? "☀️" : "🌙"}
          </button>
        </div>

        <div className="container mx-auto px-4 py-8">
          <div className="max-w-4xl mx-auto">
            {/* Header */}
            <div className="text-center mb-8 animate-fadeIn">
              <div
                className={`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${
                  isDarkMode
                    ? "bg-[var(--dark-gold-primary)]"
                    : "bg-[var(--gold-primary)]"
                }`}
              >
                <Store className="w-8 h-8 text-white" />
              </div>
              <h1 className="text-4xl font-bold mb-2 gold-gradient-text">
                Register Your Salon
              </h1>
              <p
                className={`text-lg ${
                  isDarkMode ? "text-gray-300" : "text-gray-600"
                }`}
              >
                Join our platform and start getting more customers
              </p>
            </div>

            {/* Progress Steps */}
            <div className="flex items-center justify-center mb-8">
              {[1, 2, 3, 4].map((step) => (
                <React.Fragment key={step}>
                  <div
                    className={`flex items-center justify-center w-10 h-10 rounded-full transition-all duration-300 ${
                      currentStep >= step
                        ? isDarkMode
                          ? "bg-[var(--dark-gold-primary)] text-[var(--contrast-dark)]"
                          : "bg-[var(--gold-primary)] text-[var(--contrast-dark)]"
                        : isDarkMode
                        ? "bg-gray-700 text-gray-400"
                        : "bg-gray-200 text-gray-500"
                    }`}
                  >
                    {step}
                  </div>
                  {step < 4 && (
                    <div
                      className={`w-12 h-1 mx-2 transition-all duration-300 ${
                        currentStep > step
                          ? isDarkMode
                            ? "bg-[var(--dark-gold-primary)]"
                            : "bg-[var(--gold-primary)]"
                          : isDarkMode
                          ? "bg-gray-700"
                          : "bg-gray-200"
                      }`}
                    />
                  )}
                </React.Fragment>
              ))}
            </div>

            {/* Registration Form */}
            <div
              className={`card rounded-3xl   p-8 backdrop-blur-sm transition-all duration-500 ${
                isDarkMode
                  ? "bg-gray-800/80 border border-gray-700"
                  : "bg-white/90 border border-amber-200"
              }`}
            >
              <div className="space-y-8">
                {/* Step 1: Owner Details */}
                {currentStep === 1 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      Owner Details
                    </h2>
                    <div className="grid md:grid-cols-2 gap-6">
                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Full Name
                        </label>
                        <input
                          type="text"
                          placeholder="Your full name"
                          value={formData.fullName}
                          onChange={(e) =>
                            handleInputChange("fullName", e.target.value)
                          }
                          className={`w-full form-input rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          } ${
                            validationErrors.fullName ? "border-red-500" : ""
                          }`}
                        />
                        {validationErrors.fullName && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.fullName}
                          </p>
                        )}
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Mobile Number
                        </label>
                        <div className="relative">
                          <input
                            type="tel"
                            placeholder="+91 9876543210"
                            value={formData.phone}
                            onChange={(e) =>
                              handleInputChange("phone", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            } ${
                              validationErrors.phone ? "border-red-500" : ""
                            }`}
                          />
                        </div>
                        {validationErrors.phone && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.phone}
                          </p>
                        )}
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Email
                        </label>
                        <div className="relative">
                          <input
                            type="email"
                            placeholder="your.email@example.com"
                            value={formData.email}
                            onChange={(e) =>
                              handleInputChange("email", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            } ${
                              validationErrors.email ? "border-red-500" : ""
                            }`}
                          />
                        </div>
                        {validationErrors.email && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.email}
                          </p>
                        )}
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Password
                        </label>
                        <div className="relative">
                          <input
                            type="password"
                            placeholder="Create a strong password"
                            value={formData.password}
                            onChange={(e) =>
                              handleInputChange("password", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            } ${
                              validationErrors.password ? "border-red-500" : ""
                            }`}
                          />
                        </div>
                        {validationErrors.password && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.password}
                          </p>
                        )}
                      </div>
                    </div>
                  </div>
                )}

                {/* Step 2: Salon Details */}
                {currentStep === 2 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <Store className="w-6 h-6 mr-3" />
                      Salon Details
                    </h2>

                    <div className="grid md:grid-cols-2 gap-6">
                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Salon Name
                        </label>
                        <input
                          type="text"
                          placeholder="Your salon name"
                          value={formData.salonName}
                          onChange={(e) =>
                            handleInputChange("salonName", e.target.value)
                          }
                          className={`w-full form-input rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          } ${
                            validationErrors.salonName ? "border-red-500" : ""
                          }`}
                        />
                        {validationErrors.salonName && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.salonName}
                          </p>
                        )}
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Location Pin
                        </label>
                        <div className="relative">
                          <MapPin
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <button
                            type="button"
                            className={`w-full pl-11 pr-4 py-3 rounded-xl border transition-all duration-300 text-left form-input ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600"
                                : "bg-white border-gray-300 text-gray-600 hover:bg-gray-50"
                            } ${
                              validationErrors.location ? "border-red-500" : ""
                            }`}
                            onClick={() => setShowLocationPicker(true)}
                          >
                            {formData.locationData
                              ? formData.locationData.address
                              : "Set exact location on map"}
                          </button>
                          {validationErrors.location && (
                            <p className="text-red-500 text-sm">
                              {validationErrors.location}
                            </p>
                          )}
                          {showLocationPicker && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
                              <div className="bg-white rounded-xl p-6 shadow-xl relative w-full max-w-2xl">
                                <button
                                  className="absolute top-2 right-2 text-gray-500 hover:text-gray-700"
                                  onClick={() => setShowLocationPicker(false)}
                                >
                                  ✕
                                </button>
                                <LocationPicker
                                  onLocationSelect={handleLocationSelect}
                                />
                              </div>
                            </div>
                          )}
                        </div>
                      </div>

                      <div className="md:col-span-2 space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Address
                        </label>
                        <textarea
                          placeholder="Complete address with landmarks"
                          value={formData.address}
                          onChange={(e) =>
                            handleInputChange("address", e.target.value)
                          }
                          rows={3}
                          className={`w-full form-input rounded-xl transition-all duration-300 resize-none focus:ring-2 focus:ring-opacity-50 ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          } ${
                            validationErrors.address ? "border-red-500" : ""
                          }`}
                        />
                        {validationErrors.address && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.address}
                          </p>
                        )}
                      </div>
                      <input
                        type="hidden"
                        name="latitude"
                        value={formData.latitude || ""}
                      />
                      <input
                        type="hidden"
                        name="longitude"
                        value={formData.longitude || ""}
                      />

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Opening Time
                        </label>
                        <div className="relative">
                          <Clock
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="time"
                            value={formData.openingTime}
                            onChange={(e) =>
                              handleInputChange("openingTime", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Closing Time
                        </label>
                        <div className="relative">
                          <Clock
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="time"
                            value={formData.closingTime}
                            onChange={(e) =>
                              handleInputChange("closingTime", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                )}
                {/* Step 3: Barber Management */}
                {currentStep === 3 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <div className="w-6 h-6 mr-3" />
                      Add Your Barbers
                    </h2>

                    <div className="space-y-6">
                      {formData.barbers.map((barber, index) => (
                        <div
                          key={index}
                          className={`p-6 rounded-xl border-2 transition-all duration-300 ${
                            isDarkMode
                              ? "border-gray-600 bg-gray-700/50"
                              : "border-gray-200 bg-gray-50"
                          }`}
                        >
                          <div className="flex justify-between items-center mb-4">
                            <h3
                              className={`font-semibold ${
                                isDarkMode ? "text-white" : "text-gray-900"
                              }`}
                            >
                              Barber {index + 1}
                            </h3>
                            {formData.barbers.length > 1 && (
                              <button
                                type="button"
                                onClick={() => removeBarber(index)}
                                className="text-red-500 hover:text-red-700"
                              >
                                ✕
                              </button>
                            )}
                          </div>

                          <div className="grid md:grid-cols-2 gap-4">
                            <input
                              type="text"
                              placeholder="Barber Name"
                              value={barber.name}
                              onChange={(e) =>
                                handleBarberChange(
                                  index,
                                  "name",
                                  e.target.value
                                )
                              }
                              className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                                isDarkMode
                                  ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                  : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                              }`}
                            />

                            <input
                              type="number"
                              placeholder="Years of Experience"
                              value={barber.experience}
                              onChange={(e) =>
                                handleBarberChange(
                                  index,
                                  "experience",
                                  e.target.value
                                )
                              }
                              className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                                isDarkMode
                                  ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                  : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                              }`}
                            />
                          </div>

                          <div className="mt-4">
                            <label
                              className={`block text-sm font-medium mb-2 ${
                                isDarkMode ? "text-gray-300" : "text-gray-700"
                              }`}
                            >
                              Specializations
                            </label>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                              {[
                                "Haircut",
                                "Shaving",
                                "Hair Styling",
                                "Beard Trim",
                                "Hair Color",
                                "Facial",
                              ].map((skill) => (
                                <label
                                  key={skill}
                                  className="flex items-center"
                                >
                                  <input
                                    type="checkbox"
                                    checked={barber.skills.includes(skill)}
                                    onChange={(e) =>
                                      handleBarberSkillChange(
                                        index,
                                        skill,
                                        e.target.checked
                                      )
                                    }
                                    className={`mr-2 ${
                                      isDarkMode
                                        ? "text-yellow-500 focus:ring-yellow-500"
                                        : "text-amber-500 focus:ring-amber-500"
                                    }`}
                                  />
                                  <span
                                    className={`text-sm ${
                                      isDarkMode
                                        ? "text-gray-300"
                                        : "text-gray-700"
                                    }`}
                                  >
                                    {skill}
                                  </span>
                                </label>
                              ))}
                            </div>
                          </div>

                          <div className="mt-4">
                            <label
                              className={`block text-sm font-medium mb-2 ${
                                isDarkMode ? "text-gray-300" : "text-gray-700"
                              }`}
                            >
                              Bio/Accomplishments
                            </label>
                            <textarea
                              placeholder="Describe barber's achievements, awards, etc."
                              value={barber.bio}
                              onChange={(e) =>
                                handleBarberChange(index, "bio", e.target.value)
                              }
                              rows={2}
                              className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 resize-none ${
                                isDarkMode
                                  ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                  : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                              }`}
                            />
                          </div>
                        </div>
                      ))}

                      <button
                        type="button"
                        onClick={addBarber}
                        className={`w-full py-3 border-2 border-dashed rounded-xl transition-all duration-300 ${
                          isDarkMode
                            ? "border-gray-600 text-gray-400 hover:border-yellow-500 hover:text-yellow-400"
                            : "border-gray-300 text-gray-600 hover:border-amber-500 hover:text-amber-600"
                        }`}
                      >
                        + Add Another Barber
                      </button>
                    </div>
                  </div>
                )}
                {/* Step 3: Services */}
                {currentStep === 4 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <Scissors className="w-6 h-6 mr-3" />
                      Basic Services & Pricing
                    </h2>

                    {validationErrors.services && (
                      <p className="text-red-500 text-sm mb-4">
                        {validationErrors.services}
                      </p>
                    )}

                    <div className="grid md:grid-cols-2 gap-4">
                      {services.map((service) => {
                        const Icon = service.icon;
                        return (
                          <div
                            key={service.key}
                            className={`p-4 rounded-xl border-2 transition-all duration-300 ${
                              formData.services[service.key].enabled
                                ? isDarkMode
                                  ? "border-yellow-500 bg-yellow-500/10"
                                  : "border-amber-500 bg-amber-50"
                                : isDarkMode
                                ? "border-gray-600 bg-gray-700/50 hover:border-gray-500"
                                : "border-gray-200 bg-gray-50 hover:border-gray-300"
                            }`}
                          >
                            <div className="flex items-center justify-between mb-3">
                              <div className="flex items-center">
                                <input
                                  type="checkbox"
                                  checked={
                                    formData.services[service.key].enabled
                                  }
                                  onChange={(e) =>
                                    handleServiceChange(
                                      service.key,
                                      "enabled",
                                      e.target.checked
                                    )
                                  }
                                  className={`w-5 h-5 rounded transition-all duration-300 ${
                                    isDarkMode
                                      ? "text-yellow-500 focus:ring-yellow-500 bg-gray-700 border-gray-600"
                                      : "text-amber-500 focus:ring-amber-500"
                                  }`}
                                />
                                <Icon
                                  className={`w-5 h-5 ml-3 ${
                                    formData.services[service.key].enabled
                                      ? isDarkMode
                                        ? "text-yellow-400"
                                        : "text-amber-600"
                                      : isDarkMode
                                      ? "text-gray-400"
                                      : "text-gray-500"
                                  }`}
                                />
                                <span
                                  className={`ml-2 font-medium ${
                                    formData.services[service.key].enabled
                                      ? isDarkMode
                                        ? "text-white"
                                        : "text-gray-900"
                                      : isDarkMode
                                      ? "text-gray-400"
                                      : "text-gray-600"
                                  }`}
                                >
                                  {service.label}
                                </span>
                              </div>
                            </div>

                            {formData.services[service.key].enabled && (
                              <div className="animate-slideIn">
                                <div className="flex items-center">
                                  <span
                                    className={`text-sm font-medium mr-2 ${
                                      isDarkMode
                                        ? "text-gray-300"
                                        : "text-gray-700"
                                    }`}
                                  >
                                    ₹
                                  </span>
                                  <input
                                    type="number"
                                    placeholder={service.defaultPrice}
                                    value={formData.services[service.key].price}
                                    onChange={(e) =>
                                      handleServiceChange(
                                        service.key,
                                        "price",
                                        e.target.value
                                      )
                                    }
                                    className={`flex-1 form-input px-3 py-2 rounded-lg transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                                      isDarkMode
                                        ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                        : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                                    }`}
                                  />
                                </div>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {/* Navigation Buttons */}
                <div className="flex justify-between pt-8">
                  {currentStep > 1 && (
                    <button
                      type="button"
                      onClick={handlePrevStep}
                      className={`btn btn-secondary`}
                    >
                      Previous
                    </button>
                  )}

                  {currentStep < 4 ? (
                    <button
                      type="button"
                      onClick={() => setCurrentStep(currentStep + 1)}
                      className={`px-8 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 ml-auto ${
                        isDarkMode
                          ? "bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-400 hover:to-amber-400"
                          : "bg-gradient-to-r from-amber-500 to-yellow-600 text-white hover:from-amber-600 hover:to-yellow-700"
                      }`}
                    >
                      Next Step
                    </button>
                  ) : (
                    <button
                      type="button"
                      onClick={handleSubmit}
                      className={`px-8 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 ml-auto ${
                        isDarkMode
                          ? "bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-400 hover:to-amber-400"
                          : "bg-gradient-to-r from-amber-500 to-yellow-600 text-white hover:from-amber-600 hover:to-yellow-700"
                      }`}
                    >
                      Register My Salon
                    </button>
                  )}
                </div>
              </div>

              {/* Sign In Link */}
              <div className="text-center mt-8 pt-6 border-t border-opacity-20">
                <p
                  className={`${
                    isDarkMode ? "text-gray-400" : "text-gray-600"
                  }`}
                >
                  <Link
                    href="/salons/login"
                    className={`font-medium transition-colors duration-300 ${
                      isDarkMode
                        ? "text-[var(--dark-gold-primary)] hover:opacity-80"
                        : "text-[var(--gold-primary)] hover:opacity-80"
                    }`}
                  >
                    Sign In
                  </Link>
                </p>
              </div>
            </div>
          </div>
        </div>
        <style jsx>{`
          @keyframes fadeIn {
            from {
              opacity: 0;
              transform: translateY(-20px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }

          @keyframes slideIn {
            from {
              opacity: 0;
              transform: translateX(-30px);
            }
            to {
              opacity: 1;
              transform: translateX(0);
            }
          }

          .animate-fadeIn {
            animation: fadeIn 0.8s ease-out;
          }

          .animate-slideIn {
            animation: slideIn 0.6s ease-out;
          }
        `}</style>
      </div>
    </>
  );
};

export default SalonRegisterForm;
</file>

<file path="src/pages/feedback.js">
// src/pages/feedback.js - Enhanced feedback with star ratings
import { useState, useEffect, useCallback } from "react";
import { useRouter } from "next/router";

export default function FeedbackPage() {
  const router = useRouter();
  const { bookingId } = router.query;

  const [bookings, setBooking] = useState(null);
  const [ratings, setRatings] = useState({
    serviceQuality: 0,
    timing: 0,
    barberPerformance: 0,
    ambience: 0,
    overall: 0,
  });
  const [comment, setComment] = useState("");
  const [submitting, setSubmitting] = useState(false);

  const fetchBookingDetails = useCallback(async () => {
    try {
      const response = await fetch(`/api/bookings/${bookingId}`);
      if (response.ok) {
        const data = await response.json();
        setBooking(data.booking); // Fix: access booking from response
      } else {
        console.error("Failed to fetch booking:", response.status);
      }
    } catch (error) {
      console.error("Error fetching booking:", error);
    }
  }, [bookingId]);

  useEffect(() => {
    if (bookingId) {
      fetchBookingDetails();
    }
  }, [bookingId, fetchBookingDetails]);

  // StarRating component - fixed version
  const StarRating = ({ value, onChange, label, required = true }) => {
    return (
      <div className="mb-4">
        <label className="block text-sm font-medium text-gray-700 mb-2">
          {label} {required && <span className="text-red-500">*</span>}
        </label>
        <div className="flex space-x-1 items-center">
          {[1, 2, 3, 4, 5].map((star) => (
            <button
              key={star}
              type="button"
              onClick={() => onChange(star)}
              className={`text-3xl transition-all duration-200 hover:scale-110 ${
                star <= value
                  ? "text-yellow-400 drop-shadow-sm"
                  : "text-gray-300 hover:text-yellow-200"
              }`}
            >
              {star <= value ? "⭐" : "☆"}
            </button>
          ))}
          <div className="ml-3">
            {value === 0 ? (
              <span className="text-sm text-gray-400">Tap to rate</span>
            ) : (
              <span className="text-sm text-gray-600 font-medium">
                {value}/5 {getRatingLabel(value)}
              </span>
            )}
          </div>
        </div>
      </div>
    );
  };

  // Add rating labels
  const getRatingLabel = (rating) => {
    switch (rating) {
      case 1:
        return "Poor";
      case 2:
        return "Fair";
      case 3:
        return "Good";
      case 4:
        return "Very Good";
      case 5:
        return "Excellent";
      default:
        return "";
    }
  };

  // Add validation before submission
  const submitFeedback = async () => {
    if (!bookingId) {
      alert("Invalid booking ID");
      return;
    }

    // Validate that all ratings are provided
    const unratedFields = Object.entries(ratings)
      .filter(([key, value]) => value === 0)
      .map(([key]) => key.replace(/([A-Z])/g, " $1").toLowerCase());

    if (unratedFields.length > 0) {
      alert(`Please rate: ${unratedFields.join(", ")}`);
      return;
    }

    setSubmitting(true);
    try {
      const response = await fetch("/api/bookings/update", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          bookingId,
          feedback: {
            ratings,
            comment,
            submittedAt: new Date(),
          },
        }),
      });

      if (response.ok) {
        alert("Thank you for your feedback!");

        // Store booking data in localStorage for registration prefill
        if (bookings) {
          const prefillData = {
            name: bookings.customerName,
            phone: bookings.customerPhone,
            gender: bookings.customerGender,
            lastbookings: {
              salonId: bookings.salonId,
              service: bookings.service,
              date: bookings.date,
              time: bookings.time,
            },
            timestamp: new Date().getTime(),
          };

          console.log("Storing prefill data:", prefillData);
          localStorage.setItem("userPrefillData", JSON.stringify(prefillData));
        }

        router.push("/auth/user/register");
      } else {
        alert("Failed to submit feedback");
      }
    } catch (error) {
      console.error("Feedback submission error:", error);
      alert("Error submitting feedback");
    } finally {
      setSubmitting(false);
    }
  };

  if (!bookings) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
          <p>Loading booking details...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-2xl mx-auto px-4">
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="text-center mb-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">
              Rate Your Experience
            </h1>
            <p className="text-gray-600">
              How was your visit to {bookings.salonName || "the salon"}?
            </p>
          </div>

          {/* Booking Summary */}
          <div className="bg-gray-50 rounded-lg p-4 mb-6">
            <h3 className="font-semibold mb-2">Booking Summary</h3>
            <p>
              <strong>Service:</strong> {bookings.service}
            </p>
            {bookings.barber && (
              <p>
                <strong>Barber:</strong> {bookings.barber}
              </p>
            )}
            <p>
              <strong>Date:</strong> {bookings.date} at {bookings.time}
            </p>
            <p>
              <strong>Amount:</strong> ₹{bookings.price}
            </p>
          </div>

          {/* Rating Form */}
          <div className="space-y-4">
            <StarRating
              label="Service Quality"
              value={ratings.serviceQuality}
              onChange={(value) =>
                setRatings({ ...ratings, serviceQuality: value })
              }
            />

            <StarRating
              label="Timing/Punctuality"
              value={ratings.timing}
              onChange={(value) => setRatings({ ...ratings, timing: value })}
            />

            <StarRating
              label="Barber Performance"
              value={ratings.barberPerformance}
              onChange={(value) =>
                setRatings({ ...ratings, barberPerformance: value })
              }
            />

            <StarRating
              label="Salon Ambience / Cleanliness"
              value={ratings.ambience}
              onChange={(value) => setRatings({ ...ratings, ambience: value })}
            />

            <StarRating
              label="Overall Experience"
              value={ratings.overall}
              onChange={(value) => setRatings({ ...ratings, overall: value })}
            />

            {/* Text Feedback */}
            <div className="mt-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Additional Comments (Optional)
              </label>
              <textarea
                value={comment}
                onChange={(e) => setComment(e.target.value)}
                placeholder="Share your experience in detail..."
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                rows="4"
              />
            </div>
          </div>

          {/* Submit Button */}
          <div className="mt-8 text-center">
            <button
              onClick={submitFeedback}
              disabled={submitting}
              className="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              {submitting ? "Submitting..." : "✅ Submit Feedback"}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/index.js">
// pages/index.js
import { useState, useEffect } from "react";
import { useRouter } from "next/router";
import { motion } from "framer-motion";
import dynamic from "next/dynamic";
import styles from "../styles/Home.module.css";
import Image from "next/image";
import { UserDataManager } from "../lib/userData";

export default function Home() {
  const router = useRouter();
  const [userOnboarding, setUserOnboarding] = useState(null);
  const [nearbySalons, setNearbySalons] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [isLoadingSalons, setIsLoadingSalons] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [showMapView, setShowMapView] = useState(false);
  const [selectedSalon, setSelectedSalon] = useState(null);
  const [showLoginMenu, setShowLoginMenu] = useState(false);
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");
  const [selectedService, setSelectedService] = useState("");
  const [filteredSalons, setFilteredSalons] = useState([]);

  // Dynamic import for map component
  const SalonMap = dynamic(() => import("../components/Maps/SalonMap"), {
    ssr: false,
    loading: () => <div className={styles.mapLoading}>Loading map...</div>,
  });

  useEffect(() => {
    const initializeUser = async () => {
      if (typeof window === "undefined") return;

      // Check if user has completed onboarding
      if (!UserDataManager.hasOnboarded()) {
        router.push("/onboarding");
        return;
      }

      const userToken = localStorage.getItem("userToken");

      if (userToken) {
        // User is logged in - get API data and use hardcoded location for now
        try {
          const response = await fetch("/api/user/profile", {
            headers: { Authorization: `Bearer ${userToken}` },
          });

          if (response.ok) {
            const apiUserData = await response.json();

            // Use API data with hardcoded location (temporary fix)
            const userData = {
              ...apiUserData,
              location: {
                latitude: 19.248192,
                longitude: 73.157593,
                address:
                  "Shahad, Ambivali, Kalyan-Dombivli, Kalyan Taluka, Thane, Maharashtra, 410209, India",
              },
            };

            setUserOnboarding(userData);

            // Load salons with the location
            loadNearbySalons(
              userData.location.latitude,
              userData.location.longitude,
              userData.gender
            );
          }
        } catch (error) {
          console.error("Error loading user data:", error);
        }
      } else {
        // User not logged in - check onboarding data
        const onboardingData = localStorage.getItem("userOnboardingData");
        if (onboardingData) {
          try {
            const userData = JSON.parse(onboardingData);
            setUserOnboarding(userData);

            if (userData.location?.latitude && userData.location?.longitude) {
              loadNearbySalons(
                userData.location.latitude,
                userData.location.longitude,
                userData.gender
              );
            }
          } catch (error) {
            console.error("Error parsing onboarding data:", error);
          }
        }
      }

      // Check theme preference
      const darkMode = localStorage.getItem("darkMode") === "true";
      setIsDarkMode(darkMode);
      if (darkMode) {
        document.documentElement.setAttribute("data-theme", "dark");
      }

      setIsLoading(false);
    };

    initializeUser();
  }, [router]);
  useEffect(() => {
    if (!nearbySalons.length) {
      setFilteredSalons([]);
      return;
    }

    let filtered = nearbySalons;

    // Filter by selected service
    if (selectedService) {
      filtered = filtered.filter((salon) =>
        salon.topServices?.some((service) =>
          service.name.toLowerCase().includes(selectedService.toLowerCase())
        )
      );
    }

    // Filter by search term
    if (searchTerm) {
      const searchLower = searchTerm.toLowerCase();
      filtered = filtered.filter(
        (salon) =>
          salon.salonName.toLowerCase().includes(searchLower) ||
          salon.location.address.toLowerCase().includes(searchLower) ||
          salon.topServices?.some((service) =>
            service.name.toLowerCase().includes(searchLower)
          )
      );
    }

    setFilteredSalons(filtered);
  }, [nearbySalons, searchTerm, selectedService]);

  const loadNearbySalons = async (latitude, longitude, gender) => {
    setIsLoadingSalons(true);
    try {
      console.log("Loading salons for coordinates:", latitude, longitude);

      const response = await fetch(
        `/api/salons/nearby?latitude=${latitude}&longitude=${longitude}&radius=40&gender=${gender}`
      );

      const data = await response.json();
      console.log("Salon API response:", data);

      if (response.ok) {
        setNearbySalons(data.salons || []);
        console.log("Set nearby salons:", data.salons?.length || 0);
      } else {
        console.error("Error loading salons:", data.message);
        setNearbySalons([]);
      }
    } catch (error) {
      console.error("Error loading salons:", error);
      setNearbySalons([]);
    } finally {
      setIsLoadingSalons(false);
    }
  };

  const toggleDarkMode = () => {
    const newMode = !isDarkMode;
    setIsDarkMode(newMode);
    localStorage.setItem("darkMode", newMode.toString());

    if (newMode) {
      document.documentElement.setAttribute("data-theme", "dark");
    } else {
      document.documentElement.removeAttribute("data-theme");
    }
  };

  const navigateToAuth = (type, role) => {
    router.push(`/auth/${role}/${type}`);
  };

  const handleSalonCardClick = (salonId) => {
    router.push(`/salons/${salonId}`);
  };

  if (isLoading) {
    return (
      <div className={styles.loadingContainer}>
        <div className={styles.luxurySpinner}>
          <div className={styles.spinnerRing}></div>
          <div className={styles.spinnerCore}></div>
        </div>
        <motion.p
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ delay: 0.5 }}
          className={styles.loadingText}
        >
          Crafting your luxury experience...
        </motion.p>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      {/* Enhanced Header */}
      <header className={styles.header}>
        <div className={styles.headerContent}>
          <motion.div
            className={styles.logoContainer}
            initial={{ opacity: 0, x: -30 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8, ease: "easeOut" }}
          >
            <div className={styles.logoIcon}>✨</div>
            <h1 className={styles.logo}>
              <span className={styles.goldText}>Tech</span>
              <span className={styles.trimText}>Trims</span>
            </h1>
          </motion.div>

          {/* Desktop Navigation */}
          <nav className={styles.desktopNav}>
            <div className={styles.navLinks}>
              <button className={styles.navLink}>Services</button>
              <button className={styles.navLink}>Salons</button>
              <button className={styles.navLink}>About</button>
            </div>

            <div className={styles.headerActions}>
              <motion.button
                className={styles.themeToggle}
                onClick={toggleDarkMode}
                whileHover={{ scale: 1.1, rotate: 15 }}
                whileTap={{ scale: 0.95 }}
                title={
                  isDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode"
                }
              >
                <span className={styles.themeIcon}>
                  {isDarkMode ? "☀️" : "🌙"}
                </span>
              </motion.button>

              {UserDataManager.isLoggedIn() && (
                <motion.button
                  className={`${styles.actionButton} ${styles.bookingButton}`}
                  whileHover={{ scale: 1.05, y: -2 }}
                  whileTap={{ scale: 0.98 }}
                  onClick={() => router.push("/user/dashboard")}
                >
                  <span className={styles.buttonIcon}>📅</span>
                  My Bookings
                </motion.button>
              )}

              <motion.button
                className={`${styles.actionButton} ${styles.ownerButton}`}
                whileHover={{ scale: 1.05, y: -2 }}
                whileTap={{ scale: 0.98 }}
                onClick={() => navigateToAuth("register", "salon")}
              >
                <span className={styles.buttonIcon}>🏪</span>
                Register Salon
              </motion.button>

              <div className={styles.loginDropdown}>
                <motion.button
                  className={`${styles.actionButton} ${styles.loginButton}`}
                  whileHover={{ scale: 1.05, y: -2 }}
                  whileTap={{ scale: 0.98 }}
                  onClick={() => setShowLoginMenu(!showLoginMenu)}
                >
                  <span className={styles.buttonIcon}>👤</span>
                  Login
                  <span className={styles.dropdownArrow}>▼</span>
                </motion.button>
                {showLoginMenu && (
                  <motion.div
                    className={styles.loginMenu}
                    initial={{ opacity: 0, y: -10, scale: 0.95 }}
                    animate={{ opacity: 1, y: 0, scale: 1 }}
                    transition={{ duration: 0.2 }}
                  >
                    <button
                      onClick={() => {
                        router.push("/auth/user/login");
                        setShowLoginMenu(false);
                      }}
                    >
                      👤 User Login
                    </button>
                    <button
                      onClick={() => {
                        navigateToAuth("login", "salon");
                        setShowLoginMenu(false);
                      }}
                    >
                      🏪 Salon Login
                    </button>
                  </motion.div>
                )}
              </div>
            </div>
          </nav>

          {/* Mobile Menu Button */}
          <button
            className={styles.mobileMenuButton}
            onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}
          >
            <span
              className={`${styles.hamburgerLine} ${
                isMobileMenuOpen ? styles.active : ""
              }`}
            ></span>
            <span
              className={`${styles.hamburgerLine} ${
                isMobileMenuOpen ? styles.active : ""
              }`}
            ></span>
            <span
              className={`${styles.hamburgerLine} ${
                isMobileMenuOpen ? styles.active : ""
              }`}
            ></span>
          </button>

          {/* Mobile Navigation */}
          {isMobileMenuOpen && (
            <motion.div
              className={styles.mobileNav}
              initial={{ opacity: 0, height: 0 }}
              animate={{ opacity: 1, height: "auto" }}
              transition={{ duration: 0.3 }}
            >
              <div className={styles.mobileNavLinks}>
                <button className={styles.mobileNavLink}>Services</button>
                <button className={styles.mobileNavLink}>Salons</button>
                <button className={styles.mobileNavLink}>About</button>
                <div className={styles.mobileNavDivider}></div>
                {UserDataManager.isLoggedIn() && (
                  <button
                    className={styles.mobileNavLink}
                    onClick={() => {
                      router.push("/user/dashboard");
                      setIsMobileMenuOpen(false);
                    }}
                  >
                    📅 My Bookings
                  </button>
                )}
                <button
                  className={styles.mobileNavLink}
                  onClick={() => {
                    router.push("/auth/user/login");
                    setIsMobileMenuOpen(false);
                  }}
                >
                  👤 User Login
                </button>
                <button
                  className={styles.mobileNavLink}
                  onClick={() => {
                    navigateToAuth("login", "salon");
                    setIsMobileMenuOpen(false);
                  }}
                >
                  🏪 Salon Login
                </button>
                <button
                  className={styles.mobileNavLink}
                  onClick={() => {
                    navigateToAuth("register", "salon");
                    setIsMobileMenuOpen(false);
                  }}
                >
                  🏪 Register Salon
                </button>
              </div>
            </motion.div>
          )}
        </div>
      </header>
      {/* Hero Section */}
      <section className={styles.heroSection}>
        <div className={styles.heroBackground}>
          <div className={styles.heroPattern}></div>
          <div className={styles.floatingElements}>
            <div className={`${styles.floatingElement} ${styles.element1}`}>
              ✨
            </div>
            <div className={`${styles.floatingElement} ${styles.element2}`}>
              💎
            </div>
            <div className={`${styles.floatingElement} ${styles.element3}`}>
              👑
            </div>
            <div className={`${styles.floatingElement} ${styles.element4}`}>
              🌟
            </div>
          </div>
        </div>

        <div className={styles.heroContent}>
          <div className={styles.heroLeft}>
            <motion.div
              className={styles.heroTextContainer}
              initial={{ opacity: 0, y: 50 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 1, ease: "easeOut" }}
            >
              <motion.h1
                className={styles.heroTitle}
                initial={{ opacity: 0, y: 30 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 1, delay: 0.2 }}
              >
                Welcome back,
                <br />
                <span className={styles.heroNameHighlight}>
                  {userOnboarding?.name || "Guest"} ✨{" "}
                </span>
              </motion.h1>

              <motion.p
                className={styles.heroSubtitle}
                initial={{ opacity: 0, y: 30 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 1, delay: 0.4 }}
              >
                Discover luxury salon experiences and premium beauty services
                near{" "}
                <span className={styles.locationHighlight}>
                  {userOnboarding?.location?.address || "you"}{" "}
                </span>
              </motion.p>

              <motion.div
                className={styles.heroStats}
                initial={{ opacity: 0, y: 30 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 1, delay: 0.6 }}
              >
                <div className={styles.heroStat}>
                  <div className={styles.statIcon}>🏪</div>
                  <div className={styles.statContent}>
                    <span className={styles.statNumber}>
                      {nearbySalons.length}
                    </span>
                    <span className={styles.statLabel}>Premium Salons</span>
                  </div>
                </div>
                <div className={styles.heroStat}>
                  <div className={styles.statIcon}>💆</div>
                  <div className={styles.statContent}>
                    <span className={styles.statNumber}>
                      {nearbySalons.reduce(
                        (total, salon) =>
                          total + (salon.topServices?.length || 0),
                        0
                      )}
                    </span>
                    <span className={styles.statLabel}>Expert Services</span>
                  </div>
                </div>
                <div className={styles.heroStat}>
                  <div className={styles.statIcon}>⭐</div>
                  <div className={styles.statContent}>
                    <span className={styles.statNumber}>
                      {nearbySalons.reduce(
                        (total, salon) =>
                          total + (salon.stats?.totalBookings || 0),
                        0
                      )}
                    </span>
                    <span className={styles.statLabel}>Happy Clients</span>
                  </div>
                </div>
              </motion.div>

              <motion.div
                className={styles.heroActions}
                initial={{ opacity: 0, y: 30 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 1, delay: 0.8 }}
              >
                <button className={`${styles.heroCta} ${styles.primary}`}>
                  <span className={styles.ctaIcon}>🔍</span>
                  Find Salons Near Me
                </button>
                <button className={`${styles.heroCta} ${styles.secondary}`}>
                  <span className={styles.ctaIcon}>📅</span>
                  Book Appointment
                </button>
              </motion.div>
            </motion.div>
          </div>

          <div className={styles.heroRight}>
            <motion.div
              className={styles.heroVisuals}
              initial={{ opacity: 0, x: 50 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 1, delay: 0.3 }}
            >
              <div className={styles.visualsContainer}>
                <div className={styles.mainImage}>
                  <img
                    src="https://images.unsplash.com/photo-1560066984-138dadb4c035?w=600&h=400&fit=crop&crop=face"
                    alt="Luxury salon interior"
                    className={styles.heroImage}
                  />
                  <div className={styles.imageGradient}></div>
                </div>

                <div className={styles.floatingCards}>
                  <motion.div
                    className={`${styles.floatingCard} ${styles.card1}`}
                    animate={{ y: [0, -10, 0] }}
                    transition={{ duration: 3, repeat: Infinity }}
                  >
                    <div className={styles.cardIcon}>💇‍♀️</div>
                    <div className={styles.cardText}>
                      <span className={styles.cardTitle}>Hair Styling</span>
                      <span className={styles.cardPrice}>from ₹299</span>
                    </div>
                  </motion.div>

                  <motion.div
                    className={`${styles.floatingCard} ${styles.card2}`}
                    animate={{ y: [0, 10, 0] }}
                    transition={{ duration: 3, repeat: Infinity, delay: 1 }}
                  >
                    <div className={styles.cardIcon}>✨</div>
                    <div className={styles.cardText}>
                      <span className={styles.cardTitle}>Facial Treatment</span>
                      <span className={styles.cardPrice}>from ₹599</span>
                    </div>
                  </motion.div>

                  <motion.div
                    className={`${styles.floatingCard} ${styles.card3}`}
                    animate={{ y: [0, -8, 0] }}
                    transition={{ duration: 3, repeat: Infinity, delay: 2 }}
                  >
                    <div className={styles.cardIcon}>💅</div>
                    <div className={styles.cardText}>
                      <span className={styles.cardTitle}>Manicure</span>
                      <span className={styles.cardPrice}>from ₹399</span>
                    </div>
                  </motion.div>
                </div>

                {/* Decorative Elements */}
                <div className={styles.decorativeShapes}>
                  <div className={`${styles.shape} ${styles.shape1}`}></div>
                  <div className={`${styles.shape} ${styles.shape2}`}></div>
                  <div className={`${styles.shape} ${styles.shape3}`}></div>
                </div>
              </div>
            </motion.div>
          </div>
        </div>
      </section>
      {/* Enhanced Search Section */}
      <motion.section
        className={styles.searchSection}
        initial={{ opacity: 0, y: 50 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.2 }}
      >
        <div className={styles.searchContainer}>
          <motion.div
            className={styles.searchBox}
            whileHover={{ scale: 1.02 }}
            transition={{ type: "spring", stiffness: 300 }}
          >
            <div className={styles.searchInputWrapper}>
              <span className={styles.searchIcon}>🔍</span>
              <input
                type="text"
                placeholder="Search for services, salons, or treatments..."
                className={styles.searchInput}
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
              <motion.button
                className={styles.searchButton}
                whileHover={{ scale: 1.1 }}
                whileTap={{ scale: 0.95 }}
              >
                Search
              </motion.button>
            </div>
          </motion.div>

          <div className={styles.quickFilters}>
            <span className={styles.filtersLabel}>Popular:</span>
            {[
              { icon: "💇", label: "Haircut", color: "#FF6B6B" },
              { icon: "🧔", label: "Beard Trim", color: "#4ECDC4" },
              { icon: "💅", label: "Manicure", color: "#45B7D1" },
              { icon: "✨", label: "Facial", color: "#96CEB4" },
              { icon: "🎨", label: "Hair Color", color: "#FECA57" },
              { icon: "💆", label: "Massage", color: "#FF9FF3" },
            ].map((filter, index) => (
              <motion.button
                key={filter.label}
                className={`${styles.filterChip} ${
                  selectedService === filter.label ? styles.activeFilter : ""
                }`}
                style={{ "--filter-color": filter.color }}
                whileHover={{ scale: 1.05, y: -2 }}
                whileTap={{ scale: 0.98 }}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.1 * index }}
                onClick={() => {
                  if (selectedService === filter.label) {
                    setSelectedService(""); // Deselect if already selected
                  } else {
                    setSelectedService(filter.label);
                  }
                }}
              >
                <span className={styles.filterIcon}>{filter.icon}</span>
                {filter.label}
              </motion.button>
            ))}
          </div>
        </div>
      </motion.section>
      {/* <motion.section
        className={styles.servicesSection}
        initial={{ opacity: 0, y: 50 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.4 }}
      >
        <div className={styles.sectionHeader}>
          <div className={styles.sectionTitleContainer}>
            <motion.h3
              className={styles.sectionTitle}
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.8 }}
            >
              {userOnboarding
                ? `Perfect for ${userOnboarding.gender || "Everyone"}`
                : "Perfect Services for You"}
            </motion.h3>
            <motion.p
              className={styles.sectionSubtitle}
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ duration: 0.8, delay: 0.2 }}
            >
              Curated services designed just for you
            </motion.p>
          </div>
        </div>

        <div className={styles.servicesGrid}>
          {getGenderBasedServices(userOnboarding?.gender || "Other").map(
            (service, index) => (
              <motion.div
                key={service.name}
                className={styles.serviceCard}
                initial={{ opacity: 0, y: 30 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.6, delay: 0.1 * index }}
                whileHover={{
                  y: -8,
                  scale: 1.02,
                  transition: { type: "spring", stiffness: 300 },
                }}
              >
                <div className={styles.serviceCardBackground}></div>
                <div className={styles.serviceIcon}>{service.icon}</div>
                <h4 className={styles.serviceName}>{service.name}</h4>
                <div className={styles.serviceDetails}>
                  <p className={styles.servicePrice}>₹{service.price}</p>
                  <p className={styles.serviceDuration}>
                    ⏱ {service.duration} min
                  </p>
                </div>
                <motion.button
                  className={styles.serviceBookButton}
                  whileHover={{ scale: 1.05 }}
                  whileTap={{ scale: 0.98 }}
                >
                  Book Now
                </motion.button>
              </motion.div>
            )
          )}
        </div>
      </motion.section>
      ; */}
      <motion.section
        className={styles.salonsSection}
        initial={{ opacity: 0, y: 50 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.6 }}
      >
        <div className={styles.sectionHeader}>
          <div className={styles.sectionTitleContainer}>
            <h3 className={styles.sectionTitle}>Premium Salons Near You</h3>
            <p className={styles.sectionSubtitle}>
              Handpicked luxury experiences in your area
            </p>
          </div>
          <div className={styles.viewOptions}>
            <motion.button
              className={`${styles.viewToggle} ${
                !showMapView ? styles.active : ""
              }`}
              onClick={() => setShowMapView(false)}
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.98 }}
            >
              <span className={styles.viewIcon}>🏗</span>
              Grid View
            </motion.button>
            <motion.button
              className={`${styles.viewToggle} ${
                showMapView ? styles.active : ""
              }`}
              onClick={() => setShowMapView(true)}
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.98 }}
            >
              <span className={styles.viewIcon}>🗺</span>
              Map View
            </motion.button>
          </div>
        </div>

        {isLoadingSalons ? (
          <div className={styles.loadingSalons}>
            <div className={styles.luxurySpinner}>
              <div className={styles.spinnerRing}></div>
              <div className={styles.spinnerCore}></div>
            </div>
            <p>Discovering premium salons near you...</p>
          </div>
        ) : nearbySalons.length > 0 ? (
          showMapView ? (
            <div className={styles.mapContainer}>
              <SalonMap
                salons={nearbySalons}
                userLocation={{
                  lat: userOnboarding?.location?.latitude,
                  lng: userOnboarding?.location?.longitude,
                }}
                selectedSalon={selectedSalon}
                onSalonSelect={setSelectedSalon}
                onBookNow={handleSalonCardClick}
                userGender={userOnboarding?.gender}
              />
            </div>
          ) : (
            <div className={styles.salonsGrid}>
              {(filteredSalons.length > 0 ? filteredSalons : nearbySalons).map(
                (salon, index) => {
                  return (
                    <motion.div
                      key={salon._id?.$oid || salon._id?.toString() || index}
                      className={styles.salonCard}
                      initial={{ opacity: 0, y: 30 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ duration: 0.6, delay: 0.1 * index }}
                      whileHover={{
                        y: -12,
                        scale: 1.02,
                        transition: { type: "spring", stiffness: 300 },
                      }}
                      onClick={() =>
                        handleSalonCardClick(salon._id?.$oid || salon._id)
                      }
                    >
                      <div className={styles.salonImageContainer}>
                        <img
                          src={
                            typeof salon.salonImages?.[0] === "string"
                              ? salon.salonImages[0]
                              : salon.salonImages?.[0]?.url ||
                                "https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop"
                          }
                          alt={salon.salonName || "Salon image"}
                          className={styles.salonImage}
                        />
                        <div className={styles.salonImageOverlay}></div>

                        <div className={styles.salonBadges}>
                          <span
                            className={`${styles.salonBadge} ${styles.primaryBadge}`}
                          >
                            {salon.distance < 2
                              ? "Very Close"
                              : salon.isVerified
                              ? "Verified"
                              : "Popular"}
                          </span>
                          <span
                            className={`${styles.salonBadge} ${styles.distanceBadge}`}
                          >
                            {salon.distance}km away
                          </span>
                        </div>
                      </div>

                      <div className={styles.salonInfo}>
                        <div className={styles.salonHeader}>
                          <h4 className={styles.salonName}>
                            {highlightText(salon.salonName, searchTerm)}
                          </h4>{" "}
                          <div className={styles.salonRating}>
                            <span className={styles.ratingStars}>
                              ⭐⭐⭐⭐⭐
                            </span>
                            <span className={styles.ratingNumber}>
                              {(
                                salon.ratings?.overall ??
                                salon.rating ??
                                4.5
                              ).toFixed(1)}
                            </span>
                          </div>
                        </div>

                        <p className={styles.salonLocation}>
                          📍 {highlightText(salon.location.address, searchTerm)}
                        </p>

                        <div className={styles.salonMetrics}>
                          <div className={styles.metric}>
                            <span className={styles.metricIcon}>👥</span>
                            <span className={styles.metricValue}>
                              {salon.stats?.totalBookings || 0} bookings
                            </span>
                          </div>
                          <div className={styles.metric}>
                            <span className={styles.metricIcon}>⏰</span>
                            <span className={styles.metricValue}>Open Now</span>
                          </div>
                        </div>

                        <div className={styles.salonServices}>
                          {salon.topServices
                            ?.slice(0, 3)
                            .map((service, idx) => {
                              const isHighlighted =
                                selectedService &&
                                service.name
                                  .toLowerCase()
                                  .includes(selectedService.toLowerCase());
                              return (
                                <span
                                  key={idx}
                                  className={`${styles.serviceTag} ${
                                    isHighlighted
                                      ? styles.highlightedService
                                      : ""
                                  }`}
                                >
                                  {highlightText(
                                    String(service?.name),
                                    searchTerm
                                  )}{" "}
                                  <strong>₹{String(service?.price)}</strong>
                                </span>
                              );
                            })}
                        </div>

                        <motion.button
                          className={styles.salonBookButton}
                          whileHover={{ scale: 1.02, y: -2 }}
                          whileTap={{ scale: 0.98 }}
                          onClick={(e) => {
                            e.stopPropagation();
                            handleSalonCardClick(salon._id);
                          }}
                        >
                          <span className={styles.bookButtonIcon}>📅</span>
                          Book Appointment
                          <span className={styles.bookButtonArrow}>→</span>
                        </motion.button>
                      </div>
                    </motion.div>
                  );
                }
              )}
            </div>
          )
        ) : searchTerm || selectedService ? (
          <div className={styles.noSalons}>
            <div className={styles.noSalonsIcon}>🔍</div>
            <h4 className={styles.noSalonsTitle}>No Results Found</h4>
            <p className={styles.noSalonsText}>
              No salons found matching &quot;{searchTerm || selectedService}
              &quot;. Try adjusting your search.
            </p>
            <motion.button
              className={styles.registerSalonButton}
              whileHover={{ scale: 1.05, y: -2 }}
              whileTap={{ scale: 0.98 }}
              onClick={() => {
                setSearchTerm("");
                setSelectedService("");
              }}
            >
              <span className={styles.registerIcon}>🔄</span>
              Clear Filters
            </motion.button>
          </div>
        ) : (
          <div className={styles.noSalons}>
            <div className={styles.noSalonsIcon}>🏪</div>
            <h4 className={styles.noSalonsTitle}>No Premium Salons Found</h4>
            <p className={styles.noSalonsText}>
              We couldn&#39;t find any salons in your area. Help us grow by
              registering your salon!
            </p>
            <motion.button
              className={styles.registerSalonButton}
              whileHover={{ scale: 1.05, y: -2 }}
              whileTap={{ scale: 0.98 }}
              onClick={() => navigateToAuth("register", "salon")}
            >
              <span className={styles.registerIcon}>✨</span>
              Register Your Salon
            </motion.button>
          </div>
        )}
      </motion.section>
      ;{/* Testimonials Section */}
      <motion.section
        className={styles.testimonialsSection}
        initial={{ opacity: 0, y: 50 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.8 }}
      >
        <div className={styles.sectionHeader}>
          <h3 className={styles.sectionTitle}>What Our Clients Say</h3>
          <p className={styles.sectionSubtitle}>
            Real experiences from real people
          </p>
        </div>

        <div className={styles.testimonialsGrid}>
          {[
            {
              name: "Priya Sharma",
              service: "Hair Styling & Color",
              rating: 5,
              text: "Absolutely amazing experience! The staff was professional and the results exceeded my expectations.",
              image:
                "https://images.unsplash.com/photo-1494790108755-2616b612b742?w=80&h=80&fit=crop&crop=face",
            },
            {
              name: "Rajesh Kumar",
              service: "Beard Styling",
              rating: 5,
              text: "Best grooming experience I've had in Mumbai. Clean, professional, and great attention to detail.",
              image:
                "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=80&h=80&fit=crop&crop=face",
            },
            {
              name: "Anita Patel",
              service: "Facial & Manicure",
              rating: 5,
              text: "Such a relaxing and luxurious experience. I feel completely refreshed and beautiful!",
              image:
                "https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=80&h=80&fit=crop&crop=face",
            },
          ].map((testimonial, index) => (
            <motion.div
              key={testimonial.name}
              className={styles.testimonialCard}
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.6, delay: 0.1 * index }}
              whileHover={{ y: -5, scale: 1.02 }}
            >
              <div className={styles.testimonialHeader}>
                <img
                  src={testimonial.image}
                  alt={testimonial.name}
                  className={styles.testimonialAvatar}
                />
                <div className={styles.testimonialMeta}>
                  <h5 className={styles.testimonialName}>{testimonial.name}</h5>
                  <p className={styles.testimonialService}>
                    {testimonial.service}
                  </p>
                  <div className={styles.testimonialRating}>
                    {"⭐".repeat(testimonial.rating)}
                  </div>
                </div>
              </div>
              <p className={styles.testimonialText}>
                &quot;{testimonial.text}&quot;
              </p>
            </motion.div>
          ))}
        </div>
      </motion.section>
      {/* Enhanced Footer */}
      <footer className={styles.footer}>
        <div className={styles.footerContent}>
          <div className={styles.footerMain}>
            <div className={styles.footerBrand}>
              <div className={styles.footerLogo}>
                <div className={styles.footerLogoIcon}>✨</div>
                <h4>TechTrims</h4>
              </div>
              <p className={styles.footerTagline}>
                Elevating beauty experiences through technology and luxury
              </p>
              <div className={styles.footerSocials}>
                <button className={styles.socialButton}>📘</button>
                <button className={styles.socialButton}>📸</button>
                <button className={styles.socialButton}>🐦</button>
                <button className={styles.socialButton}>💼</button>
              </div>
            </div>

            <div className={styles.footerLinks}>
              <div className={styles.footerColumn}>
                <h5 className={styles.footerColumnTitle}>Services</h5>
                <ul className={styles.footerList}>
                  <li>
                    <a href="#haircut">Hair Styling</a>
                  </li>
                  <li>
                    <a href="#facial">Facial Treatments</a>
                  </li>
                  <li>
                    <a href="#manicure">Nail Care</a>
                  </li>
                  <li>
                    <a href="#massage">Spa & Massage</a>
                  </li>
                </ul>
              </div>

              <div className={styles.footerColumn}>
                <h5 className={styles.footerColumnTitle}>For Business</h5>
                <ul className={styles.footerList}>
                  <li>
                    <a href="#register">Register Your Salon</a>
                  </li>
                  <li>
                    <a href="#partner">Partner with Us</a>
                  </li>
                  <li>
                    <a href="#business">Business Solutions</a>
                  </li>
                  <li>
                    <a href="#support">Business Support</a>
                  </li>
                </ul>
              </div>

              <div className={styles.footerColumn}>
                <h5 className={styles.footerColumnTitle}>Support</h5>
                <ul className={styles.footerList}>
                  <li>
                    <a href="#help">Help Center</a>
                  </li>
                  <li>
                    <a href="#contact">Contact Us</a>
                  </li>
                  <li>
                    <a href="#terms">Terms of Service</a>
                  </li>
                  <li>
                    <a href="#privacy">Privacy Policy</a>
                  </li>
                </ul>
              </div>

              <div className={styles.footerColumn}>
                <h5 className={styles.footerColumnTitle}>Connect</h5>
                <div className={styles.footerContact}>
                  <p>📞 +91 98765 43210</p>
                  <p>✉️ hello@techtrims.com</p>
                  <p>📍 Mumbai, Maharashtra</p>
                </div>
              </div>
            </div>
          </div>

          <div className={styles.footerBottom}>
            <div className={styles.footerBottomContent}>
              <p>&copy; 2025 TechTrims. All rights reserved.</p>
              <div className={styles.footerBadges}>
                <span className={styles.footerBadge}>🔒 Secure</span>
                <span className={styles.footerBadge}>⭐ Verified</span>
                <span className={styles.footerBadge}>💎 Premium</span>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
  );
}

// Helper function to highlight search text
function highlightText(text, highlight) {
  if (!highlight) return text;

  const regex = new RegExp(`(${highlight})`, "gi");
  return text.split(regex).map((part, index) =>
    regex.test(part) ? (
      <mark key={index} style={{ background: "#ffd700", padding: "0 2px" }}>
        {part}
      </mark>
    ) : (
      part
    )
  );
}

function getGenderBasedServices(gender) {
  const maleServices = [
    { name: "Premium Haircut", price: 299, duration: 45, icon: "✂️" },
    { name: "Beard Styling", price: 199, duration: 30, icon: "🧔" },
    { name: "Hair Styling", price: 349, duration: 35, icon: "💇‍♂️" },
    { name: "Face Treatment", price: 449, duration: 60, icon: "🧴" },
  ];

  const femaleServices = [
    { name: "Hair Styling", price: 599, duration: 90, icon: "💇‍♀️" },
    { name: "Hair Coloring", price: 1299, duration: 150, icon: "🎨" },
    { name: "Facial Glow", price: 799, duration: 90, icon: "✨" },
    { name: "Luxury Manicure", price: 499, duration: 60, icon: "💅" },
  ];

  const otherServices = [
    { name: "Hair Treatment", price: 699, duration: 75, icon: "🌿" },
    { name: "Scalp Therapy", price: 449, duration: 45, icon: "💆" },
    { name: "Hair Wash & Dry", price: 199, duration: 30, icon: "🚿" },
    { name: "Style Consultation", price: 499, duration: 60, icon: "💫" },
  ];

  switch (gender) {
    case "Male":
      return maleServices;
    case "Female":
      return femaleServices;
    default:
      return otherServices;
  }
}
</file>

<file path="src/pages/salons/[id].js">
// pages/salons/[id].js
import { useState, useEffect, useCallback } from "react";
import { useRouter } from "next/router";
import { motion } from "framer-motion";
import dynamic from "next/dynamic";
import styles from "../../styles/SalonDetail.module.css";
import Image from "next/image";

// Dynamic map import to avoid SSR issues
const MapContainer = dynamic(
  () => import("react-leaflet").then((mod) => mod.MapContainer),
  { ssr: false }
);
const TileLayer = dynamic(
  () => import("react-leaflet").then((mod) => mod.TileLayer),
  { ssr: false }
);
const Marker = dynamic(
  () => import("react-leaflet").then((mod) => mod.Marker),
  { ssr: false }
);

export default function SalonDetail({ initialSalon }) {
  const router = useRouter();
  const { id } = router.query;
  const [userInfo, setUserInfo] = useState(null);
  const [salon, setSalon] = useState(initialSalon || null);
  const [isLoading, setIsLoading] = useState(!initialSalon);
  const [selectedServices, setSelectedServices] = useState([]);
  const [selectedTime, setSelectedTime] = useState(null);
  const [availableBarbers, setAvailableBarbers] = useState([]);
  const [selectedBarber, setSelectedBarber] = useState(null);
  const [selectedDate, setSelectedDate] = useState("");
  const [selectedSlot, setSelectedSlot] = useState("");
  const [timeSlots, setTimeSlots] = useState([]); // ✅ added this
  const [userOnboarding, setUserOnboarding] = useState(null);
  const [showRegistrationModal, setShowRegistrationModal] = useState(false);
  const [isBooking, setIsBooking] = useState(false);
  const [otpSent, setOtpSent] = useState(false);
  const [otpCode, setOtpCode] = useState("");
  const [otpMobile, setOtpMobile] = useState("");
  const [sseMessages, setSseMessages] = useState([]);
  const [regName, setRegName] = useState("");
  const [regMobile, setRegMobile] = useState("");
  const [regEmail, setRegEmail] = useState("");

  useEffect(() => {
    // Only run once when component mounts
    if (typeof window !== "undefined") {
      const stored = localStorage.getItem("userOnboardingData");
      if (stored) {
        try {
          const parsed = JSON.parse(stored);
          setUserInfo(parsed);
          console.log("Loaded userInfo from localStorage:", parsed);
        } catch (err) {
          console.error("Failed to parse onboarding data:", err);
        }
      }
    }
  }, []);

  useEffect(() => {
    console.log(
      "🔎 Button enable check → Services:",
      selectedServices,
      "Time:",
      selectedTime
    );
  }, [selectedServices, selectedTime]);

  useEffect(() => {
    if (selectedServices.length > 0 && salon?._id) {
      const fetchAvailableBarbers = async () => {
        try {
          // Use the first selected service name
          const firstServiceName = selectedServices[0].name;
          console.log("Fetching barbers for service:", firstServiceName);

          // Fetch barbers who can perform the selected service
          const res = await fetch(
            `/api/salons/barbers/available?salonId=${
              salon._id
            }&service=${encodeURIComponent(firstServiceName)}`
          );

          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }

          const barbers = await res.json();
          console.log("Available barbers:", barbers);
          setAvailableBarbers(barbers);

          // If no barbers available, show a message but don't prevent booking
          if (barbers.length === 0) {
            console.warn("No barbers available for selected service");
          }
        } catch (err) {
          console.error("Error fetching barbers:", err);
          setAvailableBarbers([]);
        }
      };

      fetchAvailableBarbers();
    } else {
      setAvailableBarbers([]);
      setSelectedBarber(null);
    }
  }, [selectedServices, salon?._id]);

  const chosenService =
    salon?.services && selectedServices
      ? { name: selectedServices, ...(salon.services[selectedServices] || {}) }
      : null;
  const chosenBarber =
    salon?.barbers && selectedBarber
      ? salon.barbers.find(
          (b) => (b.id || b._id || b.name) === selectedBarber
        ) || null
      : null;
  const [showBookingModal, setShowBookingModal] = useState(false);

  // Client re-fetch (optional, keeps data fresh if user navigates without reload)
  const computeTimeSlotsForDate = useCallback(
    (dateStr) => {
      if (!dateStr) return [];
      const slots = [];
      const today = new Date();
      const selectedDateObj = new Date(dateStr);
      const startHour =
        selectedDateObj.toDateString() === today.toDateString()
          ? Math.max(9, today.getHours() + 1)
          : 9;
      const endHour = 20;

      const bookedSet = new Set(
        (salon.bookings || [])
          .filter((b) => {
            try {
              const bd = new Date(b.date);
              return bd.toDateString() === selectedDateObj.toDateString();
            } catch {
              return false;
            }
          })
          .map((b) => b.date === selectedDate)
      );

      for (let hour = startHour; hour < endHour; hour++) {
        for (let minute = 0; minute < 60; minute += 30) {
          const hh = String(hour).padStart(2, "0");
          const mm = String(minute).padStart(2, "0");
          const timeString = `${hh}:${mm}`;
          slots.push({
            time: timeString,
            available: !bookedSet.has(timeString),
          });
        }
      }

      return slots;
    },
    [salon, selectedDate]
  );
  useEffect(() => {
    if (!selectedDate) {
      setTimeSlots([]);
      setSelectedSlot("");
      return;
    }
    const slots = computeTimeSlotsForDate(selectedDate);
    setTimeSlots(slots);
  }, [selectedDate, computeTimeSlotsForDate]);
  const getFilteredServices = () => {
    if (!salon) return [];

    // Convert object → array
    const servicesArray = Object.entries(salon.services || {}).map(
      ([key, value]) => ({
        name: key,
        price: Number(value.price) || 0,
        enabled: value.enabled,
        duration: value.duration || 30, // fallback if not stored
        gender: value.gender || ["All"], // fallback if not stored
      })
    );

    if (!userOnboarding) return servicesArray;

    return servicesArray.filter(
      (service) =>
        service.gender.includes(userOnboarding.gender) ||
        service.gender.includes("All")
    );
  };

  if (isLoading) {
    return (
      <div className={styles.loadingContainer}>
        <div className={styles.spinner}></div>
        <p>Loading salon details...</p>
      </div>
    );
  }

  if (!salon) {
    return (
      <div className={styles.errorContainer}>
        <h2>Salon not found</h2>
        <button onClick={() => router.push("/")} className={styles.backButton}>
          ← Back to Home
        </button>
      </div>
    );
  }

  const handleServiceClick = (service) => {
    setSelectedServices((prev) => {
      const exists = prev.find((s) => s.name === service.name);
      if (exists) {
        return prev.filter((s) => s.name !== service.name);
      } else {
        return [...prev, service];
      }
    });
  };

  const handleTimeClick = (time) => {
    console.log("Time selected:", time);
    setSelectedTime(time);
    setSelectedSlot(time); // optional: keep both in sync
  };

  const handleBooking = async () => {
    if (selectedServices.length === 0) {
      alert("Please select at least one service");
      return;
    }

    // Allow booking even if no specific barber selected (salon can assign one)
    if (availableBarbers.length > 0 && !selectedBarber) {
      alert("Please select a barber");
      return;
    }

    if (!selectedDate) {
      alert("Please select a date");
      return;
    }

    if (!selectedSlot) {
      alert("Please select a time slot");
      return;
    }

    try {
      console.log("Booking with:", {
        selectedServices,
        selectedSlot,
        selectedBarber,
        userInfo,
      });

      // Find selected barber details if one is selected
      const selectedBarberDetails = selectedBarber
        ? availableBarbers.find((b) => b._id === selectedBarber)
        : null;

      // Prepare booking data
      const allServices = selectedServices
        .map((service) => service.name)
        .join(", ");
      const totalPrice = selectedServices.reduce(
        (sum, service) => sum + service.price,
        0
      );

      const getCurrentUserInfo = () => {
        if (typeof window === "undefined") return null;
        try {
          const stored = localStorage.getItem("userOnboardingData");
          return stored ? JSON.parse(stored) : null;
        } catch {
          return null;
        }
      };

      const currentUserInfo = getCurrentUserInfo() || userInfo;

      const payload = {
        salonId: salon._id,
        service: allServices,
        barber:
          selectedBarberDetails?.name || selectedBarber || "Any Available",
        barberId: selectedBarber || null,
        date: selectedDate,
        time: selectedSlot,
        price: totalPrice,
        customerName: currentUserInfo?.name || "Anonymous",
        customerPhone: currentUserInfo?.phone || "",
        user: currentUserInfo,
        userId: currentUserInfo?._id || null,
      };

      console.log("Booking payload:", payload);

      const response = await fetch("/api/bookings/create", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      });

      // Handle 409 conflict (slot already booked)
      if (response.status === 409) {
        const errorData = await response.json();
        alert(
          "⚠️ Sorry! This time slot was just booked by another customer. Please select a different time."
        );
        window.location.reload();
        return;
      }

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(
          errorData.error || `Booking failed: ${response.status}`
        );
      }

      const data = await response.json();
      console.log("✅ Booking confirmed:", data);

      alert("✅ Booking confirmed successfully!");

      // Reset form
      setSelectedServices([]);
      setSelectedBarber(null);
      setSelectedDate("");
      setSelectedSlot("");

      // Redirect to confirmation page
      router.push(`/booking/confirmed?id=${data.bookingId || data._id}`);
    } catch (error) {
      console.error("❌ Booking error:", error);
      alert(`Booking failed: ${error.message}`);
    }
  };

  const handleRegisterAndLink = async () => {
    // call registration API
    if (!regName || !regMobile) return alert("Please enter name and mobile");
    try {
      const res = await fetch("/api/users/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: regName,
          mobile: regMobile,
          email: regEmail,
        }),
      });
      const data = await res.json();
      if (!res.ok) {
        setIsBooking(false);
        return alert(
          "Registration failed: " + (data.message || res.statusText)
        );
      }
      // set onboarding and close modal
      setUserOnboarding({ name: regName, mobile: regMobile, email: regEmail });
      setShowRegistrationModal(false);
      alert("Account created! You are now registered.");
    } catch (e) {
      console.error(e);
      alert("Registration failed: " + e.message);
    }
  };

  const sendOtpForRegistration = async (mobile) => {
    try {
      const res = await fetch("/api/auth/send-otp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobile }),
      });
      const data = await res.json();
      if (res.ok) {
        setOtpSent(true);
        setOtpMobile(mobile);
        // For dev we get OTP in response; in prod SMS is sent.
        setOtpCode(data.otp || "");
        alert("OTP sent (dev): " + (data.otp || "---"));
      } else {
        alert("OTP send failed: " + (data.message || res.statusText));
      }
    } catch (e) {
      console.error(e);
      alert("OTP send failed");
    }
  };

  const verifyOtpAndRegister = async (mobile, otp) => {
    try {
      const res = await fetch("/api/auth/verify-otp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobile, otp }),
      });
      const data = await res.json();
      if (!res.ok)
        return alert("OTP verify failed: " + (data.message || res.statusText));
      // if user present, set onboarding; else open registration form
      if (data.user) {
        setUserOnboarding({
          name: data.user.name,
          mobile: data.user.mobile,
          email: data.user.email,
        });
        alert("Verified and signed in");
        setShowRegistrationModal(false);
      } else {
        // No existing user: fill registration modal fields
        setRegName(regName || "");
        setRegMobile(mobile);
        setShowRegistrationModal(true);
      }
      setOtpSent(false);
      setOtpCode("");
    } catch (e) {
      console.error(e);
      alert("OTP verify failed");
    }
  };

  return (
    <div className={styles.container}>
      {/* Header */}
      <header className={styles.header}>
        <button onClick={() => router.back()} className={styles.backButton}>
          ← Back
        </button>
        <h1 className={styles.salonName}>{salon.salonName}</h1>
        <div className={styles.headerActions}>
          <button className={styles.shareButton}>📤</button>
          <button className={styles.favoriteButton}>❤️</button>
        </div>
      </header>

      {/* Hero Section */}
      <motion.section
        className={styles.heroSection}
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ duration: 0.8 }}
      >
        <div className={styles.imageGallery}>
          {salon.salonImages && salon.salonImages.length > 0 ? (
            <Image
              src={salon.salonImages[0]}
              alt={salon.salonName}
              className={styles.mainImage}
            />
          ) : (
            <div className={styles.placeholderImage}>
              <span>📸</span>
              <p>No images available</p>
            </div>
          )}
        </div>

        <div className={styles.salonBasicInfo}>
          <div className={styles.ratingSection}>
            <div className={styles.mainRating}>
              ⭐ {salon.ratings.overall.toFixed(1)}
            </div>
            <div className={styles.reviewCount}>
              ({salon.ratings.totalReviews} reviews)
            </div>
          </div>

          <div className={styles.locationInfo}>
            <p>📍 {salon.location.address}</p>
            <p>📞 {salon.phone}</p>
          </div>

          <div className={styles.quickStats}>
            <div className={styles.stat}>
              <span className={styles.statNumber}>
                {salon.stats.totalBookings}
              </span>
              <span className={styles.statLabel}>Total Bookings</span>
            </div>
            <div className={styles.stat}>
              <span className={styles.statNumber}>
                {salon.stats.averageWaitTime}min
              </span>
              <span className={styles.statLabel}>Avg Wait Time</span>
            </div>
            <div className={styles.stat}>
              <span className={styles.statNumber}>
                {salon.stats.repeatCustomers}
              </span>
              <span className={styles.statLabel}>Repeat Customers</span>
            </div>
          </div>
        </div>
      </motion.section>

      {/* Services Section */}
      <motion.section
        className={styles.servicesSection}
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.2 }}
      >
        <h3 className={styles.sectionTitle}>Services & Pricing</h3>
        <div className={styles.servicesGrid}>
          {getFilteredServices().map((service, index) => (
            <motion.div
              key={index}
              className={`${styles.serviceCard} ${
                selectedServices.find((s) => s.name === service.name)
                  ? styles.selected
                  : ""
              }`}
              onClick={() => {
                console.log("Service clicked:", service.name);
                handleServiceClick(service);
                console.log("Current selectedServices:", service);
              }}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              <h4 className={styles.serviceName}>{service.name}</h4>
              <p className={styles.servicePrice}>₹{service.price}</p>
              <p className={styles.serviceDuration}>{service.duration} min</p>
              <p className={styles.serviceGender}>
                {service.gender.join(", ")}
              </p>
            </motion.div>
          ))}
        </div>
      </motion.section>

      {/* Barber Selection Section */}

      {selectedServices.length > 0 && (
        <motion.section
          className={styles.barbersSection}
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.4 }}
        >
          <h3 className={styles.sectionTitle}>Choose Your Barber</h3>

          {availableBarbers.length > 0 ? (
            <div className={styles.barbersGrid}>
              {availableBarbers.map((barber, index) => (
                <motion.div
                  key={barber._id || index}
                  className={`${styles.barberCard} ${
                    selectedBarber === barber._id ? styles.selected : ""
                  }`}
                  onClick={() => setSelectedBarber(barber._id)}
                  whileHover={{ scale: 1.02 }}
                  whileTap={{ scale: 0.98 }}
                >
                  {/* Barber card content */}
                  <div className={styles.barberImage}>
                    {barber.photo ? (
                      <img
                        src={barber.photo}
                        alt={barber.name}
                        className={styles.barberPhoto}
                      />
                    ) : (
                      <div className={styles.defaultBarberImage}>👨‍💼</div>
                    )}
                  </div>
                  <h4 className={styles.barberName}>{barber.name}</h4>
                  <p className={styles.barberExperience}>
                    {barber.experience} yrs experience
                  </p>
                  <div className={styles.barberRating}>
                    <span>⭐</span>
                    <span>{barber.rating}/5</span>
                    <span className="text-gray-500 ml-2">
                      ({barber.totalBookings} bookings)
                    </span>
                  </div>
                  <div className={styles.barberSkills}>
                    {barber.skills.slice(0, 3).map((skill) => (
                      <span key={skill} className={styles.skillChip}>
                        {skill}
                      </span>
                    ))}
                  </div>
                  {barber.bio && (
                    <p className={styles.barberBio}>
                      {barber.bio.length > 80
                        ? `${barber.bio.substring(0, 80)}...`
                        : barber.bio}
                    </p>
                  )}
                </motion.div>
              ))}
            </div>
          ) : (
            <div className="text-center py-8 bg-blue-50 rounded-lg">
              <h4 className="text-lg font-semibold text-blue-800 mb-2">
                Salon Will Assign Best Available Barber
              </h4>
              <p className="text-blue-600">
                No specialized barbers are currently available for the selected
                services, but the salon will assign the best available barber
                for your appointment.
              </p>
            </div>
          )}
        </motion.section>
      )}

      {selectedServices.length > 0 && availableBarbers.length === 0 && (
        <motion.section
          className={styles.noBarbersSection}
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.4 }}
        >
          <div className="text-center py-8 bg-yellow-50 rounded-lg">
            <h3 className="text-lg font-semibold text-yellow-800 mb-2">
              No Specialized Barbers Available
            </h3>
            <p className="text-yellow-600">
              Sorry, no barbers are currently available for the selected
              services. Please try different services or contact the salon
              directly.
            </p>
          </div>
        </motion.section>
      )}

      {/* Date & Time Selection */}
      <motion.section
        className={styles.bookingSection}
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.6 }}
      >
        <h3 className={styles.sectionTitle}>Select Date & Time</h3>
        <div className={styles.dateTimePicker}>
          <input
            type="date"
            value={selectedDate}
            onChange={(e) => setSelectedDate(e.target.value)}
            className={styles.dateInput}
          />
          <div className={styles.timeSlots}>
            {selectedDate ? (
              timeSlots.length === 0 ? (
                <div>No slots available for selected date</div>
              ) : (
                <div className={styles.timeSlotsWrapper}>
                  {timeSlots.map((slot, idx) => (
                    <button
                      key={idx}
                      className={`${styles.timeSlot} ${
                        selectedSlot === slot.time ? styles.selected : ""
                      } ${!slot.available ? styles.disabled : ""}`}
                      onClick={() => {
                        console.log("Slot clicked:", slot.time);
                        handleTimeClick(slot.time);
                        console.log("Current selectedSlot:", slot.time);
                      }}
                      disabled={!slot.available} // ✅ ensure unavailable slots can’t be clicked
                    >
                      {slot.time}
                    </button>
                  ))}
                </div>
              )
            ) : (
              <p>Please select a date</p>
            )}
          </div>
        </div>
      </motion.section>

      {/* Map Section */}
      {salon.location.latitude && salon.location.longitude && (
        <motion.section
          className={styles.mapSection}
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.8 }}
        >
          <h3 className={styles.sectionTitle}>Location</h3>
          <MapContainer
            center={[salon.location.latitude, salon.location.longitude]}
            zoom={15}
            style={{ height: "300px", width: "100%" }}
          >
            <TileLayer
              url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
              attribution="&copy; OpenStreetMap contributors"
            />
            <Marker
              position={[salon.location.latitude, salon.location.longitude]}
            />
          </MapContainer>
        </motion.section>
      )}

      {/* Book Appointment Button */}
      <div className={styles.bookButtonContainer}>
        <button
          onClick={handleBooking}
          disabled={selectedServices.length === 0 || !selectedSlot}
          className={`${styles.bookButton} ${
            selectedServices.length === 0 || !selectedSlot
              ? styles.disabled
              : ""
          }`}
        >
          Book Appointment
          {availableBarbers.length === 0 && selectedServices.length > 0 && (
            <small className={styles.buttonSubtext}>
              (Salon will assign barber)
            </small>
          )}
        </button>
      </div>

      {/* Booking Modal */}
      {/* Registration Modal - shown after booking if user not onboarded */}
      {showRegistrationModal && (
        <div className={styles.modalOverlay}>
          <div className={styles.modalContent}>
            <h3>Create your account</h3>
            <p>
              We prefilled your booking info — just confirm to create an
              account.
            </p>
            <input
              placeholder="Name"
              value={regName}
              onChange={(e) => setRegName(e.target.value)}
            />
            <input
              placeholder="Mobile"
              value={regMobile}
              onChange={(e) => setRegMobile(e.target.value)}
            />
            <input
              placeholder="Email (optional)"
              value={regEmail}
              onChange={(e) => setRegEmail(e.target.value)}
            />
            <div style={{ marginTop: "12px" }}>
              <button
                className={styles.confirmButton}
                onClick={handleRegisterAndLink}
              >
                Create Account
              </button>
              <button
                className={styles.cancelButton}
                onClick={() => setShowRegistrationModal(false)}
              >
                Skip
              </button>
            </div>
          </div>
        </div>
      )}

      {showBookingModal && (
        <div className={styles.modalOverlay}>
          <div className={styles.modalContent}>
            <h3>Confirm Your Booking</h3>
            <p>
              <strong>Service:</strong> {chosenService?.name}
            </p>
            <p>
              <strong>Barber:</strong> {chosenBarber?.name}
            </p>
            <p>
              <strong>Date:</strong> {selectedDate}
            </p>
            <p>
              <strong>Time:</strong> {selectedSlot}
            </p>
            <div className={styles.modalActions}>
              <button
                className={styles.confirmButton}
                onClick={async () => {
                  setIsBooking(true);
                  // build payload
                  const payload = {
                    salonId: id,
                    service: chosenService
                      ? chosenService.name
                      : selectedServices,
                    barber: chosenBarber
                      ? chosenBarber._id ||
                        chosenBarber._id ||
                        chosenBarber.name
                      : selectedBarber,
                    date: selectedDate,
                    time: selectedSlot,
                    user: userOnboarding || null,
                  };
                  try {
                    const res = await fetch("/api/bookings", {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify(payload),
                    });
                    if (!res.ok) {
                      setIsBooking(false);
                      const err = await res
                        .json()
                        .catch(() => ({ message: "Unknown error" }));
                      alert(
                        "Booking failed: " + (err.message || res.statusText)
                      );
                      return;
                    }
                    const data = await res.json();
                    alert(
                      "Booking confirmed! Booking ID: " +
                        (data.bookingId || data.id || "N/A")
                    );
                    if (!userOnboarding) {
                      setRegName(payload.user?.name || "");
                      setRegMobile(payload.user?.mobile || "");
                      setShowRegistrationModal(true);
                    }
                    setShowBookingModal(false);
                    setIsBooking(false);
                    // lock selected slot locally
                    setTimeSlots((prev) =>
                      prev.map((s) =>
                        s.time === selectedSlot ? { ...s, available: false } : s
                      )
                    );
                    // optionally navigate to confirmation page
                    router.push(
                      "user/bookings/confirmed?id=" +
                        (data.bookingId || data.id)
                    );
                  } catch (e) {
                    console.error(e);
                    alert("Booking failed: " + e.message);
                  }
                }}
              >
                Confirm
              </button>
              <button
                className={styles.cancelButton}
                onClick={() => setShowBookingModal(false)}
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
export async function getServerSideProps(context) {
  const { id } = context.params;

  try {
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || "http://localhost:3000";
    const response = await fetch(`${baseUrl}/api/salons/${id}`);
    const data = await response.json();

    if (!response.ok) {
      return { notFound: true };
    }

    return {
      props: {
        initialSalon: data.salon,
      },
    };
  } catch (error) {
    console.error("SSR fetch error:", error);
    return { notFound: true };
  }
}
</file>

<file path="src/pages/salons/dashboard.js">
import React, { useEffect, useState, useCallback } from "react";
import { useRouter } from "next/router";
import Layout from "../../components/Layout/Layout";
import OwnerSidebar from "../../components/OwnerSidebar";

export default function DashboardPage() {
  const router = useRouter();
  const [loading, setLoading] = useState(true);
  const [salon, setSalon] = useState(null);
  const [bookings, setBookings] = useState([]);
  const [error, setError] = useState(null);
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [dateFilter, setDateFilter] = useState("today"); // New state for date filtering

  const loadBookings = useCallback(async (salonId, filter = "today") => {
    try {
      setLoading(true);
      const now = new Date();
      const istOffset = 5.5 * 60 * 60 * 1000;
      const istDate = new Date(now.getTime() + istOffset);

      let dateParam = "";

      switch (filter) {
        case "yesterday":
          const yesterday = new Date(istDate);
          yesterday.setDate(yesterday.getDate() - 1);
          dateParam = `&date=${yesterday.toISOString().split("T")[0]}`;
          break;
        case "today":
          dateParam = `&date=${istDate.toISOString().split("T")[0]}`;
          break;
        case "tomorrow":
          const tomorrow = new Date(istDate);
          tomorrow.setDate(tomorrow.getDate() + 1);
          dateParam = `&date=${tomorrow.toISOString().split("T")[0]}`;
          break;
        case "fromTomorrow":
          const fromTomorrow = new Date(istDate);
          fromTomorrow.setDate(fromTomorrow.getDate() + 1);
          dateParam = `&from=${fromTomorrow.toISOString().split("T")[0]}`;
          break;
        case "all":
          dateParam = "";
          break;
        default:
          dateParam = `&date=${istDate.toISOString().split("T")[0]}`;
      }

      const response = await fetch(
        `/api/salons/bookings?salonId=${salonId}${dateParam}`,
        { cache: "no-store", headers: { "Content-Type": "application/json" } }
      );

      if (!response.ok) throw new Error("Failed to fetch bookings");

      const data = await response.json();
      setBookings(Array.isArray(data) ? data : []);
    } catch (err) {
      setError("Error loading bookings: " + err.message);
      setBookings([]);
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    if (!router.isReady) return;
    const salonSession = localStorage.getItem("salonSession");
    if (!salonSession) {
      router.push("/auth/salon/login");
      return;
    }
    const salonData = JSON.parse(salonSession);
    setSalon(salonData);
    loadBookings(salonData._id, dateFilter);
  }, [router, router.isReady, loadBookings, dateFilter]);

  // Handle date filter change
  const handleDateFilterChange = (newFilter) => {
    setDateFilter(newFilter);
    if (salon) {
      loadBookings(salon._id, newFilter);
    }
  };

  // Get display text for current filter
  const getFilterDisplayText = () => {
    switch (dateFilter) {
      case "yesterday":
        return "Yesterday's Bookings";
      case "today":
        return "Today's Bookings";
      case "tomorrow":
        return "Tomorrow's Bookings";
      case "fromTomorrow":
        return "Upcoming Bookings (From Tomorrow)";
      case "all":
        return "All Bookings";
      default:
        return "Today's Bookings";
    }
  };

  // Get current date display
  const getCurrentDateDisplay = () => {
    const now = new Date();
    const istOffset = 5.5 * 60 * 60 * 1000;
    const istDate = new Date(now.getTime() + istOffset);

    switch (dateFilter) {
      case "yesterday":
        const yesterday = new Date(istDate);
        yesterday.setDate(yesterday.getDate() - 1);
        return yesterday.toLocaleDateString("en-IN", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      case "today":
        return istDate.toLocaleDateString("en-IN", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      case "tomorrow":
        const tomorrow = new Date(istDate);
        tomorrow.setDate(tomorrow.getDate() + 1);
        return tomorrow.toLocaleDateString("en-IN", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      case "fromTomorrow":
        return "From Tomorrow Onwards";
      case "all":
        return "All Time";
      default:
        return istDate.toLocaleDateString("en-IN", {
          weekday: "long",
          year: "numeric",
          month: "long",
          day: "numeric",
        });
    }
  };

  const updateBookingStatus = async (bookingId, status) => {
    try {
      const response = await fetch("/api/bookings/update-status", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ bookingId, status }),
      });

      if (response.ok) {
        setBookings((prev) =>
          prev.map((b) =>
            (b._id || b.id) === bookingId
              ? { ...b, status, updatedAt: new Date() }
              : b
          )
        );
      } else {
        alert("Failed to update booking");
      }
    } catch {
      alert("Error updating booking");
    }
  };

  const getCurrentDate = () =>
    new Date().toLocaleDateString("en-IN", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric",
    });

  if (loading)
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="spinner"></div>
        <p className="ml-2">Loading dashboard...</p>
      </div>
    );

  return (
    <Layout>
      <div className="flex min-h-screen bg-background-primary">
        {/* Sidebar Desktop */}
        <aside className="hidden md:block w-64 border-r">
          <OwnerSidebar />
        </aside>

        {/* Sidebar Mobile (slide-in) */}
        {sidebarOpen && (
          <div className="fixed inset-0 z-40 flex md:hidden">
            {/* Overlay */}
            <div
              className="fixed inset-0 bg-black bg-opacity-40"
              onClick={() => setSidebarOpen(false)}
            ></div>
            {/* Drawer */}
            <div className="relative flex-1 flex flex-col max-w-xs w-full bg-white shadow-xl animate-slideIn">
              <OwnerSidebar closeSidebar={() => setSidebarOpen(false)} />
            </div>
          </div>
        )}

        {/* Main Content */}
        <main className="flex-1 p-4 md:p-6">
          <div className="max-w-6xl mx-auto space-y-6 animate-slideIn">
            {/* Top Bar for mobile */}
            <div className="md:hidden flex items-center justify-between bg-white p-3 rounded-lg shadow-sm sticky top-0 z-30">
              <button
                onClick={() => setSidebarOpen(true)}
                className="p-2 rounded-md hover:bg-gray-100"
              >
                ☰
              </button>
              <h1 className="font-bold text-lg gold-gradient-text">
                {salon?.salonName || "Dashboard"}
              </h1>
            </div>

            {/* Salon Info */}
            <div className="card">
              <h1 className="text-2xl font-bold gold-gradient-text">
                {salon?.salonName}
              </h1>
              <p className="text-text-secondary">Owner: {salon?.ownerName}</p>
            </div>

            {/* Date Filter Controls */}
            <div className="card">
              <div className="flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between">
                <h2 className="text-lg font-semibold">Filter Bookings</h2>
                <div className="flex flex-wrap gap-2">
                  {[
                    { value: "yesterday", label: "Yesterday", emoji: "⏮️" },
                    { value: "today", label: "Today", emoji: "📅" },
                    { value: "tomorrow", label: "Tomorrow", emoji: "⏭️" },
                    {
                      value: "fromTomorrow",
                      label: "From Tomorrow",
                      emoji: "🔜",
                    },
                    { value: "all", label: "All Bookings", emoji: "📊" },
                  ].map((filter) => (
                    <button
                      key={filter.value}
                      onClick={() => handleDateFilterChange(filter.value)}
                      className={`px-4 py-2 rounded-lg text-sm font-medium transition-all duration-200 ${
                        dateFilter === filter.value
                          ? "bg-primary text-white shadow-lg transform scale-105"
                          : "bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-md"
                      }`}
                    >
                      {filter.emoji} {filter.label}
                    </button>
                  ))}
                </div>
              </div>
            </div>

            {/* Bookings */}
            <div className="card">
              <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6">
                <div>
                  <h2 className="text-xl font-semibold mb-1">
                    {getFilterDisplayText()} ({bookings.length})
                  </h2>
                  <span className="text-sm text-text-secondary">
                    {getCurrentDateDisplay()}
                  </span>
                </div>
                <button
                  onClick={() => loadBookings(salon._id, dateFilter)}
                  className="mt-2 sm:mt-0 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200 transition-colors"
                  disabled={loading}
                >
                  🔄 {loading ? "Refreshing..." : "Refresh"}
                </button>
              </div>

              {error && (
                <div className="bg-error/10 border border-error text-error px-4 py-3 rounded mb-4">
                  {error}
                </div>
              )}

              {bookings.length === 0 ? (
                <div className="text-center py-8">
                  <div className="text-6xl mb-4">📅</div>
                  <p className="text-text-secondary text-lg">
                    No bookings found for{" "}
                    {dateFilter === "today"
                      ? "today"
                      : dateFilter === "yesterday"
                      ? "yesterday"
                      : dateFilter === "tomorrow"
                      ? "tomorrow"
                      : dateFilter === "fromTomorrow"
                      ? "upcoming dates"
                      : "selected period"}
                  </p>
                  <button
                    onClick={() => handleDateFilterChange("all")}
                    className="mt-3 px-4 py-2 bg-primary text-white rounded-lg text-sm hover:bg-primary-dark transition-colors"
                  >
                    View All Bookings
                  </button>
                </div>
              ) : (
                <div className="grid gap-4">
                  {bookings.map((b) => (
                    <div
                      key={b._id || b.id}
                      className="flex flex-col md:flex-row justify-between md:items-center card p-4"
                    >
                      <div className="space-y-1">
                        <h3 className="font-semibold text-lg">
                          {b.customerName}
                        </h3>
                        <p className="text-text-secondary">
                          📞 {b.customerPhone}
                        </p>
                        <p className="text-text-secondary">✂️ {b.service}</p>
                        {b.barber && (
                          <p className="text-text-secondary">👤 {b.barber}</p>
                        )}
                        <p className="text-text-secondary">
                          📅 {b.date} at {b.time}
                        </p>
                        <p className="text-text-secondary">💰 ₹{b.price}</p>
                      </div>

                      {/* Actions */}
                      <div className="mt-3 md:mt-0 flex flex-col space-y-2">
                        <span
                          className={`px-3 py-1 rounded-full text-sm font-medium self-start md:self-end ${getStatusColor(
                            b.status
                          )}`}
                        >
                          {b.status}
                        </span>

                        <div className="flex flex-wrap gap-2">
                          {b.status === "confirmed" && (
                            <button
                              onClick={() =>
                                updateBookingStatus(b._id, "started")
                              }
                              className="btn btn-primary text-sm"
                            >
                              Start Service
                            </button>
                          )}
                          {b.status === "started" && (
                            <button
                              onClick={() =>
                                updateBookingStatus(b._id, "completed")
                              }
                              className="btn btn-primary text-sm"
                            >
                              Mark Done
                            </button>
                          )}
                          {b.status !== "cancelled" &&
                            b.status !== "completed" && (
                              <button
                                onClick={() =>
                                  updateBookingStatus(b._id, "cancelled")
                                }
                                className="btn btn-secondary text-sm"
                              >
                                Cancel
                              </button>
                            )}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </main>
      </div>
    </Layout>
  );
}

function getStatusColor(status) {
  switch (status) {
    case "confirmed":
      return "bg-blue-100 text-blue-800";
    case "started":
      return "bg-yellow-100 text-yellow-800";
    case "completed":
      return "bg-success/20 text-success";
    case "cancelled":
      return "bg-error/20 text-error";
    default:
      return "bg-gray-100 text-gray-800";
  }
}
</file>

</files>
