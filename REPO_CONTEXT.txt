This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.mjs
jsconfig.json
next.config.js
next.config.mjs
package.json
postcss.config.mjs
public/file.svg
public/globe.svg
public/next.svg
public/vercel.svg
public/window.svg
README.md
src/components/Layout.js
src/components/Maps/LocationMap.js
src/components/Maps/LocationPicker.js
src/components/Maps/SalonMap.js
src/components/OwnerSidebar.js
src/components/Salon/SalonDashboard.js
src/components/Salon/SalonRegisterForm.js
src/components/Salon/SalonRegisterForm.js.bakdup
src/components/SalonCard.js
src/data/dummyData.js
src/lib/auth.js
src/lib/constants.js
src/lib/maps.js
src/lib/middleware/requireRole.js
src/lib/mongodb.js
src/lib/utils.js
src/lib/validators.js
src/models/Barber.js
src/models/Booking.js
src/models/Feedback.js
src/models/Salon.js
src/models/Service.js
src/models/Staff.js
src/models/User.js
src/pages/_app.js
src/pages/api/auth/login.js
src/pages/api/auth/register.js
src/pages/api/auth/salon-login.js
src/pages/api/auth/salon-register.js
src/pages/api/auth/salon-register.js.bakdup
src/pages/api/auth/salon/login.js
src/pages/api/auth/salon/register.js
src/pages/api/auth/send-otp.js
src/pages/api/auth/user-register.js
src/pages/api/auth/user/login.js
src/pages/api/auth/user/register.js
src/pages/api/auth/verify-otp.js
src/pages/api/bookings.js
src/pages/api/bookings/[id].js
src/pages/api/bookings/create.js
src/pages/api/bookings/update-status.js
src/pages/api/bookings/update.js
src/pages/api/maps/geocode.js
src/pages/api/maps/reverse.js
src/pages/api/salon/notifications.js
src/pages/api/salons/[id].js
src/pages/api/salons/barbers/[id].js
src/pages/api/salons/barbers/available.js
src/pages/api/salons/barbers/index.js
src/pages/api/salons/bookings.js
src/pages/api/salons/bookings/[id].js
src/pages/api/salons/bookings/today.js
src/pages/api/salons/bookings/update-status.js
src/pages/api/salons/index.js
src/pages/api/salons/nearby.js
src/pages/api/salons/profile.js
src/pages/api/salons/services/[id].js
src/pages/api/salons/services/index.js
src/pages/api/salons/staff/[id].js
src/pages/api/salons/staff/index.js
src/pages/api/users/register.js
src/pages/auth/salon/login.js
src/pages/auth/salon/register.js
src/pages/auth/user-register.js
src/pages/booking/confirmed.js
src/pages/feedback.js
src/pages/index.js
src/pages/onboarding.js
src/pages/salon-details/[id].js
src/pages/salons/[id].js
src/pages/salons/barbers/index.js
src/pages/salons/book.js
src/pages/salons/bookings/[id].js
src/pages/salons/bookings/index.js
src/pages/salons/dashboard.js
src/pages/salons/profile.js
src/pages/salons/register.js
src/pages/salons/services/[id].js
src/pages/salons/services/index.js
src/pages/salons/staff/[id].js
src/pages/salons/staff/index.js
src/pages/styles/globals.css
src/pages/styles/Home.module.css
src/pages/styles/Onboarding.module.css
src/pages/styles/Owner.module.css
src/styles/Auth.module.css
src/styles/Booking.module.css
src/styles/globals.css
src/styles/Home.module.css
src/styles/Onboarding.module.css
src/styles/Owner.module.css
src/styles/SalonDetail.module.css
src/styles/SalonDetails.module.css
src/styles/SalonMap.module.css
test.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="eslint.config.mjs">
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals"),
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "build/**",
      "next-env.d.ts",
    ],
  },
];

export default eslintConfig;
</file>

<file path="jsconfig.json">
{
  "compilerOptions": {
    "paths": {
      "@/*": ["./src/*"]
    }
  }
}
</file>

<file path="next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  experimental: {
    swcTraceProfiling: false, // üö´ disables trace file
  },
  images: {
    domains: [
      "localhost",
      "your-domain.com",
      "tile.openstreetmap.org",
      "images.unsplash.com",
    ],
    unoptimized: true,
  },
  env: {
    MONGODB_URI: process.env.MONGODB_URI,
    JWT_SECRET: process.env.JWT_SECRET,
  },
  webpack: (config) => {
    // Handle Leaflet in SSR
    config.resolve.fallback = {
      ...config.resolve.fallback,
      fs: false,
      net: false,
      tls: false,
    };
    return config;
  },
};

export default nextConfig;
</file>

<file path="next.config.mjs">
/** @type {import('next').NextConfig} */
const nextConfig = {};

export default nextConfig;
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: ["@tailwindcss/postcss"],
};

export default config;
</file>

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://github.com/vercel/next.js/tree/canary/packages/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.js`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="src/components/Layout.js">
import Link from "next/link";

export default function Layout({ children }) {
  return (
    <div className={"layout"}>
      <header className={"header"}>
        <div className={"logo"}>
          <h2>üíà SalonBook</h2>
        </div>
        <nav>
          <Link href="/">Home</Link>
          <Link href="/bookings">My Bookings</Link>
          <Link href="/profile">Profile</Link>
        </nav>
      </header>
      <main className={"main"}>{children}</main>
      <footer className={"footer"}>
        <p>&copy; 2024 SalonBook. All rights reserved.</p>
      </footer>
    </div>
  );
}
</file>

<file path="src/components/Salon/SalonDashboard.js">
// components/salons/SalonDashboard.js
import React, { useEffect, useState } from "react";
import BookingList from "./dashboard/BookingList";
import BookingForm from "./dashboard/BookingForm";
import StaffList from "./dashboard/StaffList";
import ServiceList from "./dashboard/ServiceList";

/**
 * NOTE: Replace this salonId with actual salonId from your auth/session.
 * For testing, you can hardcode a salonId string (ObjectId) from your DB.
 */
const DEFAULT_SALON_ID = process.env.NEXT_PUBLIC_SALON_ID || "";

export default function SalonDashboard() {
  const [salonId] = useState(DEFAULT_SALON_ID);

  if (!salonId) {
    return (
      <div className="p-8">
        <h2 className="text-xl font-semibold">Salon Dashboard</h2>
        <p className="mt-4 text-red-600">
          No salonId configured. Set NEXT_PUBLIC_SALON_ID or connect to auth
          session.
        </p>
      </div>
    );
  }

  return (
    <main className="p-6 space-y-6">
      <header className="flex items-center justify-between">
        <h1 className="text-2xl font-bold">Salon Owner Dashboard</h1>
        <div>
          Salon ID: <code className="bg-gray-100 p-1 rounded">{salonId}</code>
        </div>
      </header>

      <section className="grid md:grid-cols-3 gap-4">
        <div className="md:col-span-2 bg-white p-4 rounded shadow">
          <h2 className="font-semibold mb-2">Today&#39;s Bookings</h2>
          <BookingList salonId={salonId} />
        </div>

        <div className="bg-white p-4 rounded shadow">
          <h2 className="font-semibold mb-2">Create Booking</h2>
          <BookingForm salonId={salonId} />
        </div>
      </section>

      <section className="grid md:grid-cols-2 gap-4">
        <div className="bg-white p-4 rounded shadow">
          <h2 className="font-semibold mb-2">Staff</h2>
          <StaffList salonId={salonId} />
        </div>

        <div className="bg-white p-4 rounded shadow">
          <h2 className="font-semibold mb-2">Services</h2>
          <ServiceList salonId={salonId} />
        </div>
      </section>
    </main>
  );
}
</file>

<file path="src/components/Salon/SalonRegisterForm.js.bakdup">
import React, { useState, useEffect } from "react";
import {
  MapPin,
  Clock,
  User,
  Mail,
  Phone,
  Lock,
  Store,
  Scissors,
  Star,
} from "lucide-react";
import dynamic from "next/dynamic";
import Link from "next/link";

// Dynamically import LocationPicker to avoid SSR issues with Leaflet
const LocationPicker = dynamic(() => import("../Maps/LocationPicker"), {
  ssr: false,
  loading: () => (
    <div className="animate-pulse bg-gray-300 h-64 rounded-xl"></div>
  ),
});

const SalonRegisterForm = () => {
  const [formData, setFormData] = useState({
    // Owner Details
    fullName: "",
    mobileNumber: "",
    email: "",
    password: "",

    // Salon Details
    salonName: "",
    address: "",
    locationData: null, // Will store coordinates and formatted address
    openingTime: "09:00",
    closingTime: "21:00",

    // Basic Services & Pricing
    services: {
      haircut: { enabled: false, price: "" },
      shave: { enabled: false, price: "" },
      hairWash: { enabled: false, price: "" },
      hairStyling: { enabled: false, price: "" },
      facial: { enabled: false, price: "" },
      hairColor: { enabled: false, price: "" },
    },
  });

  const [currentStep, setCurrentStep] = useState(1);
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [showLocationPicker, setShowLocationPicker] = useState(false);
  const [isClient, setIsClient] = useState(false);

  useEffect(() => {
    setIsClient(true);
  }, []);

  const handleInputChange = (field, value) => {
    setFormData((prev) => ({
      ...prev,
      [field]: value,
    }));
  };

  const handleServiceChange = (service, field, value) => {
    setFormData((prev) => ({
      ...prev,
      services: {
        ...prev.services,
        [service]: {
          ...prev.services[service],
          [field]: value,
        },
      },
    }));
  };

  const handleLocationSelect = (locationData) => {
    setFormData((prev) => ({
      ...prev,
      locationData: locationData,
      address: locationData.address,
    }));
    setShowLocationPicker(false);
  };

  const handleSubmit = async () => {
    // Validate required fields
    if (
      !formData.fullName ||
      !formData.mobileNumber ||
      !formData.email ||
      !formData.password
    ) {
      alert("Please fill in all owner details");
      return;
    }

    if (!formData.salonName || !formData.locationData) {
      alert("Please fill in salon details and select location");
      return;
    }

    // Check if at least one service is enabled
    const enabledServices = Object.values(formData.services).some(
      (service) => service.enabled
    );
    if (!enabledServices) {
      alert("Please enable at least one service");
      return;
    }

    try {
      const registrationData = {
        ...formData,
        coordinates: formData.locationData?.coordinates || [0, 0],
      };

      console.log("Salon Registration Data:", registrationData);

      // Here you would send data to your backend API
      const response = await fetch("/api/api/auth/salons/register", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(registrationData),
      });

      if (response.ok) {
        await response.json();
        alert("Salon registered successfully! Welcome to the platform.");
        // Redirect to dashboard or login
        window.location.href = "/salons/dashboard";
      } else {
        const error = await response.json();
        alert(`Registration failed: ${error.message}`);
      }
    } catch (error) {
      console.error("Registration error:", error);
      alert("Registration failed. Please try again.");
    }
  };

  const services = [
    { key: "haircut", label: "Haircut", icon: Scissors, defaultPrice: "200" },
    { key: "shave", label: "Shave", icon: Scissors, defaultPrice: "100" },
    {
      key: "hairWash",
      label: "Hair Wash",
      icon: Scissors,
      defaultPrice: "150",
    },
    {
      key: "hairStyling",
      label: "Hair Styling",
      icon: Scissors,
      defaultPrice: "300",
    },
    { key: "facial", label: "Facial", icon: Star, defaultPrice: "500" },
    {
      key: "hairColor",
      label: "Hair Color",
      icon: Scissors,
      defaultPrice: "800",
    },
  ];

  // Don't render until client-side to avoid hydration issues
  if (!isClient) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-amber-50 via-white to-yellow-100 flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500"></div>
      </div>
    );
  }

  return (
    <>
      <div
        className={`min-h-screen transition-all duration-500 ${
          isDarkMode
            ? "bg-gradient-to-br from-gray-900 via-gray-800 to-black"
            : "bg-gradient-to-br from-amber-50 via-white to-yellow-100"
        }`}
      >
        {/* Dark Mode Toggle */}
        <div className="absolute top-4 right-4 z-50">
          <button
            onClick={() => setIsDarkMode(!isDarkMode)}
            className={`p-3 rounded-full transition-all duration-300 ${
              isDarkMode
                ? "bg-yellow-500 text-gray-900 hover:bg-yellow-400"
                : "bg-gray-800 text-white hover:bg-gray-700"
            }`}
          >
            {isDarkMode ? "‚òÄÔ∏è" : "üåô"}
          </button>
        </div>

        <div className="container mx-auto px-4 py-8">
          <div className="max-w-4xl mx-auto">
            {/* Header */}
            <div className="text-center mb-8 animate-fadeIn">
              <div
                className={`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${
                  isDarkMode
                    ? "bg-gradient-to-r from-yellow-500 to-amber-500"
                    : "bg-gradient-to-r from-amber-500 to-yellow-600"
                }`}
              >
                <Store className="w-8 h-8 text-white" />
              </div>
              <h1
                className={`text-4xl font-bold mb-2 ${
                  isDarkMode
                    ? "text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-amber-300"
                    : "text-transparent bg-clip-text bg-gradient-to-r from-amber-600 to-yellow-700"
                }`}
              >
                Register Your Salon
              </h1>
              <p
                className={`text-lg ${
                  isDarkMode ? "text-gray-300" : "text-gray-600"
                }`}
              >
                Join our platform and start getting more customers
              </p>
            </div>

            {/* Progress Steps */}
            <div className="flex items-center justify-center mb-8">
              {[1, 2, 3].map((step) => (
                <React.Fragment key={step}>
                  <div
                    className={`flex items-center justify-center w-10 h-10 rounded-full transition-all duration-300 ${
                      currentStep >= step
                        ? isDarkMode
                          ? "bg-yellow-500 text-gray-900"
                          : "bg-amber-500 text-white"
                        : isDarkMode
                        ? "bg-gray-700 text-gray-400"
                        : "bg-gray-200 text-gray-500"
                    }`}
                  >
                    {step}
                  </div>
                  {step < 3 && (
                    <div
                      className={`w-12 h-1 mx-2 transition-all duration-300 ${
                        currentStep > step
                          ? isDarkMode
                            ? "bg-yellow-500"
                            : "bg-amber-500"
                          : isDarkMode
                          ? "bg-gray-700"
                          : "bg-gray-200"
                      }`}
                    />
                  )}
                </React.Fragment>
              ))}
            </div>

            {/* Registration Form */}
            <div
              className={`rounded-3xl shadow-2xl p-8 backdrop-blur-sm transition-all duration-500 ${
                isDarkMode
                  ? "bg-gray-800/80 border border-gray-700"
                  : "bg-white/90 border border-amber-200"
              }`}
            >
              <div className="space-y-8">
                {/* Step 1: Owner Details */}
                {currentStep === 1 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <User className="w-6 h-6 mr-3" />
                      Owner Details
                    </h2>
                    <div className="grid md:grid-cols-2 gap-6">
                      <div className="space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Full Name
                        </label>
                        <input
                          type="text"
                          placeholder="Your full name"
                          value={formData.fullName}
                          onChange={(e) =>
                            handleInputChange("fullName", e.target.value)
                          }
                          className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          }`}
                        />
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Mobile Number
                        </label>
                        <div className="relative">
                          <Phone
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="tel"
                            placeholder="+91 9876543210"
                            value={formData.mobileNumber}
                            onChange={(e) =>
                              handleInputChange("mobileNumber", e.target.value)
                            }
                            className={`w-full pl-11 pr-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Email
                        </label>
                        <div className="relative">
                          <Mail
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="email"
                            placeholder="your.email@example.com"
                            value={formData.email}
                            onChange={(e) =>
                              handleInputChange("email", e.target.value)
                            }
                            className={`w-full pl-11 pr-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Password
                        </label>
                        <div className="relative">
                          <Lock
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="password"
                            placeholder="Create a strong password"
                            value={formData.password}
                            onChange={(e) =>
                              handleInputChange("password", e.target.value)
                            }
                            className={`w-full pl-11 pr-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {/* Step 2: Salon Details */}
                {currentStep === 2 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <Store className="w-6 h-6 mr-3" />
                      Salon Details
                    </h2>

                    <div className="grid md:grid-cols-2 gap-6">
                      <div className="space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Salon Name
                        </label>
                        <input
                          type="text"
                          placeholder="Your salon name"
                          value={formData.salonName}
                          onChange={(e) =>
                            handleInputChange("salonName", e.target.value)
                          }
                          className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          }`}
                        />
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Location Pin
                        </label>
                        <div className="relative">
                          <MapPin
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <button
                            type="button"
                            className={`w-full pl-11 pr-4 py-3 rounded-xl border transition-all duration-300 text-left ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600"
                                : "bg-white border-gray-300 text-gray-600 hover:bg-gray-50"
                            }`}
                            onClick={() => setShowLocationPicker(true)}
                          >
                            {formData.locationData
                              ? formData.locationData.address
                              : "Set exact location on map"}
                          </button>
                          {showLocationPicker && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
                              <div className="bg-white rounded-xl p-6 shadow-xl relative w-full max-w-2xl">
                                <button
                                  className="absolute top-2 right-2 text-gray-500 hover:text-gray-700"
                                  onClick={() => setShowLocationPicker(false)}
                                >
                                  ‚úï
                                </button>
                                <LocationPicker
                                  onSelect={handleLocationSelect}
                                />
                              </div>
                            </div>
                          )}
                        </div>
                      </div>

                      <div className="md:col-span-2 space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Address
                        </label>
                        <textarea
                          placeholder="Complete address with landmarks"
                          value={formData.address}
                          onChange={(e) =>
                            handleInputChange("address", e.target.value)
                          }
                          rows={3}
                          className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 resize-none ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          }`}
                        />
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Opening Time
                        </label>
                        <div className="relative">
                          <Clock
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="time"
                            value={formData.openingTime}
                            onChange={(e) =>
                              handleInputChange("openingTime", e.target.value)
                            }
                            className={`w-full pl-11 pr-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`text-sm font-medium ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Closing Time
                        </label>
                        <div className="relative">
                          <Clock
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="time"
                            value={formData.closingTime}
                            onChange={(e) =>
                              handleInputChange("closingTime", e.target.value)
                            }
                            className={`w-full pl-11 pr-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                )}
                {currentStep === 3 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <Scissors className="w-6 h-6 mr-3" />
                      Basic Services & Pricing
                    </h2>

                    <div className="grid md:grid-cols-2 gap-4">
                      {services.map((service) => {
                        const Icon = service.icon;
                        return (
                          <div
                            key={service.key}
                            className={`p-4 rounded-xl border-2 transition-all duration-300 ${
                              formData.services[service.key].enabled
                                ? isDarkMode
                                  ? "border-yellow-500 bg-yellow-500/10"
                                  : "border-amber-500 bg-amber-50"
                                : isDarkMode
                                ? "border-gray-600 bg-gray-700/50 hover:border-gray-500"
                                : "border-gray-200 bg-gray-50 hover:border-gray-300"
                            }`}
                          >
                            <div className="flex items-center justify-between mb-3">
                              <div className="flex items-center">
                                <input
                                  type="checkbox"
                                  checked={
                                    formData.services[service.key].enabled
                                  }
                                  onChange={(e) =>
                                    handleServiceChange(
                                      service.key,
                                      "enabled",
                                      e.target.checked
                                    )
                                  }
                                  className={`w-5 h-5 rounded transition-all duration-300 ${
                                    isDarkMode
                                      ? "text-yellow-500 focus:ring-yellow-500 bg-gray-700 border-gray-600"
                                      : "text-amber-500 focus:ring-amber-500"
                                  }`}
                                />
                                <Icon
                                  className={`w-5 h-5 ml-3 ${
                                    formData.services[service.key].enabled
                                      ? isDarkMode
                                        ? "text-yellow-400"
                                        : "text-amber-600"
                                      : isDarkMode
                                      ? "text-gray-400"
                                      : "text-gray-500"
                                  }`}
                                />
                                <span
                                  className={`ml-2 font-medium ${
                                    formData.services[service.key].enabled
                                      ? isDarkMode
                                        ? "text-white"
                                        : "text-gray-900"
                                      : isDarkMode
                                      ? "text-gray-400"
                                      : "text-gray-600"
                                  }`}
                                >
                                  {service.label}
                                </span>
                              </div>
                            </div>

                            {formData.services[service.key].enabled && (
                              <div className="animate-slideIn">
                                <div className="flex items-center">
                                  <span
                                    className={`text-sm font-medium mr-2 ${
                                      isDarkMode
                                        ? "text-gray-300"
                                        : "text-gray-700"
                                    }`}
                                  >
                                    ‚Çπ
                                  </span>
                                  <input
                                    type="number"
                                    placeholder={service.defaultPrice}
                                    value={formData.services[service.key].price}
                                    onChange={(e) =>
                                      handleServiceChange(
                                        service.key,
                                        "price",
                                        e.target.value
                                      )
                                    }
                                    className={`flex-1 px-3 py-2 rounded-lg border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                                      isDarkMode
                                        ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                        : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                                    }`}
                                  />
                                </div>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {/* Navigation Buttons */}
                <div className="flex justify-between pt-8">
                  {currentStep > 1 && (
                    <button
                      type="button"
                      onClick={() => setCurrentStep(currentStep - 1)}
                      className={`px-6 py-3 rounded-xl font-medium transition-all duration-300 ${
                        isDarkMode
                          ? "bg-gray-700 text-gray-300 hover:bg-gray-600"
                          : "bg-gray-200 text-gray-700 hover:bg-gray-300"
                      }`}
                    >
                      Previous
                    </button>
                  )}

                  {currentStep < 3 ? (
                    <button
                      type="button"
                      onClick={() => setCurrentStep(currentStep + 1)}
                      className={`px-8 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 ml-auto ${
                        isDarkMode
                          ? "bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-400 hover:to-amber-400"
                          : "bg-gradient-to-r from-amber-500 to-yellow-600 text-white hover:from-amber-600 hover:to-yellow-700"
                      }`}
                    >
                      Next Step
                    </button>
                  ) : (
                    <button
                      type="button"
                      onClick={handleSubmit}
                      className={`px-8 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 ml-auto ${
                        isDarkMode
                          ? "bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-400 hover:to-amber-400"
                          : "bg-gradient-to-r from-amber-500 to-yellow-600 text-white hover:from-amber-600 hover:to-yellow-700"
                      }`}
                    >
                      Register My Salon
                    </button>
                  )}
                </div>
              </div>

              {/* Sign In Link */}
              <div className="text-center mt-8 pt-6 border-t border-opacity-20">
                <p
                  className={`${
                    isDarkMode ? "text-gray-400" : "text-gray-600"
                  }`}
                >
                  <Link
                    href="/salons/login"
                    className={`font-medium transition-colors duration-300 ${
                      isDarkMode
                        ? "text-yellow-400 hover:text-yellow-300"
                        : "text-amber-600 hover:text-amber-700"
                    }`}
                  >
                    Sign In
                  </Link>
                </p>
              </div>
            </div>
          </div>
        </div>
        <style jsx>{`
          @keyframes fadeIn {
            from {
              opacity: 0;
              transform: translateY(-20px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }

          @keyframes slideIn {
            from {
              opacity: 0;
              transform: translateX(-30px);
            }
            to {
              opacity: 1;
              transform: translateX(0);
            }
          }

          .animate-fadeIn {
            animation: fadeIn 0.8s ease-out;
          }

          .animate-slideIn {
            animation: slideIn 0.6s ease-out;
          }
        `}</style>
      </div>
    </>
  );
};

export default SalonRegisterForm;
</file>

<file path="src/components/SalonCard.js">
import { useRouter } from "next/router";
import styles from "../styles/SalonCard.module.css";
import Image from "next/image";

export default function SalonCard({ salon, gender }) {
  const router = useRouter();
  if (!salon) {
    return null; // or return a loading/error placeholder
  }

  const handleBookNow = () => {
    router.push(`/salons/${salon.id}`);
  };

  return (
    <div className={styles.card}>
      <div className={styles.imageContainer}>
        <Image
          src={salon.images?.front || "/salon-placeholder.jpg"}
          alt={salon.name}
        />
        <div className={styles.popularityBadge}>
          {salon.totalBookings > 100 && "üî• Most Booked"}
        </div>
      </div>

      <div className={styles.content}>
        <h3>{salon.name}</h3>

        <div className={styles.metrics}>
          <span>‚≠ê {salon.rating}/5</span>
          <span>üìç {salon.location?.distance || "1.2"} km</span>
          <span>üéØ {salon.customerServiceScore}% satisfaction</span>
        </div>

        <div className={styles.services}>
          <h4>Popular Services</h4>
          <div className={styles.serviceList}>
            {salon.topServices?.map((service, index) => (
              <div key={index} className={styles.serviceItem}>
                <span>{service.name}</span>
                <span className={styles.price}>‚Çπ{service.price}</span>
              </div>
            ))}
          </div>
        </div>

        <button onClick={handleBookNow} className={styles.bookBtn}>
          Book Now ‚Üí
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/data/dummyData.js">
// data/dummyData.js - Sample data for testing the salon booking platform

export const dummySalons = [
  {
    _id: "salon_001",
    ownerDetails: {
      name: "Rajesh Kumar",
      mobile: "+91 9876543210",
      email: "rajesh@luxurysalon.com",
      password: "$2a$12$hashedPasswordHere", // bcrypt hashed
    },
    salonDetails: {
      name: "Royal Hair Studio",
      address:
        "Shop No. 15, Linking Road, Bandra West, Mumbai, Maharashtra 400050",
      location: {
        type: "Point",
        coordinates: [72.8261, 19.0596], // [longitude, latitude] - Bandra West
      },
      openingHours: {
        open: "09:00",
        close: "21:00",
      },
      images: [
        "/images/salons/royal-hair-studio-1.jpg",
        "/images/salons/royal-hair-studio-2.jpg",
        "/images/salons/royal-hair-studio-3.jpg",
      ],
      description:
        "Premium hair salon offering luxury services with experienced stylists and modern equipment.",
    },
    services: [
      { name: "Haircut", price: 250, duration: 45, genderSpecific: "male" },
      {
        name: "Hair Styling",
        price: 400,
        duration: 60,
        genderSpecific: "male",
      },
      { name: "Beard Trim", price: 150, duration: 30, genderSpecific: "male" },
      {
        name: "Hair Color",
        price: 800,
        duration: 90,
        genderSpecific: "unisex",
      },
      { name: "Facial", price: 600, duration: 60, genderSpecific: "unisex" },
    ],
    barbers: [
      {
        name: "Amit Sharma",
        image: "/images/barbers/amit-sharma.jpg",
        specialization: ["Haircut", "Styling", "Beard"],
        rating: 4.8,
        totalBookings: 1250,
      },
      {
        name: "Vikram Singh",
        image: "/images/barbers/vikram-singh.jpg",
        specialization: ["Hair Color", "Facial", "Styling"],
        rating: 4.6,
        totalBookings: 890,
      },
    ],
    ratings: {
      overall: 4.7,
      totalReviews: 234,
      serviceQuality: 4.8,
      timing: 4.6,
      cleanliness: 4.9,
      ambience: 4.5,
    },
    stats: {
      totalBookings: 2140,
      repeatCustomers: 156,
      averageWaitTime: 12,
    },
    isActive: true,
    createdAt: new Date("2024-01-15"),
    updatedAt: new Date("2024-09-20"),
  },
  {
    _id: "salon_002",
    ownerDetails: {
      name: "Priya Mehta",
      mobile: "+91 9765432108",
      email: "priya@glamourstudio.com",
      password: "$2a$12$anotherHashedPasswordHere",
    },
    salonDetails: {
      name: "Glamour Beauty Studio",
      address:
        "2nd Floor, Phoenix Mills, Lower Parel, Mumbai, Maharashtra 400013",
      location: {
        type: "Point",
        coordinates: [72.8347, 19.0144], // Lower Parel
      },
      openingHours: {
        open: "10:00",
        close: "22:00",
      },
      images: [
        "/images/salons/glamour-studio-1.jpg",
        "/images/salons/glamour-studio-2.jpg",
        "/images/salons/glamour-studio-3.jpg",
      ],
      description:
        "Unisex beauty studio specializing in hair, skin, and nail treatments for both men and women.",
    },
    services: [
      {
        name: "Ladies Haircut",
        price: 350,
        duration: 60,
        genderSpecific: "female",
      },
      {
        name: "Hair Styling",
        price: 500,
        duration: 75,
        genderSpecific: "female",
      },
      { name: "Facial", price: 800, duration: 90, genderSpecific: "female" },
      {
        name: "Hair Color",
        price: 1200,
        duration: 120,
        genderSpecific: "female",
      },
      {
        name: "Men's Haircut",
        price: 200,
        duration: 40,
        genderSpecific: "male",
      },
      {
        name: "Manicure & Pedicure",
        price: 600,
        duration: 60,
        genderSpecific: "unisex",
      },
    ],
    barbers: [
      {
        name: "Sneha Patel",
        image: "/images/barbers/sneha-patel.jpg",
        specialization: ["Ladies Cut", "Styling", "Color"],
        rating: 4.9,
        totalBookings: 1580,
      },
      {
        name: "Rohit Joshi",
        image: "/images/barbers/rohit-joshi.jpg",
        specialization: ["Men's Cut", "Styling", "Facial"],
        rating: 4.7,
        totalBookings: 1120,
      },
    ],
    ratings: {
      overall: 4.8,
      totalReviews: 189,
      serviceQuality: 4.9,
      timing: 4.7,
      cleanliness: 4.8,
      ambience: 4.8,
    },
    stats: {
      totalBookings: 2700,
      repeatCustomers: 203,
      averageWaitTime: 8,
    },
    isActive: true,
    createdAt: new Date("2024-02-01"),
    updatedAt: new Date("2024-09-21"),
  },
  {
    _id: "salon_003",
    ownerDetails: {
      name: "Arjun Reddy",
      mobile: "+91 9654321097",
      email: "arjun@moderncutsalon.com",
      password: "$2a$12$yetAnotherHashedPassword",
    },
    salonDetails: {
      name: "Modern Cut Salon",
      address:
        "Ground Floor, Palladium Mall, High Street Phoenix, Lower Parel, Mumbai 400013",
      location: {
        type: "Point",
        coordinates: [72.8331, 19.0095],
      },
      openingHours: {
        open: "11:00",
        close: "23:00",
      },
      images: [
        "/images/salons/modern-cut-1.jpg",
        "/images/salons/modern-cut-2.jpg",
      ],
      description:
        "Trendy salon focusing on modern cuts and contemporary styling for the urban crowd.",
    },
    services: [
      {
        name: "Trendy Haircut",
        price: 300,
        duration: 50,
        genderSpecific: "male",
      },
      { name: "Buzz Cut", price: 150, duration: 25, genderSpecific: "male" },
      { name: "Hair Wash", price: 100, duration: 20, genderSpecific: "male" },
      {
        name: "Beard Styling",
        price: 200,
        duration: 35,
        genderSpecific: "male",
      },
      {
        name: "Hair Gel Styling",
        price: 250,
        duration: 40,
        genderSpecific: "male",
      },
    ],
    barbers: [
      {
        name: "Kiran Kumar",
        image: "/images/barbers/kiran-kumar.jpg",
        specialization: ["Modern Cuts", "Styling", "Beard"],
        rating: 4.5,
        totalBookings: 950,
      },
    ],
    ratings: {
      overall: 4.5,
      totalReviews: 127,
      serviceQuality: 4.6,
      timing: 4.4,
      cleanliness: 4.7,
      ambience: 4.3,
    },
    stats: {
      totalBookings: 950,
      repeatCustomers: 89,
      averageWaitTime: 15,
    },
    isActive: true,
    createdAt: new Date("2024-03-10"),
    updatedAt: new Date("2024-09-19"),
  },
];

export const dummyUsers = [
  {
    _id: "user_001",
    name: "Rahul Sharma",
    mobile: "+91 9876543211",
    email: "rahul.sharma@email.com",
    gender: "male",
    location: {
      coordinates: [72.8777, 19.076], // Andheri
      address: "Andheri East, Mumbai, Maharashtra",
    },
    preferences: {
      favoriteServices: ["Haircut", "Beard Trim"],
      preferredPriceRange: { min: 100, max: 500 },
    },
    bookingHistory: ["booking_001", "booking_002"],
    createdAt: new Date("2024-06-15"),
    updatedAt: new Date("2024-09-20"),
  },
  {
    _id: "user_002",
    name: "Anita Desai",
    mobile: "+91 9765432109",
    email: "anita.desai@email.com",
    gender: "female",
    location: {
      coordinates: [72.8261, 19.0596], // Bandra
      address: "Bandra West, Mumbai, Maharashtra",
    },
    preferences: {
      favoriteServices: ["Ladies Haircut", "Facial", "Hair Color"],
      preferredPriceRange: { min: 300, max: 1500 },
    },
    bookingHistory: ["booking_003"],
    createdAt: new Date("2024-07-22"),
    updatedAt: new Date("2024-09-18"),
  },
];

export const dummyBookings = [
  {
    _id: "booking_001",
    userId: "user_001",
    salonId: "salon_001",
    barberName: "Amit Sharma",
    service: {
      name: "Haircut",
      price: 250,
      duration: 45,
    },
    scheduledTime: new Date("2024-09-25T14:30:00Z"),
    status: "confirmed",
    userDetails: {
      name: "Rahul Sharma",
      mobile: "+91 9876543211",
      gender: "male",
    },
    paymentStatus: "paid",
    feedback: {
      submitted: false,
      ratings: {},
      comment: "",
    },
    createdAt: new Date("2024-09-20T10:15:00Z"),
    updatedAt: new Date("2024-09-20T10:15:00Z"),
  },
  {
    _id: "booking_002",
    userId: "user_001",
    salonId: "salon_001",
    barberName: "Vikram Singh",
    service: {
      name: "Facial",
      price: 600,
      duration: 60,
    },
    scheduledTime: new Date("2024-08-15T16:00:00Z"),
    status: "completed",
    userDetails: {
      name: "Rahul Sharma",
      mobile: "+91 9876543211",
      gender: "male",
    },
    paymentStatus: "paid",
    feedback: {
      submitted: true,
      ratings: {
        serviceQuality: 5,
        timing: 4,
        barberPerformance: 5,
        salonAmbience: 4,
        overall: 5,
      },
      comment:
        "Excellent service! Very professional and relaxing facial. Will definitely come back.",
    },
    createdAt: new Date("2024-08-10T09:30:00Z"),
    updatedAt: new Date("2024-08-15T17:15:00Z"),
  },
  {
    _id: "booking_003",
    userId: "user_002",
    salonId: "salon_002",
    barberName: "Sneha Patel",
    service: {
      name: "Ladies Haircut",
      price: 350,
      duration: 60,
    },
    scheduledTime: new Date("2024-09-28T11:00:00Z"),
    status: "confirmed",
    userDetails: {
      name: "Anita Desai",
      mobile: "+91 9765432109",
      gender: "female",
    },
    paymentStatus: "pending",
    feedback: {
      submitted: false,
      ratings: {},
      comment: "",
    },
    createdAt: new Date("2024-09-21T14:22:00Z"),
    updatedAt: new Date("2024-09-21T14:22:00Z"),
  },
];

export const dummyFeedback = [
  {
    _id: "feedback_001",
    bookingId: "booking_002",
    userId: "user_001",
    salonId: "salon_001",
    ratings: {
      serviceQuality: 5,
      timing: 4,
      barberPerformance: 5,
      salonAmbience: 4,
      overall: 5,
    },
    comment:
      "Excellent service! Very professional and relaxing facial. Will definitely come back.",
    createdAt: new Date("2024-08-15T17:15:00Z"),
  },
];

// Popular services by gender
export const popularServices = {
  male: [
    { name: "Haircut", avgPrice: 200, popularity: 95 },
    { name: "Beard Trim", avgPrice: 125, popularity: 78 },
    { name: "Hair Styling", avgPrice: 350, popularity: 65 },
    { name: "Facial", avgPrice: 550, popularity: 45 },
  ],
  female: [
    { name: "Ladies Haircut", avgPrice: 350, popularity: 92 },
    { name: "Hair Color", avgPrice: 1000, popularity: 76 },
    { name: "Facial", avgPrice: 700, popularity: 84 },
    { name: "Hair Styling", avgPrice: 450, popularity: 88 },
  ],
  unisex: [
    { name: "Hair Wash", avgPrice: 120, popularity: 70 },
    { name: "Hair Treatment", avgPrice: 800, popularity: 55 },
    { name: "Scalp Massage", avgPrice: 300, popularity: 62 },
  ],
};

// Time slots for bookings (24-hour format)
export const availableTimeSlots = [
  "09:00",
  "09:30",
  "10:00",
  "10:30",
  "11:00",
  "11:30",
  "12:00",
  "12:30",
  "13:00",
  "13:30",
  "14:00",
  "14:30",
  "15:00",
  "15:30",
  "16:00",
  "16:30",
  "17:00",
  "17:30",
  "18:00",
  "18:30",
  "19:00",
  "19:30",
  "20:00",
  "20:30",
  "21:00",
  "21:30",
];

// Mumbai area coordinates for testing nearby functionality
export const mumbaiAreas = [
  { name: "Bandra West", coordinates: [72.8261, 19.0596] },
  { name: "Andheri East", coordinates: [72.8777, 19.076] },
  { name: "Lower Parel", coordinates: [72.8347, 19.0144] },
  { name: "Powai", coordinates: [72.905, 19.1176] },
  { name: "Juhu", coordinates: [72.8261, 19.1075] },
  { name: "Worli", coordinates: [72.817, 19.0176] },
  { name: "Colaba", coordinates: [72.8342, 18.9067] },
  { name: "Malad West", coordinates: [72.8405, 19.1864] },
];

// Admin user for testing
export const dummyAdmin = {
  _id: "admin_001",
  username: "admin",
  email: "admin@luxurysalon.com",
  password: "$2a$12$adminHashedPasswordHere", // bcrypt hashed "admin123"
  role: "super_admin",
  permissions: [
    "manage_salons",
    "manage_users",
    "view_analytics",
    "manage_bookings",
  ],
  createdAt: new Date("2024-01-01"),
  lastLogin: new Date("2024-09-21"),
};

// Sample analytics data for dashboard
export const analyticsData = {
  totalSalons: 156,
  totalUsers: 2847,
  totalBookings: 12459,
  monthlyBookings: [
    { month: "Jan", bookings: 890 },
    { month: "Feb", bookings: 1205 },
    { month: "Mar", bookings: 1156 },
    { month: "Apr", bookings: 1389 },
    { month: "May", bookings: 1547 },
    { month: "Jun", bookings: 1678 },
    { month: "Jul", bookings: 1456 },
    { month: "Aug", bookings: 1789 },
    { month: "Sep", bookings: 1349 },
  ],
  topServices: [
    { service: "Haircut", count: 4567, revenue: 913400 },
    { service: "Hair Styling", count: 2134, revenue: 853600 },
    { service: "Facial", count: 1876, revenue: 1313200 },
    { service: "Hair Color", count: 1234, revenue: 1234000 },
    { service: "Beard Trim", count: 2345, revenue: 293125 },
  ],
  revenueByMonth: [
    { month: "Jan", revenue: 234000 },
    { month: "Feb", revenue: 312000 },
    { month: "Mar", revenue: 289000 },
    { month: "Apr", revenue: 387000 },
    { month: "May", revenue: 445000 },
    { month: "Jun", revenue: 523000 },
    { month: "Jul", revenue: 467000 },
    { month: "Aug", revenue: 589000 },
    { month: "Sep", revenue: 445000 },
  ],
};

// Helper function to seed database (for testing)
export const seedDatabase = async () => {
  try {
    console.log("üå± Seeding database with dummy data...");

    // This would be used in your API routes to populate initial data
    const seedData = {
      salons: dummySalons,
      users: dummyUsers,
      bookings: dummyBookings,
      feedback: dummyFeedback,
      admin: dummyAdmin,
    };

    console.log("‚úÖ Database seeded successfully!");
    return seedData;
  } catch (error) {
    console.error("‚ùå Error seeding database:", error);
    throw error;
  }
};

// Utility function to generate random booking data
export const generateRandomBooking = (userId, salonId, barberName) => {
  const services = [
    "Haircut",
    "Facial",
    "Hair Styling",
    "Beard Trim",
    "Hair Color",
  ];
  const prices = [200, 500, 400, 150, 800];
  const durations = [45, 60, 75, 30, 90];

  const randomService = Math.floor(Math.random() * services.length);
  const futureDate = new Date();
  futureDate.setDate(futureDate.getDate() + Math.floor(Math.random() * 30) + 1);

  return {
    _id: `booking_${Date.now()}`,
    userId,
    salonId,
    barberName,
    service: {
      name: services[randomService],
      price: prices[randomService],
      duration: durations[randomService],
    },
    scheduledTime: futureDate,
    status: "confirmed",
    userDetails: {
      name: "New User",
      mobile: "+91 9999999999",
      gender: "male",
    },
    paymentStatus: "pending",
    feedback: {
      submitted: false,
      ratings: {},
      comment: "",
    },
    createdAt: new Date(),
    updatedAt: new Date(),
  };
};

// Export all data as default
const dummyData = {
  salons: dummySalons,
  users: dummyUsers,
  bookings: dummyBookings,
  feedback: dummyFeedback,
  admin: dummyAdmin,
  popularServices,
  availableTimeSlots,
  mumbaiAreas,
  analyticsData,
  seedDatabase,
  generateRandomBooking,
};

export default dummyData;
</file>

<file path="src/lib/auth.js">
import bcrypt from "bcryptjs";
import jwt from "jsonwebtoken";

export const hashPassword = async (password) => {
  const saltRounds = 12;
  return await bcrypt.hash(password, saltRounds);
};

export const verifyPassword = async (password, hashedPassword) => {
  return await bcrypt.compare(password, hashedPassword);
};

export const generateToken = (userId, role, email) => {
  return jwt.sign({ userId, role, email }, process.env.JWT_SECRET, {
    expiresIn: "7d",
  });
};

export const verifyToken = (token) => {
  try {
    return jwt.verify(token, process.env.JWT_SECRET);
  } catch (error) {
    return null;
  }
};

export const getLocationFromCoordinates = async (lat, lng) => {
  try {
    // Using reverse geocoding - you might want to use a proper service like Google Maps API
    const response = await fetch(
      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`
    );
    const data = await response.json();
    return {
      address: data.display_name,
      city: data.address?.city || data.address?.town || data.address?.village,
      state: data.address?.state,
      country: data.address?.country,
      postcode: data.address?.postcode,
    };
  } catch (error) {
    console.error("Error getting location:", error);
    return null;
  }
};
</file>

<file path="src/lib/constants.js">
export const USER_ROLES = {
  USER: "user",
  SALON_OWNER: "salon_owner",
  ADMIN: "admin",
  SUPER_ADMIN: "super_admin",
};

export const BOOKING_STATUS = {
  CONFIRMED: "confirmed",
  COMPLETED: "completed",
  CANCELLED: "cancelled",
  NO_SHOW: "no_show",
};

export const PAYMENT_STATUS = {
  PENDING: "pending",
  PAID: "paid",
  FAILED: "failed",
  REFUNDED: "refunded",
};

export const GENDER_OPTIONS = [
  { value: "male", label: "Male" },
  { value: "female", label: "Female" },
  { value: "other", label: "Other" },
];

export const SERVICE_CATEGORIES = {
  HAIR: "hair",
  BEARD: "beard",
  SKIN: "skin",
  NAIL: "nail",
  MASSAGE: "massage",
};

export const RATING_CATEGORIES = [
  { key: "serviceQuality", label: "Service Quality" },
  { key: "timing", label: "Timing/Punctuality" },
  { key: "barberPerformance", label: "Staff Performance" },
  { key: "salonAmbience", label: "Salon Ambience" },
  { key: "overall", label: "Overall Experience" },
];

export const TIME_SLOTS = [
  "09:00",
  "09:30",
  "10:00",
  "10:30",
  "11:00",
  "11:30",
  "12:00",
  "12:30",
  "13:00",
  "13:30",
  "14:00",
  "14:30",
  "15:00",
  "15:30",
  "16:00",
  "16:30",
  "17:00",
  "17:30",
  "18:00",
  "18:30",
  "19:00",
  "19:30",
  "20:00",
  "20:30",
];

export const SEARCH_RADIUS = 5000; // 5km in meters for nearby salon search

export const DEFAULT_SALON_IMAGE = "/images/salon-placeholder.jpg";
export const DEFAULT_BARBER_IMAGE = "/images/barber-placeholder.jpg";
</file>

<file path="src/lib/maps.js">
// src/lib/maps.js (only the reverseGeocode part shown)
export const geocodeAddress = async (address) => {
  try {
    const res = await fetch("/api/maps/geocode", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ address }),
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.error || "Geocoding failed");
    }

    const data = await res.json();
    return data; // { coordinates: [lng, lat], formattedAddress: string }
  } catch (error) {
    console.error("Geocoding error:", error);
    throw error;
  }
};

export const reverseGeocode = async (lat, lng) => {
  try {
    const res = await fetch("/api/maps/reverse", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ lat, lng }),
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.error || "Reverse geocoding failed");
    }

    const data = await res.json();
    return data.address; // string or null
  } catch (error) {
    console.error("Reverse geocoding error:", error);
    throw error;
  }
};
</file>

<file path="src/lib/middleware/requireRole.js">
// lib/middleware/requireRole.js
const jwt = require('jsonwebtoken');
function requireRole(handler, allowedRoles = []) {
  return async (req, res) => {
    try {
      const auth = req.headers.authorization || '';
      const token = auth.replace('Bearer ', '');
      if (!token) return res.status(401).json({ message: 'Token required' });
      const payload = jwt.verify(token, process.env.JWT_SECRET || 'dev_jwt_secret');
      if (!allowedRoles.includes(payload.role)) {
        return res.status(403).json({ message: 'Insufficient privileges' });
      }
      req.user = payload;
      return handler(req, res);
    } catch (err) {
      return res.status(401).json({ message: 'Invalid or missing token', error: String(err) });
    }
  };
}
module.exports = { requireRole };
</file>

<file path="src/lib/utils.js">
export const formatPrice = (price) => {
  return `‚Çπ${price.toLocaleString("en-IN")}`;
};

export const formatTime = (time) => {
  return new Date(`2000-01-01 ${time}`).toLocaleString("en-US", {
    hour: "numeric",
    minute: "2-digit",
    hour12: true,
  });
};

export const formatDate = (date) => {
  return new Date(date).toLocaleDateString("en-IN", {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  });
};

export const calculateDistance = (lat1, lon1, lat2, lon2) => {
  const R = 6371; // Radius of the Earth in kilometers
  const dLat = ((lat2 - lat1) * Math.PI) / 180;
  const dLon = ((lon2 - lon1) * Math.PI) / 180;
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos((lat1 * Math.PI) / 180) *
      Math.cos((lat2 * Math.PI) / 180) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  const distance = R * c; // Distance in kilometers
  return distance;
};

export const generateUniqueId = () => {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
};

export const debounce = (func, wait) => {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
};
</file>

<file path="src/lib/validators.js">
export const validateEmail = (email) => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(email);
};

export const validateMobile = (mobile) => {
  const mobileRegex = /^(\+91[\-\s]?)?[0]?(91)?[6789]\d{9}$/;
  return mobileRegex.test(mobile);
};

export const validatePassword = (password) => {
  return password && password.length >= 6;
};

export const validateSalonRegistration = (data) => {
  const errors = {};

  // Owner Details Validation
  if (!data.fullName || data.fullName.trim().length < 2) {
    errors.fullName = "Full name must be at least 2 characters";
  }

  if (!validateMobile(data.mobileNumber)) {
    errors.mobileNumber = "Invalid mobile number format";
  }

  if (!validateEmail(data.email)) {
    errors.email = "Invalid email format";
  }

  if (!validatePassword(data.password)) {
    errors.password = "Password must be at least 6 characters";
  }

  // Salon Details Validation
  if (!data.salonName || data.salonName.trim().length < 2) {
    errors.salonName = "Salon name must be at least 2 characters";
  }

  if (!data.address || data.address.trim().length < 10) {
    errors.address = "Address must be at least 10 characters";
  }

  // Services Validation
  const enabledServices = Object.entries(data.services || {})
    .filter(([_, service]) => service.enabled)
    .map(([key, service]) => ({ key, ...service }));

  if (enabledServices.length === 0) {
    errors.services = "At least one service must be enabled";
  }

  enabledServices.forEach((service) => {
    if (!service.price || service.price < 1) {
      errors[`service_${service.key}`] = "Service price must be greater than 0";
    }
  });

  return {
    isValid: Object.keys(errors).length === 0,
    errors,
  };
};

export const validateBooking = (data) => {
  const errors = {};

  if (!data.salonId) {
    errors.salonId = "Salon selection is required";
  }

  if (!data.barberName) {
    errors.barberName = "Barber selection is required";
  }

  if (!data.service) {
    errors.service = "Service selection is required";
  }
  if (!data.scheduledTime && !data.timeSlot) {
    errors.scheduledTime = "Time slot selection is required";
  } else if (!data.scheduledTime && data.timeSlot) {
    // normalize: if client sent timeSlot, map it to scheduledTime for downstream code
    data.scheduledTime = data.timeSlot;
  }

  if (!data.userDetails?.name) {
    errors.userName = "Name is required";
  }

  if (!validateMobile(data.userDetails?.mobile)) {
    errors.userMobile = "Valid mobile number is required";
  }

  return {
    isValid: Object.keys(errors).length === 0,
    errors,
  };
};
</file>

<file path="src/models/Feedback.js">
// models/Feedback.js
export class Feedback {
  constructor(data) {
    this.bookingId = data.bookingId;
    this.userId = data.userId;
    this.salonId = data.salonId;
    this.ratings = {
      serviceQuality: data.ratings.serviceQuality,
      timing: data.ratings.timing,
      barberPerformance: data.ratings.barberPerformance,
      salonAmbience: data.ratings.salonAmbience,
      overall: data.ratings.overall,
    };
    this.comment = data.comment || "";
    this.isPublic = data.isPublic !== undefined ? data.isPublic : true;
    this.createdAt = new Date();
  }

  static async create(feedbackData) {
    const { db } = await connectToDatabase();
    const feedback = new Feedback(feedbackData);
    const result = await db.collection("feedback").insertOne(feedback);
    return { ...feedback, _id: result.insertedId };
  }

  static async findBySalonId(salonId, options = {}) {
    const { db } = await connectToDatabase();
    const query = {
      salonId,
      isPublic: true,
    };

    let cursor = db.collection("feedback").find(query);

    if (options.sort) {
      cursor = cursor.sort(options.sort);
    } else {
      cursor = cursor.sort({ createdAt: -1 });
    }

    if (options.limit) {
      cursor = cursor.limit(options.limit);
    }

    return await cursor.toArray();
  }

  static async getSalonAverageRatings(salonId) {
    const { db } = await connectToDatabase();

    const pipeline = [
      {
        $match: {
          salonId,
          isPublic: true,
        },
      },
      {
        $group: {
          _id: null,
          avgServiceQuality: { $avg: "$ratings.serviceQuality" },
          avgTiming: { $avg: "$ratings.timing" },
          avgBarberPerformance: { $avg: "$ratings.barberPerformance" },
          avgSalonAmbience: { $avg: "$ratings.salonAmbience" },
          avgOverall: { $avg: "$ratings.overall" },
          totalReviews: { $sum: 1 },
        },
      },
    ];

    const result = await db
      .collection("feedback")
      .aggregate(pipeline)
      .toArray();
    return result[0] || null;
  }
}
</file>

<file path="src/models/Salon.js">
// models/Salon.js
export class Salon {
  constructor(data) {
    this.ownerDetails = {
      name: data.ownerDetails.name,
      mobile: data.ownerDetails.mobile,
      email: data.ownerDetails.email,
      password: data.ownerDetails.password, // Should be hashed
    };
    this.salonDetails = {
      name: data.salonDetails.name,
      address: data.salonDetails.address,
      location: data.salonDetails.location || {
        type: "Point",
        coordinates: [0, 0],
      },
      openingHours: data.salonDetails.openingHours || {
        open: "09:00",
        close: "21:00",
      },
      images: data.salonDetails.images || [],
      description: data.salonDetails.description || "",
    };
    this.services = data.services || [];
    this.barbers = data.barbers || [];
    this.ratings = data.ratings || {
      overall: 5.0,
      totalReviews: 0,
      serviceQuality: 5.0,
      timing: 5.0,
      cleanliness: 5.0,
      ambience: 5.0,
    };
    this.stats = data.stats || {
      totalBookings: 0,
      repeatCustomers: 0,
      averageWaitTime: 10,
    };
    this.isActive = data.isActive !== undefined ? data.isActive : true;
    this.createdAt = new Date();
    this.updatedAt = new Date();
  }

  static async create(salonData) {
    const { db } = await connectToDatabase();
    const salon = new Salon(salonData);

    // Create geospatial index for location-based queries
    await db
      .collection("salons")
      .createIndex({ "salonDetails.location": "2dsphere" });

    const result = await db.collection("salons").insertOne(salon);
    return { ...salon, _id: result.insertedId };
  }

  static async findById(id) {
    const { db } = await connectToDatabase();
    return await db.collection("salons").findOne({ _id: new ObjectId(id) });
  }

  static async findByOwnerEmail(email) {
    const { db } = await connectToDatabase();
    return await db
      .collection("salons")
      .findOne({ "ownerDetails.email": email });
  }

  static async findNearby(coordinates, radius = 5000, options = {}) {
    const { db } = await connectToDatabase();

    const pipeline = [
      {
        $geoNear: {
          near: {
            type: "Point",
            coordinates: coordinates, // [longitude, latitude]
          },
          distanceField: "distance",
          maxDistance: radius,
          spherical: true,
        },
      },
      {
        $match: { isActive: true },
      },
    ];

    // Add gender-based service filtering if specified
    if (options.gender) {
      pipeline.push({
        $addFields: {
          relevantServices: {
            $filter: {
              input: "$services",
              cond: {
                $or: [
                  { $eq: ["$$this.genderSpecific", "unisex"] },
                  { $eq: ["$$this.genderSpecific", options.gender] },
                ],
              },
            },
          },
        },
      });
    }

    pipeline.push(
      {
        $addFields: {
          topServices: { $slice: ["$relevantServices", 4] },
          distanceKm: { $round: [{ $divide: ["$distance", 1000] }, 1] },
        },
      },
      {
        $project: {
          "ownerDetails.password": 0,
        },
      },
      { $limit: options.limit || 20 }
    );

    return await db.collection("salons").aggregate(pipeline).toArray();
  }

  static async updateById(id, updateData) {
    const { db } = await connectToDatabase();
    const result = await db.collection("salons").updateOne(
      { _id: new ObjectId(id) },
      {
        $set: {
          ...updateData,
          updatedAt: new Date(),
        },
      }
    );
    return result.modifiedCount > 0;
  }

  static async incrementBookingCount(id) {
    const { db } = await connectToDatabase();
    return await db.collection("salons").updateOne(
      { _id: new ObjectId(id) },
      {
        $inc: { "stats.totalBookings": 1 },
        $set: { updatedAt: new Date() },
      }
    );
  }

  static async updateRatings(id, newRatings) {
    const { db } = await connectToDatabase();
    return await db.collection("salons").updateOne(
      { _id: new ObjectId(id) },
      {
        $set: {
          "ratings.overall": newRatings.overall,
          "ratings.serviceQuality": newRatings.serviceQuality,
          "ratings.timing": newRatings.timing,
          "ratings.cleanliness": newRatings.cleanliness,
          "ratings.ambience": newRatings.ambience,
          "ratings.totalReviews": newRatings.totalReviews,
          updatedAt: new Date(),
        },
      }
    );
  }
}
</file>

<file path="src/models/Service.js">
// models/Service.js
import mongoose from "mongoose";

const ServiceSchema = new mongoose.Schema(
  {
    salonId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Salon",
      required: true,
      index: true,
    },
    title: { type: String, required: true },
    description: { type: String, default: "" },
    durationMinutes: { type: Number, default: 30 },
    price: { type: Number, required: true },
    isActive: { type: Boolean, default: true },
    createdAt: { type: Date, default: Date.now },
  },
  { timestamps: true }
);

export default mongoose.models.Service ||
  mongoose.model("Service", ServiceSchema);
</file>

<file path="src/models/Staff.js">
// models/Staff.js
import mongoose from "mongoose";

const StaffSchema = new mongoose.Schema(
  {
    salonId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Salon",
      required: true,
      index: true,
    },
    name: { type: String, required: true },
    skills: [{ type: String }],
    workingHours: {
      start: { type: String, default: "09:00" },
      end: { type: String, default: "21:00" },
    },
    photo: { type: String, default: "" },
    bio: { type: String, default: "" },
    isAvailable: { type: Boolean, default: true },
    earnings: { type: Number, default: 0 },
  },
  { timestamps: true }
);

export default mongoose.models.Staff || mongoose.model("Staff", StaffSchema);
</file>

<file path="src/models/User.js">
// models/User.js
import { connectToDatabase } from "../lib/mongodb";
import { ObjectId } from "mongodb";

export class User {
  constructor(data) {
    this.name = data.name;
    this.mobile = data.mobile;
    this.email = data.email || null;
    this.gender = data.gender || "male";
    this.location = data.location || null;
    this.preferences = data.preferences || {
      favoriteServices: [],
      preferredPriceRange: { min: 0, max: 2000 },
    };
    this.bookingHistory = data.bookingHistory || [];
    this.createdAt = new Date();
    this.updatedAt = new Date();
  }

  static async create(userData) {
    const { db } = await connectToDatabase();
    const user = new User(userData);
    const result = await db.collection("users").insertOne(user);
    return { ...user, _id: result.insertedId };
  }

  static async findById(id) {
    const { db } = await connectToDatabase();
    return await db.collection("users").findOne({ _id: new ObjectId(id) });
  }

  static async findByMobile(mobile) {
    const { db } = await connectToDatabase();
    return await db.collection("users").findOne({ mobile });
  }

  static async findByEmail(email) {
    const { db } = await connectToDatabase();
    return await db.collection("users").findOne({ email });
  }

  static async updateById(id, updateData) {
    const { db } = await connectToDatabase();
    const result = await db.collection("users").updateOne(
      { _id: new ObjectId(id) },
      {
        $set: {
          ...updateData,
          updatedAt: new Date(),
        },
      }
    );
    return result.modifiedCount > 0;
  }

  static async addBookingToHistory(userId, bookingId) {
    const { db } = await connectToDatabase();
    return await db.collection("users").updateOne(
      { _id: new ObjectId(userId) },
      {
        $push: { bookingHistory: bookingId },
        $set: { updatedAt: new Date() },
      }
    );
  }
}
</file>

<file path="src/pages/_app.js">
// pages/_app.js
import "leaflet/dist/leaflet.css";
import "../styles/globals.css";

function MyApp({ Component, pageProps }) {
  return <Component {...pageProps} />;
}

export default MyApp;
</file>

<file path="src/pages/api/auth/salon-login.js">
// pages/api/auth/salon-login.js
import { connectToDatabase } from "../../../lib/mongodb";
import { generateToken } from "../../../lib/auth";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { email, password } = req.body;

    if (!email || !password) {
      return res.status(400).json({ error: "Email and password are required" });
    }

    const { db } = await connectToDatabase();

    const salon = await db.collection("salons").findOne({
      "ownerDetails.email": email,
    });

    if (!salon) {
      return res.status(401).json({ error: "Invalid credentials" });
    }

    const isPasswordValid = awaitomparePassword(
      password,
      salon.ownerDetails.password
    );
    if (!isPasswordValid) {
      return res.status(401).json({ error: "Invalid credentials" });
    }

    if (!salon.isActive) {
      return res.status(403).json({ error: "Salon account is deactivated" });
    }

    const token = generateToken({
      id: salon._id,
      email: salon.ownerDetails.email,
      role: "salon_owner",
    });

    res.status(200).json({
      success: true,
      token,
      salon: {
        id: salon._id,
        name: salon.salonDetails.name,
        email: salon.ownerDetails.email,
        address: salon.salonDetails.address,
      },
    });
  } catch (error) {
    console.error("Salon login error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/auth/salon-register.js">
// pages/api/auth/salons/register.js
// Proxy to canonical route /api/auth/salons/register
export default async function handler(req, res) {
  if (req.method !== "POST") {
    res.setHeader("Allow", "POST");
    return res.status(405).end("Method Not Allowed");
  }
  try {
    const base = process.env.NEXT_PUBLIC_BASE_URL || "";
    const url = base + "/api/auth/salons/register";
    const r = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(req.body),
    });
    const data = await r.json();
    return res.status(r.status).json(data);
  } catch (e) {
    console.error("proxy error", e);
    return res.status(500).json({ message: "Proxy error", error: String(e) });
  }
}
</file>

<file path="src/pages/api/auth/salon-register.js.bakdup">
// pages/api/api/auth/salons/register.js
// Proxy to canonical route /api/api/auth/salons/register
export default async function handler(req, res) {
  if (req.method !== 'POST') {
    res.setHeader('Allow', 'POST');
    return res.status(405).end('Method Not Allowed');
  }
  try {
    const base = process.env.NEXT_PUBLIC_BASE_URL || '';
    const url = base + '/api/api/auth/salons/register';
    const r = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(req.body) });
    const data = await r.json();
    return res.status(r.status).json(data);
  } catch (e) {
    console.error('proxy error', e);
    return res.status(500).json({ message: 'Proxy error', error: String(e) });
  }
}
</file>

<file path="src/pages/api/auth/salon/login.js">
import { connectToDatabase } from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";
import bcrypt from "bcryptjs";
import jwt from "jsonwebtoken";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { db } = await connectToDatabase();
    const { email, password } = req.body;

    if (!email || !password) {
      return res.status(400).json({ message: "Email and password required" });
    }

    // Find salon
    const salon = await db.collection("salons").findOne({
      $or: [
        { email: email.toLowerCase() },
        { "ownerDetails.email": email },
        { "salonDetails.ownerEmail": email },
      ],
    });

    if (!salon) {
      return res.status(401).json({ message: "Invalid credentials" });
    }

    // Debug log to see your data structure
    console.log("Found salon:", JSON.stringify(salon, null, 2));

    // Check password - handle both hashed and plain text passwords
    // Check password - always use hashedPassword
    let isValidPassword = false;

    if (salon.hashedPassword) {
      isValidPassword = await bcrypt.compare(password, salon.hashedPassword);
    } else if (salon.password) {
      // Fallback in case old records stored plain password
      isValidPassword = password === salon.password;
    } else if (salon.ownerDetails?.password) {
      // If you had an old schema with ownerDetails.password
      isValidPassword = await bcrypt.compare(
        password,
        salon.ownerDetails.password
      );
    }

    // Generate token
    const token = jwt.sign(
      { salonId: salon._id, email: salon.email },
      process.env.JWT_SECRET || "fallback_secret",
      { expiresIn: "30d" }
    );

    // Remove password from response
    const { password: _, ...salonData } = salon;

    res.status(200).json({
      success: true,
      message: "Login successful",
      salon: salonData,
      token,
    });
  } catch (error) {
    console.error("Login error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/auth/send-otp.js">
// pages/api/auth/send-otp.js
// Generates a 6-digit OTP and stores in 'otps' collection (expires in 5 minutes).
// NOTE: No SMS provider integrated. Replace sendSms() with your provider.
import { connectToDatabase } from "../../../lib/mongodb";
import { nanoid } from "nanoid";

function generateOtp() {
  return Math.floor(100000 + Math.random() * 900000).toString();
}

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ message: "Method not allowed" });
  try {
    const { mobile } = req.body || {};
    if (!mobile) return res.status(400).json({ message: "Missing mobile" });
    const { db } = await connectToDatabase();
    const otp = generateOtp();
    const expiresAt = new Date(Date.now() + 5 * 60 * 1000); // 5 mins
    await db.collection("otps").updateOne({ mobile }, { $set: { otp, expiresAt } }, { upsert: true });
    // TODO: Integrate SMS provider here. For now we return OTP in response for testing.
    return res.status(200).json({ message: "OTP sent (dev)", otp });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ message: e.message });
  }
}
</file>

<file path="src/pages/api/auth/user-register.js">
// pages/api/auth/user-register.js
import { connectToDatabase } from "../../../lib/mongodb";
import { generateToken } from "../../../lib/auth";
import { validateMobile, validateEmail } from "../../../lib/validators";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { name, mobile, email, gender, location, bookingData } = req.body;

    // Basic validation
    if (!name || name.trim().length < 2) {
      return res.status(400).json({ error: "Valid name is required" });
    }

    if (!validateMobile(mobile)) {
      return res.status(400).json({ error: "Valid mobile number is required" });
    }

    const { db } = await connectToDatabase();

    // Check if user already exists
    const existingUser = await db.collection("users").findOne({
      $or: [{ mobile }, { email }],
    });

    if (existingUser) {
      // User exists, just return token
      const token = generateToken({
        id: existingUser._id,
        mobile: existingUser.mobile,
        role: "user",
      });

      return res.status(200).json({
        success: true,
        message: "Welcome back!",
        token,
        user: {
          id: existingUser._id,
          name: existingUser.name,
          mobile: existingUser.mobile,
        },
      });
    }

    // Create new user
    const userData = {
      name: name.trim(),
      mobile,
      email: email || null,
      gender: gender || "male",
      location: location || null,
      preferences: {
        favoriteServices: [],
        preferredPriceRange: { min: 0, max: 2000 },
      },
      bookingHistory: [],
      createdAt: new Date(),
      updatedAt: new Date(),
    };

    const result = await db.collection("users").insertOne(userData);

    // If there's booking data from service completion, associate it with user
    if (bookingData && bookingData.bookingId) {
      await db.collection("bookings").updateOne(
        { _id: new ObjectId(bookingData.bookingId) },
        {
          $set: {
            userId: result.insertedId,
            updatedAt: new Date(),
          },
        }
      );

      // Add booking to user's history
      await db.collection("users").updateOne(
        { _id: result.insertedId },
        {
          $push: { bookingHistory: bookingData.bookingId },
        }
      );
    }

    const token = generateToken({
      id: result.insertedId,
      mobile,
      role: "user",
    });

    res.status(201).json({
      success: true,
      message: "User registered successfully!",
      token,
      user: {
        id: result.insertedId,
        name,
        mobile,
      },
    });
  } catch (error) {
    console.error("User registration error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/auth/user/login.js">
import clientPromise from "../../../../lib/mongodb";
import { verifyPassword, generateToken } from "../../../../lib/auth";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { emailOrPhone, password } = req.body;

    // Validate required fields
    if (!emailOrPhone || !password) {
      return res.status(400).json({
        message: "Email/Phone and password are required",
      });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");
    const users = db.collection("users");

    // Find user by email or phone
    const user = await users.findOne({
      $or: [{ email: emailOrPhone.toLowerCase() }, { phone: emailOrPhone }],
    });

    if (!user) {
      return res.status(401).json({
        message: "Invalid credentials",
      });
    }

    // Check if user is active
    if (!user.isActive) {
      return res.status(401).json({
        message: "Account has been deactivated. Please contact support.",
      });
    }

    // Verify password
    const isPasswordValid = await verifyPassword(password, user.hashedPassword);

    if (!isPasswordValid) {
      return res.status(401).json({
        message: "Invalid credentials",
      });
    }

    // Update last login
    await users.updateOne(
      { _id: user._id },
      {
        $set: {
          lastLogin: new Date(),
          updatedAt: new Date(),
        },
      }
    );

    // Generate JWT token
    const token = generateToken(user._id, user.role, user.email);

    // Remove sensitive data from response
    const { hashedPassword, ...userResponse } = user;

    res.status(200).json({
      message: "Login successful",
      user: userResponse,
      token,
    });
  } catch (error) {
    console.error("User login error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/auth/user/register.js">
import clientPromise from "../../../../lib/mongodb";
import { hashPassword, generateToken } from "../../../../lib/auth";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { name, email, phone, gender, password } = req.body;

    // Validate required fields
    if (!name || !email || !phone || !gender || !password) {
      return res.status(400).json({
        message: "All fields are required",
        required: ["name", "email", "phone", "gender", "password"],
      });
    }

    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      return res.status(400).json({ message: "Invalid email format" });
    }

    // Validate phone format (Indian format)
    const phoneRegex = /^[6-9]\d{9}$/;
    if (!phoneRegex.test(phone)) {
      return res
        .status(400)
        .json({ message: "Invalid phone number. Use 10-digit Indian format" });
    }

    // Validate password strength
    if (password.length < 6) {
      return res
        .status(400)
        .json({ message: "Password must be at least 6 characters long" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");
    const users = db.collection("users");

    // Check if user already exists
    const existingUser = await users.findOne({
      $or: [{ email: email.toLowerCase() }, { phone: phone }],
    });

    if (existingUser) {
      return res.status(409).json({
        message: "User already exists with this email or phone number",
      });
    }

    // Hash password
    const hashedPassword = await hashPassword(password);

    // Create new user
    const newUser = {
      name: name.trim(),
      email: email.toLowerCase(),
      phone: phone,
      gender: gender,
      role: "user",
      hashedPassword,
      bookingHistory: [],
      preferences: {
        favoriteServices: [],
        preferredSalons: [],
      },
      createdAt: new Date(),
      updatedAt: new Date(),
      isActive: true,
    };

    const result = await users.insertOne(newUser);

    // Generate JWT token
    const token = generateToken(result.insertedId, "user", email);

    // Remove password from response
    const { hashedPassword: _, ...userResponse } = newUser;
    userResponse._id = result.insertedId;

    res.status(201).json({
      message: "User registered successfully",
      user: userResponse,
      token,
    });
  } catch (error) {
    console.error("User registration error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/auth/verify-otp.js">
// pages/api/auth/verify-otp.js
// Verifies OTP and returns a temporary token (or creates/returns user).
// For demo returns user info if found or indicates success.
import { connectToDatabase } from "../../../lib/mongodb";

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ message: "Method not allowed" });
  try {
    const { mobile, otp } = req.body || {};
    if (!mobile || !otp) return res.status(400).json({ message: "Missing fields" });
    const { db } = await connectToDatabase();
    const record = await db.collection("otps").findOne({ mobile });
    if (!record) return res.status(400).json({ message: "No OTP found" });
    if (new Date(record.expiresAt) < new Date()) return res.status(400).json({ message: "OTP expired" });
    if (String(record.otp) !== String(otp)) return res.status(400).json({ message: "Invalid OTP" });
    // OTP ok ‚Äî optionally find/create user
    const user = await db.collection("users").findOne({ mobile });
    // delete OTP after use
    await db.collection("otps").deleteOne({ mobile });
    return res.status(200).json({ message: "Verified", user: user || null });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ message: e.message });
  }
}
</file>

<file path="src/pages/api/bookings.js">
// pages/api/bookings.js
import { connectToDatabase, clientPromise } from "../../lib/mongodb";
import { ObjectId } from "mongodb";

/**
 * This version uses a MongoDB transaction (when available) to insert booking,
 * update salon, and create/find user atomically. It also publishes a simple
 * in-memory SSE notification for subscribed salon dashboards.
 */

// simple in-memory pubsub for SSE (dev only)
const subscribers = {}; // { salonId: [res, ...] }

function publishNotification(salonId, payload) {
  // store for any connected subscribers
  const list = subscribers[salonId] || [];
  list.forEach((res) => {
    try {
      res.write(`data: ${JSON.stringify(payload)}\n\n`);
    } catch (e) {
      // ignore writes errors
    }
  });
}

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ message: "Method not allowed" });
  try {
    const body = req.body || {};
    const { salonId, service, barber, date, time, user } = body;

    if (!salonId || !service || !date || !time) {
      return res.status(400).json({ message: "Missing required fields" });
    }

    const { db, client } = await connectToDatabase();
    const session = client.startSession ? client.startSession() : null;
    let bookingId = null;
    let userId = null;

    const bookingDate = new Date(date);
    if (isNaN(bookingDate.getTime())) return res.status(400).json({ message: "Invalid date" });

    const bookingDoc = {
      salonId: ObjectId.isValid(salonId) ? new ObjectId(salonId) : salonId,
      service,
      barber: barber || null,
      date,
      time,
      customerName: user?.name || body.customerName || "Guest",
      customerPhone: user?.mobile || body.customerPhone || "Unknown",
      price: body.price || 0,
      paymentStatus: "pending",
      status: "confirmed",
      createdAt: new Date()
    };

    const transactionFn = async (session) => {
      // double booking check inside transaction
      const existing = await db.collection("bookings").findOne({
        salonId: bookingDoc.salonId,
        date,
        time,
        barber: bookingDoc.barber,
        status: { $ne: "cancelled" }
      }, { session });
      if (existing) throw new Error("Slot already booked");

      const insertResult = await db.collection("bookings").insertOne(bookingDoc, { session });
      bookingId = insertResult.insertedId;

      if (user && user.mobile) {
        let existingUser = await db.collection("users").findOne({ mobile: user.mobile }, { session });
        if (!existingUser) {
          const newUser = {
            name: user.name || "Guest",
            mobile: user.mobile,
            email: user.email || null,
            gender: user.gender || "other",
            location: user.location || null,
            bookingHistory: [bookingId],
            createdAt: new Date()
          };
          const ur = await db.collection("users").insertOne(newUser, { session });
          userId = ur.insertedId;
        } else {
          userId = existingUser._id;
          await db.collection("users").updateOne({ _id: userId }, { $push: { bookingHistory: bookingId }, $set: { updatedAt: new Date() } }, { session });
        }
        await db.collection("bookings").updateOne({ _id: bookingId }, { $set: { userId } }, { session });
      }

      // update salon bookings array
      await db.collection("salons").updateOne(
        { _id: bookingDoc.salonId },
        { $push: { bookings: { _id: bookingId, date, time, service, barber } }, $set: { updatedAt: new Date() } },
        { session }
      );
    };

    if (session) {
      try {
        await session.withTransaction(async () => {
          await transactionFn(session);
        });
      } finally {
        await session.endSession();
      }
    } else {
      // fallback: not a replica set / no sessions available
      await transactionFn(null);
    }

    // Publish SSE notification (dev-time)
    try {
      publishNotification(String(salonId), { type: "new_booking", bookingId: String(bookingId), date, time, service, barber });
    } catch (e) {
      console.warn("Publish failed", e.message);
    }

    return res.status(201).json({ bookingId, userId: userId || null });
  } catch (e) {
    if (e.message && e.message.includes("Slot already booked")) {
      return res.status(409).json({ message: "Slot already booked" });
    }
    console.error("Booking API error:", e);
    return res.status(500).json({ message: e.message || "Internal server error" });
  }
}

// Expose a helper to allow SSE subscription (imported by /api/salon/notifications)
export function _subscribe(salonId, res) {
  subscribers[salonId] = subscribers[salonId] || [];
  subscribers[salonId].push(res);
  // Remove on close
  reqClose(res);
}

function reqClose(res) {
  res.on("close", () => {
    for (const sid of Object.keys(subscribers)) {
      subscribers[sid] = subscribers[sid].filter(r => r !== res);
    }
  });
}
</file>

<file path="src/pages/api/bookings/[id].js">
// pages/api/bookings/[id].js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const { id } = req.query;
  if (!id) return res.status(400).json({ message: "Missing id" });
  if (req.method !== "GET")
    return res.status(405).json({ message: "Method not allowed" });
  try {
    const { db } = await connectToDatabase();
    const b = await db
      .collection("bookings")
      .findOne({ _id: ObjectId.isValid(id) ? new ObjectId(id) : id });
    if (!b) return res.status(404).json({ message: "Not found" });
    return res.status(200).json({ booking: b });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ message: e.message });
  }
}
</file>

<file path="src/pages/api/bookings/create.js">
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { db } = await connectToDatabase();
    const {
      salonId,
      service,
      barber,
      date,
      time,
      user,
      price,
      customerName,
      customerPhone,
    } = req.body;

    if (!salonId || !service || !date || !time) {
      return res.status(400).json({ error: "Missing required fields" });
    }

    // Check for existing booking
    const existingBooking = await db.collection("bookings").findOne({
      salonId: ObjectId.isValid(salonId) ? new ObjectId(salonId) : salonId,
      date,
      time,
      status: { $ne: "cancelled" },
    });

    if (existingBooking) {
      return res.status(409).json({ error: "Time slot already booked" });
    }

    const bookingData = {
      salonId: ObjectId.isValid(salonId) ? new ObjectId(salonId) : salonId,
      service,
      barber: barber || null,
      date,
      time,
      customerName: customerName || "Guest",
      customerPhone: customerPhone || "",
      price: price || 0,
      paymentStatus: "pending",
      status: "confirmed",
      userId: user?.id || null,
      createdAt: new Date(),
      updatedAt: new Date(),
      feedback: {
        submitted: false,
        ratings: {},
        comment: "",
      },
    };

    const result = await db.collection("bookings").insertOne(bookingData);

    res.status(201).json({
      success: true,
      message: "Booking created successfully",
      bookingId: result.insertedId,
      _id: result.insertedId,
    });
  } catch (error) {
    console.error("Booking creation error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/bookings/update-status.js">
// src/pages/api/bookings/update-status.js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "PUT") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { bookingId, status } = req.body;

    if (!bookingId || !status) {
      return res
        .status(400)
        .json({ error: "Booking ID and status are required" });
    }

    const { client, db } = await connectToDatabase();

    // Update booking status
    const result = await db.collection("bookings").updateOne(
      { _id: new ObjectId(bookingId) },
      {
        $set: {
          status,
          updatedAt: new Date(),
          // Add completion timestamp when service is done
          ...(status === "completed" && { completedAt: new Date() }),
        },
      }
    );

    if (result.matchedCount === 0) {
      return res.status(404).json({ error: "Booking not found" });
    }

    // Get updated booking to return
    const updatedBooking = await db.collection("bookings").findOne({
      _id: new ObjectId(bookingId),
    });

    res.status(200).json({
      success: true,
      message: "Booking status updated successfully",
      booking: updatedBooking,
    });
  } catch (error) {
    console.error("Error updating booking status:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/bookings/update.js">
// pages/api/bookings/update.js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "PUT") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { bookingId, status, feedback } = req.body;

    if (!ObjectId.isValid(bookingId)) {
      return res.status(400).json({ error: "Invalid booking ID" });
    }

    const { db } = await connectToDatabase();

    const updateData = { updatedAt: new Date() };

    if (status) {
      updateData.status = status;
    }

    if (feedback) {
      updateData.feedback = {
        submitted: true,
        ...feedback,
        submittedAt: new Date(),
      };
    }

    const result = await db
      .collection("bookings")
      .updateOne({ _id: new ObjectId(bookingId) }, { $set: updateData });

    if (result.matchedCount === 0) {
      return res.status(404).json({ error: "Booking not found" });
    }

    // If feedback is submitted, update salon ratings
    if (feedback && feedback.ratings) {
      const booking = await db.collection("bookings").findOne({
        _id: new ObjectId(bookingId),
      });

      if (booking) {
        await updateSalonRatings(db, booking.salonId, feedback.ratings);
      }
    }

    res.status(200).json({
      success: true,
      message: "Booking updated successfully",
    });
  } catch (error) {
    console.error("Booking update error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}

// Helper function to update salon ratings
async function updateSalonRatings(db, salonId, newRatings) {
  try {
    // Get all feedback for this salon
    const allFeedback = await db
      .collection("bookings")
      .find({
        salonId,
        "feedback.submitted": true,
      })
      .toArray();

    if (allFeedback.length === 0) return;

    // Calculate average ratings
    const totalRatings = allFeedback.reduce((acc, booking) => {
      const ratings = booking.feedback.ratings;
      Object.keys(ratings).forEach((key) => {
        acc[key] = (acc[key] || 0) + ratings[key];
      });
      return acc;
    }, {});

    const avgRatings = {};
    Object.keys(totalRatings).forEach((key) => {
      avgRatings[key] = parseFloat(
        (totalRatings[key] / allFeedback.length).toFixed(1)
      );
    });

    // Update salon ratings
    await db.collection("salons").updateOne(
      { _id: new ObjectId(salonId) },
      {
        $set: {
          "ratings.overall": avgRatings.overall || 5.0,
          "ratings.serviceQuality": avgRatings.serviceQuality || 5.0,
          "ratings.timing": avgRatings.timing || 5.0,
          "ratings.cleanliness": avgRatings.cleanliness || 5.0,
          "ratings.ambience": avgRatings.ambience || 5.0,
          "ratings.totalReviews": allFeedback.length,
          updatedAt: new Date(),
        },
      }
    );
  } catch (error) {
    console.error("Error updating salon ratings:", error);
  }
}
</file>

<file path="src/pages/api/maps/geocode.js">
// pages/api/maps/geocode.js
export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  try {
    const { address } = req.body;
    const apiKey = process.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;

    if (!address) {
      return res.status(400).json({ error: "Address is required" });
    }

    const response = await fetch(
      `https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(
        address
      )}&key=${apiKey}`
    );

    const data = await response.json();

    if (data.status !== "OK" || !data.results || data.results.length === 0) {
      return res.status(400).json({ error: "Address not found" });
    }

    const result = data.results[0];
    const location = result.geometry.location;

    res.status(200).json({
      success: true,
      coordinates: [location.lng, location.lat], // [longitude, latitude] for MongoDB
      formattedAddress: result.formatted_address,
      placeId: result.place_id,
    });
  } catch (error) {
    console.error("Geocoding error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salon/notifications.js">
// pages/api/salon/notifications.js
// Simple Server-Sent Events (SSE) endpoint for salon dashboards to subscribe to live notifications.
// Note: This is a simple in-memory solution for dev. For production use Redis/Message broker.

const subscribers = {}; // { salonId: [res, ...] }

export default async function handler(req, res) {
  const { salonId } = req.query;
  if (!salonId) return res.status(400).json({ message: "Missing salonId" });
  // Set SSE headers
  res.writeHead(200, {
    Connection: "keep-alive",
    "Cache-Control": "no-cache, no-transform",
    "Content-Type": "text/event-stream",
  });
  res.write("\n");

  subscribers[salonId] = subscribers[salonId] || [];
  subscribers[salonId].push(res);

  req.on("close", () => {
    subscribers[salonId] = subscribers[salonId].filter((r) => r !== res);
  });
}

// Provide a small helper to publish (other modules can import this file and call publish)
export function publish(salonId, payload) {
  const list = subscribers[salonId] || [];
  list.forEach((res) => {
    try {
      res.write(`data: ${JSON.stringify(payload)}\n\n`);
    } catch (e) {}
  });
}
</file>

<file path="src/pages/api/salons/[id].js">
// pages/api/salons/[id].js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const { id } = req.query;

  if (!ObjectId.isValid(id)) {
    return res.status(400).json({ error: "Invalid salon ID" });
  }

  try {
    const { db } = await connectToDatabase();

    if (req.method === "GET") {
      const salon = await db
        .collection("salons")
        .findOne(
          { _id: new ObjectId(id) },
          { projection: { "ownerDetails.password": 0 } }
        );

      if (!salon) {
        return res.status(404).json({ error: "Salon not found" });
      }

      // Get recent reviews/feedback
      const recentFeedback = await db
        .collection("bookings")
        .find({
          salonId: id,
          "feedback.submitted": true,
        })
        .sort({ updatedAt: -1 })
        .limit(5)
        .toArray();

      res.status(200).json({
        success: true,
        salon: {
          ...salon,
          recentFeedback: recentFeedback.map((booking) => ({
            userName: booking.userDetails.name,
            rating: booking.feedback.ratings.overall,
            comment: booking.feedback.comment,
            service: booking.service.name,
            date: booking.updatedAt,
          })),
        },
      });
    } else if (req.method === "PUT") {
      // Update salon details (protected route - needs authentication)
      const updateData = {
        ...req.body,
        updatedAt: new Date(),
      };

      const result = await db
        .collection("salons")
        .updateOne({ _id: new ObjectId(id) }, { $set: updateData });

      if (result.matchedCount === 0) {
        return res.status(404).json({ error: "Salon not found" });
      }

      res.status(200).json({
        success: true,
        message: "Salon updated successfully",
      });
    } else {
      res.status(405).json({ error: "Method not allowed" });
    }
  } catch (error) {
    console.error("Salon API error:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/barbers/[id].js">
// pages/api/salons/barbers/[id].js
import clientPromise from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const { method } = req;
  const { id } = req.query;

  if (!ObjectId.isValid(id)) {
    return res.status(400).json({ error: "Invalid barber ID" });
  }

  try {
    const client = await clientPromise;
    const db = client.db("techtrims");
    const barbersCollection = db.collection("barbers");

    if (method === "GET") {
      const barber = await barbersCollection.findOne({ _id: new ObjectId(id) });
      if (!barber) return res.status(404).json({ error: "Barber not found" });
      return res.status(200).json(barber);
    }

    if (method === "PUT") {
      const updateData = { ...req.body, updatedAt: new Date() };

      const result = await barbersCollection.findOneAndUpdate(
        { _id: new ObjectId(id) },
        { $set: updateData },
        { returnDocument: "after" }
      );

      if (!result.value)
        return res.status(404).json({ error: "Barber not found" });
      return res.status(200).json(result.value);
    }

    if (method === "DELETE") {
      const result = await barbersCollection.deleteOne({
        _id: new ObjectId(id),
      });
      if (result.deletedCount === 0)
        return res.status(404).json({ error: "Barber not found" });
      return res.status(204).end();
    }

    return res.setHeader("Allow", ["GET", "PUT", "DELETE"]).status(405).end();
  } catch (err) {
    console.error("api/barbers/[id] error:", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/barbers/available.js">
// pages/api/salons/barbers/available.js
import clientPromise from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  const { salonId, service } = req.query;

  console.log("=== AVAILABLE BARBERS API DEBUG ===");
  console.log("SalonId:", salonId);
  console.log("Service:", service);

  if (!salonId) {
    return res.status(400).json({ error: "salonId required" });
  }

  try {
    const client = await clientPromise;
    const db = client.db("techtrims");
    const barbersCollection = db.collection("barbers");

    // Convert salonId to ObjectId
    let salonObjectId;
    try {
      salonObjectId = new ObjectId(salonId);
    } catch (objIdError) {
      return res.status(400).json({ error: "Invalid salonId format" });
    }

    // Find barbers who can perform the requested service
    const query = {
      salonId: salonObjectId,
      isAvailable: true,
    };

    if (service) {
      // Check if the barber has this skill
      query.skills = { $in: [service] };
    }

    console.log("Database query:", JSON.stringify(query, null, 2));

    const barbers = await barbersCollection
      .find(query)
      .sort({ rating: -1, totalBookings: -1 })
      .toArray();

    console.log("Found available barbers:", barbers.length);
    console.log("Barbers:", barbers);

    return res.status(200).json(barbers);
  } catch (err) {
    console.error("Available barbers API error:", err);
    return res
      .status(500)
      .json({ error: "Internal server error", details: err.message });
  }
}
</file>

<file path="src/pages/api/salons/barbers/index.js">
// pages/api/salons/barbers/index.js
import clientPromise from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  const { method } = req;

  // Extract salonId from query parameters or request body
  const salonId = req.query.salonId || req.body.salonId;

  console.log("=== BARBERS API DEBUG ===");
  console.log("Method:", method);
  console.log("Raw salonId:", salonId);
  console.log("SalonId type:", typeof salonId);

  if (!salonId) {
    return res.status(400).json({ error: "salonId required" });
  }

  try {
    const client = await clientPromise;
    const db = client.db("techtrims");
    const barbersCollection = db.collection("barbers");

    console.log("Database connected successfully");

    if (method === "GET") {
      // Get all barbers for salon
      console.log("Fetching barbers for salon:", salonId);

      // Convert salonId to ObjectId - ADD VALIDATION
      let salonObjectId;
      try {
        salonObjectId = new ObjectId(salonId);
        console.log("Converted to ObjectId:", salonObjectId);
      } catch (objIdError) {
        console.error("Invalid ObjectId:", salonId, objIdError);
        return res.status(400).json({ error: "Invalid salonId format" });
      }

      const barbers = await barbersCollection
        .find({
          salonId: salonObjectId,
        })
        .sort({ name: 1 })
        .toArray();

      console.log("Found barbers:", barbers.length);
      console.log("Barbers data:", barbers);

      return res.status(200).json(barbers);
    }

    if (method === "POST") {
      // Create new barber
      let salonObjectId;
      try {
        salonObjectId = new ObjectId(salonId);
      } catch (objIdError) {
        return res.status(400).json({ error: "Invalid salonId format" });
      }

      const barberData = {
        ...req.body,
        salonId: salonObjectId,
        totalBookings: 0,
        rating: 5.0,
        isAvailable: req.body.isAvailable !== false,
        workingHours: {
          start: "09:00",
          end: "21:00",
        },
        accomplishments: [],
        earnings: 0,
        lastActiveAt: new Date(),
        createdAt: new Date(),
        updatedAt: new Date(),
      };

      console.log("Creating barber:", barberData);

      const result = await barbersCollection.insertOne(barberData);
      const createdBarber = await barbersCollection.findOne({
        _id: result.insertedId,
      });

      console.log("Barber created:", result.insertedId);
      return res.status(201).json(createdBarber);
    }

    return res
      .setHeader("Allow", ["GET", "POST"])
      .status(405)
      .json({ error: "Method not allowed" });
  } catch (err) {
    console.error("=== API ERROR ===");
    console.error("Error name:", err.name);
    console.error("Error message:", err.message);
    console.error("Error stack:", err.stack);
    console.error("=== END ERROR ===");

    return res.status(500).json({
      error: "Internal server error",
      details: err.message,
      name: err.name,
    });
  }
}
</file>

<file path="src/pages/api/salons/bookings.js">
// src/pages/api/salons/bookings.js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  const { salonId, date, status, from, to } = req.query;

  if (!salonId) {
    return res.status(400).json({ error: "salonId is required" });
  }

  try {
    const { client, db } = await connectToDatabase(); // Note: destructure both client and db

    // Build filter object
    const filter = {};

    // Handle salonId - could be string or ObjectId
    if (ObjectId.isValid(salonId)) {
      filter.salonId = new ObjectId(salonId);
    } else {
      filter.salonId = salonId;
    }

    // Add status filter
    if (status) {
      filter.status = status;
    }

    // Add date filter
    if (date) {
      // For specific date, match the date string exactly
      filter.date = date;
    } else if (from || to) {
      // For date range, use appointmentAt if it exists
      filter.appointmentAt = {};
      if (from) filter.appointmentAt.$gte = new Date(from);
      if (to) filter.appointmentAt.$lte = new Date(to);
    }

    console.log("Booking query filter:", JSON.stringify(filter, null, 2));

    // Query bookings
    const bookings = await db
      .collection("bookings")
      .find(filter)
      .sort({ date: 1, time: 1 })
      .limit(100)
      .toArray();

    console.log(`Found ${bookings.length} bookings for salon ${salonId}`);

    return res.status(200).json(bookings);
  } catch (error) {
    console.error("Bookings API error:", error);
    return res.status(500).json({
      error: "Internal server error",
      message: error.message,
    });
  }
}
</file>

<file path="src/pages/api/salons/bookings/today.js">
import { connectToDatabase } from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { db } = await connectToDatabase();
    const { salonId } = req.query;

    if (!salonId) {
      return res.status(400).json({ message: "Salon ID required" });
    }

    // ‚úÖ define today BEFORE using it
    // get today in local timezone as YYYY-MM-DD
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    const todayStr = `${yyyy}-${mm}-${dd}`;

    console.log("Fetching bookings for salon:", salonId, "date:", todayStr);

    const bookings = await db
      .collection("bookings")
      .find({
        salonId: salonId,
        date: todayStr,
        status: { $ne: "cancelled" },
      })
      .sort({ time: 1 })
      .toArray();

    res.status(200).json({
      success: true,
      bookings,
    });
  } catch (error) {
    console.error("Error fetching today's bookings:", error);
    // expose real error while debugging
    res.status(500).json({ message: error.message, stack: error.stack });
  }
}
</file>

<file path="src/pages/api/salons/bookings/update-status.js">
//pages/api/salons/bookings/today.js
import { connectToDatabase } from "../../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "PUT") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  try {
    const { db } = await connectToDatabase();
    const { bookingId, status } = req.body;

    if (!bookingId || !status) {
      return res
        .status(400)
        .json({ message: "Booking ID and status required" });
    }

    const result = await db.collection("bookings").updateOne(
      { _id: new ObjectId(bookingId) },
      {
        $set: {
          status,
          updatedAt: new Date(),
        },
      }
    );

    if (result.matchedCount === 0) {
      return res.status(404).json({ message: "Booking not found" });
    }

    res.status(200).json({
      success: true,
      message: "Booking status updated successfully",
    });
  } catch (error) {
    console.error("Error updating booking status:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/index.js">
// pages/api/salons/index.js
import { connectToDatabase } from "../../../lib/mongodb";

export default async function handler(req, res) {
  try {
    const { db } = await connectToDatabase();
    const salons = await db.collection("salons").find({}).toArray();
    console.log("Salons fetched from DB:", salons); // debug
    res.status(200).json({ success: true, salons });
  } catch (error) {
    console.error("Error fetching salons:", error);
    res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/profile.js">
// pages/api/salons/profile.js
import clientPromise from "../../../lib/mongodb";

export default async function handler(req, res) {
  try {
    const client = await clientPromise;
    const db = client.db("techtrims");
    const salon = await db.collection("salons").findOne({});
    res.status(200).json(salon);
  } catch (e) {
    console.error(e);
    res.status(500).json({ error: "Failed to load salon profile" });
  }
}
</file>

<file path="src/pages/api/salons/services/[id].js">
// pages/api/salons/services/[id].js
import { connectToDatabase } from "../../../../lib/mongodb";
import Service from "../../../../models/Service";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const { id } = req.query;

  try {
    if (method === "GET") {
      const s = await Service.findById(id);
      if (!s) return res.status(404).json({ error: "Not found" });
      return res.status(200).json(s);
    }
    if (method === "PUT") {
      const update = req.body;
      const s = await Service.findByIdAndUpdate(id, update, { new: true });
      return res.status(200).json(s);
    }
    if (method === "DELETE") {
      await Service.findByIdAndDelete(id);
      return res.status(204).end();
    }
    return res.setHeader("Allow", ["GET", "PUT", "DELETE"]).status(405).end();
  } catch (err) {
    console.error("api/services/[id] error", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/services/index.js">
// pages/api/salons/services/index.js
import { connectToDatabase } from "../../../../lib/mongodb";
import Service from "../../../../models/Service";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const salonId = req.query.salonId || req.body.salonId;
  if (!salonId) return res.status(400).json({ error: "salonId required" });

  try {
    if (method === "GET") {
      const items = await Service.find({ salonId }).sort({ title: 1 });
      return res.status(200).json(items);
    }
    if (method === "POST") {
      const payload = { ...req.body, salonId };
      const s = new Service(payload);
      await s.save();
      return res.status(201).json(s);
    }
    return res.setHeader("Allow", ["GET", "POST"]).status(405).end();
  } catch (err) {
    console.error("api/services error", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/staff/[id].js">
// pages/api/salons/staff/[id].js
import { connectToDatabase } from "../../../../lib/mongodb";
import Staff from "../../../../models/Staff";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const { id } = req.query;

  try {
    if (method === "GET") {
      const s = await Staff.findById(id);
      if (!s) return res.status(404).json({ error: "Not found" });
      return res.status(200).json(s);
    }
    if (method === "PUT") {
      const update = req.body;
      const s = await Staff.findByIdAndUpdate(id, update, { new: true });
      return res.status(200).json(s);
    }
    if (method === "DELETE") {
      await Staff.findByIdAndDelete(id);
      return res.status(204).end();
    }
    return res.setHeader("Allow", ["GET", "PUT", "DELETE"]).status(405).end();
  } catch (err) {
    console.error("api/staff/[id] error", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/staff/index.js">
// pages/api/salons/staff/index.js
import { connectToDatabase } from "../../../../lib/mongodb";
import Staff from "../../../../models/Staff";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const salonId = req.query.salonId || req.body.salonId;

  if (!salonId) return res.status(400).json({ error: "salonId required" });

  try {
    if (method === "GET") {
      const items = await Staff.find({ salonId }).sort({ name: 1 });
      return res.status(200).json(items);
    }
    if (method === "POST") {
      const payload = { ...req.body, salonId };
      const st = new Staff(payload);
      await st.save();
      return res.status(201).json(st);
    }

    return res.setHeader("Allow", ["GET", "POST"]).status(405).end();
  } catch (err) {
    console.error("api/staff error", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/users/register.js">
// pages/api/users/register.js
import { connectToDatabase } from "../../../lib/mongodb";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  if (req.method !== "POST") return res.status(405).json({ message: "Method not allowed" });
  try {
    const body = req.body || {};
    const { name, mobile, email, gender, location } = body;
    if (!mobile || !name) return res.status(400).json({ message: "Missing name or mobile" });

    const { db } = await connectToDatabase();
    let existing = await db.collection("users").findOne({ mobile });
    if (existing) {
      return res.status(200).json({ message: "User exists", userId: existing._id });
    }

    const userDoc = {
      name,
      mobile,
      email: email || null,
      gender: gender || "other",
      location: location || null,
      bookingHistory: [],
      createdAt: new Date()
    };

    const r = await db.collection("users").insertOne(userDoc);
    return res.status(201).json({ userId: r.insertedId });
  } catch (e) {
    console.error(e);
    return res.status(500).json({ message: e.message });
  }
}
</file>

<file path="src/pages/auth/salon/login.js">
import { useState } from "react";
import { useRouter } from "next/router";
import styles from "../../../styles/Auth.module.css";

export default function SalonLogin() {
  const router = useRouter();
  const [formData, setFormData] = useState({
    email: "",
    password: "",
  });
  const [isLoading, setIsLoading] = useState(false);

  const handleLogin = async (e) => {
    e.preventDefault();
    setIsLoading(true);

    try {
      const response = await fetch("/api/auth/salon/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      const data = await response.json();

      if (response.ok) {
        // Store salon session
        localStorage.setItem("salonSession", JSON.stringify(data.salon));
        localStorage.setItem("salonToken", data.token);
        router.push("/salons/dashboard");
      } else {
        alert(data.message || "Login failed");
      }
    } catch (error) {
      alert("Login error: " + error.message);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className={styles.container}>
      <div className={styles.loginCard}>
        <h1>Salon Owner Login</h1>
        <form onSubmit={handleLogin}>
          <input
            type="email"
            placeholder="Email"
            value={formData.email}
            onChange={(e) =>
              setFormData({ ...formData, email: e.target.value })
            }
            required
          />
          <input
            type="password"
            placeholder="Password"
            value={formData.password}
            onChange={(e) =>
              setFormData({ ...formData, password: e.target.value })
            }
            required
          />
          <button type="submit" disabled={isLoading}>
            {isLoading ? "Logging in..." : "Login"}
          </button>
        </form>
        <p>
          Don&#39;t have an account?
          <a onClick={() => router.push("/auth/salon/register")}>
            {" "}
            Register here
          </a>
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/auth/salon/register.js">
import SalonRegisterForm from "../../../components/Salon/SalonRegisterForm";

export default function SalonRegisterPage() {
  return (
    <div style={{ padding: "2rem" }}>
      <h1>Register Your Salon</h1>
      <SalonRegisterForm />
    </div>
  );
}
</file>

<file path="src/pages/auth/user-register.js">
// src/pages/auth/user-register.js - Add prefill functionality
import { useState, useEffect } from "react";
import { useRouter } from "next/router";

export default function UserRegisterPage() {
  const router = useRouter();
  const [formData, setFormData] = useState({
    name: "",
    email: "",
    phone: "",
    gender: "",
    password: "",
  });
  const [prefillData, setPrefillData] = useState(null);

  // Load prefill data on component mount
  // src/pages/auth/user-register.js - Use existing userOnboardingData
  useEffect(() => {
    // First check for userOnboardingData (from booking flow)
    const onboardingData = localStorage.getItem("userOnboardingData");
    const savedPrefillData = localStorage.getItem("userPrefillData");

    let prefillInfo = null;

    if (onboardingData) {
      try {
        const data = JSON.parse(onboardingData);

        prefillInfo = {
          name: data.name || "",
          gender: data.gender || "",
          location: data.location || null,
          source: "onboarding",
        };

        setPrefillData(prefillInfo);

        // Prefill form with onboarding data
        setFormData((prev) => ({
          ...prev,
          name: data.name || prev.name,
          gender: data.gender?.toLowerCase() || prev.gender,
          // Could also prefill location if you have address field
        }));

        console.log("Form prefilled from onboarding data");
      } catch (error) {
        console.error("Error parsing onboarding data:", error);
      }
    } else if (savedPrefillData) {
      // Fallback to feedback prefill data
      try {
        const data = JSON.parse(savedPrefillData);

        prefillInfo = {
          name: data.name || "",
          phone: data.phone || "",
          lastBooking: data.lastBooking || null,
          source: "feedback",
        };

        setPrefillData(prefillInfo);

        setFormData((prev) => ({
          ...prev,
          name: data.name || prev.name,
          phone: data.phone || prev.phone,
        }));
      } catch (error) {
        console.error("Error parsing prefill data:", error);
      }
    }
  }, []);

  // src/pages/auth/user-register.js - Clear both data sources
  const handleSubmit = async (e) => {
    e.preventDefault();

    try {
      const response = await fetch("/api/auth/user-register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (response.ok) {
        const result = await response.json();

        // Store auth token
        localStorage.setItem("userToken", result.token);

        // Clear both prefill data sources after successful registration
        localStorage.removeItem("userPrefillData");
        localStorage.removeItem("userOnboardingData");

        alert("Registration successful! Welcome to TechTrims!");
        router.push("/user/dashboard"); // or wherever you want to redirect
      } else {
        const error = await response.json();
        alert(`Registration failed: ${error.message}`);
      }
    } catch (error) {
      console.error("Registration error:", error);
      alert("Registration failed. Please try again.");
    }
  };

  return (
    <div className="min-h-screen bg-gray-50 flex items-center justify-center">
      <div className="max-w-md w-full bg-white rounded-lg shadow-md p-6">
        <h1 className="text-2xl font-bold text-center mb-6">Create Account</h1>

        {/* Show prefill info if available */}
        {prefillData && (
          <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
            <h3 className="font-semibold text-green-900 mb-2">
              ‚úÖ Complete your registration
            </h3>
            {prefillData.source === "onboarding" ? (
              <div className="text-sm text-green-700">
                <p>
                  Welcome back, <strong>{prefillData.name}</strong>!
                </p>
                <p>Gender: {prefillData.gender}</p>
                {prefillData.location && (
                  <p className="text-xs text-green-600 mt-1">
                    üìç Location: {prefillData.location.address}
                  </p>
                )}
              </div>
            ) : prefillData.source === "feedback" ? (
              <p className="text-sm text-green-700">
                Based on your recent booking: {prefillData.lastBooking?.service}
                {prefillData.lastBooking?.date &&
                  ` on ${prefillData.lastBooking.date}`}
              </p>
            ) : null}
          </div>
        )}

        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Full Name *
            </label>
            <input
              type="text"
              value={formData.name}
              onChange={(e) =>
                setFormData({ ...formData, name: e.target.value })
              }
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Phone Number *
            </label>
            <input
              type="tel"
              value={formData.phone}
              onChange={(e) =>
                setFormData({ ...formData, phone: e.target.value })
              }
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Email
            </label>
            <input
              type="email"
              value={formData.email}
              onChange={(e) =>
                setFormData({ ...formData, email: e.target.value })
              }
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Gender *
            </label>
            <select
              value={formData.gender}
              onChange={(e) =>
                setFormData({ ...formData, gender: e.target.value })
              }
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
            >
              <option value="">Select Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div>
            <label className="block text-sm font-medium text-gray-700 mb-1">
              Password *
            </label>
            <input
              type="password"
              value={formData.password}
              onChange={(e) =>
                setFormData({ ...formData, password: e.target.value })
              }
              className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              required
              minLength="6"
            />
          </div>

          <button
            type="submit"
            className="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
          >
            Create Account
          </button>
        </form>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/barbers/index.js">
// pages/salons/barbers/index.js
import { useEffect, useState } from "react";
import { useRouter } from "next/router";
import axios from "axios";
import Link from "next/link";

export default function SalonBarbersPage() {
  const router = useRouter();
  const [barbers, setBarbers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");
  const [showForm, setShowForm] = useState(false);
  const [salonId, setSalonId] = useState(null);
  const [newBarber, setNewBarber] = useState({
    name: "",
    experience: 0,
    skills: [],
    bio: "",
    photo: "",
  });

  const availableSkills = [
    "Haircut",
    "Shaving",
    "Hair Styling",
    "Beard Trim",
    "Hair Color",
    "Facial",
  ];

  // Get salonId from localStorage (salon session)
  useEffect(() => {
    if (typeof window !== "undefined") {
      console.log("Checking localStorage for salon session...");

      // Check all possible keys
      const salonSession = localStorage.getItem("salonSession");
      const salonToken = localStorage.getItem("salonToken");

      console.log("Raw salonSession:", salonSession);
      console.log("Raw salonToken:", salonToken);

      if (salonSession) {
        try {
          const salonData = JSON.parse(salonSession);
          console.log("Parsed salon data:", salonData);

          // Try multiple possible id fields
          const id = salonData.id || salonData._id || salonData.salonId;

          if (id) {
            setSalonId(id);
            console.log("Salon ID loaded from session:", id);
          } else {
            console.error("No ID found in salon session data");
            setError("Invalid salon session data");
          }
        } catch (err) {
          console.error("Failed to parse salon session:", err);
          setError("Failed to parse salon session");
        }
      } else {
        console.error("No salon session found in localStorage");
        setError("No salon session found. Please login first.");
        setTimeout(() => {
          router.push("/auth/salon-login");
        }, 2000);
      }
    }
  }, [router]);

  useEffect(() => {
    if (!salonId) {
      console.log("No salonId yet, waiting...");
      return;
    }

    console.log("Fetching barbers for salon:", salonId);
    const fetchBarbers = async () => {
      setLoading(true);
      try {
        // Use the correct API endpoint
        const res = await axios.get(`/api/salons/barbers?salonId=${salonId}`);
        console.log("Barbers API response:", res.data);
        setBarbers(res.data);
        setError("");
      } catch (err) {
        console.error("Fetch barbers error:", err);
        console.error("Error response:", err.response?.data);
        setError(
          `Failed to fetch barbers: ${err.response?.data?.error || err.message}`
        );
      }
      setLoading(false);
    };

    fetchBarbers();
  }, [salonId]);

  // Rest of your component remains the same...
  const handleCreate = async () => {
    if (!newBarber.name) return alert("Name is required");
    if (!salonId) return alert("No salon session found");

    try {
      console.log("Creating barber:", { ...newBarber, salonId });
      const res = await axios.post("/api/salons/barbers", {
        ...newBarber,
        salonId,
      });
      console.log("Create response:", res.data);
      setBarbers([...barbers, res.data]);
      setNewBarber({ name: "", experience: 0, skills: [], bio: "", photo: "" });
      setShowForm(false);
      setError("");
    } catch (err) {
      console.error("Create barber error:", err);
      setError(
        `Failed to create barber: ${err.response?.data?.error || err.message}`
      );
    }
  };

  const handleSkillToggle = (skill) => {
    setNewBarber((prev) => ({
      ...prev,
      skills: prev.skills.includes(skill)
        ? prev.skills.filter((s) => s !== skill)
        : [...prev.skills, skill],
    }));
  };

  const toggleAvailability = async (barberId, currentStatus) => {
    try {
      await axios.put(`/api/salons/barbers/${barberId}`, {
        isAvailable: !currentStatus,
      });
      setBarbers(
        barbers.map((b) =>
          b._id === barberId ? { ...b, isAvailable: !currentStatus } : b
        )
      );
    } catch (err) {
      console.error("Toggle availability error:", err);
      setError("Failed to update barber status");
    }
  };

  // Show debug info while loading
  if (loading || !salonId) {
    return (
      <div className="max-w-6xl mx-auto p-6">
        <div className="mb-4 p-4 bg-blue-50 border border-blue-200 rounded">
          <h3 className="font-semibold text-blue-800 mb-2">
            Loading Barbers...
          </h3>
          <div className="text-sm space-y-1">
            <p>
              <strong>Salon ID:</strong> {salonId || "Loading..."}
            </p>
            <p>
              <strong>Loading:</strong> {loading.toString()}
            </p>
            <p>
              <strong>Error:</strong> {error || "None"}
            </p>
            <p>
              <strong>LocalStorage Keys:</strong>{" "}
              {typeof window !== "undefined"
                ? Object.keys(localStorage).join(", ")
                : "Not available"}
            </p>
            {typeof window !== "undefined" &&
              localStorage.getItem("salonSession") && (
                <p>
                  <strong>Session Data:</strong>{" "}
                  {localStorage.getItem("salonSession")}
                </p>
              )}
          </div>
        </div>
        {error && error.includes("No salon session") && (
          <div className="text-center py-8">
            <p className="text-red-600 mb-4">{error}</p>
            <button
              onClick={() => router.push("/auth/salon-login")}
              className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
            >
              Go to Login
            </button>
          </div>
        )}
      </div>
    );
  }

  return (
    <div className="max-w-6xl mx-auto p-6">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-3xl font-bold">Barber Management</h1>
        <button
          onClick={() => setShowForm(!showForm)}
          className="bg-amber-600 text-white px-4 py-2 rounded hover:bg-amber-700"
        >
          {showForm ? "Cancel" : "Add New Barber"}
        </button>
      </div>

      {error && <p className="text-red-500 mb-4">{error}</p>}

      {/* Add Barber Form */}
      {showForm && (
        <div className="mb-8 p-6 border rounded-lg shadow bg-gray-50">
          <h2 className="text-xl font-semibold mb-4">Add New Barber</h2>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <input
              type="text"
              placeholder="Barber Name"
              value={newBarber.name}
              onChange={(e) =>
                setNewBarber({ ...newBarber, name: e.target.value })
              }
              className="border rounded px-3 py-2 w-full"
            />
            <input
              type="number"
              placeholder="Years of Experience"
              value={newBarber.experience}
              onChange={(e) =>
                setNewBarber({
                  ...newBarber,
                  experience: parseInt(e.target.value) || 0,
                })
              }
              className="border rounded px-3 py-2 w-full"
            />
          </div>

          <div className="mb-4">
            <label className="block font-medium mb-2">
              Skills & Specializations
            </label>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
              {availableSkills.map((skill) => (
                <label key={skill} className="flex items-center">
                  <input
                    type="checkbox"
                    checked={newBarber.skills.includes(skill)}
                    onChange={() => handleSkillToggle(skill)}
                    className="mr-2"
                  />
                  {skill}
                </label>
              ))}
            </div>
          </div>

          <div className="mb-4">
            <label className="block font-medium mb-2">
              Bio/Accomplishments
            </label>
            <textarea
              placeholder="Describe achievements, awards, specialties..."
              value={newBarber.bio}
              onChange={(e) =>
                setNewBarber({ ...newBarber, bio: e.target.value })
              }
              rows={3}
              className="w-full border rounded px-3 py-2"
            />
          </div>

          <button
            onClick={handleCreate}
            className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
          >
            Add Barber
          </button>
        </div>
      )}

      {/* Barbers List */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {barbers.map((barber) => (
          <div
            key={barber._id}
            className="bg-white border rounded-lg shadow-md p-6"
          >
            <div className="flex justify-between items-start mb-4">
              <div>
                <h3 className="text-lg font-semibold">{barber.name}</h3>
                <p className="text-gray-600">
                  {barber.experience} years experience
                </p>
                <div className="flex items-center mt-1">
                  <span className="text-yellow-500">‚≠ê</span>
                  <span className="ml-1">{barber.rating}/5</span>
                  <span className="text-gray-500 ml-2">
                    ({barber.totalBookings} bookings)
                  </span>
                </div>
              </div>

              <button
                onClick={() =>
                  toggleAvailability(barber._id, barber.isAvailable)
                }
                className={`px-3 py-1 rounded text-sm ${
                  barber.isAvailable
                    ? "bg-green-100 text-green-800"
                    : "bg-red-100 text-red-800"
                }`}
              >
                {barber.isAvailable ? "Available" : "Unavailable"}
              </button>
            </div>

            {/* Skills */}
            <div className="mb-3">
              <p className="font-medium text-sm mb-2">Specializations:</p>
              <div className="flex flex-wrap gap-1">
                {barber.skills.map((skill) => (
                  <span
                    key={skill}
                    className="bg-amber-100 text-amber-800 px-2 py-1 rounded text-xs"
                  >
                    {skill}
                  </span>
                ))}
              </div>
            </div>

            {/* Bio */}
            {barber.bio && (
              <div className="mb-3">
                <p className="text-gray-700 text-sm">{barber.bio}</p>
              </div>
            )}

            <div className="flex gap-2 mt-4">
              <Link href={`/salons/barbers/${barber._id}`} className="flex-1">
                <button className="w-full bg-blue-600 text-white py-2 rounded text-sm hover:bg-blue-700">
                  Edit Details
                </button>
              </Link>
            </div>
          </div>
        ))}
      </div>

      {barbers.length === 0 && !loading && (
        <div className="text-center py-12">
          <p className="text-gray-500 mb-4">No barbers found for this salon.</p>
          <button
            onClick={() => setShowForm(true)}
            className="bg-amber-600 text-white px-6 py-3 rounded hover:bg-amber-700"
          >
            Add Your First Barber
          </button>
        </div>
      )}

      {/* Debug Info */}
      <div className="mt-8 p-4 bg-gray-100 rounded">
        <h3 className="font-semibold mb-2">Debug Info:</h3>
        <p>Salon ID: {salonId || "Not loaded"}</p>
        <p>Barbers Count: {barbers.length}</p>
        <p>Loading: {loading.toString()}</p>
        <p>Error: {error || "None"}</p>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/book.js">
// pages/salons/book.js
import { useRouter } from "next/router";
import { useState, useEffect } from "react";
import styles from "../../styles/Booking.module.css";
import Layout from "../../components/Layout";

export default function BookingPage() {
  const router = useRouter();
  const { salonId, serviceId, serviceName, price } = router.query;

  const [mobile, setMobile] = useState("");
  const [barbers, setBarbers] = useState([]);
  const [selectedBarber, setSelectedBarber] = useState("");
  const [selectedDate, setSelectedDate] = useState("");
  const [selectedSlot, setSelectedSlot] = useState("");
  const [slots, setSlots] = useState([]);
  const [userInfo, setUserInfo] = useState(null);

  useEffect(() => {
    // Get user info from session
    const sessionData = sessionStorage.getItem("userSession");
    if (sessionData) {
      const userData = JSON.parse(sessionData);
      setUserInfo(userData);
    }

    // Fetch barbers
    fetchBarbers();
  }, []);

  useEffect(() => {
    if (selectedBarber && selectedDate) {
      fetchAvailableSlots();
    }
  }, [selectedBarber, selectedDate]);

  const fetchBarbers = async () => {
    // Mock data - in production, fetch from API
    setBarbers([
      {
        id: "1",
        name: "Raj Kumar",
        rating: 4.5,
        specialization: "Hair Styling",
        bookings: 1250,
      },
      {
        id: "2",
        name: "Amit Singh",
        rating: 4.8,
        specialization: "Beard Expert",
        bookings: 980,
      },
      {
        id: "3",
        name: "Priya Sharma",
        rating: 4.7,
        specialization: "Color Specialist",
        bookings: 850,
      },
    ]);
  };

  const fetchAvailableSlots = async () => {
    // Generate time slots
    const allSlots = [];
    for (let hour = 9; hour < 21; hour++) {
      for (let min = 0; min < 60; min += 30) {
        const time = `${hour.toString().padStart(2, "0")}:${min
          .toString()
          .padStart(2, "0")}`;
        allSlots.push({
          time,
          available: Math.random() > 0.3, // Mock availability
          waitTime: Math.floor(Math.random() * 15),
        });
      }
    }
    setSlots(allSlots);
  };

  const handleBooking = async () => {
    if (!mobile || !selectedBarber || !selectedDate || !selectedSlot) {
      alert("Please fill all required fields");
      return;
    }

    const bookingData = {
      salonId,
      serviceId,
      barberId: selectedBarber,
      date: selectedDate,
      timeSlot: selectedSlot,
      userDetails: {
        name: userInfo?.name || "Guest",
        mobile,
        gender: userInfo?.gender || "other",
      },
    };

    try {
      const response = await fetch("/api/bookings/create", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(bookingData),
      });

      if (response.ok) {
        const result = await response.json();
        // Show success and redirect to confirmation
        alert("Booking Confirmed!");
        const bookingId = result?.booking?.id || result?.bookingId;
        if (bookingId) router.push(`/bookings?id=${bookingId}`);
        else router.push("/bookings");
      } else {
        alert("Booking failed. Please try again.");
      }
    } catch (error) {
      console.error("Booking error:", error);
      alert("Something went wrong. Please try again.");
    }
  };

  return (
    <Layout>
      <div className={styles.container}>
        <h1>Book Appointment</h1>
        <div className={styles.serviceInfo}>
          <h2>{serviceName}</h2>
          <span className={styles.price}>‚Çπ{price}</span>
        </div>

        <div className={styles.form}>
          <div className={styles.formGroup}>
            <label>üì± Mobile Number</label>
            <input
              type="tel"
              value={mobile}
              onChange={(e) => setMobile(e.target.value)}
              placeholder="Enter your mobile number"
              maxLength="10"
            />
          </div>

          <div className={styles.formGroup}>
            <label>üë®‚Äçü¶± Select Barber</label>
            <div className={styles.barberGrid}>
              {barbers.map((barber) => (
                <div
                  key={barber.id}
                  className={`${styles.barberCard} ${
                    selectedBarber === barber.id ? styles.selected : ""
                  }`}
                  onClick={() => setSelectedBarber(barber.id)}
                >
                  <div className={styles.barberInfo}>
                    <h3>{barber.name}</h3>
                    <p>
                      ‚≠ê {barber.rating} | {barber.specialization}
                    </p>
                    <p>{barber.bookings} bookings</p>
                  </div>
                </div>
              ))}
            </div>
          </div>

          <div className={styles.formGroup}>
            <label>üìÖ Select Date</label>
            <input
              type="date"
              value={selectedDate}
              onChange={(e) => setSelectedDate(e.target.value)}
              min={new Date().toISOString().split("T")[0]}
            />
          </div>

          {slots.length > 0 && (
            <div className={styles.formGroup}>
              <label>‚è∞ Select Time Slot</label>
              <div className={styles.slotGrid}>
                {slots.map((slot) => (
                  <button
                    key={slot.time}
                    className={`${styles.slotBtn} 
                      ${!slot.available ? styles.unavailable : ""} 
                      ${selectedSlot === slot.time ? styles.selected : ""}`}
                    onClick={() => slot.available && setSelectedSlot(slot.time)}
                    disabled={!slot.available}
                  >
                    {slot.time}
                    {slot.available && slot.waitTime > 0 && (
                      <span className={styles.waitTime}>
                        ~{slot.waitTime}min wait
                      </span>
                    )}
                  </button>
                ))}
              </div>
            </div>
          )}

          <div className={styles.userDetails}>
            <p>Booking for: {userInfo?.name || "Guest"}</p>
            <p>Gender: {userInfo?.gender || "Not specified"}</p>
          </div>

          <button className={styles.confirmBtn} onClick={handleBooking}>
            Confirm Booking
          </button>
        </div>
      </div>
    </Layout>
  );
}
</file>

<file path="src/pages/salons/bookings/[id].js">
// pages/salons/bookings/[id].jsx
import { useEffect, useState } from "react";
import { useRouter } from "next/router";

export default function BookingDetailPage() {
  const router = useRouter();
  const { id } = router.query;

  const [booking, setBooking] = useState(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [deleting, setDeleting] = useState(false);
  const [error, setError] = useState("");
  const [form, setForm] = useState({
    customerName: "",
    customerPhone: "",
    serviceId: "",
    appointmentAt: "",
    status: "",
  });

  // Fetch booking data
  useEffect(() => {
    if (!id) return;
    const fetchBooking = async () => {
      setLoading(true);
      try {
        const res = await fetch(`/api/salons/bookings/${id}`);
        if (!res.ok) throw new Error("Booking not found");
        const data = await res.json();
        setBooking(data);
        setForm({
          customerName: data.customerName || "",
          customerPhone: data.customerPhone || "",
          serviceId: data.serviceId || "",
          appointmentAt: data.appointmentAt
            ? new Date(data.appointmentAt).toISOString().slice(0, 16)
            : "",
          status: data.status || "pending",
        });
      } catch (err) {
        console.error(err);
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };
    fetchBooking();
  }, [id]);

  // Update booking
  const handleUpdate = async (e) => {
    e.preventDefault();
    setSaving(true);
    setError("");
    try {
      const res = await fetch(`/api/salons/bookings/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(form),
      });
      if (!res.ok) {
        const err = await res.json();
        throw new Error(err.error || "Update failed");
      }
      const updated = await res.json();
      setBooking(updated);
      alert("Booking updated successfully!");
    } catch (err) {
      console.error(err);
      setError(err.message);
    } finally {
      setSaving(false);
    }
  };

  // Delete booking
  const handleDelete = async () => {
    if (!confirm("Are you sure you want to delete this booking?")) return;
    setDeleting(true);
    setError("");
    try {
      const res = await fetch(`/api/salons/bookings/${id}`, {
        method: "DELETE",
      });
      if (!res.ok) throw new Error("Delete failed");
      alert("Booking deleted successfully!");
      router.push("/salons/bookings"); // redirect to booking list
    } catch (err) {
      console.error(err);
      setError(err.message);
    } finally {
      setDeleting(false);
    }
  };

  if (loading) return <p className="p-4">Loading booking...</p>;
  if (!booking)
    return <p className="p-4 text-red-500">{error || "Booking not found"}</p>;

  return (
    <div className="p-6 max-w-xl mx-auto space-y-6">
      <h1 className="text-2xl font-bold">Booking Details</h1>

      {error && <p className="text-red-500">{error}</p>}

      <form
        onSubmit={handleUpdate}
        className="grid gap-4 bg-white p-6 rounded shadow-md"
      >
        <div>
          <label className="block font-semibold">Customer Name</label>
          <input
            type="text"
            value={form.customerName}
            onChange={(e) => setForm({ ...form, customerName: e.target.value })}
            required
            className="w-full border rounded px-3 py-2"
          />
        </div>

        <div>
          <label className="block font-semibold">Customer Phone</label>
          <input
            type="text"
            value={form.customerPhone}
            onChange={(e) =>
              setForm({ ...form, customerPhone: e.target.value })
            }
            required
            className="w-full border rounded px-3 py-2"
          />
        </div>

        <div>
          <label className="block font-semibold">Service ID</label>
          <input
            type="text"
            value={form.serviceId}
            onChange={(e) => setForm({ ...form, serviceId: e.target.value })}
            required
            className="w-full border rounded px-3 py-2"
          />
        </div>

        <div>
          <label className="block font-semibold">Appointment Date & Time</label>
          <input
            type="datetime-local"
            value={form.appointmentAt}
            onChange={(e) =>
              setForm({ ...form, appointmentAt: e.target.value })
            }
            required
            className="w-full border rounded px-3 py-2"
          />
        </div>

        <div>
          <label className="block font-semibold">Status</label>
          <select
            value={form.status}
            onChange={(e) => setForm({ ...form, status: e.target.value })}
            className="w-full border rounded px-3 py-2"
          >
            <option value="pending">Pending</option>
            <option value="confirmed">Confirmed</option>
            <option value="completed">Completed</option>
            <option value="canceled">Canceled</option>
          </select>
        </div>

        <div className="flex justify-between items-center mt-4">
          <button
            type="submit"
            disabled={saving}
            className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50"
          >
            {saving ? "Saving..." : "Update Booking"}
          </button>
          <button
            type="button"
            onClick={handleDelete}
            disabled={deleting}
            className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 disabled:opacity-50"
          >
            {deleting ? "Deleting..." : "Delete Booking"}
          </button>
        </div>
      </form>

      <div className="bg-gray-50 p-4 rounded shadow">
        <h2 className="font-semibold mb-2">Current Booking Info:</h2>
        <pre className="text-sm">{JSON.stringify(booking, null, 2)}</pre>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/bookings/index.js">
// src/pages/salons/bookings/index.jsx
import { useEffect, useState } from "react";
import { useRouter } from "next/router";

export default function BookingsPage() {
  const router = useRouter();
  const { salonId } = router.query; // salonId passed via query param
  const [bookings, setBookings] = useState([]);
  const [loading, setLoading] = useState(false);
  const [form, setForm] = useState({
    customerName: "",
    customerPhone: "",
    serviceId: "",
    appointmentAt: "",
  });

  // fetch bookings
  useEffect(() => {
    if (!salonId) return;
    setLoading(true);
    fetch(`/api/salons/bookings?salonId=${salonId}`)
      .then((res) => res.json())
      .then((data) => {
        setBookings(data);
        setLoading(false);
      })
      .catch(() => setLoading(false));
  }, [salonId]);

  // submit booking
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!salonId) return alert("No salon selected");

    const res = await fetch(`/api/salons/bookings?salonId=${salonId}`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(form),
    });

    if (res.ok) {
      const newBooking = await res.json();
      setBookings((prev) => [...prev, newBooking]);
      setForm({
        customerName: "",
        customerPhone: "",
        serviceId: "",
        appointmentAt: "",
      });
    } else {
      const err = await res.json();
      alert(err.error || "Failed to create booking");
    }
  };

  return (
    <div style={{ padding: "2rem" }}>
      <h1>Bookings</h1>

      {/* Add Booking Form */}
      <form
        onSubmit={handleSubmit}
        style={{
          marginBottom: "2rem",
          display: "grid",
          gap: "0.5rem",
          maxWidth: "400px",
        }}
      >
        <input
          type="text"
          placeholder="Customer Name"
          value={form.customerName}
          onChange={(e) => setForm({ ...form, customerName: e.target.value })}
          required
        />
        <input
          type="text"
          placeholder="Customer Phone"
          value={form.customerPhone}
          onChange={(e) => setForm({ ...form, customerPhone: e.target.value })}
          required
        />
        <input
          type="text"
          placeholder="Service ID"
          value={form.serviceId}
          onChange={(e) => setForm({ ...form, serviceId: e.target.value })}
          required
        />
        <input
          type="datetime-local"
          value={form.appointmentAt}
          onChange={(e) => setForm({ ...form, appointmentAt: e.target.value })}
          required
        />
        <button type="submit">Add Booking</button>
      </form>

      {/* Booking List */}
      {loading ? (
        <p>Loading...</p>
      ) : bookings.length === 0 ? (
        <p>No bookings yet.</p>
      ) : (
        <table
          border="1"
          cellPadding="8"
          style={{ borderCollapse: "collapse" }}
        >
          <thead>
            <tr>
              <th>Customer</th>
              <th>Phone</th>
              <th>Service</th>
              <th>Appointment</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            {bookings.map((b) => (
              <tr key={b._id}>
                <td>{b.customerName}</td>
                <td>{b.customerPhone}</td>
                <td>{b.serviceId}</td>
                <td>{new Date(b.appointmentAt).toLocaleString()}</td>
                <td>{b.status || "pending"}</td>
              </tr>
            ))}
          </tbody>
        </table>
      )}
    </div>
  );
}
</file>

<file path="src/pages/salons/profile.js">
// pages/salons/profile.js
import { useEffect, useState } from "react";
import OwnerSidebar from "../../components/OwnerSidebar";

export default function SalonProfilePage() {
  const [salon, setSalon] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);

  useEffect(() => {
    async function fetchSalon() {
      try {
        const res = await fetch("/api/salons/profile");
        if (!res.ok) throw new Error("Failed to fetch salon profile");
        const data = await res.json();
        setSalon(data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }
    fetchSalon();
  }, []);

  return (
    <div className="flex">
      <OwnerSidebar />

      <main className="flex-1 p-6">
        <h1 className="text-3xl font-bold mb-6">Salon Profile</h1>

        {salon && (
          <div className="bg-white shadow rounded-lg p-6 space-y-4">
            <h2 className="text-2xl font-semibold">{salon.salonName}</h2>
            <p>
              <strong>Owner:</strong> {salon.ownerName}
            </p>
            <p>
              <strong>Email:</strong> {salon.email}
            </p>
            <p>
              <strong>Phone:</strong> {salon.phone}
            </p>
            <p>
              <strong>Status:</strong>{" "}
              {salon.isActive ? "‚úÖ Active" : "‚ùå Inactive"}
            </p>
            <p>
              <strong>Verified:</strong> {salon.isVerified ? "‚úÖ Yes" : "‚ùå No"}
            </p>
            <p>
              <strong>Amenities:</strong>{" "}
              {salon.amenities?.length
                ? salon.amenities.join(", ")
                : "Not listed"}
            </p>
            <p>
              <strong>Created At:</strong>{" "}
              {new Date(salon.createdAt).toLocaleString()}
            </p>
          </div>
        )}
      </main>
    </div>
  );
}
</file>

<file path="src/pages/salons/register.js">
// pages/salons/register.js
import React from "react";
import SalonRegisterForm from "../../components/Salon/SalonRegisterForm";

const SalonRegisterPage = () => {
  return (
    <div>
      <SalonRegisterForm />
    </div>
  );
};

export default SalonRegisterPage;
</file>

<file path="src/pages/salons/services/[id].js">
// pages/salons/services/[id].jsx
import { useRouter } from "next/router";
import { useEffect, useState } from "react";
import axios from "axios";

export default function ServicePage() {
  const router = useRouter();
  const { id } = router.query;

  const [service, setService] = useState(null);
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [error, setError] = useState("");

  // Fetch the service by ID
  useEffect(() => {
    if (!id) return;

    const fetchService = async () => {
      setLoading(true);
      try {
        const res = await axios.get(`/api/salons/services/${id}`);
        setService(res.data);
        setError("");
      } catch (err) {
        console.error(err);
        setError("Failed to fetch service");
      }
      setLoading(false);
    };

    fetchService();
  }, [id]); // ‚úÖ only depends on `id`

  // Handle form changes
  const handleChange = (e) => {
    const { name, value } = e.target;
    setService({ ...service, [name]: value });
  };

  // Save updated service
  const handleSave = async () => {
    if (!service) return;
    setSaving(true);
    try {
      const res = await axios.put(`/api/salons/services/${id}`, service);
      setService(res.data);
      setError("");
      alert("Service updated successfully!");
    } catch (err) {
      console.error(err);
      setError("Failed to update service");
    }
    setSaving(false);
  };

  // Delete service
  const handleDelete = async () => {
    if (!window.confirm("Are you sure you want to delete this service?"))
      return;
    try {
      await axios.delete(`/api/salons/services/${id}`);
      alert("Service deleted successfully!");
      router.push("/salons/services"); // Redirect after deletion
    } catch (err) {
      console.error(err);
      setError("Failed to delete service");
    }
  };

  if (loading) return <p>Loading service...</p>;
  if (!service) return <p>No service found.</p>;

  return (
    <div className="max-w-2xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-4">Edit Service</h1>
      {error && <p className="text-red-500 mb-4">{error}</p>}

      <div className="mb-4">
        <label className="block font-medium">Name:</label>
        <input
          type="text"
          name="name"
          value={service.name || ""}
          onChange={handleChange}
          className="w-full border rounded px-3 py-2 mt-1"
        />
      </div>

      <div className="mb-4">
        <label className="block font-medium">Description:</label>
        <textarea
          name="description"
          value={service.description || ""}
          onChange={handleChange}
          className="w-full border rounded px-3 py-2 mt-1"
        />
      </div>

      <div className="mb-4">
        <label className="block font-medium">Price:</label>
        <input
          type="number"
          name="price"
          value={service.price || 0}
          onChange={handleChange}
          className="w-full border rounded px-3 py-2 mt-1"
        />
      </div>

      <div className="flex gap-4">
        <button
          onClick={handleSave}
          disabled={saving}
          className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >
          {saving ? "Saving..." : "Save Changes"}
        </button>
        <button
          onClick={handleDelete}
          className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
        >
          Delete Service
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/services/index.js">
// pages/salons/[salonId]/services.jsx
import { useEffect, useState } from "react";
import { useRouter } from "next/router";
import axios from "axios";
import Link from "next/link";

export default function SalonServicesPage() {
  const router = useRouter();
  const { salonId } = router.query;

  const [services, setServices] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");
  const [newService, setNewService] = useState({
    title: "",
    description: "",
    price: 0,
  });
  const [creating, setCreating] = useState(false);

  // Fetch services
  useEffect(() => {
    if (!salonId) return;

    const fetchServices = async () => {
      setLoading(true);
      try {
        const res = await axios.get(`/api/salons/services?salonId=${salonId}`);
        setServices(res.data);
        setError("");
      } catch (err) {
        console.error(err);
        setError("Failed to fetch services");
      }
      setLoading(false);
    };

    fetchServices();
  }, [salonId]);

  // Handle input changes
  const handleChange = (e) => {
    const { name, value } = e.target;
    setNewService({ ...newService, [name]: value });
  };

  // Create new service
  const handleCreate = async () => {
    if (!newService.title) return alert("Title is required");
    setCreating(true);
    try {
      const res = await axios.post("/api/salons/services", {
        ...newService,
        salonId,
      });
      setServices([...services, res.data]);
      setNewService({ title: "", description: "", price: 0 });
      setError("");
    } catch (err) {
      console.error(err);
      setError("Failed to create service");
    }
    setCreating(false);
  };

  if (loading) return <p className="p-6">Loading services...</p>;

  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">Services for Salon {salonId}</h1>

      {error && <p className="text-red-500 mb-4">{error}</p>}

      {/* New Service Form */}
      <div className="mb-8 p-4 border rounded shadow">
        <h2 className="text-xl font-semibold mb-2">Add New Service</h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <input
            type="text"
            name="title"
            placeholder="Title"
            value={newService.title}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="number"
            name="price"
            placeholder="Price"
            value={newService.price}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="text"
            name="description"
            placeholder="Description"
            value={newService.description}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
        </div>
        <button
          onClick={handleCreate}
          disabled={creating}
          className="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
        >
          {creating ? "Creating..." : "Add Service"}
        </button>
      </div>

      {/* Services List */}
      <div>
        <h2 className="text-xl font-semibold mb-2">Existing Services</h2>
        {services.length === 0 ? (
          <p>No services yet.</p>
        ) : (
          <div className="overflow-x-auto">
            <table className="min-w-full border rounded">
              <thead className="bg-gray-100">
                <tr>
                  <th className="px-4 py-2 border">Title</th>
                  <th className="px-4 py-2 border">Description</th>
                  <th className="px-4 py-2 border">Price</th>
                  <th className="px-4 py-2 border">Actions</th>
                </tr>
              </thead>
              <tbody>
                {services.map((s) => (
                  <tr key={s._id} className="hover:bg-gray-50">
                    <td className="px-4 py-2 border">{s.title}</td>
                    <td className="px-4 py-2 border">{s.description}</td>
                    <td className="px-4 py-2 border">{s.price}</td>
                    <td className="px-4 py-2 border">
                      <Link
                        href={`/salons/services/${s._id}`}
                        className="text-blue-600 hover:underline mr-3"
                      >
                        Edit
                      </Link>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salons/staff/[id].js">
// pages/salons/staff/[id].js
import { useRouter } from "next/router";
import { useEffect, useState } from "react";

export default function StaffPage() {
  const router = useRouter();
  const { id } = router.query;

  const [staff, setStaff] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!id) return;
    const fetchStaff = async () => {
      try {
        const res = await fetch(`/api/salons/staff/${id}`);
        if (!res.ok) throw new Error("Failed to fetch staff");
        const data = await res.json();
        setStaff(data);
      } catch (err) {
        console.error(err);
      } finally {
        setLoading(false);
      }
    };
    fetchStaff();
  }, [id]);

  if (loading) return <p>Loading...</p>;
  if (!staff) return <p>Staff not found</p>;

  return (
    <div>
      <h1>{staff.name}</h1>
      <p>Email: {staff.email}</p>
      <p>Role: {staff.role}</p>
    </div>
  );
}
</file>

<file path="src/pages/salons/staff/index.js">
// pages/salons/[salonId]/staff.jsx
import { useEffect, useState } from "react";
import { useRouter } from "next/router";
import axios from "axios";
import Link from "next/link";

export default function SalonStaffPage() {
  const router = useRouter();
  const { salonId } = router.query;

  const [staffList, setStaffList] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState("");
  const [newStaff, setNewStaff] = useState({
    name: "",
    email: "",
    phone: "",
    role: "",
  });
  const [creating, setCreating] = useState(false);

  // Fetch staff
  useEffect(() => {
    if (!salonId) return;

    const fetchStaff = async () => {
      setLoading(true);
      try {
        const res = await axios.get(`/api/salons/staff?salonId=${salonId}`);
        setStaffList(res.data);
        setError("");
      } catch (err) {
        console.error(err);
        setError("Failed to fetch staff");
      }
      setLoading(false);
    };

    fetchStaff();
  }, [salonId]);

  // Handle input changes
  const handleChange = (e) => {
    const { name, value } = e.target;
    setNewStaff({ ...newStaff, [name]: value });
  };

  // Create new staff
  const handleCreate = async () => {
    if (!newStaff.name) return alert("Name is required");
    setCreating(true);
    try {
      const res = await axios.post("/api/salons/staff", {
        ...newStaff,
        salonId,
      });
      setStaffList([...staffList, res.data]);
      setNewStaff({ name: "", email: "", phone: "", role: "" });
      setError("");
    } catch (err) {
      console.error(err);
      setError("Failed to create staff");
    }
    setCreating(false);
  };

  if (loading) return <p className="p-6">Loading staff...</p>;

  return (
    <div className="max-w-4xl mx-auto p-6">
      <h1 className="text-3xl font-bold mb-6">Staff for Salon {salonId}</h1>

      {error && <p className="text-red-500 mb-4">{error}</p>}

      {/* New Staff Form */}
      <div className="mb-8 p-4 border rounded shadow">
        <h2 className="text-xl font-semibold mb-2">Add New Staff</h2>
        <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
          <input
            type="text"
            name="name"
            placeholder="Name"
            value={newStaff.name}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="email"
            name="email"
            placeholder="Email"
            value={newStaff.email}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="text"
            name="phone"
            placeholder="Phone"
            value={newStaff.phone}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
          <input
            type="text"
            name="role"
            placeholder="Role"
            value={newStaff.role}
            onChange={handleChange}
            className="border rounded px-3 py-2 w-full"
          />
        </div>
        <button
          onClick={handleCreate}
          disabled={creating}
          className="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
        >
          {creating ? "Adding..." : "Add Staff"}
        </button>
      </div>

      {/* Staff List */}
      <div>
        <h2 className="text-xl font-semibold mb-2">Existing Staff</h2>
        {staffList.length === 0 ? (
          <p>No staff yet.</p>
        ) : (
          <div className="overflow-x-auto">
            <table className="min-w-full border rounded">
              <thead className="bg-gray-100">
                <tr>
                  <th className="px-4 py-2 border">Name</th>
                  <th className="px-4 py-2 border">Email</th>
                  <th className="px-4 py-2 border">Phone</th>
                  <th className="px-4 py-2 border">Role</th>
                  <th className="px-4 py-2 border">Actions</th>
                </tr>
              </thead>
              <tbody>
                {staffList.map((st) => (
                  <tr key={st._id} className="hover:bg-gray-50">
                    <td className="px-4 py-2 border">{st.name}</td>
                    <td className="px-4 py-2 border">{st.email}</td>
                    <td className="px-4 py-2 border">{st.phone}</td>
                    <td className="px-4 py-2 border">{st.role}</td>
                    <td className="px-4 py-2 border">
                      <Link
                        href={`/salons/staff/${st._id}`}
                        className="text-blue-600 hover:underline"
                      >
                        Edit
                      </Link>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/pages/styles/globals.css">
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  /* Light Mode Colors */
  --gold-primary: #d4af37;
  --gold-dark: #b8941f;
  --gold-light: #f5e99b;
  --contrast-dark: #1a1a1a;
  --contrast-medium: #333333;
  --contrast-light: #666666;
  --background-primary: #ffffff;
  --background-secondary: #f8f8f8;
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --border-color: #e5e5e5;
  --success: #22c55e;
  --error: #ef4444;
  --warning: #f59e0b;

  /* Dark Mode Colors */
  --dark-gold-primary: #ffd700;
  --dark-gold-dark: #e6c200;
  --dark-gold-light: #fff4b3;
  --dark-contrast-dark: #ffffff;
  --dark-contrast-medium: #cccccc;
  --dark-contrast-light: #999999;
  --dark-background-primary: #121212;
  --dark-background-secondary: #1e1e1e;
  --dark-text-primary: #ffffff;
  --dark-text-secondary: #cccccc;
  --dark-border-color: #333333;
}

[data-theme="dark"] {
  --gold-primary: var(--dark-gold-primary);
  --gold-dark: var(--dark-gold-dark);
  --gold-light: var(--dark-gold-light);
  --contrast-dark: var(--dark-contrast-dark);
  --contrast-medium: var(--dark-contrast-medium);
  --contrast-light: var(--dark-contrast-light);
  --background-primary: var(--dark-background-primary);
  --background-secondary: var(--dark-background-secondary);
  --text-primary: var(--dark-text-primary);
  --text-secondary: var(--dark-text-secondary);
  --border-color: var(--dark-border-color);
}

html,
body {
  font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
    sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--background-primary);
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Luxury scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--background-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--gold-primary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--gold-dark);
}

/* Common button styles */
.btn {
  padding: 12px 24px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.btn-secondary {
  background: transparent;
  color: var(--text-primary);
  border: 2px solid var(--border-color);
}

.btn-secondary:hover {
  border-color: var(--gold-primary);
  color: var(--gold-primary);
}

/* Form styles */
.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--text-primary);
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background-color: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
}

.form-select {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background-color: var(--background-primary);
  color: var(--text-primary);
  cursor: pointer;
}

/* Card styles */
.card {
  background: var(--background-primary);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

/* Animation keyframes */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes shimmer {
  0% {
    background-position: -200px 0;
  }
  100% {
    background-position: calc(200px + 100%) 0;
  }
}

.animate-fadeIn {
  animation: fadeIn 0.6s ease-out;
}

.animate-slideIn {
  animation: slideIn 0.6s ease-out;
}

/* Luxury gold gradient text */
.gold-gradient-text {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Loading spinner */
.spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--border-color);
  border-top: 3px solid var(--gold-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .btn {
    width: 100%;
    padding: 14px 20px;
  }

  .card {
    padding: 20px;
    margin-bottom: 16px;
  }

  .form-input,
  .form-select {
    font-size: 18px; /* Prevents zoom on iOS */
  }
}
</file>

<file path="src/pages/styles/Home.module.css">
.container {
  min-height: 100vh;
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
}

.loadingContainer {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--border-color);
  border-top: 4px solid var(--gold-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

/* Header */
.header {
  background: var(--background-primary);
  border-bottom: 1px solid var(--border-color);
  padding: 16px 0;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
}

.headerContent {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
}

.goldText {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.headerActions {
  display: flex;
  align-items: center;
  gap: 16px;
}

.themeToggle {
  padding: 8px;
  border: none;
  background: transparent;
  border-radius: 8px;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.3s ease;
}

.themeToggle:hover {
  background: var(--background-secondary);
}

.ownerButton {
  padding: 10px 20px;
  background: transparent;
  color: var(--gold-primary);
  border: 2px solid var(--gold-primary);
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.ownerButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.loginButton {
  padding: 10px 20px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.loginButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

/* Welcome Section */
.welcomeSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px 40px;
  text-align: center;
}

.welcomeContent {
  margin-bottom: 40px;
}

.welcomeTitle {
  font-size: 48px;
  font-weight: 700;
  margin-bottom: 16px;
  color: var(--text-primary);
  line-height: 1.2;
}

.welcomeSubtitle {
  font-size: 18px;
  color: var(--text-secondary);
  margin-bottom: 0;
}

.quickStats {
  display: flex;
  justify-content: center;
  gap: 60px;
  margin-top: 40px;
}

.stat {
  text-align: center;
}

.statNumber {
  display: block;
  font-size: 32px;
  font-weight: 700;
  color: var(--gold-primary);
  margin-bottom: 4px;
}

.statLabel {
  font-size: 14px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Search Section */
.searchSection {
  max-width: 800px;
  margin: 0 auto;
  padding: 0 20px 40px;
}

.searchContainer {
  text-align: center;
}

.searchBox {
  position: relative;
  margin-bottom: 24px;
}

.searchInput {
  width: 100%;
  padding: 16px 60px 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: 50px;
  font-size: 16px;
  background: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.searchInput:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
}

.searchButton {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 44px;
  height: 44px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 18px;
  transition: all 0.3s ease;
}

.searchButton:hover {
  transform: translateY(-50%) scale(1.05);
}

.quickFilters {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}

.filterChip {
  padding: 8px 16px;
  background: var(--background-primary);
  border: 2px solid var(--border-color);
  border-radius: 25px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.filterChip:hover {
  border-color: var(--gold-primary);
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

/* Services Section */
.servicesSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px;
}

.sectionTitle {
  font-size: 32px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 40px;
  color: var(--text-primary);
}

.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 24px;
}

.serviceCard {
  background: var(--background-primary);
  border-radius: 16px;
  padding: 32px 24px;
  text-align: center;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  cursor: pointer;
}

.serviceCard:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  border-color: var(--gold-primary);
}

.serviceIcon {
  font-size: 48px;
  margin-bottom: 16px;
}

.serviceName {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.servicePrice {
  font-size: 24px;
  font-weight: 700;
  color: var(--gold-primary);
  margin-bottom: 4px;
}

.serviceDuration {
  font-size: 14px;
  color: var(--text-secondary);
}

/* Salons Section */
.salonsSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px;
}

.sectionHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
}

.viewAllButton {
  padding: 10px 20px;
  background: transparent;
  color: var(--gold-primary);
  border: 2px solid var(--gold-primary);
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.viewAllButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.salonsCarousel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
}

.salonCard {
  background: var(--background-primary);
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  cursor: pointer;
}

.salonCard:hover {
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  border-color: var(--gold-primary);
}

.salonImage {
  position: relative;
  height: 200px;
  overflow: hidden;
}

.salonImage img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.salonCard:hover .salonImage img {
  transform: scale(1.05);
}

.salonBadge {
  position: absolute;
  top: 12px;
  right: 12px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.salonInfo {
  padding: 20px;
}

.salonName {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
  color: var(--text-primary);
}

.salonLocation {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 12px;
}

.salonStats {
  display: flex;
  gap: 16px;
  margin-bottom: 16px;
}

.rating,
.bookings {
  font-size: 14px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 4px;
}

.rating {
  color: var(--gold-primary);
  font-weight: 600;
}

.salonServices {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
}

.serviceTag {
  background: var(--background-secondary);
  color: var(--text-secondary);
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  white-space: nowrap;
}

.bookButton {
  width: 100%;
  padding: 12px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.bookButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

/* Footer */
.footer {
  background: var(--contrast-dark);
  color: var(--background-primary);
  padding: 60px 0 20px;
  margin-top: 80px;
}

.footerContent {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 40px;
}

.footerSection h4 {
  color: var(--gold-primary);
  font-size: 24px;
  margin-bottom: 16px;
}

.footerSection h5 {
  color: var(--background-primary);
  font-size: 18px;
  margin-bottom: 12px;
}

.footerSection ul {
  list-style: none;
  padding: 0;
}

.footerSection ul li {
  margin-bottom: 8px;
}

.footerSection ul li a {
  color: var(--contrast-light);
  text-decoration: none;
  transition: color 0.3s ease;
}

.footerSection ul li a:hover {
  color: var(--gold-primary);
}

.footerBottom {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  text-align: center;
  border-top: 1px solid var(--contrast-medium);
  margin-top: 40px;
}

.loadingSalons {
  text-align: center;
  padding: 60px 20px;
}

.loadingSalons p {
  margin-top: 16px;
  color: var(--text-secondary);
}

.noSalons {
  text-align: center;
  padding: 60px 20px;
  background: var(--background-secondary);
  border-radius: 16px;
}

.noSalons p {
  color: var(--text-secondary);
  font-size: 16px;
  margin-bottom: 24px;
}

.registerSalonButton {
  padding: 12px 24px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.registerSalonButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.distanceBadge {
  position: absolute;
  top: 12px;
  left: 12px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 10px;
  font-weight: 600;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
  .headerContent {
    padding: 0 16px;
  }

  .headerActions {
    gap: 8px;
  }

  .ownerButton,
  .loginButton {
    padding: 8px 12px;
    font-size: 14px;
  }

  .welcomeTitle {
    font-size: 32px;
  }

  .quickStats {
    gap: 30px;
  }

  .statNumber {
    font-size: 24px;
  }

  .servicesGrid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
  }

  .serviceCard {
    padding: 24px 16px;
  }

  .salonsCarousel {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .sectionHeader {
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }

  .footerContent {
    grid-template-columns: 1fr;
    gap: 30px;
    text-align: center;
  }
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
</file>

<file path="src/pages/styles/Onboarding.module.css">
.container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  position: relative;
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
}

.background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: 0;
}

.goldOrb {
  position: absolute;
  border-radius: 50%;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  opacity: 0.1;
  filter: blur(60px);
}

.goldOrb:first-child {
  width: 300px;
  height: 300px;
  top: -150px;
  right: -150px;
  animation: float 8s ease-in-out infinite;
}

.goldOrb:last-child {
  width: 200px;
  height: 200px;
  bottom: -100px;
  left: -100px;
  animation: float 8s ease-in-out infinite reverse;
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-20px) rotate(180deg);
  }
}

.onboardingCard {
  background: var(--background-primary);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
  padding: 40px;
  width: 100%;
  max-width: 500px;
  position: relative;
  z-index: 1;
  border: 1px solid var(--border-color);
}

.header {
  text-align: center;
  margin-bottom: 40px;
}

.title {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.goldText {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.subtitle {
  color: var(--text-secondary);
  font-size: 16px;
  margin-bottom: 30px;
}

.progressBar {
  display: flex;
  align-items: center;
  gap: 12px;
}

.progressTrack {
  flex: 1;
  height: 6px;
  background: var(--border-color);
  border-radius: 3px;
  overflow: hidden;
}

.progressFill {
  height: 100%;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  border-radius: 3px;
  transition: width 0.3s ease;
}

.progressText {
  font-size: 14px;
  font-weight: 600;
  color: var(--gold-primary);
  min-width: 30px;
}

.stepContent {
  min-height: 300px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.step {
  text-align: center;
}

.stepIcon {
  font-size: 64px;
  margin-bottom: 24px;
}

.step h2 {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text-primary);
}

.step p {
  color: var(--text-secondary);
  margin-bottom: 32px;
  line-height: 1.5;
}

.formGroup {
  margin-bottom: 24px;
}

.input {
  width: 100%;
  padding: 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  font-size: 16px;
  background: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
  text-align: center;
}

.input:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
}

.genderOptions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 16px;
  margin-bottom: 20px;
}

.genderButton {
  padding: 20px 16px;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  background: var(--background-primary);
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.genderButton:hover {
  border-color: var(--gold-primary);
  transform: translateY(-2px);
}

.genderButton.selected {
  border-color: var(--gold-primary);
  background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
  color: var(--contrast-dark);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3);
}

.genderIcon {
  font-size: 32px;
}

.genderButton span {
  font-weight: 600;
  font-size: 14px;
}

.locationSection {
  margin-bottom: 20px;
}

.locationButton {
  width: 100%;
  padding: 16px 20px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 20px;
}

.locationButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.divider {
  text-align: center;
  margin: 20px 0;
  position: relative;
}

.divider::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--border-color);
}

.divider span {
  background: var(--background-primary);
  padding: 0 16px;
  color: var(--text-secondary);
  font-size: 14px;
  position: relative;
  z-index: 1;
}

.loadingLocation {
  text-align: center;
  padding: 40px 20px;
}

.loadingLocation p {
  margin-top: 16px;
  color: var(--text-secondary);
}

.locationSuccess {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  background: rgba(34, 197, 94, 0.1);
  border: 2px solid var(--success);
  border-radius: 12px;
}

.locationIcon {
  font-size: 24px;
}

.locationSuccess div {
  flex: 1;
}

.locationSuccess h4 {
  color: var(--success);
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 4px;
}

.locationSuccess p {
  color: var(--text-secondary);
  font-size: 14px;
  margin: 0;
}

.changeLocationButton {
  padding: 8px 16px;
  background: transparent;
  color: var(--gold-primary);
  border: 1px solid var(--gold-primary);
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.changeLocationButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.locationError {
  text-align: center;
}

.locationError p {
  color: var(--error);
  margin-bottom: 16px;
}

.navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 40px;
  gap: 16px;
}

.backButton {
  padding: 12px 24px;
  background: transparent;
  color: var(--text-secondary);
  border: 2px solid var(--border-color);
  border-radius: 12px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.backButton:hover {
  border-color: var(--gold-primary);
  color: var(--gold-primary);
}

.nextButton {
  flex: 1;
  padding: 14px 28px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.nextButton:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.nextButton:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Mobile Optimizations */
@media (max-width: 768px) {
  .container {
    padding: 16px;
  }

  .onboardingCard {
    padding: 24px;
    border-radius: 16px;
  }

  .title {
    font-size: 28px;
  }

  .step h2 {
    font-size: 20px;
  }

  .stepIcon {
    font-size: 48px;
  }

  .genderOptions {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .genderButton {
    flex-direction: row;
    justify-content: flex-start;
    padding: 16px 20px;
  }

  .navigation {
    flex-direction: column;
    gap: 12px;
  }

  .backButton {
    width: 100%;
    order: 2;
  }

  .nextButton {
    order: 1;
  }
}
</file>

<file path="src/pages/styles/Owner.module.css">
.dashboard {
  display: flex;
  min-height: 100vh;
  background: #f5f7fa;
}

.content {
  flex: 1;
  padding: 30px;
  margin-left: 250px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.header h1 {
  font-size: 2rem;
  color: #333;
}

.date {
  color: #666;
  font-size: 1.1rem;
}

.statsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
  margin-bottom: 40px;
}

.statCard {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.statCard h3 {
  color: #666;
  font-size: 0.95rem;
  margin-bottom: 10px;
  font-weight: normal;
}

.statNumber {
  font-size: 2.5rem;
  font-weight: bold;
  color: #333;
  margin-bottom: 10px;
}

.statSubtext {
  color: #999;
  font-size: 0.9rem;
}

.upcomingSection,
.notifications,
.quickActions {
  background: white;
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 25px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.appointmentList {
  margin-top: 20px;
}

.appointmentCard {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  margin-bottom: 12px;
}

.appointmentCard:hover {
  background: #f8f9fa;
}

.time {
  font-weight: bold;
  color: #667eea;
  font-size: 1.1rem;
  min-width: 80px;
}

.customerInfo {
  flex: 1;
  margin-left: 20px;
}

.customerInfo strong {
  display: block;
  margin-bottom: 5px;
}

.customerInfo span {
  color: #666;
  font-size: 0.9rem;
}

.barber {
  color: #999;
  font-size: 0.9rem;
  margin-right: 15px;
}

.actionBtn {
  background: #667eea;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 0.9rem;
}

.actionGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.actionButton {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 10px;
  font-size: 1rem;
  transition: transform 0.2s;
}

.actionButton:hover {
  transform: scale(1.05);
}

.notificationList {
  margin-top: 20px;
}

.notification {
  display: flex;
  align-items: start;
  padding: 15px;
  border-bottom: 1px solid #e0e0e0;
}

.notification:last-child {
  border-bottom: none;
}

.notifIcon {
  font-size: 1.5rem;
  margin-right: 15px;
}

.notifContent {
  flex: 1;
}

.notifContent strong {
  display: block;
  margin-bottom: 5px;
}

.notifContent p {
  color: #666;
  font-size: 0.9rem;
  margin-bottom: 5px;
}

.notifTime {
  color: #999;
  font-size: 0.85rem;
}

/* Forms */
.formOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.formModal {
  background: white;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
}

.formGroup {
  margin-bottom: 20px;
}

.formGroup label {
  display: block;
  margin-bottom: 8px;
  color: #333;
  font-weight: 500;
}

.formGroup input,
.formGroup textarea,
.formGroup select {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
}

.formRow {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
}

.formActions {
  display: flex;
  gap: 15px;
  margin-top: 25px;
}

.saveBtn {
  flex: 1;
  padding: 12px;
  background: #667eea;
  color: white;
  border-radius: 6px;
  font-size: 1rem;
}

.cancelBtn {
  flex: 1;
  padding: 12px;
  background: #e0e0e0;
  color: #333;
  border-radius: 6px;
  font-size: 1rem;
}

.addButton {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 1rem;
}

/* Services */
.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.serviceCard {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.serviceHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.genderBadge {
  background: #f0f0f0;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  color: #666;
}

.serviceDesc {
  color: #666;
  margin-bottom: 15px;
  min-height: 40px;
}

.serviceDetails {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
  padding-top: 15px;
  border-top: 1px solid #f0f0f0;
}

.serviceActions {
  display: flex;
  gap: 10px;
}

.editBtn,
.deleteBtn {
  flex: 1;
  padding: 8px;
  border-radius: 6px;
  font-size: 0.9rem;
}

.editBtn {
  background: #f0f0f0;
  color: #333;
}

.deleteBtn {
  background: #fee;
  color: #c00;
}

.packagesSection {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.addPackageBtn {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  margin-top: 15px;
}

.packageList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.packageCard {
  border: 2px solid #667eea;
  border-radius: 10px;
  padding: 20px;
  background: linear-gradient(
    135deg,
    rgba(102, 126, 234, 0.1) 0%,
    rgba(118, 75, 162, 0.1) 100%
  );
}

.packagePrice {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 15px;
}

.originalPrice {
  text-decoration: line-through;
  color: #999;
}

.discountPrice {
  font-size: 1.5rem;
  font-weight: bold;
  color: #667eea;
}
</file>

<file path="src/styles/Auth.module.css">
.container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.loginCard {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 400px;
}

.loginCard h1 {
  text-align: center;
  margin-bottom: 1.5rem;
  color: #333;
}

.loginCard form {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.loginCard input {
  padding: 12px;
  border: 2px solid #e1e5e9;
  border-radius: 8px;
  font-size: 16px;
}

.loginCard input:focus {
  outline: none;
  border-color: #667eea;
}

.loginCard button {
  background: #667eea;
  color: white;
  border: none;
  padding: 12px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s;
}

.loginCard button:hover:not(:disabled) {
  background: #5a6fd8;
}

.loginCard button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.loginCard p {
  text-align: center;
  margin-top: 1rem;
}

.loginCard a {
  color: #667eea;
  cursor: pointer;
  text-decoration: underline;
}
</file>

<file path="src/styles/Booking.module.css">
/* styles/Booking.module.css - replace broken CSS with this clear, modular style set */

/* Overlay for modal */
.modalOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.45);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

/* Modal content */
.modalContent {
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  min-width: 320px;
  max-width: 560px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
}

/* Buttons */
.confirmButton {
  background: #0b76ef;
  color: #fff;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}
.cancelButton {
  background: #eee;
  color: #333;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}
.bookNowButton {
  background: #0b76ef;
  color: #fff;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  cursor: pointer;
}

/* Time slots grid */
.timeSlotsWrapper {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}

/* Each slot */
.timeSlot {
  border: 1px solid #ddd;
  padding: 8px 10px;
  border-radius: 6px;
  margin: 4px;
  cursor: pointer;
  min-width: 90px;
  text-align: center;
  user-select: none;
  transition: transform 0.12s ease, box-shadow 0.12s ease;
  background: #fff;
}

/* Hover effect */
.timeSlot:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.06);
}

/* Disabled / unavailable slot */
.timeSlot.disabled {
  opacity: 0.5;
  pointer-events: none;
  transform: none;
  box-shadow: none;
}

/* Selected slot */
.timeSlot.selected {
  border-color: #0b76ef;
  background: rgba(11, 118, 239, 0.08);
  color: #0b76ef;
  font-weight: 600;
}
</file>

<file path="src/styles/globals.css">
@import "tailwindcss";
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

:root {
  /* Light Mode Colors */
  --gold-primary: #d4af37;
  --gold-dark: #b8941f;
  --gold-light: #f5e99b;
  --contrast-dark: #1a1a1a;
  --contrast-medium: #333333;
  --contrast-light: #666666;
  --background-primary: #ffffff;
  --background-secondary: #f8f8f8;
  --text-primary: #1a1a1a;
  --text-secondary: #666666;
  --border-color: #e5e5e5;
  --success: #22c55e;
  --error: #ef4444;
  --warning: #f59e0b;

  /* Dark Mode Colors */
  --dark-gold-primary: #ffd700;
  --dark-gold-dark: #e6c200;
  --dark-gold-light: #fff4b3;
  --dark-contrast-dark: #ffffff;
  --dark-contrast-medium: #cccccc;
  --dark-contrast-light: #999999;
  --dark-background-primary: #121212;
  --dark-background-secondary: #1e1e1e;
  --dark-text-primary: #ffffff;
  --dark-text-secondary: #cccccc;
  --dark-border-color: #333333;

  /* Spacing Scale */
  --space-xs: 0.5rem;
  --space-sm: 0.75rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
  --space-3xl: 4rem;
  --space-4xl: 6rem;

  /* Border Radius */
  --radius-sm: 0.5rem;
  --radius-md: 0.75rem;
  --radius-lg: 1rem;
  --radius-xl: 1.5rem;

  /* Shadows */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
    0 4px 6px -4px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1),
    0 8px 10px -6px rgb(0 0 0 / 0.1);
}

[data-theme="dark"] {
  --gold-primary: var(--dark-gold-primary);
  --gold-dark: var(--dark-gold-dark);
  --gold-light: var(--dark-gold-light);
  --contrast-dark: var(--dark-contrast-dark);
  --contrast-medium: var(--dark-contrast-medium);
  --contrast-light: var(--dark-contrast-light);
  --background-primary: var(--dark-background-primary);
  --background-secondary: var(--dark-background-secondary);
  --text-primary: var(--dark-text-primary);
  --text-secondary: var(--dark-text-secondary);
  --border-color: var(--dark-border-color);
}

html,
body {
  font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
    sans-serif;
  line-height: 1.6;
  color: var(--text-primary);
  background-color: var(--background-primary);
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Luxury scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--background-secondary);
}

::-webkit-scrollbar-thumb {
  background: var(--gold-primary);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--gold-dark);
}

/* Common button styles */
.btn {
  padding: 12px 24px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 16px;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  text-decoration: none;
}

.btn-primary {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.btn-secondary {
  background: transparent;
  color: var(--text-primary);
  border: 2px solid var(--border-color);
}

.btn-secondary:hover {
  border-color: var(--gold-primary);
  color: var(--gold-primary);
}

/* Form styles */
.form-group {
  margin-bottom: 20px;
}

.form-label {
  display: block;
  margin-bottom: 8px;
  font-weight: 500;
  color: var(--text-primary);
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background-color: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
}

.form-select {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  font-size: 16px;
  background-color: var(--background-primary);
  color: var(--text-primary);
  cursor: pointer;
}

/* Card styles */
.card {
  background: var(--background-primary);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
}

/* Animation keyframes */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes shimmer {
  0% {
    background-position: -200px 0;
  }
  100% {
    background-position: calc(200px + 100%) 0;
  }
}

.animate-fadeIn {
  animation: fadeIn 0.6s ease-out;
}

.animate-slideIn {
  animation: slideIn 0.6s ease-out;
}

/* Luxury gold gradient text */
.gold-gradient-text {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

/* Loading spinner */
.spinner {
  width: 24px;
  height: 24px;
  border: 3px solid var(--border-color);
  border-top: 3px solid var(--gold-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Mobile optimizations */
@media (max-width: 768px) {
  .btn {
    width: 100%;
    padding: 14px 20px;
  }

  .card {
    padding: 20px;
    margin-bottom: 16px;
  }

  .form-input,
  .form-select {
    font-size: 18px; /* Prevents zoom on iOS */
  }
}
</file>

<file path="src/styles/Home.module.css">
.container {
  min-height: 100vh;
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
}

.loadingContainer {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 20px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--border-color);
  border-top: 4px solid var(--gold-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

/* Header */
.header {
  background: var(--background-primary);
  border-bottom: 1px solid var(--border-color);
  padding: 16px 0;
  position: sticky;
  top: 0;
  z-index: 100;
  backdrop-filter: blur(10px);
}

.headerContent {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 28px;
  font-weight: 700;
  color: var(--text-primary);
}

.goldText {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  background-clip: text;
}

.headerActions {
  display: flex;
  align-items: center;
  gap: 16px;
}

.themeToggle {
  padding: 8px;
  border: none;
  background: transparent;
  border-radius: 8px;
  cursor: pointer;
  font-size: 20px;
  transition: all 0.3s ease;
}

.themeToggle:hover {
  background: var(--background-secondary);
}

.ownerButton {
  padding: 10px 20px;
  background: transparent;
  color: var(--gold-primary);
  border: 2px solid var(--gold-primary);
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.ownerButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.loginButton {
  padding: 10px 20px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.loginButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

/* Welcome Section */
.welcomeSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px 40px;
  text-align: center;
}

.welcomeContent {
  margin-bottom: 40px;
}

.welcomeTitle {
  font-size: 48px;
  font-weight: 700;
  margin-bottom: 16px;
  color: var(--text-primary);
  line-height: 1.2;
}

.welcomeSubtitle {
  font-size: 18px;
  color: var(--text-secondary);
  margin-bottom: 0;
}

.quickStats {
  display: flex;
  justify-content: center;
  gap: 60px;
  margin-top: 40px;
}

.stat {
  text-align: center;
}

.statNumber {
  display: block;
  font-size: 32px;
  font-weight: 700;
  color: var(--gold-primary);
  margin-bottom: 4px;
}

.statLabel {
  font-size: 14px;
  color: var(--text-secondary);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Search Section */
.searchSection {
  max-width: 800px;
  margin: 0 auto;
  padding: 0 20px 40px;
}

.searchContainer {
  text-align: center;
}

.searchBox {
  position: relative;
  margin-bottom: 24px;
}

.searchInput {
  width: 100%;
  padding: 16px 60px 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: 50px;
  font-size: 16px;
  background: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
}

.searchInput:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
}

.searchButton {
  position: absolute;
  right: 8px;
  top: 50%;
  transform: translateY(-50%);
  width: 44px;
  height: 44px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 18px;
  transition: all 0.3s ease;
}

.searchButton:hover {
  transform: translateY(-50%) scale(1.05);
}

.quickFilters {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}

.filterChip {
  padding: 8px 16px;
  background: var(--background-primary);
  border: 2px solid var(--border-color);
  border-radius: 25px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.filterChip:hover {
  border-color: var(--gold-primary);
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

/* Services Section */
.servicesSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px;
}

.sectionTitle {
  font-size: 32px;
  font-weight: 700;
  text-align: center;
  margin-bottom: 40px;
  color: var(--text-primary);
}

.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 24px;
}

.serviceCard {
  background: var(--background-primary);
  border-radius: 16px;
  padding: 32px 24px;
  text-align: center;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  cursor: pointer;
}

.serviceCard:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  border-color: var(--gold-primary);
}

.serviceIcon {
  font-size: 48px;
  margin-bottom: 16px;
}

.serviceName {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.servicePrice {
  font-size: 24px;
  font-weight: 700;
  color: var(--gold-primary);
  margin-bottom: 4px;
}

.serviceDuration {
  font-size: 14px;
  color: var(--text-secondary);
}

/* Salons Section */
.salonsSection {
  max-width: 1200px;
  margin: 0 auto;
  padding: 60px 20px;
}

.sectionHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
}
.viewOptions {
  display: flex;
  gap: 8px;
}

.viewToggle {
  padding: 8px 16px;
  border: 2px solid #f59e0b;
  background: transparent;
  color: #f59e0b;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.viewToggle:hover {
  background: #f59e0b;
  color: white;
  transform: translateY(-2px);
}

.viewToggle.active {
  background: #f59e0b;
  color: white;
  box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
}

.mapLoading {
  height: 600px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
  border-radius: 20px;
  font-size: 18px;
  color: #6b7280;
}
.viewAllButton {
  padding: 10px 20px;
  background: transparent;
  color: var(--gold-primary);
  border: 2px solid var(--gold-primary);
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.viewAllButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.salonsCarousel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
  gap: 24px;
}

.salonCard {
  background: var(--background-primary);
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
  cursor: pointer;
}

.salonCard:hover {
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  border-color: var(--gold-primary);
}

.salonImage {
  position: relative;
  height: 200px;
  overflow: hidden;
}

.salonImage img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.salonCard:hover .salonImage img {
  transform: scale(1.05);
}

.salonBadge {
  position: absolute;
  top: 12px;
  right: 12px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.salonInfo {
  padding: 20px;
}

.salonName {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 4px;
  color: var(--text-primary);
}

.salonLocation {
  color: var(--text-secondary);
  font-size: 14px;
  margin-bottom: 12px;
}

.salonStats {
  display: flex;
  gap: 16px;
  margin-bottom: 16px;
}

.rating,
.bookings {
  font-size: 14px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 4px;
}

.rating {
  color: var(--gold-primary);
  font-weight: 600;
}

.salonServices {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 20px;
}

.serviceTag {
  background: var(--background-secondary);
  color: var(--text-secondary);
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  white-space: nowrap;
}

.bookButton {
  width: 100%;
  padding: 12px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.bookButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

/* Footer */
.footer {
  background: var(--contrast-dark);
  color: var(--background-primary);
  padding: 60px 0 20px;
  margin-top: 80px;
}

.footerContent {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 20px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 40px;
}

.footerSection h4 {
  color: var(--gold-primary);
  font-size: 24px;
  margin-bottom: 16px;
}

.footerSection h5 {
  color: var(--background-primary);
  font-size: 18px;
  margin-bottom: 12px;
}

.footerSection ul {
  list-style: none;
  padding: 0;
}

.footerSection ul li {
  margin-bottom: 8px;
}

.footerSection ul li a {
  color: var(--contrast-light);
  text-decoration: none;
  transition: color 0.3s ease;
}

.footerSection ul li a:hover {
  color: var(--gold-primary);
}

.footerBottom {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  text-align: center;
  border-top: 1px solid var(--contrast-medium);
  margin-top: 40px;
}

.loadingSalons {
  text-align: center;
  padding: 60px 20px;
}

.loadingSalons p {
  margin-top: 16px;
  color: var(--text-secondary);
}

.noSalons {
  text-align: center;
  padding: 60px 20px;
  background: var(--background-secondary);
  border-radius: 16px;
}

.noSalons p {
  color: var(--text-secondary);
  font-size: 16px;
  margin-bottom: 24px;
}

.registerSalonButton {
  padding: 12px 24px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
}

.registerSalonButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.distanceBadge {
  position: absolute;
  top: 12px;
  left: 12px;
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 10px;
  font-weight: 600;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
  .headerContent {
    padding: 0 16px;
  }

  .headerActions {
    gap: 8px;
  }

  .ownerButton,
  .loginButton {
    padding: 8px 12px;
    font-size: 14px;
  }

  .welcomeTitle {
    font-size: 32px;
  }

  .quickStats {
    gap: 30px;
  }

  .statNumber {
    font-size: 24px;
  }

  .servicesGrid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
  }

  .serviceCard {
    padding: 24px 16px;
  }

  .salonsCarousel {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .sectionHeader {
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }

  .footerContent {
    grid-template-columns: 1fr;
    gap: 30px;
    text-align: center;
  }
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
</file>

<file path="src/styles/Onboarding.module.css">
.container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  position: relative;
  background: linear-gradient(
    135deg,
    var(--background-primary) 0%,
    var(--background-secondary) 100%
  );
}

.background {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
  z-index: 0;
}

.goldOrb {
  position: absolute;
  border-radius: 50%;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  opacity: 0.1;
  filter: blur(60px);
}

.goldOrb:first-child {
  width: 300px;
  height: 300px;
  top: -150px;
  right: -150px;
  animation: float 8s ease-in-out infinite;
}

.goldOrb:last-child {
  width: 200px;
  height: 200px;
  bottom: -100px;
  left: -100px;
  animation: float 8s ease-in-out infinite reverse;
}

@keyframes float {
  0%,
  100% {
    transform: translateY(0px) rotate(0deg);
  }
  50% {
    transform: translateY(-20px) rotate(180deg);
  }
}

.onboardingCard {
  background: var(--background-primary);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
  padding: 40px;
  width: 100%;
  max-width: 500px;
  position: relative;
  z-index: 1;
  border: 1px solid var(--border-color);
}

.header {
  text-align: center;
  margin-bottom: 40px;
}

.title {
  font-size: 32px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--text-primary);
}

.goldText {
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.subtitle {
  color: var(--text-secondary);
  font-size: 16px;
  margin-bottom: 30px;
}

.progressBar {
  display: flex;
  align-items: center;
  gap: 12px;
}

.progressTrack {
  flex: 1;
  height: 6px;
  background: var(--border-color);
  border-radius: 3px;
  overflow: hidden;
}

.progressFill {
  height: 100%;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  border-radius: 3px;
  transition: width 0.3s ease;
}

.progressText {
  font-size: 14px;
  font-weight: 600;
  color: var(--gold-primary);
  min-width: 30px;
}

.stepContent {
  min-height: 300px;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.step {
  text-align: center;
}

.stepIcon {
  font-size: 64px;
  margin-bottom: 24px;
}

.step h2 {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 12px;
  color: var(--text-primary);
}

.step p {
  color: var(--text-secondary);
  margin-bottom: 32px;
  line-height: 1.5;
}

.formGroup {
  margin-bottom: 24px;
}

.input {
  width: 100%;
  padding: 16px 20px;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  font-size: 16px;
  background: var(--background-primary);
  color: var(--text-primary);
  transition: all 0.3s ease;
  text-align: center;
}

.input:focus {
  outline: none;
  border-color: var(--gold-primary);
  box-shadow: 0 0 0 4px rgba(212, 175, 55, 0.1);
}

.genderOptions {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 16px;
  margin-bottom: 20px;
}

.genderButton {
  padding: 20px 16px;
  border: 2px solid var(--border-color);
  border-radius: 12px;
  background: var(--background-primary);
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
}

.genderButton:hover {
  border-color: var(--gold-primary);
  transform: translateY(-2px);
}

.genderButton.selected {
  border-color: var(--gold-primary);
  background: linear-gradient(135deg, var(--gold-primary), var(--gold-dark));
  color: var(--contrast-dark);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3);
}

.genderIcon {
  font-size: 32px;
}

.genderButton span {
  font-weight: 600;
  font-size: 14px;
}

.locationSection {
  margin-bottom: 20px;
}

.locationButton {
  width: 100%;
  padding: 16px 20px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-bottom: 20px;
}

.locationButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.divider {
  text-align: center;
  margin: 20px 0;
  position: relative;
}

.divider::before {
  content: "";
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 1px;
  background: var(--border-color);
}

.divider span {
  background: var(--background-primary);
  padding: 0 16px;
  color: var(--text-secondary);
  font-size: 14px;
  position: relative;
  z-index: 1;
}

.loadingLocation {
  text-align: center;
  padding: 40px 20px;
}

.loadingLocation p {
  margin-top: 16px;
  color: var(--text-secondary);
}

.locationSuccess {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 16px;
  background: rgba(34, 197, 94, 0.1);
  border: 2px solid var(--success);
  border-radius: 12px;
}

.locationIcon {
  font-size: 24px;
}

.locationSuccess div {
  flex: 1;
}

.locationSuccess h4 {
  color: var(--success);
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 4px;
}

.locationSuccess p {
  color: var(--text-secondary);
  font-size: 14px;
  margin: 0;
}

.changeLocationButton {
  padding: 8px 16px;
  background: transparent;
  color: var(--gold-primary);
  border: 1px solid var(--gold-primary);
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.changeLocationButton:hover {
  background: var(--gold-primary);
  color: var(--contrast-dark);
}

.locationError {
  text-align: center;
}

.locationError p {
  color: var(--error);
  margin-bottom: 16px;
}

.navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 40px;
  gap: 16px;
}

.backButton {
  padding: 12px 24px;
  background: transparent;
  color: var(--text-secondary);
  border: 2px solid var(--border-color);
  border-radius: 12px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.backButton:hover {
  border-color: var(--gold-primary);
  color: var(--gold-primary);
}

.nextButton {
  flex: 1;
  padding: 14px 28px;
  background: linear-gradient(
    135deg,
    var(--gold-primary) 0%,
    var(--gold-dark) 100%
  );
  color: var(--contrast-dark);
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.nextButton:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
}

.nextButton:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top: 2px solid currentColor;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

/* Mobile Optimizations */
@media (max-width: 768px) {
  .container {
    padding: 16px;
  }

  .onboardingCard {
    padding: 24px;
    border-radius: 16px;
  }

  .title {
    font-size: 28px;
  }

  .step h2 {
    font-size: 20px;
  }

  .stepIcon {
    font-size: 48px;
  }

  .genderOptions {
    grid-template-columns: 1fr;
    gap: 12px;
  }

  .genderButton {
    flex-direction: row;
    justify-content: flex-start;
    padding: 16px 20px;
  }

  .navigation {
    flex-direction: column;
    gap: 12px;
  }

  .backButton {
    width: 100%;
    order: 2;
  }

  .nextButton {
    order: 1;
  }
}
</file>

<file path="src/styles/Owner.module.css">
.dashboard {
  display: flex;
  min-height: 100vh;
  background: #f5f7fa;
}

.content {
  flex: 1;
  padding: 30px;
  margin-left: 250px;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
}

.header h1 {
  font-size: 2rem;
  color: #333;
}

.date {
  color: #666;
  font-size: 1.1rem;
}

.statsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 25px;
  margin-bottom: 40px;
}

.statCard {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.statCard h3 {
  color: #666;
  font-size: 0.95rem;
  margin-bottom: 10px;
  font-weight: normal;
}

.statNumber {
  font-size: 2.5rem;
  font-weight: bold;
  color: #333;
  margin-bottom: 10px;
}

.statSubtext {
  color: #999;
  font-size: 0.9rem;
}

.upcomingSection,
.notifications,
.quickActions {
  background: white;
  padding: 25px;
  border-radius: 12px;
  margin-bottom: 25px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.appointmentList {
  margin-top: 20px;
}

.appointmentCard {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 15px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  margin-bottom: 12px;
}

.appointmentCard:hover {
  background: #f8f9fa;
}

.time {
  font-weight: bold;
  color: #667eea;
  font-size: 1.1rem;
  min-width: 80px;
}

.customerInfo {
  flex: 1;
  margin-left: 20px;
}

.customerInfo strong {
  display: block;
  margin-bottom: 5px;
}

.customerInfo span {
  color: #666;
  font-size: 0.9rem;
}

.barber {
  color: #999;
  font-size: 0.9rem;
  margin-right: 15px;
}

.actionBtn {
  background: #667eea;
  color: white;
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 0.9rem;
}

.actionGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

.actionButton {
  padding: 20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-radius: 10px;
  font-size: 1rem;
  transition: transform 0.2s;
}

.actionButton:hover {
  transform: scale(1.05);
}

.notificationList {
  margin-top: 20px;
}

.notification {
  display: flex;
  align-items: start;
  padding: 15px;
  border-bottom: 1px solid #e0e0e0;
}

.notification:last-child {
  border-bottom: none;
}

.notifIcon {
  font-size: 1.5rem;
  margin-right: 15px;
}

.notifContent {
  flex: 1;
}

.notifContent strong {
  display: block;
  margin-bottom: 5px;
}

.notifContent p {
  color: #666;
  font-size: 0.9rem;
  margin-bottom: 5px;
}

.notifTime {
  color: #999;
  font-size: 0.85rem;
}

/* Forms */
.formOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.formModal {
  background: white;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
}

.formGroup {
  margin-bottom: 20px;
}

.formGroup label {
  display: block;
  margin-bottom: 8px;
  color: #333;
  font-weight: 500;
}

.formGroup input,
.formGroup textarea,
.formGroup select {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 1rem;
}

.formRow {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 15px;
}

.formActions {
  display: flex;
  gap: 15px;
  margin-top: 25px;
}

.saveBtn {
  flex: 1;
  padding: 12px;
  background: #667eea;
  color: white;
  border-radius: 6px;
  font-size: 1rem;
}

.cancelBtn {
  flex: 1;
  padding: 12px;
  background: #e0e0e0;
  color: #333;
  border-radius: 6px;
  font-size: 1rem;
}

.addButton {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  font-size: 1rem;
}

/* Services */
.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
  margin-bottom: 40px;
}

.serviceCard {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
}

.serviceHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.genderBadge {
  background: #f0f0f0;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  color: #666;
}

.serviceDesc {
  color: #666;
  margin-bottom: 15px;
  min-height: 40px;
}

.serviceDetails {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
  padding-top: 15px;
  border-top: 1px solid #f0f0f0;
}

.serviceActions {
  display: flex;
  gap: 10px;
}

.editBtn,
.deleteBtn {
  flex: 1;
  padding: 8px;
  border-radius: 6px;
  font-size: 0.9rem;
}

.editBtn {
  background: #f0f0f0;
  color: #333;
}

.deleteBtn {
  background: #fee;
  color: #c00;
}

.packagesSection {
  background: white;
  padding: 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
}

.addPackageBtn {
  background: #667eea;
  color: white;
  padding: 10px 20px;
  border-radius: 6px;
  margin-top: 15px;
}

.packageList {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
  margin-top: 20px;
}

.packageCard {
  border: 2px solid #667eea;
  border-radius: 10px;
  padding: 20px;
  background: linear-gradient(
    135deg,
    rgba(102, 126, 234, 0.1) 0%,
    rgba(118, 75, 162, 0.1) 100%
  );
}

.packagePrice {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 15px;
}

.originalPrice {
  text-decoration: line-through;
  color: #999;
}

.discountPrice {
  font-size: 1.5rem;
  font-weight: bold;
  color: #667eea;
}
</file>

<file path="src/styles/SalonDetails.module.css">
.container {
  min-height: 100vh;
  background: linear-gradient(135deg, #fef3c7, #fed7aa);
}

.header {
  display: flex;
  align-items: center;
  padding: 20px;
  background: white;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  position: sticky;
  top: 0;
  z-index: 100;
}

.backBtn {
  background: #f59e0b;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  margin-right: 20px;
}

.heroSection {
  position: relative;
  padding: 40px 20px;
}

.imageGallery {
  width: 100%;
  max-width: 1200px;
  margin: 0 auto 30px;
  border-radius: 20px;
  overflow: hidden;
}

.heroImage {
  width: 100%;
  height: 400px;
  object-fit: cover;
}

.heroContent {
  max-width: 1200px;
  margin: 0 auto;
}

.salonInfo {
  background: white;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.salonName {
  font-size: 32px;
  font-weight: 700;
  color: #1f2937;
  margin: 0 0 10px;
}

.address {
  color: #6b7280;
  font-size: 16px;
  margin: 0 0 20px;
}

.badges {
  display: flex;
  gap: 10px;
  margin-bottom: 20px;
}

.badge {
  background: #f59e0b;
  color: white;
  padding: 6px 12px;
  border-radius: 12px;
  font-size: 14px;
  font-weight: 600;
}

.stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

.stat {
  text-align: center;
  padding: 20px;
  background: #fef3c7;
  border-radius: 12px;
}

.statNumber {
  display: block;
  font-size: 24px;
  font-weight: 700;
  color: #d97706;
  margin-bottom: 5px;
}

.statLabel {
  font-size: 14px;
  color: #92400e;
}

.actionButtons {
  display: flex;
  gap: 15px;
}

.bookButton {
  flex: 1;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  border: none;
  padding: 15px 30px;
  border-radius: 12px;
  font-size: 18px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.bookButton:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
}

.directionsButton {
  background: white;
  color: #f59e0b;
  border: 2px solid #f59e0b;
  padding: 15px 20px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.directionsButton:hover {
  background: #f59e0b;
  color: white;
}

.servicesSection {
  padding: 40px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.servicesSection h2 {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 30px;
  text-align: center;
}

.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}

.serviceCard {
  background: white;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  cursor: pointer;
  transition: all 0.3s;
  display: flex;
  align-items: center;
  gap: 15px;
}

.serviceCard:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.serviceIcon {
  font-size: 32px;
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #fef3c7;
  border-radius: 12px;
}

.serviceDetails h3 {
  font-size: 18px;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 5px;
}

.serviceDetails p {
  color: #6b7280;
  font-size: 14px;
  margin: 0 0 10px;
}

.serviceMeta {
  display: flex;
  gap: 15px;
}

.price {
  font-size: 16px;
  font-weight: 700;
  color: #f59e0b;
}

.duration {
  font-size: 14px;
  color: #6b7280;
}

.locationSection {
  padding: 40px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.locationSection h2 {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 20px;
  text-align: center;
}

.reviewsSection {
  padding: 40px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.reviewsSection h2 {
  font-size: 28px;
  font-weight: 700;
  color: #1f2937;
  margin-bottom: 30px;
  text-align: center;
}

.reviewsList {
  display: grid;
  gap: 20px;
}

.reviewCard {
  background: white;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.reviewHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
}

.userName {
  font-weight: 600;
  color: #1f2937;
}

.rating {
  color: #f59e0b;
  font-weight: 600;
}

.reviewComment {
  color: #4b5563;
  margin: 10px 0;
  line-height: 1.6;
}

.reviewMeta {
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  color: #6b7280;
}

.noReviews {
  text-align: center;
  color: #6b7280;
  font-style: italic;
  padding: 40px;
}

.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.bookingModal {
  background: white;
  padding: 30px;
  border-radius: 20px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  position: relative;
  max-height: 90vh;
  overflow-y: auto;
  animation: fadeInScale 0.3s ease-out;
}
@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.closeModalBtn {
  position: absolute;
  top: 15px;
  right: 15px;
  background: #f59e0b;
  color: white;
  border: none;
  width: 30px;
  height: 30px;
  border-radius: 50%;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}
.closeModalBtn:hover {
  background: #d97706;
}
.mapContainer {
  position: relative;
  height: 600px;
  margin-top: 40px;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  max-width: 1200px;
  margin-left: auto;
  margin-right: auto;
  background: white;
  padding: 20px;
  box-sizing: border-box;
  margin-bottom: 60px;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  border: 2px solid #f3f4f6;
  background: #f9fafb;
  border-radius: 20px;
}
</file>

<file path="package.json">
{
  "name": "techtrims",
  "version": "0.1.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start ",
    "lint": "eslint . ",
    "seed": "node scripts/seed.js"
  },
  "dependencies": {
    "bcryptjs": "^2.4.3",
    "cookie": "^1.0.2",
    "dotenv": "^17.2.2",
    "framer-motion": "^12.23.16",
    "jsonwebtoken": "^9.0.2",
    "leaflet": "^1.9.4",
    "mongodb": "^6.20.0",
    "mongoose": "^7.5.0",
    "next": "^14.2.32",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-leaflet": "^4.2.1",
    "swr": "^2.1.0",
    "uuid": "^9.0.0",
    "validator": "^13.9.0"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@tailwindcss/postcss": "^4.1.13",
    "@types/react": "^19.1.13",
    "autoprefixer": "^10.4.21",
    "eslint": "^9",
    "eslint-config-next": "15.5.3",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.13",
    "typescript": "^5.9.2"
  }
}
</file>

<file path="src/components/Maps/LocationMap.js">
// techtrims/src/components/Maps/LocationMap.js
import React, { useEffect, useState } from "react";
import {
  MapContainer,
  TileLayer,
  Marker,
  Popup,
  Polyline,
} from "react-leaflet";
import L from "leaflet";
import "leaflet/dist/leaflet.css";
import styles from "../../styles/LocationMap.module.css";

// Fix for default markers
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",
  iconUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",
  shadowUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
});

// Custom icons
const salonIcon = new L.Icon({
  iconUrl:
    "data:image/svg+xml;base64," +
    btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f59e0b" width="35" height="35">
      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
    </svg>
  `),
  iconSize: [35, 35],
  iconAnchor: [17.5, 35],
  popupAnchor: [0, -35],
});

const userIcon = new L.Icon({
  iconUrl:
    "data:image/svg+xml;base64," +
    btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#3b82f6" width="25" height="25">
      <circle cx="12" cy="12" r="8" stroke="#fff" stroke-width="2"/>
      <circle cx="12" cy="12" r="4"/>
    </svg>
  `),
  iconSize: [25, 25],
  iconAnchor: [12.5, 12.5],
});

const LocationMap = ({ salonLocation, userLocation, salonName, address }) => {
  const [routeCoordinates, setRouteCoordinates] = useState([]);
  const [distance, setDistance] = useState(null);
  const [duration, setDuration] = useState(null);
  const [loading, setLoading] = useState(false);

  const center = salonLocation || [19.076, 72.8777];

  const calculateDirectRoute = useCallback(() => {
    if (userLocation && salonLocation) {
      const route = [
        [userLocation.lat, userLocation.lng],
        [salonLocation[0], salonLocation[1]],
      ];
      setRouteCoordinates(route);

      const R = 6371;
      const dLat = ((salonLocation[0] - userLocation.lat) * Math.PI) / 180;
      const dLon = ((salonLocation[1] - userLocation.lng) * Math.PI) / 180;
      const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos((userLocation.lat * Math.PI) / 180) *
          Math.cos((salonLocation[0] * Math.PI) / 180) *
          Math.sin(dLon / 2) *
          Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      const dist = R * c;

      setDistance(dist.toFixed(1));
      setDuration(Math.round(dist * 3));
    }
  }, [userLocation, salonLocation]);

  const getAdvancedDirections = async () => {
    if (!userLocation || !salonLocation) return;

    setLoading(true);
    try {
      // Using OpenRouteService for routing (free alternative to Google)
      const response = await fetch(
        `https://api.openrouteservice.org/v2/directions/driving-car?api_key=YOUR_API_KEY&start=${userLocation.lng},${userLocation.lat}&end=${salonLocation[1]},${salonLocation[0]}`
      );

      if (response.ok) {
        const data = await response.json();
        const coordinates = data.features[0].geometry.coordinates.map(
          (coord) => [coord[1], coord[0]]
        );
        setRouteCoordinates(coordinates);

        const route = data.features[0].properties.segments[0];
        setDistance((route.distance / 1000).toFixed(1));
        setDuration(Math.round(route.duration / 60));
      } else {
        // Fallback to direct route
        calculateDirectRoute();
      }
    } catch (error) {
      console.log("Advanced routing failed, using direct route");
      calculateDirectRoute();
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    if (userLocation && salonLocation) {
      calculateDirectRoute();
    }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [calculateDirectRoute]);

  // In SalonMap.js or LocationMap.js
  const openInGoogleMaps = () => {
    if (salonLocation) {
      const [salonLat, salonLng] = salonLocation;
      let url;

      if (userLocation) {
        // Directions from user location to salon
        url = `https://www.google.com/maps/dir/${userLocation.lat},${userLocation.lng}/${salonLat},${salonLng}`;
      } else {
        // Just show salon location
        url = `https://www.google.com/maps/search/?api=1&query=${salonLat},${salonLng}`;
      }

      // Use location.href instead of window.open for better mobile compatibility
      window.location.href = url;
    }
  };

  return (
    <div className={styles.mapContainer}>
      <div className={styles.mapHeader}>
        <div className={styles.mapInfo}>
          <h3>{salonName}</h3>
          <p>{address}</p>
          {distance && (
            <div className={styles.routeInfo}>
              <span>üìç {distance} km</span>
              {duration && <span>üïê ~{duration} min</span>}
            </div>
          )}
        </div>
        <div className={styles.mapActions}>
          <button className={styles.directionsBtn} onClick={openInGoogleMaps}>
            Get Directions
          </button>
          {userLocation && (
            <button
              className={styles.routeBtn}
              onClick={getAdvancedDirections}
              disabled={loading}
            >
              {loading ? "Loading..." : "Show Route"}
            </button>
          )}
        </div>
      </div>

      <MapContainer
        center={center}
        zoom={userLocation ? 13 : 15}
        className={styles.map}
      >
        <TileLayer
          url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        />

        {/* Salon marker */}
        {salonLocation && (
          <Marker position={salonLocation} icon={salonIcon}>
            <Popup>
              <div className={styles.popupContent}>
                <strong>{salonName}</strong>
                <p>{address}</p>
                <button onClick={openInGoogleMaps} className={styles.popupBtn}>
                  Get Directions
                </button>
              </div>
            </Popup>
          </Marker>
        )}

        {/* User location marker */}
        {userLocation && (
          <Marker
            position={[userLocation.lat, userLocation.lng]}
            icon={userIcon}
          >
            <Popup>
              <div className={styles.popupContent}>
                <strong>Your Location</strong>
              </div>
            </Popup>
          </Marker>
        )}

        {/* Route polyline */}
        {routeCoordinates.length > 0 && (
          <Polyline
            positions={routeCoordinates}
            color="#f59e0b"
            weight={4}
            opacity={0.7}
            dashArray="10, 10"
          />
        )}
      </MapContainer>
    </div>
  );
};

export default LocationMap;
</file>

<file path="src/components/Maps/LocationPicker.js">
// components/Maps/LocationPicker.js - Leaflet location picker
import React, { useState, useEffect, useRef } from "react";
import {
  MapContainer,
  TileLayer,
  Marker,
  Popup,
  useMapEvents,
} from "react-leaflet";
import { MapPin, Search, Navigation } from "lucide-react";
import { geocodeAddress, reverseGeocode } from "../../lib/maps";

// Fix for Leaflet icons in Next.js
import L from "leaflet";
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",
  iconUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",
  shadowUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png",
});

// Custom marker icon for salons
const salonIcon = new L.Icon({
  iconUrl:
    "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTIuNSAxNi41QzIuNSAxNi41IDYuNSAxMi41IDEyIDEyLjVTMjEuNSAxNi41IDIxLjUgMTYuNSIgc3Ryb2tlPSIjRjU5RTBCIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8cGF0aCBkPSJNMTIgMjJWMTIuNSIgc3Ryb2tlPSIjRjU5RTBCIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K",
  iconSize: [32, 32],
  iconAnchor: [16, 32],
  popupAnchor: [0, -32],
});

function LocationMarker({ position, setPosition, setAddress, isDarkMode }) {
  const map = useMapEvents({
    click(e) {
      const newPos = [e.latlng.lat, e.latlng.lng];
      setPosition(newPos);

      // Get address for the clicked position
      reverseGeocode(e.latlng.lat, e.latlng.lng)
        .then((address) => setAddress(address))
        .catch(console.error);
    },
  });

  return position ? (
    <Marker position={position}>
      <Popup>
        <div
          className={`p-2 ${isDarkMode ? "text-gray-800" : "text-gray-900"}`}
        >
          üìç Selected Location
        </div>
      </Popup>
    </Marker>
  ) : null;
}

const LocationPicker = ({
  onLocationSelect = () => {
    console.log("Location selected");
  },
  initialPosition = [19.076, 72.8777], // Mumbai center
  isDarkMode = false,
}) => {
  const [position, setPosition] = useState(initialPosition);
  const [address, setAddress] = useState("");
  const [searchQuery, setSearchQuery] = useState("");
  const [loading, setLoading] = useState(false);
  const mapRef = useRef();

  const handleSearch = async () => {
    if (!searchQuery.trim()) return;

    setLoading(true);
    try {
      const result = await geocodeAddress(searchQuery);
      const newPos = [result.coordinates[1], result.coordinates[0]]; // lat, lng for Leaflet
      setPosition(newPos);
      setAddress(result.formattedAddress);

      // Fly to the new position
      if (mapRef.current) {
        mapRef.current.flyTo(newPos, 15);
      }
    } catch (error) {
      alert("Location not found. Please try a different search term.");
    } finally {
      setLoading(false);
    }
  };

  const getCurrentLocation = () => {
    if (navigator.geolocation) {
      setLoading(true);
      navigator.geolocation.getCurrentPosition(
        async (pos) => {
          const newPos = [pos.coords.latitude, pos.coords.longitude];
          setPosition(newPos);

          try {
            const address = await reverseGeocode(
              pos.coords.latitude,
              pos.coords.longitude
            );
            setAddress(address);
          } catch (error) {
            console.error("Error getting address:", error);
          }

          if (mapRef.current) {
            mapRef.current.flyTo(newPos, 15);
          }
          setLoading(false);
        },
        (error) => {
          console.error("Geolocation error:", error);
          alert("Unable to get your location");
          setLoading(false);
        }
      );
    }
  };

  const handleConfirm = () => {
    if (position && address && onLocationSelect) {
      console.log("Confirming location:", {
        lat: position[0],
        lng: position[1],
        address: address,
      });
      onLocationSelect({
        lat: position[0],
        lng: position[1],
        address: address,
      });
    } else {
      console.log("Missing data:", { position, address, onLocationSelect });
    }
  };

  return (
    <div className="space-y-4">
      {/* Search Controls */}
      <div className="space-y-3">
        <div className="flex space-x-2">
          <div className="flex-1 relative">
            <Search
              className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                isDarkMode ? "text-gray-400" : "text-gray-500"
              }`}
            />
            <input
              type="text"
              placeholder="Search for an address..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              onKeyPress={(e) => e.key === "Enter" && handleSearch()}
              className={`w-full pl-10 pr-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                isDarkMode
                  ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                  : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
              }`}
            />
          </div>
          <button
            onClick={handleSearch}
            disabled={loading}
            className={`px-4 py-3 rounded-xl font-medium transition-all duration-300 ${
              isDarkMode
                ? "bg-yellow-500 text-gray-900 hover:bg-yellow-400"
                : "bg-amber-500 text-white hover:bg-amber-600"
            } disabled:opacity-50`}
          >
            {loading ? "..." : "Search"}
          </button>
        </div>

        <button
          onClick={getCurrentLocation}
          disabled={loading}
          className={`w-full py-3 px-4 rounded-xl border-2 border-dashed transition-all duration-300 flex items-center justify-center ${
            isDarkMode
              ? "border-gray-600 text-gray-300 hover:border-gray-500"
              : "border-gray-300 text-gray-600 hover:border-gray-400"
          } disabled:opacity-50`}
        >
          <Navigation className="w-5 h-5 mr-2" />
          {loading ? "Getting location..." : "Use Current Location"}
        </button>
      </div>

      {/* Map Container */}
      <div
        className={`rounded-xl overflow-hidden border-2 ${
          isDarkMode ? "border-gray-600" : "border-gray-300"
        }`}
        style={{ height: "400px" }}
      >
        <MapContainer
          center={position}
          zoom={13}
          style={{ height: "100%", width: "100%" }}
          ref={mapRef}
        >
          <TileLayer
            attribution='&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
          />
          <LocationMarker
            position={position}
            setPosition={setPosition}
            setAddress={setAddress}
            isDarkMode={isDarkMode}
          />
        </MapContainer>
      </div>

      {/* Selected Address Display */}
      {address && (
        <div
          className={`p-4 rounded-xl ${
            isDarkMode ? "bg-gray-700" : "bg-gray-100"
          }`}
        >
          <div className="flex items-start">
            <MapPin
              className={`w-5 h-5 mr-3 mt-0.5 flex-shrink-0 ${
                isDarkMode ? "text-yellow-400" : "text-amber-600"
              }`}
            />
            <div>
              <p
                className={`font-medium ${
                  isDarkMode ? "text-white" : "text-gray-900"
                }`}
              >
                Selected Location:
              </p>
              <p
                className={`text-sm mt-1 ${
                  isDarkMode ? "text-gray-300" : "text-gray-600"
                }`}
              >
                {address}
              </p>
            </div>
          </div>
        </div>
      )}

      {/* Confirm Button */}
      <button
        onClick={handleConfirm}
        disabled={!position || !address}
        className={`w-full py-3 px-6 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 disabled:transform-none disabled:opacity-50 ${
          isDarkMode
            ? "bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-400 hover:to-amber-400"
            : "bg-gradient-to-r from-amber-500 to-yellow-600 text-white hover:from-amber-600 hover:to-yellow-700"
        }`}
      >
        Confirm Location
      </button>
    </div>
  );
};

export default LocationPicker;
</file>

<file path="src/lib/mongodb.js">
// lib/mongodb.js
import { MongoClient, ServerApiVersion } from "mongodb";

const uri = process.env.MONGODB_URI;

const options = {
  serverApi: {
    version: ServerApiVersion.v1,
    strict: true,
    deprecationErrors: true,
  },
  maxPoolSize: 10,
  serverSelectionTimeoutMS: 5000,
  socketTimeoutMS: 45000,
  connectTimeoutMS: 5000,
  maxIdleTimeMS: 30000,
  // REMOVED: bufferMaxEntries - this option is deprecated/not supported
};

if (!uri) {
  throw new Error("Please add your Mongo URI to .env.local (MONGODB_URI)");
}

let client;
let clientPromise;

if (process.env.NODE_ENV === "development") {
  if (!global._mongoClientPromise) {
    client = new MongoClient(uri, options);
    global._mongoClientPromise = client.connect();
  }
  clientPromise = global._mongoClientPromise;
} else {
  client = new MongoClient(uri, options);
  clientPromise = client.connect();
}

export default clientPromise;

export async function connectToDatabase() {
  try {
    const client = await clientPromise;
    const db = client.db(process.env.MONGODB_DB);

    // Test the connection
    await client.db("admin").command({ ping: 1 });
    console.log("‚úÖ Connected to MongoDB!");

    return { client, db };
  } catch (error) {
    console.error("‚ùå Database connection failed:", error.message);

    // Reset global cache on connection failure
    if (process.env.NODE_ENV === "development") {
      global._mongoClientPromise = null;
    }

    throw error;
  }
}
</file>

<file path="src/models/Barber.js">
// models/Barber.js
import mongoose from "mongoose";

const BarberSchema = new mongoose.Schema(
  {
    salonId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Salon",
      required: true,
      index: true,
    },
    name: { type: String, required: true },
    experience: { type: Number, default: 0 }, // years
    skills: [{ type: String }], // specializations
    bio: { type: String, default: "" },
    photo: { type: String, default: "" },
    isAvailable: { type: Boolean, default: true },
    workingHours: {
      start: { type: String, default: "09:00" },
      end: { type: String, default: "21:00" },
    },
    totalBookings: { type: Number, default: 0 },
    rating: { type: Number, default: 5.0, min: 0, max: 5 },
    accomplishments: [{ type: String }],
    earnings: { type: Number, default: 0 },
    lastActiveAt: { type: Date, default: Date.now },
  },
  { timestamps: true }
);

export default mongoose.models.Barber || mongoose.model("Barber", BarberSchema);
</file>

<file path="src/models/Booking.js">
// src/models/Booking.js - Match your actual database structure
import mongoose from "mongoose";

const BookingSchema = new mongoose.Schema(
  {
    salonId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "Salon",
      required: true,
      index: true,
    },
    customerName: { type: String, required: true },
    customerPhone: { type: String, required: true },
    service: { type: String, required: true }, // Change from serviceId to service (string)
    barber: { type: String, default: null }, // Change from staffId to barber (string)
    date: { type: String, required: true }, // Your DB uses string dates like "2025-09-25"
    time: { type: String, required: true }, // Your DB uses string times like "14:00"
    price: { type: Number, default: 0 },
    paymentStatus: {
      type: String,
      enum: ["pending", "partial", "paid"],
      default: "pending",
    },
    status: {
      type: String,
      enum: [
        "requested",
        "confirmed", // Your DB uses "confirmed" not "accepted"
        "completed",
        "cancelled",
      ],
      default: "confirmed",
    },
    userId: {
      type: mongoose.Schema.Types.ObjectId,
      ref: "User",
      default: null,
    },
    feedback: {
      type: mongoose.Schema.Types.Mixed,
      default: {},
    },
  },
  { timestamps: true }
);

export default mongoose.models.Booking ||
  mongoose.model("Booking", BookingSchema);
</file>

<file path="src/pages/api/auth/login.js">
import clientPromise from "../../../lib/mongodb";
import { verifyPassword } from "../../../lib/auth";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  const { email, password, userType } = req.body;

  try {
    const client = await clientPromise;
    const db = client.db("techtrims");

    const collection = userType === "owner" ? "salons" : "users";

    const user = await db.collection(collection).findOne({ email });

    if (!user) {
      return res.status(401).json({ message: "Invalid credentials" });
    }

    const isValid = await verifyPassword(password, user.password);

    if (!isValid) {
      return res.status(401).json({ message: "Invalid credentials" });
    }

    res.status(200).json({
      message: "Login successful",
      token,
      userType,
      user: {
        id: user._id,
        name: user.name,
        email: user.email,
      },
    });
  } catch (error) {
    console.error("Login error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/auth/register.js">
import clientPromise from "../../../lib/mongodb";
import { hashPassword } from "../../../lib/auth";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }

  const { userType, ...userData } = req.body;

  try {
    const client = await clientPromise;
    const db = client.db("techtrims");

    // Hash password
    const hashedPassword = await hashPassword(userData.password);

    // Determine collection based on user type
    const collection = userType === "owner" ? "salons" : "users";

    // Check if user already exists
    const existingUser = await db.collection(collection).findOne({
      $or: [{ email: userData.email }, { mobile: userData.mobile }],
    });

    if (existingUser) {
      return res.status(400).json({ message: "User already exists" });
    }

    // Create user
    const newUser = {
      ...userData,
      password: hashedPassword,
      createdAt: new Date(),
      updatedAt: new Date(),
    };

    // Add default fields for salon owners
    if (userType === "owner") {
      newUser.rating = 0;
      newUser.totalBookings = 0;
      newUser.customerServiceScore = 0;
      newUser.services = [];
      newUser.staff = [];
      newUser.achievements = [];
      newUser.metrics = {
        avgWaitingTime: 0,
        cleanliness: 0,
        staffPoliteness: 0,
      };
    }

    const result = await db.collection(collection).insertOne(newUser);

    // Create token

    res.status(201).json({
      message: "Registration successful",
      token,
      userType,
    });
  } catch (error) {
    console.error("Registration error:", error);
    res.status(500).json({ message: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/maps/reverse.js">
export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ error: "Method not allowed" });
  }

  const { lat, lng } = req.body ?? {};

  if (lat === undefined || lng === undefined) {
    return res.status(400).json({ error: "lat and lng are required" });
  }

  try {
    const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${encodeURIComponent(
      lat
    )}&lon=${encodeURIComponent(lng)}&addressdetails=1`;

    const response = await fetch(url, {
      headers: {
        "User-Agent": "TechTrims/1.0 (techtrims1@gmail.com)",
        "Accept-Language": "en-US,en;q=0.9",
      },
    });

    if (!response.ok) {
      const body = await response.text().catch(() => "");
      console.error("Nominatim returned non-OK:", response.status, body);
      return res
        .status(response.status)
        .json({ error: "Reverse geocoding provider error" });
    }

    const data = await response.json();
    const displayName = data.display_name || null;

    return res.status(200).json({
      address: displayName,
      raw: data,
    });
  } catch (err) {
    console.error("Reverse geocoding error:", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/bookings/[id].js">
// src/pages/api/salons/bookings/[id].js - Only handle specific booking IDs
import connectToDatabase from "../../../../lib/mongodb";
import Booking from "../../../../models/Booking";
import { ObjectId } from "mongodb";

export default async function handler(req, res) {
  await connectToDatabase();
  const { method } = req;
  const { id } = req.query;

  // Check if id is actually a valid ObjectId
  if (!ObjectId.isValid(id)) {
    return res.status(400).json({ error: "Invalid booking ID format" });
  }

  try {
    if (method === "GET") {
      const booking = await Booking.findById(id);
      if (!booking) {
        return res.status(404).json({ error: "Booking not found" });
      }
      return res.status(200).json(booking);
    }

    if (method === "PUT") {
      const update = req.body;
      const booking = await Booking.findByIdAndUpdate(id, update, {
        new: true,
      });
      if (!booking) {
        return res.status(404).json({ error: "Booking not found" });
      }
      return res.status(200).json(booking);
    }

    if (method === "DELETE") {
      await Booking.findByIdAndDelete(id);
      return res.status(204).end();
    }

    return res
      .setHeader("Allow", ["GET", "PUT", "DELETE"])
      .status(405)
      .end(`Method ${method} Not Allowed`);
  } catch (err) {
    console.error("api/bookings/[id] error:", err);
    return res.status(500).json({ error: "Internal server error" });
  }
}
</file>

<file path="src/pages/booking/confirmed.js">
import { useRouter } from "next/router";
import { useEffect, useState } from "react";

export default function BookingConfirmed() {
  const router = useRouter();
  const { id } = router.query;
  const [booking, setBooking] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    if (!id) return;

    const loadBooking = async () => {
      try {
        const res = await fetch("/api/bookings/" + id);
        if (res.ok) {
          const data = await res.json();
          setBooking(data.booking);
        }
      } catch (error) {
        console.error("Error loading booking:", error);
      } finally {
        setLoading(false);
      }
    };

    loadBooking();
    const interval = setInterval(loadBooking, 10000);
    return () => clearInterval(interval);
  }, [id]);

  const proceedToFeedback = () => {
    router.push(`/feedback?bookingId=${id}`);
  };

  if (loading) return <div style={{ padding: 20 }}>Loading...</div>;
  if (!booking) return <div style={{ padding: 20 }}>Booking not found.</div>;

  return (
    <div style={{ padding: 20, maxWidth: 600, margin: "0 auto" }}>
      <h2>Booking Status</h2>

      <div
        style={{
          background: "#f8f9fa",
          color: "black",
          padding: 20,
          borderRadius: 8,
          marginBottom: 20,
        }}
      >
        <p>
          <strong>Booking ID:</strong> {booking._id}
        </p>
        <p>
          <strong>Service:</strong> {booking.service}
        </p>
        {booking.barber && (
          <p>
            <strong>Barber:</strong> {booking.barber}
          </p>
        )}
        <p>
          <strong>Date:</strong> {booking.date}
        </p>
        <p>
          <strong>Time:</strong> {booking.time}
        </p>
        <p>
          <strong>Customer:</strong> {booking.customerName}
        </p>
      </div>

      <div style={{ marginBottom: 20 }}>
        <h3>Service Status</h3>
        <div
          style={{
            display: "flex",
            justifyContent: "space-between",
            margin: "20px 0",
          }}
        >
          <StatusStep
            label="Confirmed"
            active={true}
            completed={booking.status !== "confirmed"}
          />
          <StatusStep
            label="Customer Arrived"
            active={
              booking.status === "arrived" ||
              isAfterStatus("arrived", booking.status)
            }
            completed={isAfterStatus("arrived", booking.status)}
          />
          <StatusStep
            label="Service Started"
            active={
              booking.status === "started" ||
              isAfterStatus("started", booking.status)
            }
            completed={isAfterStatus("started", booking.status)}
          />
          <StatusStep
            label="Service Done"
            active={booking.status === "completed"}
            completed={booking.status === "completed"}
          />
        </div>
      </div>

      {booking.status === "completed" && (
        <div
          style={{
            background: "#d4edda",
            color: "black",
            border: "1px solid #c3e6cb",
            padding: 15,
            borderRadius: 5,
            marginBottom: 20,
          }}
        >
          <h3 style={{ color: "black", margin: 0 }}>Service Completed!</h3>
          <p style={{ color: "black", margin: "10px 0 0 0" }}>
            Your service has been completed. Please provide feedback.
          </p>
          <button
            onClick={proceedToFeedback}
            style={{
              background: "#28a745",
              color: "white",
              border: "none",
              padding: "10px 20px",
              borderRadius: 5,
              cursor: "pointer",
              marginTop: 10,
            }}
          >
            Give Feedback
          </button>
        </div>
      )}

      {booking.status !== "completed" && (
        <div
          style={{
            background: "#fff3cd",
            border: "1px solid #ffeaa7",
            padding: 15,
            borderRadius: 5,
          }}
        >
          <p style={{ margin: 0 }}>{getStatusMessage(booking.status)}</p>
        </div>
      )}
    </div>
  );
}

function StatusStep({ label, active, completed }) {
  return (
    <div
      style={{
        textAlign: "center",
        opacity: active || completed ? 1 : 0.4,
      }}
    >
      <div
        style={{
          width: 30,
          height: 30,
          borderRadius: "50%",
          background: completed ? "#28a745" : active ? "#ffc107" : "#6c757d",
          margin: "0 auto 5px",
          display: "flex",
          alignItems: "center",
          justifyContent: "center",
          color: "white",
          fontSize: 12,
          fontWeight: "bold",
        }}
      >
        {completed ? "‚úì" : active ? "‚è≥" : "‚è∏"}
      </div>
      <div style={{ fontSize: 12 }}>{label}</div>
    </div>
  );
}

function isAfterStatus(checkStatus, currentStatus) {
  const statusOrder = ["confirmed", "arrived", "started", "completed"];
  return statusOrder.indexOf(currentStatus) > statusOrder.indexOf(checkStatus);
}

function getStatusMessage(status) {
  switch (status) {
    case "confirmed":
      return "Your booking is confirmed. Please arrive on time.";
    case "arrived":
      return "You have arrived. Waiting for service to start.";
    case "started":
      return "Your service is in progress. Please wait.";
    case "completed":
      return "Service completed! Please provide feedback.";
    default:
      return "Unknown status";
  }
}
</file>

<file path="src/pages/feedback.js">
// src/pages/feedback.js - Enhanced feedback with star ratings
import { useState, useEffect, useCallback } from "react";
import { useRouter } from "next/router";

export default function FeedbackPage() {
  const router = useRouter();
  const { bookingId } = router.query;

  const [booking, setBooking] = useState(null);
  const [ratings, setRatings] = useState({
    serviceQuality: 0,
    timing: 0,
    barberPerformance: 0,
    ambience: 0,
    overall: 0,
  });
  const [comment, setComment] = useState("");
  const [submitting, setSubmitting] = useState(false);

  const fetchBookingDetails = useCallback(async () => {
    try {
      const response = await fetch(`/api/bookings/${bookingId}`);
      if (response.ok) {
        const data = await response.json();
        setBooking(data);
      }
    } catch (error) {
      console.error("Error fetching booking:", error);
    }
  }, [bookingId]);

  useEffect(() => {
    if (bookingId) {
      fetchBookingDetails();
    }
  }, [bookingId, fetchBookingDetails]);

  // StarRating component - fixed version
  const StarRating = ({ value, onChange, label, required = true }) => {
    return (
      <div className="mb-4">
        <label className="block text-sm font-medium text-gray-700 mb-2">
          {label} {required && <span className="text-red-500">*</span>}
        </label>
        <div className="flex space-x-1 items-center">
          {[1, 2, 3, 4, 5].map((star) => (
            <button
              key={star}
              type="button"
              onClick={() => onChange(star)}
              className={`text-3xl transition-all duration-200 hover:scale-110 ${
                star <= value
                  ? "text-yellow-400 drop-shadow-sm"
                  : "text-gray-300 hover:text-yellow-200"
              }`}
            >
              {star <= value ? "‚≠ê" : "‚òÜ"}
            </button>
          ))}
          <div className="ml-3">
            {value === 0 ? (
              <span className="text-sm text-gray-400">Tap to rate</span>
            ) : (
              <span className="text-sm text-gray-600 font-medium">
                {value}/5 {getRatingLabel(value)}
              </span>
            )}
          </div>
        </div>
      </div>
    );
  };

  // Add rating labels
  const getRatingLabel = (rating) => {
    switch (rating) {
      case 1:
        return "Poor";
      case 2:
        return "Fair";
      case 3:
        return "Good";
      case 4:
        return "Very Good";
      case 5:
        return "Excellent";
      default:
        return "";
    }
  };

  // Add validation before submission
  const submitFeedback = async () => {
    if (!bookingId) {
      alert("Invalid booking ID");
      return;
    }

    // Validate that all ratings are provided
    const unratedFields = Object.entries(ratings)
      .filter(([key, value]) => value === 0)
      .map(([key]) => key.replace(/([A-Z])/g, " $1").toLowerCase());

    if (unratedFields.length > 0) {
      alert(`Please rate: ${unratedFields.join(", ")}`);
      return;
    }

    setSubmitting(true);
    try {
      const response = await fetch("/api/bookings/update", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          bookingId,
          feedback: {
            ratings,
            comment,
            submittedAt: new Date(),
          },
        }),
      });

      if (response.ok) {
        alert("Thank you for your feedback!");

        // Store booking data in localStorage for registration prefill
        if (booking) {
          const prefillData = {
            name: booking.customerName,
            phone: booking.customerPhone,
            lastBooking: {
              salonId: booking.salonId,
              service: booking.service,
              date: booking.date,
              time: booking.time,
            },
            timestamp: new Date().getTime(),
          };

          console.log("Storing prefill data:", prefillData);
          localStorage.setItem("userPrefillData", JSON.stringify(prefillData));
        }

        router.push("/auth/user-register");
      } else {
        alert("Failed to submit feedback");
      }
    } catch (error) {
      console.error("Feedback submission error:", error);
      alert("Error submitting feedback");
    } finally {
      setSubmitting(false);
    }
  };

  if (!booking) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
          <p>Loading booking details...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 py-8">
      <div className="max-w-2xl mx-auto px-4">
        <div className="bg-white rounded-lg shadow-md p-6">
          <div className="text-center mb-6">
            <h1 className="text-2xl font-bold text-gray-900 mb-2">
              Rate Your Experience
            </h1>
            <p className="text-gray-600">
              How was your visit to {booking.salonName || "the salon"}?
            </p>
          </div>

          {/* Booking Summary */}
          <div className="bg-gray-50 rounded-lg p-4 mb-6">
            <h3 className="font-semibold mb-2">Booking Summary</h3>
            <p>
              <strong>Service:</strong> {booking.service}
            </p>
            {booking.barber && (
              <p>
                <strong>Barber:</strong> {booking.barber}
              </p>
            )}
            <p>
              <strong>Date:</strong> {booking.date} at {booking.time}
            </p>
            <p>
              <strong>Amount:</strong> ‚Çπ{booking.price}
            </p>
          </div>

          {/* Rating Form */}
          <div className="space-y-4">
            <StarRating
              label="Service Quality"
              value={ratings.serviceQuality}
              onChange={(value) =>
                setRatings({ ...ratings, serviceQuality: value })
              }
            />

            <StarRating
              label="Timing/Punctuality"
              value={ratings.timing}
              onChange={(value) => setRatings({ ...ratings, timing: value })}
            />

            <StarRating
              label="Barber Performance"
              value={ratings.barberPerformance}
              onChange={(value) =>
                setRatings({ ...ratings, barberPerformance: value })
              }
            />

            <StarRating
              label="Salon Ambience / Cleanliness"
              value={ratings.ambience}
              onChange={(value) => setRatings({ ...ratings, ambience: value })}
            />

            <StarRating
              label="Overall Experience"
              value={ratings.overall}
              onChange={(value) => setRatings({ ...ratings, overall: value })}
            />

            {/* Text Feedback */}
            <div className="mt-6">
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Additional Comments (Optional)
              </label>
              <textarea
                value={comment}
                onChange={(e) => setComment(e.target.value)}
                placeholder="Share your experience in detail..."
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                rows="4"
              />
            </div>
          </div>

          {/* Submit Button */}
          <div className="mt-8 text-center">
            <button
              onClick={submitFeedback}
              disabled={submitting}
              className="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            >
              {submitting ? "Submitting..." : "‚úÖ Submit Feedback"}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/index.js">
// pages/index.js
import { useState, useEffect } from "react";
import { useRouter } from "next/router";
import { motion } from "framer-motion";
import dynamic from "next/dynamic";
import styles from "../styles/Home.module.css";
import Image from "next/image";

export default function Home() {
  const router = useRouter();
  const [userOnboarding, setUserOnboarding] = useState(null);
  const [nearbySalons, setNearbySalons] = useState([]);
  const [isLoading, setIsLoading] = useState(true);
  const [isLoadingSalons, setIsLoadingSalons] = useState(false);
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [showMapView, setShowMapView] = useState(false);
  const [selectedSalon, setSelectedSalon] = useState(null);

  // Dynamic import for map component
  const SalonMap = dynamic(() => import("../components/Maps/SalonMap"), {
    ssr: false,
    loading: () => <div className={styles.mapLoading}>Loading map...</div>,
  });

  useEffect(() => {
    // Check if user has completed onboarding
    const hasOnboarded = localStorage.getItem("hasOnboarded");
    const onboardingData = localStorage.getItem("userOnboardingData");

    if (!hasOnboarded) {
      router.push("/onboarding");
      return;
    }

    if (onboardingData) {
      const userData = JSON.parse(onboardingData);
      setUserOnboarding(userData);

      // Load nearby salons based on user location
      if (
        userData.location &&
        userData.location.latitude &&
        userData.location.longitude
      ) {
        loadNearbySalons(
          userData.location.latitude,
          userData.location.longitude,
          userData.gender
        );
      }
    }

    // Check theme preference
    const darkMode = localStorage.getItem("darkMode") === "true";
    setIsDarkMode(darkMode);
    if (darkMode) {
      document.documentElement.setAttribute("data-theme", "dark");
    }

    setIsLoading(false);
  }, [router]);

  const loadNearbySalons = async (latitude, longitude, gender) => {
    setIsLoadingSalons(true);
    try {
      console.log("Loading salons for coordinates:", latitude, longitude);

      const response = await fetch(
        `/api/salons/nearby?latitude=${latitude}&longitude=${longitude}&radius=40&gender=${gender}`
      );

      const data = await response.json();
      console.log("Salon API response:", data);

      if (response.ok) {
        setNearbySalons(data.salons || []);
        console.log("Set nearby salons:", data.salons?.length || 0);
      } else {
        console.error("Error loading salons:", data.message);
        setNearbySalons([]);
      }
    } catch (error) {
      console.error("Error loading salons:", error);
      setNearbySalons([]);
    } finally {
      setIsLoadingSalons(false);
    }
  };

  const toggleDarkMode = () => {
    const newMode = !isDarkMode;
    setIsDarkMode(newMode);
    localStorage.setItem("darkMode", newMode.toString());

    if (newMode) {
      document.documentElement.setAttribute("data-theme", "dark");
    } else {
      document.documentElement.removeAttribute("data-theme");
    }
  };

  const navigateToAuth = (type, role) => {
    router.push(`/auth/${role}/${type}`);
  };

  const handleSalonCardClick = (salonId) => {
    router.push(`/salons/${salonId}`);
  };

  if (isLoading) {
    return (
      <div className={styles.loadingContainer}>
        <div className={styles.spinner}></div>
        <p>Loading your personalized experience...</p>
      </div>
    );
  }

  return (
    <div className={styles.container}>
      {/* Header */}
      <header className={styles.header}>
        <div className={styles.headerContent}>
          <motion.h1
            className={styles.logo}
            initial={{ opacity: 0, x: -20 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.6 }}
          >
            <span className={styles.goldText}>Luxe</span>Salon
          </motion.h1>

          <div className={styles.headerActions}>
            <button
              className={styles.themeToggle}
              onClick={toggleDarkMode}
              title={
                isDarkMode ? "Switch to Light Mode" : "Switch to Dark Mode"
              }
            >
              {isDarkMode ? "‚òÄÔ∏è" : "üåô"}
            </button>

            <button
              className={styles.ownerButton}
              onClick={() => navigateToAuth("register", "salon")}
            >
              Register as Owner
            </button>

            <button
              className={styles.loginButton}
              onClick={() => navigateToAuth("login", "salon")}
            >
              Login
            </button>
          </div>
        </div>
      </header>

      {/* Welcome Section */}
      <motion.section
        className={styles.welcomeSection}
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8 }}
      >
        <div className={styles.welcomeContent}>
          <h2 className={styles.welcomeTitle}>
            Welcome back,{" "}
            <span className={styles.goldText}>{userOnboarding?.name}</span>! üëã
          </h2>
          <p className={styles.welcomeSubtitle}>
            Discover luxury salon experiences near{" "}
            {userOnboarding?.location?.address || "you"}
          </p>
        </div>

        <div className={styles.quickStats}>
          <div className={styles.stat}>
            <span className={styles.statNumber}>{nearbySalons.length}</span>
            <span className={styles.statLabel}>Nearby Salons</span>
          </div>
          <div className={styles.stat}>
            <span className={styles.statNumber}>
              {nearbySalons.reduce(
                (total, salon) => total + (salon.topServices?.length || 0),
                0
              )}
            </span>
            <span className={styles.statLabel}>Available Services</span>
          </div>
          <div className={styles.stat}>
            <span className={styles.statNumber}>
              {nearbySalons.reduce(
                (total, salon) => total + (salon.stats?.totalBookings || 0),
                0
              )}
            </span>
            <span className={styles.statLabel}>Happy Bookings</span>
          </div>
        </div>
      </motion.section>

      {/* Search Section */}
      <motion.section
        className={styles.searchSection}
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.2 }}
      >
        <div className={styles.searchContainer}>
          <div className={styles.searchBox}>
            <input
              type="text"
              placeholder="Search for services or salons..."
              className={styles.searchInput}
            />
            <button className={styles.searchButton}>üîç</button>
          </div>

          <div className={styles.quickFilters}>
            <button className={styles.filterChip}>üíá Haircut</button>
            <button className={styles.filterChip}>üßî Beard Trim</button>
            <button className={styles.filterChip}>üíÖ Manicure</button>
            <button className={styles.filterChip}>‚ú® Facial</button>
          </div>
        </div>
      </motion.section>

      {/* Popular Services for Gender */}
      <motion.section
        className={styles.servicesSection}
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.4 }}
      >
        <h3 className={styles.sectionTitle}>
          Popular Services for {userOnboarding?.gender}s
        </h3>

        <div className={styles.servicesGrid}>
          {getGenderBasedServices(userOnboarding?.gender).map(
            (service, index) => (
              <motion.div
                key={service.name}
                className={styles.serviceCard}
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ duration: 0.5, delay: 0.1 * index }}
              >
                <div className={styles.serviceIcon}>{service.icon}</div>
                <h4 className={styles.serviceName}>{service.name}</h4>
                <p className={styles.servicePrice}>‚Çπ{service.price}</p>
                <p className={styles.serviceDuration}>{service.duration} min</p>
              </motion.div>
            )
          )}
        </div>
      </motion.section>

      {/* Nearby Salons - Dynamic */}
      <motion.section
        className={styles.salonsSection}
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.6 }}
      >
        <div className={styles.sectionHeader}>
          <h3 className={styles.sectionTitle}>Nearby Luxury Salons</h3>
          <div className={styles.viewOptions}>
            <button
              className={`${styles.viewToggle} ${
                !showMapView ? styles.active : ""
              }`}
              onClick={() => setShowMapView(false)}
            >
              Grid View
            </button>
            <button
              className={`${styles.viewToggle} ${
                showMapView ? styles.active : ""
              }`}
              onClick={() => setShowMapView(true)}
            >
              Map View
            </button>
          </div>
        </div>

        {isLoadingSalons ? (
          <div className={styles.loadingSalons}>
            <div className={styles.spinner}></div>
            <p>Finding salons near you...</p>
          </div>
        ) : nearbySalons.length > 0 ? (
          showMapView ? (
            <SalonMap
              salons={nearbySalons}
              userLocation={{
                lat: userOnboarding?.location?.latitude,
                lng: userOnboarding?.location?.longitude,
              }}
              selectedSalon={selectedSalon}
              onSalonSelect={setSelectedSalon}
              onBookNow={handleSalonCardClick}
              userGender={userOnboarding?.gender}
            />
          ) : (
            <div className={styles.salonsCarousel}>
              {nearbySalons.map((salon, index) => {
                return (
                  <motion.div
                    key={salon._id?.$oid || salon._id?.toString() || index}
                    className={styles.salonCard}
                    initial={{ opacity: 0, x: 50 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ duration: 0.6, delay: 0.1 * index }}
                    whileHover={{ y: -8 }}
                    onClick={() =>
                      handleSalonCardClick(salon._id?.$oid || salon._id)
                    }
                  >
                    <div className={styles.salonImage}>
                      <img
                        src={
                          typeof salon.salonImages?.[0] === "string"
                            ? salon.salonImages[0]
                            : salon.salonImages?.[0]?.url ||
                              "https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop"
                        }
                        alt={salon.salonName || "Salon image"}
                        width={300}
                        height={200}
                        style={{ objectFit: "cover" }}
                      />

                      <div className={styles.salonBadge}>
                        {salon.distance < 2
                          ? "Very Close"
                          : salon.isVerified
                          ? "Verified"
                          : "Popular"}
                      </div>
                      <div className={styles.distanceBadge}>
                        {salon.distance}km away
                      </div>
                    </div>
                    <div className={styles.salonInfo}>
                      <h4 className={styles.salonName}>{salon.salonName}</h4>
                      <p className={styles.salonLocation}>
                        {salon.location.address}
                      </p>

                      <div className={styles.salonStats}>
                        <div className={styles.rating}>
                          ‚≠ê{" "}
                          {(
                            salon.ratings?.overall ??
                            salon.rating ??
                            0
                          ).toFixed(1)}
                        </div>
                        <div className={styles.bookings}>
                          {salon.stats.totalBookings} bookings
                        </div>
                      </div>

                      <div className={styles.salonServices}>
                        {salon.topServices?.map((service, idx) => (
                          <span key={idx} className={styles.serviceTag}>
                            {String(service?.name)} ‚Çπ{String(service?.price)}
                          </span>
                        ))}
                      </div>

                      <button
                        className={styles.bookButton}
                        onClick={(e) => {
                          e.stopPropagation();
                          handleSalonCardClick(salon._id);
                        }}
                      >
                        Book Now
                      </button>
                    </div>
                  </motion.div>
                );
              })}
            </div>
          )
        ) : (
          <div className={styles.noSalons}>
            <p>
              No salons found near your location. Try expanding the search
              radius or register a salon in your area!
            </p>
            <button
              className={styles.registerSalonButton}
              onClick={() => navigateToAuth("register", "salon")}
            >
              Register Your Salon
            </button>
          </div>
        )}
      </motion.section>

      {/* Footer */}
      <footer className={styles.footer}>
        <div className={styles.footerContent}>
          <div className={styles.footerSection}>
            <h4>LuxeSalon</h4>
            <p>Premium salon booking experience</p>
          </div>

          <div className={styles.footerSection}>
            <h5>Quick Links</h5>
            <ul>
              <li>
                <a href="#about">About</a>
              </li>
              <li>
                <a href="#services">Services</a>
              </li>
              <li>
                <a href="#contact">Contact</a>
              </li>
            </ul>
          </div>

          <div className={styles.footerSection}>
            <h5>For Business</h5>
            <ul>
              <li>
                <a href="#register-salon">Register Your Salon</a>
              </li>
              <li>
                <a href="#partner">Partner with Us</a>
              </li>
            </ul>
          </div>
        </div>

        <div className={styles.footerBottom}>
          <p>&copy; 2025 LuxeSalon. All rights reserved.</p>
        </div>
      </footer>
    </div>
  );
}

function getGenderBasedServices(gender) {
  const maleServices = [
    { name: "Haircut", price: 200, duration: 30, icon: "‚úÇÔ∏è" },
    { name: "Beard Trim", price: 150, duration: 20, icon: "üßî" },
    { name: "Hair Styling", price: 250, duration: 25, icon: "üíá‚Äç‚ôÇÔ∏è" },
    { name: "Face Cleanup", price: 300, duration: 45, icon: "üß¥" },
  ];

  const femaleServices = [
    { name: "Haircut & Style", price: 400, duration: 60, icon: "üíá‚Äç‚ôÄÔ∏è" },
    { name: "Hair Coloring", price: 800, duration: 120, icon: "üé®" },
    { name: "Facial Treatment", price: 600, duration: 75, icon: "‚ú®" },
    { name: "Manicure", price: 350, duration: 45, icon: "üíÖ" },
  ];

  const otherServices = [
    { name: "Hair Treatment", price: 500, duration: 60, icon: "üåø" },
    { name: "Scalp Massage", price: 300, duration: 30, icon: "üíÜ" },
    { name: "Hair Wash", price: 150, duration: 20, icon: "üöø" },
    { name: "Styling", price: 350, duration: 40, icon: "üí´" },
  ];

  switch (gender) {
    case "Male":
      return maleServices;
    case "Female":
      return femaleServices;
    default:
      return otherServices;
  }
}
</file>

<file path="src/pages/onboarding.js">
import { useState, useEffect } from "react";
import { useRouter } from "next/router";
import { motion } from "framer-motion";
import styles from "../styles/Onboarding.module.css";

export default function Onboarding() {
  const router = useRouter();
  const [currentStep, setCurrentStep] = useState(1);
  const [formData, setFormData] = useState({
    name: "",
    gender: "",
    location: {
      latitude: null,
      longitude: null,
      address: "",
    },
  });
  const [isLoading, setIsLoading] = useState(false);
  const [locationStatus, setLocationStatus] = useState("pending"); // pending, loading, success, error

  useEffect(() => {
    // Check if user has already completed onboarding
    const hasOnboarded = localStorage.getItem("hasOnboarded");
    if (hasOnboarded) {
      router.push("/");
    }
  }, [router]);

  const handleInputChange = (field, value) => {
    setFormData((prev) => ({
      ...prev,
      [field]: value,
    }));
  };

  const getCurrentLocation = () => {
    setLocationStatus("loading");

    if (!navigator.geolocation) {
      setLocationStatus("error");
      alert("Geolocation is not supported by this browser.");
      return;
    }

    navigator.geolocation.getCurrentPosition(
      async (position) => {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        console.log("üîç ACTUAL GPS COORDINATES:", { latitude, longitude });

        try {
          // Reverse geocoding to get address
          const response = await fetch("/api/maps/reverse", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ lat: latitude, lng: longitude }),
          });

          if (!response.ok) {
            throw new Error("Failed to reverse geocode");
          }

          const data = await response.json();

          setFormData((prev) => ({
            ...prev,
            location: {
              latitude,
              longitude,
              address: data.address || `${latitude}, ${longitude}`,
            },
          }));
          setLocationStatus("success");
        } catch (error) {
          console.error("Error getting address:", error);
          setFormData((prev) => ({
            ...prev,
            location: {
              latitude,
              longitude,
              address: `${latitude}, ${longitude}`,
            },
          }));
          setLocationStatus("success");
        }
      },
      (error) => {
        console.error("Error getting location:", error);
        setLocationStatus("error");
        alert(
          "Unable to get your location. Please enter manually or try again."
        );
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 600000,
      }
    );
  };

  const handleManualLocation = (address) => {
    setFormData((prev) => ({
      ...prev,
      location: {
        latitude: null,
        longitude: null,
        address,
      },
    }));
    setLocationStatus("success");
  };

  const nextStep = () => {
    if (currentStep === 1 && formData.name.trim().length < 2) {
      alert("Please enter a valid name");
      return;
    }
    if (currentStep === 2 && !formData.gender) {
      alert("Please select your gender");
      return;
    }
    if (currentStep === 3 && locationStatus !== "success") {
      alert("Please set your location");
      return;
    }

    if (currentStep < 3) {
      setCurrentStep((prev) => prev + 1);
    } else {
      completeOnboarding();
    }
  };

  const prevStep = () => {
    if (currentStep > 1) {
      setCurrentStep((prev) => prev - 1);
    }
  };

  const completeOnboarding = () => {
    setIsLoading(true);

    // Store onboarding data in localStorage
    localStorage.setItem("userOnboardingData", JSON.stringify(formData));
    localStorage.setItem("hasOnboarded", "true");

    setTimeout(() => {
      setIsLoading(false);
      router.push("/");
    }, 1500);
  };

  const stepVariants = {
    hidden: { opacity: 0, x: 50 },
    visible: { opacity: 1, x: 0 },
    exit: { opacity: 0, x: -50 },
  };

  return (
    <div className={styles.container}>
      <div className={styles.background}>
        <div className={styles.goldOrb}></div>
        <div className={styles.goldOrb}></div>
      </div>

      <div className={styles.onboardingCard}>
        <div className={styles.header}>
          <h1 className={styles.title}>
            Welcome to <span className={styles.goldText}>LuxeSalon</span>
          </h1>
          <p className={styles.subtitle}>
            Let&apos;s personalize your experience
          </p>

          <div className={styles.progressBar}>
            <div className={styles.progressTrack}>
              <div
                className={styles.progressFill}
                style={{ width: `${(currentStep / 3) * 100}%` }}
              ></div>
            </div>
            <span className={styles.progressText}>{currentStep}/3</span>
          </div>
        </div>

        <motion.div
          key={currentStep}
          initial="hidden"
          animate="visible"
          exit="exit"
          variants={stepVariants}
          transition={{ duration: 0.3 }}
          className={styles.stepContent}
        >
          {currentStep === 1 && (
            <div className={styles.step}>
              <div className={styles.stepIcon}>üëã</div>
              <h2>What&apos;s your name?</h2>
              <p>We&apos;ll use this to personalize your booking experience</p>

              <div className={styles.formGroup}>
                <input
                  type="text"
                  placeholder="Enter your full name"
                  value={formData.name}
                  onChange={(e) => handleInputChange("name", e.target.value)}
                  className={styles.input}
                  autoFocus
                />
              </div>
            </div>
          )}

          {currentStep === 2 && (
            <div className={styles.step}>
              <div className={styles.stepIcon}>‚ößÔ∏è</div>
              <h2>How do you identify?</h2>
              <p>This helps us show relevant services and pricing</p>

              <div className={styles.genderOptions}>
                {["Male", "Female", "Other"].map((gender) => (
                  <button
                    key={gender}
                    type="button"
                    className={`${styles.genderButton} ${
                      formData.gender === gender ? styles.selected : ""
                    }`}
                    onClick={() => handleInputChange("gender", gender)}
                  >
                    <div className={styles.genderIcon}>
                      {gender === "Male"
                        ? "üë®"
                        : gender === "Female"
                        ? "üë©"
                        : "üßë"}
                    </div>
                    <span>{gender}</span>
                  </button>
                ))}
              </div>
            </div>
          )}

          {currentStep === 3 && (
            <div className={styles.step}>
              <div className={styles.stepIcon}>üìç</div>
              <h2>Where are you located?</h2>
              <p>We&apos;ll find the best salons near you</p>

              <div className={styles.locationSection}>
                {locationStatus === "pending" && (
                  <>
                    <button
                      type="button"
                      className={styles.locationButton}
                      onClick={getCurrentLocation}
                    >
                      <span>üìç</span>
                      Use Current Location
                    </button>

                    <div className={styles.divider}>
                      <span>or</span>
                    </div>

                    <input
                      type="text"
                      placeholder="Enter your area/city manually"
                      className={styles.input}
                      onKeyPress={(e) => {
                        if (e.key === "Enter" && e.target.value.trim()) {
                          handleManualLocation(e.target.value.trim());
                        }
                      }}
                      onBlur={(e) => {
                        if (e.target.value.trim()) {
                          handleManualLocation(e.target.value.trim());
                        }
                      }}
                    />
                  </>
                )}

                {locationStatus === "loading" && (
                  <div className={styles.loadingLocation}>
                    <div className={styles.spinner}></div>
                    <p>Getting your location...</p>
                  </div>
                )}

                {locationStatus === "success" && (
                  <div className={styles.locationSuccess}>
                    <div className={styles.locationIcon}>‚úÖ</div>
                    <div>
                      <h4>Location Set!</h4>
                      <p>{formData.location.address}</p>
                    </div>
                    <button
                      type="button"
                      className={styles.changeLocationButton}
                      onClick={() => setLocationStatus("pending")}
                    >
                      Change
                    </button>
                  </div>
                )}

                {locationStatus === "error" && (
                  <div className={styles.locationError}>
                    <p>Couldn&apos;t get location. Please enter manually:</p>
                    <input
                      type="text"
                      placeholder="Enter your area/city"
                      className={styles.input}
                      onKeyPress={(e) => {
                        if (e.key === "Enter" && e.target.value.trim()) {
                          handleManualLocation(e.target.value.trim());
                        }
                      }}
                    />
                  </div>
                )}
              </div>
            </div>
          )}
        </motion.div>

        <div className={styles.navigation}>
          {currentStep > 1 && (
            <button
              type="button"
              className={styles.backButton}
              onClick={prevStep}
            >
              ‚Üê Back
            </button>
          )}

          <button
            type="button"
            className={styles.nextButton}
            onClick={nextStep}
            disabled={isLoading}
          >
            {isLoading ? (
              <>
                <div className={styles.spinner}></div>
                Setting up...
              </>
            ) : currentStep === 3 ? (
              "Complete Setup"
            ) : (
              "Next ‚Üí"
            )}
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/salon-details/[id].js">
// pages/salon-details/[id].js - CHANGE FROM basic details TO comprehensive details page
import { useState, useEffect, useCallback, useMemo } from "react";
import { useRouter } from "next/router";
import { motion } from "framer-motion";
import dynamic from "next/dynamic";
import {
  MapPin,
  Clock,
  Phone,
  Star,
  Navigation,
  Share2,
  Heart,
} from "lucide-react";

// Dynamic imports to avoid SSR issues
const LocationMap = dynamic(() => import("../../components/Maps/LocationMap"), {
  ssr: false,
  loading: () => (
    <div className="animate-pulse bg-gray-300 h-64 rounded-xl"></div>
  ),
});

export default function SalonDetailsPage() {
  const router = useRouter();
  const { id } = router.query;
  const [salon, setSalon] = useState(null);
  const [loading, setLoading] = useState(true);
  const [userLocation, setUserLocation] = useState(null);
  const [showBooking, setShowBooking] = useState(false);
  const [selectedService, setSelectedService] = useState(null);
  const [activeTab, setActiveTab] = useState("overview");
  const [isFavorite, setIsFavorite] = useState(false);
  const services = useMemo(() => {
    if (!salon) return [];

    // Check if salon has services array
    if (salon.services && Array.isArray(salon.services)) {
      return salon.services;
    }

    // Check if salon has services object (convert to array)
    if (salon.services && typeof salon.services === "object") {
      return Object.entries(salon.services).map(([key, value]) => ({
        name: key,
        price: value.price || 0,
        duration: value.duration || 30,
        enabled: value.enabled || true,
        ...value,
      }));
    }

    // Fallback to gender-based services
    return getGenderServices(salon.targetGender || "Male");
  }, [salon]);

  const salonCoords = useMemo(() => {
    if (!salon?.location?.coordinates) return null;

    // Handle different coordinate formats
    const coords = salon.location.coordinates;
    if (Array.isArray(coords) && coords.length >= 2) {
      // GeoJSON format [lng, lat] -> Leaflet format [lat, lng]
      return [coords[1], coords[0]];
    }
    return null;
  }, [salon]);

  const fetchSalonDetails = useCallback(async () => {
    if (!id) return;

    try {
      const response = await fetch(`/api/salons/${id}`);
      const data = await response.json();

      if (data.success) {
        setSalon(data.salon);
      } else {
        console.error("Failed to fetch salon details");
      }
    } catch (error) {
      console.error("Error fetching salon details:", error);
    } finally {
      setLoading(false);
    }
  }, [id]);

  useEffect(() => {
    if (id) {
      fetchSalonDetails();
    }
    getUserLocation();
  }, [id, fetchSalonDetails]);

  const getUserLocation = () => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          setUserLocation({
            lat: position.coords.latitude,
            lng: position.coords.longitude,
          });
        },
        (error) => {
          console.log("Location access denied");
        }
      );
    }
  };
  const getGenderServices = (gender) => {
    const maleServices = [
      {
        name: "Haircut",
        price: 200,
        duration: 30,
        icon: "‚úÇÔ∏è",
        description: "Professional haircut with styling",
      },
      {
        name: "Beard Trim",
        price: 150,
        duration: 20,
        icon: "üßî",
        description: "Beard shaping and trimming",
      },
      {
        name: "Hair Styling",
        price: 250,
        duration: 25,
        icon: "üíá‚Äç‚ôÇÔ∏è",
        description: "Hair styling with premium products",
      },
      {
        name: "Face Cleanup",
        price: 300,
        duration: 45,
        icon: "üß¥",
        description: "Deep face cleansing treatment",
      },
      {
        name: "Hair Wash",
        price: 100,
        duration: 15,
        icon: "üöø",
        description: "Professional hair wash",
      },
      {
        name: "Massage",
        price: 400,
        duration: 60,
        icon: "üíÜ‚Äç‚ôÇÔ∏è",
        description: "Relaxing head and shoulder massage",
      },
    ];

    const femaleServices = [
      {
        name: "Haircut & Style",
        price: 400,
        duration: 60,
        icon: "üíá‚Äç‚ôÄÔ∏è",
        description: "Cut and professional styling",
      },
      {
        name: "Hair Coloring",
        price: 800,
        duration: 120,
        icon: "üé®",
        description: "Professional hair coloring service",
      },
      {
        name: "Facial Treatment",
        price: 600,
        duration: 75,
        icon: "‚ú®",
        description: "Deep cleansing facial treatment",
      },
      {
        name: "Manicure",
        price: 350,
        duration: 45,
        icon: "üíÖ",
        description: "Complete nail care and polish",
      },
      {
        name: "Pedicure",
        price: 400,
        duration: 50,
        icon: "ü¶∂",
        description: "Foot care and nail treatment",
      },
      {
        name: "Hair Treatment",
        price: 500,
        duration: 60,
        icon: "üåø",
        description: "Nourishing hair treatment",
      },
    ];

    return gender === "Male" ? maleServices : femaleServices;
  };
  const getDirections = () => {
    if (salon?.location?.coordinates && userLocation) {
      const [lng, lat] = salon.location.coordinates;
      const url = `https://www.google.com/maps/dir/${userLocation.lat},${userLocation.lng}/${lat},${lng}`;
      window.open(url, "_blank");
    } else if (salon?.location?.coordinates) {
      const [lng, lat] = salon.location.coordinates;
      const url = `https://www.google.com/maps/place/${lat},${lng}`;
      window.open(url, "_blank");
    }
  };

  const handleBookNow = () => {
    router.push(`/salons/${id}`);
  };

  const handleShare = async () => {
    if (navigator.share) {
      try {
        await navigator.share({
          title: salon.salonName,
          text: `Check out ${salon.salonName} - a great salon near you!`,
          url: window.location.href,
        });
      } catch (error) {
        console.log("Error sharing:", error);
      }
    } else {
      // Fallback: copy to clipboard
      navigator.clipboard.writeText(window.location.href);
      alert("Link copied to clipboard!");
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500 mx-auto mb-4"></div>
          <p className="text-gray-600">Loading salon details...</p>
        </div>
      </div>
    );
  }

  if (!salon) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="text-center">
          <h2 className="text-2xl font-bold text-gray-900 mb-4">
            Salon not found
          </h2>
          <button
            onClick={() => router.back()}
            className="bg-amber-600 text-white px-6 py-2 rounded-lg hover:bg-amber-700 transition-colors"
          >
            Go Back
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white shadow-sm sticky top-0 z-50">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <button
              onClick={() => router.back()}
              className="flex items-center text-gray-600 hover:text-gray-900 transition-colors"
            >
              <svg
                className="w-5 h-5 mr-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M15 19l-7-7 7-7"
                />
              </svg>
              Back
            </button>

            <div className="flex items-center space-x-3">
              <button
                onClick={handleShare}
                className="p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors"
              >
                <Share2 className="w-5 h-5" />
              </button>
              <button
                onClick={() => setIsFavorite(!isFavorite)}
                className={`p-2 rounded-lg transition-colors ${
                  isFavorite
                    ? "text-red-500 bg-red-50"
                    : "text-gray-600 hover:text-red-500 hover:bg-gray-100"
                }`}
              >
                <Heart
                  className={`w-5 h-5 ${isFavorite ? "fill-current" : ""}`}
                />
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Hero Section */}
      <section className="bg-white">
        <div className="max-w-7xl mx-auto px-4 py-6">
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Image Gallery */}
            <div className="space-y-4">
              <div className="aspect-video bg-gray-200 rounded-xl overflow-hidden">
                <img
                  src={
                    salon.salonImages?.[0]?.url ||
                    salon.salonImages?.[0] ||
                    "https://images.unsplash.com/photo-1560066984-138dadb4c035?w=800&h=400&fit=crop"
                  }
                  alt={salon.salonName}
                  className="w-full h-full object-cover"
                />
              </div>

              {/* Additional images */}
              {salon.salonImages && salon.salonImages.length > 1 && (
                <div className="grid grid-cols-3 gap-4">
                  {salon.salonImages.slice(1, 4).map((image, index) => (
                    <div
                      key={index}
                      className="aspect-square bg-gray-200 rounded-lg overflow-hidden"
                    >
                      <img
                        src={typeof image === "string" ? image : image.url}
                        alt={`${salon.salonName} ${index + 2}`}
                        className="w-full h-full object-cover"
                      />
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Salon Info */}
            <div className="space-y-6">
              <div>
                <div className="flex items-start justify-between mb-2">
                  <h1 className="text-3xl font-bold text-gray-900">
                    {salon.salonName}
                  </h1>
                  {salon.isVerified && (
                    <span className="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
                      ‚úì Verified
                    </span>
                  )}
                </div>

                <div className="flex items-center text-gray-600 mb-4">
                  <MapPin className="w-5 h-5 mr-2" />
                  <span>{salon.location?.address}</span>
                </div>

                <div className="flex items-center space-x-6 text-sm">
                  <div className="flex items-center">
                    <Star className="w-5 h-5 text-yellow-400 mr-1" />
                    <span className="font-medium">
                      {(salon.ratings?.overall || 4.5).toFixed(1)}
                    </span>
                    <span className="text-gray-500 ml-1">
                      ({salon.ratings?.totalReviews || 0} reviews)
                    </span>
                  </div>
                  <div className="flex items-center text-gray-500">
                    <span>{salon.stats?.totalBookings || 0} bookings</span>
                  </div>
                  <div className="flex items-center text-gray-500">
                    <span>{salon.distance?.toFixed(1) || "1.2"} km away</span>
                  </div>
                </div>
              </div>

              {/* Contact Info */}
              <div className="bg-gray-50 rounded-lg p-4">
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div className="flex items-center">
                    <Phone className="w-5 h-5 text-gray-400 mr-3" />
                    <span>{salon.phone || "Not available"}</span>
                  </div>
                  <div className="flex items-center">
                    <Clock className="w-5 h-5 text-gray-400 mr-3" />
                    <span>
                      {salon.openingTime || "09:00"} -{" "}
                      {salon.closingTime || "21:00"}
                    </span>
                  </div>
                </div>
              </div>

              {/* Action Buttons */}
              <div className="flex space-x-4">
                <button
                  onClick={handleBookNow}
                  className="flex-1 bg-amber-600 text-white px-6 py-3 rounded-lg hover:bg-amber-700 transition-colors font-medium"
                >
                  Book Appointment
                </button>
                <button
                  onClick={getDirections}
                  className="flex items-center justify-center px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
                >
                  <Navigation className="w-5 h-5 mr-2" />
                  Directions
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Tabs Navigation */}
      <div className="bg-white border-b">
        <div className="max-w-7xl mx-auto px-4">
          <nav className="flex space-x-8">
            {[
              { id: "overview", label: "Overview" },
              { id: "services", label: "Services" },
              { id: "reviews", label: "Reviews" },
              { id: "location", label: "Location" },
            ].map((tab) => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={`py-4 px-1 border-b-2 font-medium text-sm transition-colors ${
                  activeTab === tab.id
                    ? "border-amber-500 text-amber-600"
                    : "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"
                }`}
              >
                {tab.label}
              </button>
            ))}
          </nav>
        </div>
      </div>

      {/* Tab Content */}
      <div className="max-w-7xl mx-auto px-4 py-8">
        {activeTab === "overview" && (
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div className="lg:col-span-2 space-y-6">
              {/* About */}
              <div className="bg-white rounded-lg shadow-sm p-6">
                <h3 className="text-xl font-semibold mb-4">
                  About {salon.salonName}
                </h3>
                <p className="text-gray-600 leading-relaxed">
                  {salon.description ||
                    `Welcome to ${salon.salonName}, your premier destination for professional grooming and beauty services. Our experienced team is dedicated to providing top-quality treatments in a comfortable and hygienic environment.`}
                </p>
              </div>

              {/* Popular Services Preview */}
              <div className="bg-white rounded-lg shadow-sm p-6">
                <h3 className="text-xl font-semibold mb-4">Popular Services</h3>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  {(services || []).slice(0, 4).map((service, index) => (
                    <div
                      key={index}
                      className="flex items-center justify-between p-4 bg-gray-50 rounded-lg"
                    >
                      <div className="flex items-center">
                        <span className="text-2xl mr-3">{service.icon}</span>
                        <div>
                          <h4 className="font-medium">{service.name}</h4>
                          <p className="text-sm text-gray-500">
                            {service.duration} min
                          </p>
                        </div>
                      </div>
                      <span className="font-semibold text-amber-600">
                        ‚Çπ{service.price}
                      </span>
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {/* Sidebar */}
            <div className="space-y-6">
              {/* Quick Stats */}
              <div className="bg-white rounded-lg shadow-sm p-6">
                <h3 className="text-lg font-semibold mb-4">Quick Stats</h3>
                <div className="space-y-3">
                  <div className="flex justify-between">
                    <span className="text-gray-600">Average Wait Time</span>
                    <span className="font-medium">
                      {salon.stats?.averageWaitTime || 15} min
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Repeat Customers</span>
                    <span className="font-medium">
                      {salon.stats?.repeatCustomers || 85}%
                    </span>
                  </div>
                  <div className="flex justify-between">
                    <span className="text-gray-600">Total Bookings</span>
                    <span className="font-medium">
                      {salon.stats?.totalBookings || 0}
                    </span>
                  </div>
                </div>
              </div>

              {/* Amenities */}
              {salon.amenities && salon.amenities.length > 0 && (
                <div className="bg-white rounded-lg shadow-sm p-6">
                  <h3 className="text-lg font-semibold mb-4">Amenities</h3>
                  <div className="space-y-2">
                    {salon.amenities.map((amenity, index) => (
                      <div key={index} className="flex items-center">
                        <span className="text-green-500 mr-2">‚úì</span>
                        <span>{amenity}</span>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>
        )}

        {activeTab === "services" && (
          <div className="bg-white rounded-lg shadow-sm p-6">
            <h3 className="text-2xl font-semibold mb-6">All Services</h3>
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              {services.map((service, index) => (
                <motion.div
                  key={index}
                  className="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer"
                  onClick={() => setSelectedService(service)}
                  whileHover={{ scale: 1.02 }}
                >
                  <div className="text-3xl mb-3">{service.icon}</div>
                  <h4 className="text-lg font-semibold mb-2">{service.name}</h4>
                  <p className="text-gray-600 text-sm mb-4">
                    {service.description}
                  </p>
                  <div className="flex justify-between items-center">
                    <span className="text-2xl font-bold text-amber-600">
                      ‚Çπ{service.price}
                    </span>
                    <span className="text-sm text-gray-500">
                      {service.duration} min
                    </span>
                  </div>
                </motion.div>
              ))}
            </div>
          </div>
        )}

        {activeTab === "reviews" && (
          <div className="bg-white rounded-lg shadow-sm p-6">
            <h3 className="text-2xl font-semibold mb-6">Customer Reviews</h3>
            {salon.recentFeedback && salon.recentFeedback.length > 0 ? (
              <div className="space-y-6">
                {salon.recentFeedback.map((review, index) => (
                  <div key={index} className="border-b border-gray-200 pb-6">
                    <div className="flex items-start justify-between mb-3">
                      <div>
                        <h4 className="font-semibold">{review.userName}</h4>
                        <div className="flex items-center mt-1">
                          {[...Array(5)].map((_, i) => (
                            <Star
                              key={i}
                              className={`w-4 h-4 ${
                                i < review.rating
                                  ? "text-yellow-400 fill-current"
                                  : "text-gray-300"
                              }`}
                            />
                          ))}
                          <span className="ml-2 text-sm text-gray-500">
                            {new Date(review.date).toLocaleDateString()}
                          </span>
                        </div>
                      </div>
                      <span className="text-sm text-gray-500">
                        {review.service}
                      </span>
                    </div>
                    <p className="text-gray-700">{review.comment}</p>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-12">
                <div className="text-gray-400 text-6xl mb-4">üí¨</div>
                <h4 className="text-lg font-medium text-gray-900 mb-2">
                  No reviews yet
                </h4>
                <p className="text-gray-500">
                  Be the first to review this salon!
                </p>
              </div>
            )}
          </div>
        )}

        {activeTab === "location" && (
          <div className="bg-white rounded-lg shadow-sm overflow-hidden">
            <div className="p-6 border-b">
              <h3 className="text-2xl font-semibold mb-4">
                Location & Directions
              </h3>
              <div className="flex items-center text-gray-600">
                <MapPin className="w-5 h-5 mr-2" />
                <span>{salon.location?.address}</span>
              </div>
            </div>

            {salonCoords && (
              <div style={{ height: "400px" }}>
                <LocationMap
                  salonLocation={salonCoords}
                  userLocation={userLocation}
                  salonName={salon.salonName}
                  address={salon.location?.address}
                />
              </div>
            )}

            <div className="p-6">
              <button
                onClick={getDirections}
                className="w-full bg-amber-600 text-white px-6 py-3 rounded-lg hover:bg-amber-700 transition-colors font-medium flex items-center justify-center"
              >
                <Navigation className="w-5 h-5 mr-2" />
                Get Directions
              </button>
            </div>
          </div>
        )}
      </div>

      {/* Service Detail Modal */}
      {selectedService && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
          <motion.div
            className="bg-white rounded-xl p-6 max-w-md w-full"
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            exit={{ opacity: 0, scale: 0.9 }}
          >
            <div className="text-center mb-6">
              <div className="text-6xl mb-4">{selectedService.icon}</div>
              <h3 className="text-2xl font-bold mb-2">
                {selectedService.name}
              </h3>
              <p className="text-gray-600">{selectedService.description}</p>
            </div>

            <div className="flex justify-between items-center mb-6 p-4 bg-gray-50 rounded-lg">
              <div>
                <span className="text-sm text-gray-500">Price</span>
                <div className="text-2xl font-bold text-amber-600">
                  ‚Çπ{selectedService.price}
                </div>
              </div>
              <div className="text-right">
                <span className="text-sm text-gray-500">Duration</span>
                <div className="text-lg font-semibold">
                  {selectedService.duration} min
                </div>
              </div>
            </div>

            <div className="flex space-x-3">
              <button
                onClick={() => setSelectedService(null)}
                className="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Close
              </button>
              <button
                onClick={() => {
                  setSelectedService(null);
                  handleBookNow();
                }}
                className="flex-1 px-4 py-2 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors"
              >
                Book Now
              </button>
            </div>
          </motion.div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/styles/SalonDetail.module.css">
/* styles/SalonDetail.module.css */

/* Container */
.container {
  padding: 24px;
}

/* Header */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 24px;
}

.backButton {
  font-size: 14px;
  padding: 8px 16px;
}

.salonName {
  font-size: 24px;
  font-weight: 700;
  text-align: center;
  flex: 1;
  color: var(--gold-primary);
}

.headerActions {
  display: flex;
  gap: 12px;
}

.shareButton,
.favoriteButton {
  background: transparent;
  border: none;
  cursor: pointer;
  font-size: 20px;
  transition: transform 0.2s ease;
}

.shareButton:hover,
.favoriteButton:hover {
  transform: scale(1.1);
  color: var(--gold-primary);
}

/* Hero Section */
.heroSection {
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 24px;
  margin-bottom: 32px;
}

.imageGallery {
  height: 400px;
  border-radius: 12px;
  overflow: hidden;
  background: var(--background-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
}

.mainImage {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.placeholderImage {
  text-align: center;
  color: var(--text-secondary);
}

.salonBasicInfo {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.ratingSection {
  display: flex;
  align-items: center;
  gap: 8px;
}

.mainRating {
  font-size: 18px;
  font-weight: 700;
  color: var(--gold-primary);
}

.reviewCount {
  font-size: 14px;
  color: var(--text-secondary);
}

.locationInfo {
  font-size: 14px;
  color: var(--text-secondary);
}

.quickStats {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.stat {
  padding: 12px;
  text-align: center;
  flex: 1;
}

.statNumber {
  font-weight: 700;
  color: var(--gold-primary);
}

.statLabel {
  font-size: 13px;
  color: var(--text-secondary);
}
.serviceItem {
  border: 1px solid #ddd;
  padding: 10px;
  margin: 6px 0;
  border-radius: 6px;
  cursor: pointer;
  user-select: none;
  transition: background 0.2s, border-color 0.2s;
}

.serviceItem:hover {
  border-color: #0b76ef;
  background: rgba(11, 118, 239, 0.06);
}

.serviceItem.selected {
  border-color: #0b76ef;
  background: rgba(11, 118, 239, 0.12);
  color: #0b76ef;
  font-weight: 600;
}

/* Remove blockers completely */
.overlayBlocker {
  display: none !important;
}
/* Add to SalonDetail.module.css */
.barbersSection {
  margin: 3rem 0;
}

.barbersGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 1.5rem;
  margin-top: 1.5rem;
}

.barberCard {
  background: white;
  border-radius: 12px;
  padding: 1.5rem;
  border: 2px solid #e5e7eb;
  transition: all 0.3s ease;
  cursor: pointer;
  text-align: center;
}

.barberCard:hover {
  border-color: #f59e0b;
  box-shadow: 0 8px 25px rgba(245, 158, 11, 0.15);
}

.barberCard.selected {
  border-color: #f59e0b;
  background: #fffbeb;
  box-shadow: 0 8px 25px rgba(245, 158, 11, 0.25);
}

.barberImage {
  width: 80px;
  height: 80px;
  margin: 0 auto 1rem;
  border-radius: 50%;
  overflow: hidden;
  background: #f3f4f6;
  display: flex;
  align-items: center;
  justify-content: center;
}

.barberPhoto {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.defaultBarberImage {
  font-size: 2rem;
}

.barberName {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #111827;
}

.barberExperience {
  color: #6b7280;
  margin-bottom: 0.5rem;
  font-size: 0.9rem;
}

.barberRating {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
  margin-bottom: 1rem;
  font-size: 0.9rem;
}

.barberSkills {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  justify-content: center;
  margin-bottom: 1rem;
}

.skillChip {
  background: #fef3c7;
  color: #d97706;
  padding: 0.25rem 0.5rem;
  border-radius: 0.5rem;
  font-size: 0.75rem;
  font-weight: 500;
}

.barberBio {
  font-size: 0.85rem;
  color: #6b7280;
  line-height: 1.4;
}

.noBarbersSection {
  margin: 2rem 0;
}

/* Sections */
.sectionTitle {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 16px;
}

/* Services Grid */
.servicesGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 16px;
}

.serviceCard {
  cursor: pointer;
  transition: transform 0.2s ease;
  text-align: center;
}

.serviceCard:hover {
  transform: translateY(-4px);
}

.serviceCard.selected {
  border: 2px solid var(--gold-primary);
}

.serviceName {
  font-weight: 600;
  margin-bottom: 8px;
}

.servicePrice {
  font-weight: 700;
  color: var(--gold-primary);
}

.serviceDuration,
.serviceGender {
  font-size: 14px;
  color: var(--text-secondary);
}

/* Barbers */
.barbersGrid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 16px;
}

.barberCard {
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.barberCard:hover {
  transform: translateY(-4px);
}

.barberCard.selected {
  border: 2px solid var(--gold-primary);
}

.barberImage {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 8px;
}

/* Booking */
.dateTimePicker {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.dateInput {
  max-width: 250px;
}

.timeSlots {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.timeSlot {
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid var(--border-color);
  background: var(--background-secondary);
  cursor: pointer;
  transition: all 0.2s ease;
}

.timeSlot:hover:not(:disabled) {
  border-color: var(--gold-primary);
  color: var(--gold-primary);
}

.timeSlot.selected {
  background: var(--gold-primary);
  color: var(--contrast-dark);
  border-color: var(--gold-dark);
}

.timeSlot:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

/* Map */
.mapSection {
  margin-top: 24px;
}

.mapSection .leaflet-container {
  border-radius: 12px;
  border: 1px solid var(--border-color);
}

/* CTA */
.bookButtonContainer {
  margin: 32px 0;
  text-align: center;
}

/* Modal */
.modalOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 50;
}

.modalContent {
  max-width: 500px;
  width: 100%;
}

.modalActions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 16px;
}
</file>

<file path="src/styles/SalonMap.module.css">
.mapContainer {
  position: relative;
  height: 600px;
  width: 100%;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}
.custom-popup .leaflet-popup-content-wrapper {
  border-radius: 8px !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
  padding: 0 !important;
  min-width: 50px !important;
}

.custom-popup .leaflet-popup-content {
  margin: 0 !important;
  padding: 0 !important;
  width: auto !important;
}

.custom-popup .leaflet-popup-tip {
  background: white !important;
}

.map {
  height: 100%;
  width: 100%;
  z-index: 1;
}

.mapLoading {
  height: 600px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
  border-radius: 20px;
  font-size: 18px;
  color: #6b7280;
}

/* Side Panel for Selected Salon */
.sidePanel {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 350px;
  max-height: calc(100% - 40px);
  background: white;
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
  z-index: 1000;
  overflow-y: auto;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    transform: translateX(100%);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

.closeButton {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 30px;
  height: 30px;
  border: none;
  background: rgba(0, 0, 0, 0.1);
  border-radius: 50%;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  z-index: 1001;
  transition: all 0.2s;
}

.closeButton:hover {
  background: rgba(0, 0, 0, 0.2);
  transform: scale(1.1);
}

/* Salon Card Styles */
.salonCard {
  background: white;
  border-radius: 16px;
  overflow: hidden;
}

.cardHeader {
  position: relative;
  height: 180px;
}

.salonImage {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.badges {
  position: absolute;
  top: 12px;
  left: 12px;
  display: flex;
  gap: 8px;
}

.badge {
  background: rgba(245, 158, 11, 0.9);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 600;
  backdrop-filter: blur(10px);
}

.cardContent {
  padding: 20px;
}

.salonName {
  font-size: 20px;
  font-weight: 700;
  color: #1f2937;
  margin: 0 0 8px 0;
}

.address {
  color: #6b7280;
  font-size: 14px;
  margin: 0 0 16px 0;
  line-height: 1.4;
}

.stats {
  display: flex;
  gap: 16px;
  margin-bottom: 20px;
}

.stat {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 14px;
  color: #374151;
}

.icon {
  font-size: 16px;
}

.services h4 {
  font-size: 16px;
  font-weight: 600;
  color: #1f2937;
  margin: 0 0 12px 0;
}

.serviceGrid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 20px;
}

.serviceItem {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px;
  background: #f9fafb;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.serviceIcon {
  font-size: 16px;
}

.serviceItem div {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.serviceName {
  font-size: 12px;
  font-weight: 500;
  color: #374151;
}

.servicePrice {
  font-size: 12px;
  font-weight: 700;
  color: #f59e0b;
}

.bookButton {
  width: 100%;
  background: linear-gradient(135deg, #f59e0b, #d97706);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.bookButton:hover {
  background: linear-gradient(135deg, #d97706, #b45309);
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
}

/* Popup Styles */
.popupContent {
  min-width: 200px;
  padding: 8px;
}

.popupContent strong {
  display: block;
  margin-bottom: 4px;
  color: #1f2937;
}

.popupContent p {
  margin: 4px 0;
  font-size: 13px;
  color: #6b7280;
}

.popupButton {
  background: #f59e0b;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 8px;
  width: 100%;
  transition: background 0.2s;
}

.popupButton:hover {
  background: #d97706;
}

.userPopup {
  text-align: center;
  padding: 4px;
}

.userPopup strong {
  color: #3b82f6;
  font-size: 14px;
}

/* Dark mode support */
[data-theme="dark"] .salonCard,
[data-theme="dark"] .sidePanel {
  background: #1f2937;
  color: white;
}

[data-theme="dark"] .salonName {
  color: white;
}

[data-theme="dark"] .address {
  color: #9ca3af;
}

[data-theme="dark"] .stat {
  color: #d1d5db;
}

[data-theme="dark"] .services h4 {
  color: white;
}

[data-theme="dark"] .serviceItem {
  background: #374151;
  border-color: #4b5563;
}

[data-theme="dark"] .serviceName {
  color: #d1d5db;
}

[data-theme="dark"] .closeButton {
  background: rgba(255, 255, 255, 0.1);
  color: white;
}

[data-theme="dark"] .closeButton:hover {
  background: rgba(255, 255, 255, 0.2);
}

/* Responsive */
@media (max-width: 768px) {
  .sidePanel {
    width: calc(100% - 40px);
    height: 400px;
    top: auto;
    bottom: 20px;
    right: 20px;
    left: 20px;
  }

  .mapContainer {
    height: 500px;
  }

  .serviceGrid {
    grid-template-columns: 1fr;
  }
}
</file>

<file path="test.js">
// fixCoordinates.js
import { MongoClient } from "mongodb";
import dotenv from "dotenv";

dotenv.config({ path: ".env.local" });

async function fixCoordinates() {
  const client = new MongoClient(process.env.MONGODB_URI);
  await client.connect();
  const db = client.db(); // default DB from URI
  const salons = db.collection("salons");

  const allSalons = await salons
    .find({ "location.coordinates": { $exists: true } })
    .toArray();

  for (const s of allSalons) {
    const coords = s.location.coordinates;
    if (coords.length === 2) {
      const [first, second] = coords;

      // if stored as [lat, lng], flip to [lng, lat]
      if (Math.abs(first) <= 90 && Math.abs(second) <= 180) {
        const newCoords = [second, first];
        console.log(`Fixing ${s.salonName}: ${coords} -> ${newCoords}`);

        await salons.updateOne(
          { _id: s._id },
          { $set: { "location.coordinates": newCoords } }
        );
      }
    }
  }

  console.log("‚úÖ Coordinate fix completed");
  await client.close();
}

fixCoordinates().catch(console.error);
</file>

<file path="src/components/Maps/SalonMap.js">
//pages/src/components/Maps/SalonMap.js
import React, { useEffect, useRef, useState, useMemo } from "react";
import { useRouter } from "next/router";
import { MapContainer, TileLayer, Marker, Popup, useMap } from "react-leaflet";
import L from "leaflet";
import "leaflet/dist/leaflet.css";
import styles from "../../styles/SalonMap.module.css";

// Fix for default markers in react-leaflet
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",
  iconUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",
  shadowUrl:
    "https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png",
});

// Custom salon marker icon
const salonIcon = new L.Icon({
  iconUrl:
    "data:image/svg+xml;base64," +
    btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#f59e0b" width="30" height="30">
      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
    </svg>
  `),
  iconSize: [60, 30],
  iconAnchor: [15, 30],
  popupAnchor: [0, -30],
});

// User location marker
const userIcon = new L.Icon({
  iconUrl: "/maps/usericon.jpg", // Put your icon here
  iconSize: [30, 30],
  iconAnchor: [15, 15],
});

const SalonCard = ({
  salon,
  userLocation,
  selectedSalon,
  onSalonSelect,
  onBookNow,
  userGender,
}) => {
  const getGenderServices = (gender) => {
    const maleServices = [
      { name: "Haircut", price: 200, icon: "‚úÇÔ∏è" },
      { name: "Beard Trim", price: 150, icon: "üßî" },
      { name: "Hair Styling", price: 250, icon: "üíá‚Äç‚ôÇÔ∏è" },
      { name: "Face Cleanup", price: 300, icon: "üß¥" },
    ];

    const femaleServices = [
      { name: "Haircut & Style", price: 400, icon: "üíá‚Äç‚ôÄÔ∏è" },
      { name: "Hair Coloring", price: 800, icon: "üé®" },
      { name: "Facial Treatment", price: 600, icon: "‚ú®" },
      { name: "Manicure", price: 350, icon: "üíÖ" },
    ];

    return gender === "Male" ? maleServices : femaleServices;
  };

  const services =
    salon.topServices?.length > 0
      ? salon.topServices.slice(0, 4)
      : getGenderServices(userGender).slice(0, 4);

  return (
    <div className={styles.salonCard}>
      <div className={styles.cardHeader}>
        <img
          src={
            typeof salon.salonImages?.[0] === "string"
              ? salon.salonImages[0]
              : salon.salonImages?.[0]?.url ||
                "https://images.unsplash.com/photo-1560066984-138dadb4c035?w=300&h=200&fit=crop"
          }
          alt={salon.salonName}
          className={styles.salonImage}
        />
        <div className={styles.badges}>
          {salon.distance < 2 && (
            <span className={styles.badge}>Very Close</span>
          )}
          {salon.isVerified && <span className={styles.badge}>Verified</span>}
        </div>
      </div>

      <div className={styles.cardContent}>
        <h3 className={styles.salonName}>{salon.salonName}</h3>
        <p className={styles.address}>{salon.location.address}</p>

        <div className={styles.stats}>
          <div className={styles.stat}>
            <span className={styles.icon}>‚≠ê</span>
            <span>
              {(salon.ratings?.overall ?? salon.rating ?? 4.5).toFixed(1)}
            </span>
          </div>
          <div className={styles.stat}>
            <span className={styles.icon}>üìç</span>
            <span>{salon.distance?.toFixed(1) || "1.2"} km</span>
          </div>
          <div className={styles.stat}>
            <span className={styles.icon}>üë•</span>
            <span>{salon.stats?.totalBookings || 0} bookings</span>
          </div>
        </div>

        <div className={styles.services}>
          <h4>Popular Services</h4>
          <div className={styles.serviceGrid}>
            {services.map((service, idx) => (
              <div key={idx} className={styles.serviceItem}>
                <span className={styles.serviceIcon}>
                  {service.icon || "‚úÇÔ∏è"}
                </span>
                <div>
                  <span className={styles.serviceName}>{service.name}</span>
                  <span className={styles.servicePrice}>‚Çπ{service.price}</span>
                </div>
              </div>
            ))}
          </div>
        </div>

        <button
          className={styles.bookButton}
          onClick={() => onBookNow(salon._id)}
        >
          Book Now
        </button>
      </div>
    </div>
  );
};

const MapUpdater = ({ selectedSalon, salons }) => {
  const map = useMap();

  useEffect(() => {
    if (selectedSalon) {
      const salon = salons.find((s) => s._id === selectedSalon);
      if (salon && salon.location?.coordinates) {
        map.setView(
          [salon.location.coordinates[1], salon.location.coordinates[0]],
          16
        );
      }
    }
  }, [selectedSalon, salons, map]);

  return null;
};

// const AutoOpenPopup = ({ children, position, ...props }) => {
//   const map = useMap();

//   const popupOptions = useMemo(() => props, [props]);

//   useEffect(() => {
//     const marker = L.marker(position, { icon: salonIcon }).addTo(map);
//     const popup = L.popup(popupOptions).setContent(children);
//     marker.bindPopup(popup).openPopup();

//     return () => {
//       map.removeLayer(marker);
//     };
//   }, [map, position, children, popupOptions]);

//   return null;
// };

const SalonMap = ({
  salons,
  userLocation,
  selectedSalon,
  onSalonSelect,
  onBookNow,
  userGender,
}) => {
  const [mapLoaded, setMapLoaded] = useState(false);
  const selectedSalonData = salons.find((s) => s._id === selectedSalon);
  const router = useRouter();
  const mapRef = useRef(null);
  const [mapTheme, setMapTheme] = useState("standard");

  const mapThemes = {
    standard: {
      url: "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
      name: "Standard",
    },
    dark: {
      url: "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",
      name: "Dark",
    },
    light: {
      url: "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
      name: "Light",
    },
    satellite: {
      url: "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
      name: "Satellite",
    },
    terrain: {
      url: "https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}{r}.png",
      name: "Terrain",
    },
  };

  const defaultCenter =
    userLocation?.lat && userLocation?.lng
      ? [userLocation.lat, userLocation.lng]
      : [19.076, 72.8777]; // Mumbai default
  const ThemeSelector = () => (
    <div className="absolute top-4 right-4 z-[1000] bg-white rounded-lg shadow-lg p-2 text-black">
      <select
        value={mapTheme}
        onChange={(e) => setMapTheme(e.target.value)}
        className="text-sm border rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        {Object.entries(mapThemes).map(([key, theme]) => (
          <option key={key} value={key}>
            {theme.name}
          </option>
        ))}
      </select>
    </div>
  );
  // Add this component inside the MapContainer, after TileLayer
  const PopupOpener = ({ salons }) => {
    const map = useMap();

    useEffect(() => {
      const timer = setTimeout(() => {
        map.eachLayer((layer) => {
          if (layer instanceof L.Marker && layer.getPopup()) {
            layer.openPopup();
          }
        });
      }, 100);

      return () => clearTimeout(timer);
    }, [map, salons]);

    return null;
  };

  return (
    <div className={styles.mapContainer}>
      <ThemeSelector />
      <MapContainer
        center={defaultCenter}
        zoom={15}
        maxZoom={20}
        ref={mapRef}
        className={styles.map}
        whenCreated={() => setMapLoaded(true)}
      >
        <TileLayer
          url={mapThemes[mapTheme].url}
          attribution="&copy; Map Data"
        />
        <PopupOpener salons={salons} />
        <MapUpdater selectedSalon={selectedSalon} salons={salons} />

        {/* User location marker */}
        {userLocation?.lat && userLocation?.lng && (
          <Marker
            position={[userLocation.lat, userLocation.lng]}
            icon={userIcon}
          >
            <Popup>
              <div className={styles.userPopup}>
                <strong>Your Location</strong>
              </div>
            </Popup>
          </Marker>
        )}

        {/* Salon markers with always-open popups */}
        {salons.map((salon) => (
          <Marker
            key={salon._id}
            position={[
              salon.location.coordinates[1],
              salon.location.coordinates[0],
            ]}
            icon={salonIcon}
            eventHandlers={{
              click: () => onSalonSelect(salon),
            }}
          >
            <Popup
              autoClose={false}
              closeButton={false}
              closeOnClick={false}
              closeOnEscapeKey={false}
              autoPan={false}
              className="custom-popup"
            >
              <div className="text-center p-2 min-w-[20px]">
                <h3 className="font-bold text-sm mb-1">{salon.salonName}</h3>
                <p className="text-xs font-medium text-blue-600 ">
                  {salon.distance?.toFixed(1)}km away
                </p>
                <div className="flex flex-col gap-1">
                  <button
                    className="text-xs bg-orange-500 text-white rounded px-4 py-1 font-medium hover:bg-orange-600"
                    onClick={() => onSalonSelect(salon)}
                  >
                    View Details
                  </button>
                  <button
                    className="text-xs bg-blue-500 text-white rounded px-2 py-1 font-medium hover:bg-blue-600"
                    onClick={(e) => {
                      e.stopPropagation();
                      window.open(
                        `https://maps.google.com/maps?daddr=${salon.location.coordinates[1]},${salon.location.coordinates[0]}`
                      );
                    }}
                  >
                    Get Directions
                  </button>
                </div>
              </div>
            </Popup>
          </Marker>
        ))}

        {salons.map((salon) => (
          <Marker
            key={`marker-${salon._id}`}
            position={[
              salon.location.coordinates[1],
              salon.location.coordinates[0],
            ]}
            icon={salonIcon}
            eventHandlers={{
              click: () => onSalonSelect(salon),
            }}
          />
        ))}
      </MapContainer>

      {/* Salon Details Card */}
      {selectedSalonData && (
        <div className={styles.sidePanel}>
          <button
            className={styles.closeButton}
            onClick={() => onSalonSelect(null)}
          >
            √ó
          </button>
          <SalonCard
            salon={selectedSalonData}
            onBookNow={onBookNow}
            userGender={userGender}
          />
        </div>
      )}
    </div>
  );
};

export default SalonMap;
</file>

<file path="src/components/OwnerSidebar.js">
import { useRouter } from "next/router";

export default function OwnerSidebar({ closeSidebar }) {
  const router = useRouter();

  const menuItems = [
    { icon: "üë§", label: "Profile", path: "/salons/profile" },
    { icon: "üìä", label: "Dashboard", path: "/salons/dashboard" },
    { icon: "üìÖ", label: "Bookings", path: "/salons/bookings" },
    {
      icon: "üë®‚Äçüíº",
      label: "Barber Management",
      href: "/salons/barbers",
      path: "/salons/barbers",
    },

    { icon: "üë•", label: "Staff", path: "/salons/staff" },
    { icon: "‚úÇÔ∏è", label: "Services", path: "/salons/services" },
    { icon: "üí∞", label: "Payments", path: "/salons/payments" },
    { icon: "üìà", label: "Analytics", path: "/salons/analytics" },
    { icon: "‚öôÔ∏è", label: "Settings", path: "/salons/settings" },
  ];

  const handleLogout = () => {
    localStorage.removeItem("ownerToken");
    router.push("/salons/login");
  };

  return (
    <div className="flex flex-col h-full bg-white shadow-md">
      {/* Logo */}
      <div className="p-6 border-b flex justify-between items-center">
        <div>
          <h2 className="text-xl font-bold gold-gradient-text">
            üíà SalonBook Pro
          </h2>
          <p className="text-sm text-text-secondary">Owner Dashboard</p>
        </div>
        {/* Mobile close button */}
        {closeSidebar && (
          <button
            onClick={closeSidebar}
            className="md:hidden p-2 rounded-md hover:bg-gray-100"
          >
            ‚ùå
          </button>
        )}
      </div>

      {/* Nav Menu */}
      <nav className="flex-1 overflow-y-auto p-4 space-y-1">
        {menuItems.map((item) => (
          <button
            key={item.path}
            onClick={() => {
              router.push(item.path);
              if (closeSidebar) closeSidebar();
            }}
            className={`w-full flex items-center gap-3 px-4 py-2 rounded-lg transition-all ${
              router.pathname === item.path
                ? "bg-primary text-white shadow-md"
                : "hover:bg-gray-100 text-text-primary"
            }`}
          >
            <span className="text-lg">{item.icon}</span>
            <span className="capitalize">{item.label}</span>
          </button>
        ))}
      </nav>

      {/* Footer */}
      <div className="p-4 border-t">
        <button
          onClick={handleLogout}
          className="btn btn-secondary w-full flex items-center justify-center gap-2"
        >
          üö™ Logout
        </button>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Salon/SalonRegisterForm.js">
import React, { useState, useEffect } from "react";
import { MapPin, Clock, Store, Scissors, Star } from "lucide-react";
import dynamic from "next/dynamic";
import Link from "next/link";

// Dynamically import LocationPicker to avoid SSR issues with Leaflet
const LocationPicker = dynamic(() => import("../Maps/LocationPicker"), {
  ssr: false,
  loading: () => (
    <div className="animate-pulse bg-gray-300 h-64 rounded-xl"></div>
  ),
});

const SalonRegisterForm = () => {
  const [formData, setFormData] = useState({
    // Owner Details
    fullName: "",
    phone: "",
    email: "",
    password: "",

    // Salon Details
    salonName: "",
    address: "",
    locationData: null,
    latitude: "",
    longitude: "", // Will store coordinates and formatted address
    openingTime: "09:00",
    closingTime: "21:00",

    // Basic Services & Pricing
    services: {
      haircut: { enabled: false, price: "" },
      shave: { enabled: false, price: "" },
      hairWash: { enabled: false, price: "" },
      hairStyling: { enabled: false, price: "" },
      facial: { enabled: false, price: "" },
      hairColor: { enabled: false, price: "" },
    },
    barbers: [],
    services: {
      haircut: { enabled: false, price: "" },
      shave: { enabled: false, price: "" },
      hairWash: { enabled: false, price: "" },
      hairStyling: { enabled: false, price: "" },
      facial: { enabled: false, price: "" },
      hairColor: { enabled: false, price: "" },
    },
  });

  const [currentStep, setCurrentStep] = useState(1);
  const [isDarkMode, setIsDarkMode] = useState(false);
  const [showLocationPicker, setShowLocationPicker] = useState(false);
  const [isClient, setIsClient] = useState(false);
  const [validationErrors, setValidationErrors] = useState({});
  useEffect(() => {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition((pos) => {
        setFormData((prev) => ({
          ...prev,
          latitude: prev.latitude || pos.coords.latitude,
          longitude: prev.longitude || pos.coords.longitude,
        }));
      });
    }
  }, []);
  useEffect(() => {
    setIsClient(true);
  }, []);

  const validateStep = (step) => {
    const errors = {};

    if (step === 1) {
      if (!formData.fullName) errors.fullName = "Full name is required";
      if (!formData.phone) errors.phone = "Mobile number is required";
      if (!formData.email) errors.email = "Email is required";
      if (!formData.password) errors.password = "Password is required";
      else if (formData.password.length < 6)
        errors.password = "Password must be at least 6 characters";
    }

    if (step === 2) {
      if (!formData.salonName) errors.salonName = "Salon name is required";
      if (!formData.locationData) {
        errors.location = "Please select a location on the map";
      }
      if (!formData.address) errors.address = "Address is required";
    }

    if (step === 3) {
      const enabledServices = Object.values(formData.services).some(
        (service) => service.enabled
      );
      if (!enabledServices)
        errors.services = "Please enable at least one service";
    }

    setValidationErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleInputChange = (field, value) => {
    setFormData((prev) => ({
      ...prev,
      [field]: value,
    }));

    // Clear validation error when field is updated
    if (validationErrors[field]) {
      setValidationErrors((prev) => {
        const newErrors = { ...prev };
        delete newErrors[field];
        return newErrors;
      });
    }
  };

  const handleServiceChange = (service, field, value) => {
    setFormData((prev) => ({
      ...prev,
      services: {
        ...prev.services,
        [service]: {
          ...prev.services[service],
          [field]: value,
        },
      },
    }));
  };

  // Add barber management functions
  const addBarber = () => {
    setFormData((prev) => ({
      ...prev,
      barbers: [
        ...prev.barbers,
        {
          name: "",
          experience: "",
          skills: [],
          bio: "",
          photo: "",
          isAvailable: true,
          totalBookings: 0,
          rating: 5.0,
        },
      ],
    }));
  };

  const removeBarber = (index) => {
    setFormData((prev) => ({
      ...prev,
      barbers: prev.barbers.filter((_, i) => i !== index),
    }));
  };

  const handleBarberChange = (index, field, value) => {
    setFormData((prev) => ({
      ...prev,
      barbers: prev.barbers.map((barber, i) =>
        i === index ? { ...barber, [field]: value } : barber
      ),
    }));
  };

  const handleBarberSkillChange = (index, skill, checked) => {
    setFormData((prev) => ({
      ...prev,
      barbers: prev.barbers.map((barber, i) =>
        i === index
          ? {
              ...barber,
              skills: checked
                ? [...barber.skills, skill]
                : barber.skills.filter((s) => s !== skill),
            }
          : barber
      ),
    }));
  };

  const handleLocationSelect = (locationData) => {
    const lat = locationData.lat ? parseFloat(locationData.lat) : "";
    const lng = locationData.lng ? parseFloat(locationData.lng) : "";

    setFormData((prev) => ({
      ...prev,
      locationData: {
        lat: lat,
        lng: lng,
        address: locationData.address,
      },
      latitude: lat,
      longitude: lng,
      address: locationData.address || prev.address,
    }));
    setShowLocationPicker(false);

    if (validationErrors.location) {
      setValidationErrors((prev) => {
        const newErrors = { ...prev };
        delete newErrors.location;
        return newErrors;
      });
    }
  };

  const handleNextStep = () => {
    if (validateStep(currentStep)) {
      setCurrentStep(currentStep + 1);
    }
  };

  const handlePrevStep = () => {
    setCurrentStep(currentStep - 1);
  };

  const handleSubmit = async () => {
    if (!validateStep(4)) return;

    // Remove this duplicate validation check - it's already in validateStep
    console.log("Location data:", formData.locationData);
    console.log("Form lat/lng:", formData.latitude, formData.longitude);
    console.log("Barbers data:", formData.barbers); // ADD THIS LOG

    const lat = formData.locationData?.lat || parseFloat(formData.latitude);
    const lng = formData.locationData?.lng || parseFloat(formData.longitude);

    try {
      const registrationData = {
        ownerName: formData.fullName,
        phone: formData.phone,
        email: formData.email,
        password: formData.password,
        salonName: formData.salonName,
        address: formData.locationData?.address || formData.address,
        latitude: lat,
        longitude: lng,
        coordinates: [lng, lat],
        openingTime: formData.openingTime,
        closingTime: formData.closingTime,
        services: formData.services,
        barbers: formData.barbers,
      };

      console.log("Salon Registration Data:", registrationData);

      // Here you would send data to your backend API
      const response = await fetch("/api/auth/salon/register", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(registrationData),
      });

      if (response.ok) {
        const result = await response.json();
        console.log("Registration result:", result);

        // Store salon session with proper structure
        const salonSession = {
          id: result.salon._id || result.salon.id,
          salonName: result.salon.salonName,
          ownerName: result.salon.ownerName,
          email: result.salon.email,
        };

        localStorage.setItem("salonSession", JSON.stringify(salonSession));
        localStorage.setItem("salonToken", result.token);
        // alert("Salon registered successfully! Welcome to the platform.");
        alert(
          `Salon registered successfully! ${
            result.barbersCreated || 0
          } barbers added. Welcome!`
        );

        // Redirect to dashboard or login
        // window.location.href = "/salons/dashboard";
      } else {
        const error = await response.json();
        alert(`Registration failed: ${error.message}`);
      }
    } catch (error) {
      console.error("Registration error:", error);
      alert("Registration failed. Please try again.");
    }
  };

  const services = [
    { key: "haircut", label: "Haircut", icon: Scissors, defaultPrice: "200" },
    { key: "shave", label: "Shave", icon: Scissors, defaultPrice: "100" },
    {
      key: "hairWash",
      label: "Hair Wash",
      icon: Scissors,
      defaultPrice: "150",
    },
    {
      key: "hairStyling",
      label: "Hair Styling",
      icon: Scissors,
      defaultPrice: "300",
    },
    { key: "facial", label: "Facial", icon: Star, defaultPrice: "500" },
    {
      key: "hairColor",
      label: "Hair Color",
      icon: Scissors,
      defaultPrice: "800",
    },
  ];

  // Don't render until client-side to avoid hydration issues
  if (!isClient) {
    return (
      <div className="min-h-screen bg-[var(--background-primary)] flex items-center justify-center">
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-amber-500"></div>
      </div>
    );
  }

  return (
    <>
      <div
        className={`min-h-screen transition-all duration-500 ${
          isDarkMode
            ? "bg-[var(--dark-background-primary)]"
            : "bg-[var(--background-primary)]"
        }`}
      >
        {/* Dark Mode Toggle */}
        <div className="absolute top-4 right-4 z-50">
          <button
            onClick={() => setIsDarkMode(!isDarkMode)}
            className={`p-3 rounded-full transition-all duration-300 ${
              isDarkMode
                ? "bg-[var(--dark-gold-primary)] text-gray-900 hover:opacity-90"
                : "bg-gray-800 text-white hover:bg-gray-700"
            }`}
          >
            {isDarkMode ? "‚òÄÔ∏è" : "üåô"}
          </button>
        </div>

        <div className="container mx-auto px-4 py-8">
          <div className="max-w-4xl mx-auto">
            {/* Header */}
            <div className="text-center mb-8 animate-fadeIn">
              <div
                className={`inline-flex items-center justify-center w-16 h-16 rounded-full mb-4 ${
                  isDarkMode
                    ? "bg-[var(--dark-gold-primary)]"
                    : "bg-[var(--gold-primary)]"
                }`}
              >
                <Store className="w-8 h-8 text-white" />
              </div>
              <h1 className="text-4xl font-bold mb-2 gold-gradient-text">
                Register Your Salon
              </h1>
              <p
                className={`text-lg ${
                  isDarkMode ? "text-gray-300" : "text-gray-600"
                }`}
              >
                Join our platform and start getting more customers
              </p>
            </div>

            {/* Progress Steps */}
            <div className="flex items-center justify-center mb-8">
              {[1, 2, 3, 4].map((step) => (
                <React.Fragment key={step}>
                  <div
                    className={`flex items-center justify-center w-10 h-10 rounded-full transition-all duration-300 ${
                      currentStep >= step
                        ? isDarkMode
                          ? "bg-[var(--dark-gold-primary)] text-[var(--contrast-dark)]"
                          : "bg-[var(--gold-primary)] text-[var(--contrast-dark)]"
                        : isDarkMode
                        ? "bg-gray-700 text-gray-400"
                        : "bg-gray-200 text-gray-500"
                    }`}
                  >
                    {step}
                  </div>
                  {step < 4 && (
                    <div
                      className={`w-12 h-1 mx-2 transition-all duration-300 ${
                        currentStep > step
                          ? isDarkMode
                            ? "bg-[var(--dark-gold-primary)]"
                            : "bg-[var(--gold-primary)]"
                          : isDarkMode
                          ? "bg-gray-700"
                          : "bg-gray-200"
                      }`}
                    />
                  )}
                </React.Fragment>
              ))}
            </div>

            {/* Registration Form */}
            <div
              className={`card rounded-3xl   p-8 backdrop-blur-sm transition-all duration-500 ${
                isDarkMode
                  ? "bg-gray-800/80 border border-gray-700"
                  : "bg-white/90 border border-amber-200"
              }`}
            >
              <div className="space-y-8">
                {/* Step 1: Owner Details */}
                {currentStep === 1 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      Owner Details
                    </h2>
                    <div className="grid md:grid-cols-2 gap-6">
                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Full Name
                        </label>
                        <input
                          type="text"
                          placeholder="Your full name"
                          value={formData.fullName}
                          onChange={(e) =>
                            handleInputChange("fullName", e.target.value)
                          }
                          className={`w-full form-input rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          } ${
                            validationErrors.fullName ? "border-red-500" : ""
                          }`}
                        />
                        {validationErrors.fullName && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.fullName}
                          </p>
                        )}
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Mobile Number
                        </label>
                        <div className="relative">
                          <input
                            type="tel"
                            placeholder="+91 9876543210"
                            value={formData.phone}
                            onChange={(e) =>
                              handleInputChange("phone", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            } ${
                              validationErrors.phone ? "border-red-500" : ""
                            }`}
                          />
                        </div>
                        {validationErrors.phone && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.phone}
                          </p>
                        )}
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Email
                        </label>
                        <div className="relative">
                          <input
                            type="email"
                            placeholder="your.email@example.com"
                            value={formData.email}
                            onChange={(e) =>
                              handleInputChange("email", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            } ${
                              validationErrors.email ? "border-red-500" : ""
                            }`}
                          />
                        </div>
                        {validationErrors.email && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.email}
                          </p>
                        )}
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Password
                        </label>
                        <div className="relative">
                          <input
                            type="password"
                            placeholder="Create a strong password"
                            value={formData.password}
                            onChange={(e) =>
                              handleInputChange("password", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                            } ${
                              validationErrors.password ? "border-red-500" : ""
                            }`}
                          />
                        </div>
                        {validationErrors.password && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.password}
                          </p>
                        )}
                      </div>
                    </div>
                  </div>
                )}

                {/* Step 2: Salon Details */}
                {currentStep === 2 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <Store className="w-6 h-6 mr-3" />
                      Salon Details
                    </h2>

                    <div className="grid md:grid-cols-2 gap-6">
                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Salon Name
                        </label>
                        <input
                          type="text"
                          placeholder="Your salon name"
                          value={formData.salonName}
                          onChange={(e) =>
                            handleInputChange("salonName", e.target.value)
                          }
                          className={`w-full form-input rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          } ${
                            validationErrors.salonName ? "border-red-500" : ""
                          }`}
                        />
                        {validationErrors.salonName && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.salonName}
                          </p>
                        )}
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Location Pin
                        </label>
                        <div className="relative">
                          <MapPin
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <button
                            type="button"
                            className={`w-full pl-11 pr-4 py-3 rounded-xl border transition-all duration-300 text-left form-input ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-gray-300 hover:bg-gray-600"
                                : "bg-white border-gray-300 text-gray-600 hover:bg-gray-50"
                            } ${
                              validationErrors.location ? "border-red-500" : ""
                            }`}
                            onClick={() => setShowLocationPicker(true)}
                          >
                            {formData.locationData
                              ? formData.locationData.address
                              : "Set exact location on map"}
                          </button>
                          {validationErrors.location && (
                            <p className="text-red-500 text-sm">
                              {validationErrors.location}
                            </p>
                          )}
                          {showLocationPicker && (
                            <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40">
                              <div className="bg-white rounded-xl p-6 shadow-xl relative w-full max-w-2xl">
                                <button
                                  className="absolute top-2 right-2 text-gray-500 hover:text-gray-700"
                                  onClick={() => setShowLocationPicker(false)}
                                >
                                  ‚úï
                                </button>
                                <LocationPicker
                                  onLocationSelect={handleLocationSelect}
                                />
                              </div>
                            </div>
                          )}
                        </div>
                      </div>

                      <div className="md:col-span-2 space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Address
                        </label>
                        <textarea
                          placeholder="Complete address with landmarks"
                          value={formData.address}
                          onChange={(e) =>
                            handleInputChange("address", e.target.value)
                          }
                          rows={3}
                          className={`w-full form-input rounded-xl transition-all duration-300 resize-none focus:ring-2 focus:ring-opacity-50 ${
                            isDarkMode
                              ? "bg-gray-700 border-gray-600 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                              : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                          } ${
                            validationErrors.address ? "border-red-500" : ""
                          }`}
                        />
                        {validationErrors.address && (
                          <p className="text-red-500 text-sm">
                            {validationErrors.address}
                          </p>
                        )}
                      </div>
                      <input
                        type="hidden"
                        name="latitude"
                        value={formData.latitude || ""}
                      />
                      <input
                        type="hidden"
                        name="longitude"
                        value={formData.longitude || ""}
                      />

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Opening Time
                        </label>
                        <div className="relative">
                          <Clock
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="time"
                            value={formData.openingTime}
                            onChange={(e) =>
                              handleInputChange("openingTime", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>

                      <div className="space-y-2">
                        <label
                          className={`form-label ${
                            isDarkMode ? "text-gray-300" : "text-gray-700"
                          }`}
                        >
                          Closing Time
                        </label>
                        <div className="relative">
                          <Clock
                            className={`absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 ${
                              isDarkMode ? "text-gray-400" : "text-gray-500"
                            }`}
                          />
                          <input
                            type="time"
                            value={formData.closingTime}
                            onChange={(e) =>
                              handleInputChange("closingTime", e.target.value)
                            }
                            className={`w-full form-input pl-11 pr-4 rounded-xl transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                              isDarkMode
                                ? "bg-gray-700 border-gray-600 text-white focus:border-yellow-500 focus:ring-yellow-500"
                                : "bg-white border-gray-300 text-gray-900 focus:border-amber-500 focus:ring-amber-500"
                            }`}
                          />
                        </div>
                      </div>
                    </div>
                  </div>
                )}
                {/* Step 3: Barber Management */}
                {currentStep === 3 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <div className="w-6 h-6 mr-3" />
                      Add Your Barbers
                    </h2>

                    <div className="space-y-6">
                      {formData.barbers.map((barber, index) => (
                        <div
                          key={index}
                          className={`p-6 rounded-xl border-2 transition-all duration-300 ${
                            isDarkMode
                              ? "border-gray-600 bg-gray-700/50"
                              : "border-gray-200 bg-gray-50"
                          }`}
                        >
                          <div className="flex justify-between items-center mb-4">
                            <h3
                              className={`font-semibold ${
                                isDarkMode ? "text-white" : "text-gray-900"
                              }`}
                            >
                              Barber {index + 1}
                            </h3>
                            {formData.barbers.length > 1 && (
                              <button
                                type="button"
                                onClick={() => removeBarber(index)}
                                className="text-red-500 hover:text-red-700"
                              >
                                ‚úï
                              </button>
                            )}
                          </div>

                          <div className="grid md:grid-cols-2 gap-4">
                            <input
                              type="text"
                              placeholder="Barber Name"
                              value={barber.name}
                              onChange={(e) =>
                                handleBarberChange(
                                  index,
                                  "name",
                                  e.target.value
                                )
                              }
                              className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                                isDarkMode
                                  ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                  : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                              }`}
                            />

                            <input
                              type="number"
                              placeholder="Years of Experience"
                              value={barber.experience}
                              onChange={(e) =>
                                handleBarberChange(
                                  index,
                                  "experience",
                                  e.target.value
                                )
                              }
                              className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                                isDarkMode
                                  ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                  : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                              }`}
                            />
                          </div>

                          <div className="mt-4">
                            <label
                              className={`block text-sm font-medium mb-2 ${
                                isDarkMode ? "text-gray-300" : "text-gray-700"
                              }`}
                            >
                              Specializations
                            </label>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                              {[
                                "Haircut",
                                "Shaving",
                                "Hair Styling",
                                "Beard Trim",
                                "Hair Color",
                                "Facial",
                              ].map((skill) => (
                                <label
                                  key={skill}
                                  className="flex items-center"
                                >
                                  <input
                                    type="checkbox"
                                    checked={barber.skills.includes(skill)}
                                    onChange={(e) =>
                                      handleBarberSkillChange(
                                        index,
                                        skill,
                                        e.target.checked
                                      )
                                    }
                                    className={`mr-2 ${
                                      isDarkMode
                                        ? "text-yellow-500 focus:ring-yellow-500"
                                        : "text-amber-500 focus:ring-amber-500"
                                    }`}
                                  />
                                  <span
                                    className={`text-sm ${
                                      isDarkMode
                                        ? "text-gray-300"
                                        : "text-gray-700"
                                    }`}
                                  >
                                    {skill}
                                  </span>
                                </label>
                              ))}
                            </div>
                          </div>

                          <div className="mt-4">
                            <label
                              className={`block text-sm font-medium mb-2 ${
                                isDarkMode ? "text-gray-300" : "text-gray-700"
                              }`}
                            >
                              Bio/Accomplishments
                            </label>
                            <textarea
                              placeholder="Describe barber's achievements, awards, etc."
                              value={barber.bio}
                              onChange={(e) =>
                                handleBarberChange(index, "bio", e.target.value)
                              }
                              rows={2}
                              className={`w-full px-4 py-3 rounded-xl border transition-all duration-300 focus:ring-2 focus:ring-opacity-50 resize-none ${
                                isDarkMode
                                  ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                  : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                              }`}
                            />
                          </div>
                        </div>
                      ))}

                      <button
                        type="button"
                        onClick={addBarber}
                        className={`w-full py-3 border-2 border-dashed rounded-xl transition-all duration-300 ${
                          isDarkMode
                            ? "border-gray-600 text-gray-400 hover:border-yellow-500 hover:text-yellow-400"
                            : "border-gray-300 text-gray-600 hover:border-amber-500 hover:text-amber-600"
                        }`}
                      >
                        + Add Another Barber
                      </button>
                    </div>
                  </div>
                )}
                {/* Step 3: Services */}
                {currentStep === 4 && (
                  <div className="animate-slideIn">
                    <h2
                      className={`text-2xl font-bold mb-6 flex items-center ${
                        isDarkMode ? "text-yellow-400" : "text-amber-600"
                      }`}
                    >
                      <Scissors className="w-6 h-6 mr-3" />
                      Basic Services & Pricing
                    </h2>

                    {validationErrors.services && (
                      <p className="text-red-500 text-sm mb-4">
                        {validationErrors.services}
                      </p>
                    )}

                    <div className="grid md:grid-cols-2 gap-4">
                      {services.map((service) => {
                        const Icon = service.icon;
                        return (
                          <div
                            key={service.key}
                            className={`p-4 rounded-xl border-2 transition-all duration-300 ${
                              formData.services[service.key].enabled
                                ? isDarkMode
                                  ? "border-yellow-500 bg-yellow-500/10"
                                  : "border-amber-500 bg-amber-50"
                                : isDarkMode
                                ? "border-gray-600 bg-gray-700/50 hover:border-gray-500"
                                : "border-gray-200 bg-gray-50 hover:border-gray-300"
                            }`}
                          >
                            <div className="flex items-center justify-between mb-3">
                              <div className="flex items-center">
                                <input
                                  type="checkbox"
                                  checked={
                                    formData.services[service.key].enabled
                                  }
                                  onChange={(e) =>
                                    handleServiceChange(
                                      service.key,
                                      "enabled",
                                      e.target.checked
                                    )
                                  }
                                  className={`w-5 h-5 rounded transition-all duration-300 ${
                                    isDarkMode
                                      ? "text-yellow-500 focus:ring-yellow-500 bg-gray-700 border-gray-600"
                                      : "text-amber-500 focus:ring-amber-500"
                                  }`}
                                />
                                <Icon
                                  className={`w-5 h-5 ml-3 ${
                                    formData.services[service.key].enabled
                                      ? isDarkMode
                                        ? "text-yellow-400"
                                        : "text-amber-600"
                                      : isDarkMode
                                      ? "text-gray-400"
                                      : "text-gray-500"
                                  }`}
                                />
                                <span
                                  className={`ml-2 font-medium ${
                                    formData.services[service.key].enabled
                                      ? isDarkMode
                                        ? "text-white"
                                        : "text-gray-900"
                                      : isDarkMode
                                      ? "text-gray-400"
                                      : "text-gray-600"
                                  }`}
                                >
                                  {service.label}
                                </span>
                              </div>
                            </div>

                            {formData.services[service.key].enabled && (
                              <div className="animate-slideIn">
                                <div className="flex items-center">
                                  <span
                                    className={`text-sm font-medium mr-2 ${
                                      isDarkMode
                                        ? "text-gray-300"
                                        : "text-gray-700"
                                    }`}
                                  >
                                    ‚Çπ
                                  </span>
                                  <input
                                    type="number"
                                    placeholder={service.defaultPrice}
                                    value={formData.services[service.key].price}
                                    onChange={(e) =>
                                      handleServiceChange(
                                        service.key,
                                        "price",
                                        e.target.value
                                      )
                                    }
                                    className={`flex-1 form-input px-3 py-2 rounded-lg transition-all duration-300 focus:ring-2 focus:ring-opacity-50 ${
                                      isDarkMode
                                        ? "bg-gray-600 border-gray-500 text-white placeholder-gray-400 focus:border-yellow-500 focus:ring-yellow-500"
                                        : "bg-white border-gray-300 text-gray-900 placeholder-gray-500 focus:border-amber-500 focus:ring-amber-500"
                                    }`}
                                  />
                                </div>
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {/* Navigation Buttons */}
                <div className="flex justify-between pt-8">
                  {currentStep > 1 && (
                    <button
                      type="button"
                      onClick={handlePrevStep}
                      className={`btn btn-secondary`}
                    >
                      Previous
                    </button>
                  )}

                  {currentStep < 4 ? (
                    <button
                      type="button"
                      onClick={() => setCurrentStep(currentStep + 1)}
                      className={`px-8 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 ml-auto ${
                        isDarkMode
                          ? "bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-400 hover:to-amber-400"
                          : "bg-gradient-to-r from-amber-500 to-yellow-600 text-white hover:from-amber-600 hover:to-yellow-700"
                      }`}
                    >
                      Next Step
                    </button>
                  ) : (
                    <button
                      type="button"
                      onClick={handleSubmit}
                      className={`px-8 py-3 rounded-xl font-medium transition-all duration-300 transform hover:scale-105 ml-auto ${
                        isDarkMode
                          ? "bg-gradient-to-r from-yellow-500 to-amber-500 text-gray-900 hover:from-yellow-400 hover:to-amber-400"
                          : "bg-gradient-to-r from-amber-500 to-yellow-600 text-white hover:from-amber-600 hover:to-yellow-700"
                      }`}
                    >
                      Register My Salon
                    </button>
                  )}
                </div>
              </div>

              {/* Sign In Link */}
              <div className="text-center mt-8 pt-6 border-t border-opacity-20">
                <p
                  className={`${
                    isDarkMode ? "text-gray-400" : "text-gray-600"
                  }`}
                >
                  <Link
                    href="/salons/login"
                    className={`font-medium transition-colors duration-300 ${
                      isDarkMode
                        ? "text-[var(--dark-gold-primary)] hover:opacity-80"
                        : "text-[var(--gold-primary)] hover:opacity-80"
                    }`}
                  >
                    Sign In
                  </Link>
                </p>
              </div>
            </div>
          </div>
        </div>
        <style jsx>{`
          @keyframes fadeIn {
            from {
              opacity: 0;
              transform: translateY(-20px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }

          @keyframes slideIn {
            from {
              opacity: 0;
              transform: translateX(-30px);
            }
            to {
              opacity: 1;
              transform: translateX(0);
            }
          }

          .animate-fadeIn {
            animation: fadeIn 0.8s ease-out;
          }

          .animate-slideIn {
            animation: slideIn 0.6s ease-out;
          }
        `}</style>
      </div>
    </>
  );
};

export default SalonRegisterForm;
</file>

<file path="src/pages/api/auth/salon/register.js">
import clientPromise from "../../../../lib/mongodb";
import {
  hashPassword,
  generateToken,
  getLocationFromCoordinates,
} from "../../../../lib/auth";

export default async function handler(req, res) {
  if (req.method !== "POST") {
    return res.status(405).json({ message: "Method not allowed" });
  }
  const client = await clientPromise;
  const db = client.db("techtrims");
  const salons = db.collection("salons");
  const barbersCollection = db.collection("barbers");

  // ADD DATABASE CONNECTION VERIFICATION
  console.log("=== DATABASE CONNECTION DEBUG ===");
  console.log("Client connected:", !!client);
  console.log("Database name:", db.databaseName);
  console.log("Collections initialized:", !!salons && !!barbersCollection);

  // Test database write access
  try {
    await db.admin().ping();
    console.log("Database ping successful");
  } catch (pingError) {
    console.error("Database ping failed:", pingError);
  }

  console.log("=== END CONNECTION DEBUG ===");
  try {
    let {
      salonName,
      ownerName,
      email,
      phone,
      password,
      address,
      latitude,
      longitude,
      services,
      barbers = [],
      operatingHours,
      description,
      amenities,
      salonImages,
    } = req.body;

    console.log("Registration request:", {
      salonName,
      ownerName,
      barbers: barbers,
      barbersCount: barbers.length,
    });

    // Ensure latitude/longitude are numbers
    latitude = parseFloat(latitude);
    longitude = parseFloat(longitude);

    // Validate required fields
    const requiredFields = {
      salonName: "Salon name",
      ownerName: "Owner name",
      email: "Email",
      phone: "Phone number",
      password: "Password",
      address: "Address",
      latitude: "Location (latitude)",
      longitude: "Location (longitude)",
    };

    for (const [field, label] of Object.entries(requiredFields)) {
      if (!req.body[field]) {
        return res.status(400).json({
          message: `${label} is required`,
        });
      }
    }

    // Validate email format
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(email)) {
      return res.status(400).json({ message: "Invalid email format" });
    }

    // Validate phone format (Indian format)
    const phoneRegex = /^[6-9]\d{9}$/;
    if (!phoneRegex.test(phone)) {
      return res
        .status(400)
        .json({ message: "Invalid phone number. Use 10-digit Indian format" });
    }

    // Validate password strength
    if (password.length < 6) {
      return res
        .status(400)
        .json({ message: "Password must be at least 6 characters long" });
    }

    // Validate coordinates
    if (isNaN(latitude) || isNaN(longitude)) {
      return res
        .status(400)
        .json({ message: "Location (latitude) is required" });
    }

    const client = await clientPromise;
    const db = client.db("techtrims");
    const salons = db.collection("salons");
    const barbersCollection = db.collection("barbers"); // ADD THIS LINE

    // Check if salon already exists
    const existingSalon = await salons.findOne({
      $or: [
        { email: email.toLowerCase() },
        { phone: phone },
        { salonName: salonName.trim() },
      ],
    });

    if (existingSalon) {
      return res.status(409).json({
        message: "Salon already exists with this email, phone number, or name",
      });
    }

    // Hash password
    const hashedPassword = await hashPassword(password);

    // Get location details from coordinates
    let locationDetails = {};
    try {
      let locationDetails = {};
      try {
        locationDetails = await getLocationFromCoordinates(latitude, longitude);
      } catch (err) {
        console.warn("Geocoding failed:", err.message);
        locationDetails = {
          city: "",
          state: "",
          country: "India",
          postcode: "",
        };
      }
    } catch (err) {
      console.warn("Geocoding failed, falling back to defaults:", err);
      locationDetails = { city: "", state: "", country: "India", postcode: "" };
    }

    // Default services if not provided
    const defaultServices = services || [
      { name: "Haircut", price: 200, duration: 30, gender: ["Male", "Female"] },
      {
        name: "Hair Wash",
        price: 100,
        duration: 15,
        gender: ["Male", "Female"],
      },
      { name: "Beard Trim", price: 150, duration: 20, gender: ["Male"] },
      { name: "Facial", price: 500, duration: 60, gender: ["Female"] },
    ];

    // Default operating hours if not provided
    const defaultOperatingHours = operatingHours || {
      monday: { open: "09:00", close: "20:00", closed: false },
      tuesday: { open: "09:00", close: "20:00", closed: false },
      wednesday: { open: "09:00", close: "20:00", closed: false },
      thursday: { open: "09:00", close: "20:00", closed: false },
      friday: { open: "09:00", close: "20:00", closed: false },
      saturday: { open: "09:00", close: "21:00", closed: false },
      sunday: { open: "10:00", close: "19:00", closed: false },
    };

    // Create new salon
    const newSalon = {
      salonName: salonName.trim(),
      ownerName: ownerName.trim(),
      email: email.toLowerCase(),
      phone: phone,
      hashedPassword,
      role: "salon",
      location: {
        type: "Point",
        coordinates: [parseFloat(longitude), parseFloat(latitude)],
        address: address.trim(),
        city: locationDetails?.city || "",
        state: locationDetails?.state || "",
        country: locationDetails?.country || "India",
        postcode: locationDetails?.postcode || "",
      },
      services: defaultServices,
      operatingHours: defaultOperatingHours,
      description: description || "",
      amenities: amenities || ["WiFi", "Air Conditioning", "Parking"],
      salonImages: salonImages || [],
      barbers: [],
      ratings: {
        overall: 0,
        serviceQuality: 0,
        timing: 0,
        ambience: 0,
        cleanliness: 0,
        totalReviews: 0,
      },
      stats: {
        totalBookings: 0,
        completedBookings: 0,
        repeatCustomers: 0,
        averageWaitTime: 0,
      },
      achievements: [],
      isVerified: false,
      isActive: true,
      createdAt: new Date(),
      updatedAt: new Date(),
    };

    const result = await salons.insertOne(newSalon);
    console.log("Creating salon with data:", newSalon);
    console.log("Salon created with ID:", result.insertedId);

    // CREATE BARBERS IF PROVIDED - ADD THIS SECTION
    let barbersCreatedCount = 0;
    let barberIds = [];

    if (barbers && barbers.length > 0) {
      console.log("Creating barbers for salon:", result.insertedId);

      try {
        const barberDocuments = barbers.map((barber) => ({
          salonId: result.insertedId, // Link to the salon
          name: barber.name || "",
          experience: parseInt(barber.experience) || 0,
          skills: Array.isArray(barber.skills) ? barber.skills : [],
          bio: barber.bio || "",
          photo: barber.photo || "",
          isAvailable: barber.isAvailable !== false, // Default to true
          workingHours: {
            start: "09:00",
            end: "21:00",
          },
          totalBookings: 0,
          rating: 5.0,
          accomplishments: [],
          earnings: 0,
          lastActiveAt: new Date(),
          createdAt: new Date(),
          updatedAt: new Date(),
        }));

        console.log("Inserting barbers:", barberDocuments);

        // Insert all barbers at once
        const barberResult = await barbersCollection.insertMany(
          barberDocuments
        );

        barbersCreatedCount = barberResult.insertedCount || 0;
        barberIds = Object.values(barberResult.insertedIds || {});

        console.log("Barbers created:", barbersCreatedCount);
        console.log("Barber IDs:", barberIds);

        // UPDATE SALON DOCUMENT WITH BARBER IDS
        console.log("Updating salon document with barber IDs...");
        const salonUpdateResult = await salons.updateOne(
          { _id: result.insertedId },
          {
            $set: {
              barbers: barberIds, // Add barber IDs to salon
              updatedAt: new Date(),
            },
          }
        );

        console.log("Salon update result:", salonUpdateResult);
      } catch (barberError) {
        console.error("Error creating barbers:", barberError);
        barbersCreatedCount = 0;
      }
    } else {
      console.log("No barbers provided");
    }

    // Generate JWT token
    const token = generateToken(result.insertedId, "salon", email);

    // Remove password from response
    const { hashedPassword: _, ...salonResponse } = newSalon;
    salonResponse._id = result.insertedId;
    console.log("Final barbersCreatedCount to send:", barbersCreatedCount);

    res.status(201).json({
      message: "Salon registered successfully",
      salon: salonResponse,
      barbersCreated: barbersCreatedCount, // ADD THIS LINE

      token,
    });
  } catch (error) {
    console.error("Salon registration error:", error);
    console.error("Salon registration error:", error.stack || error);
    res.status(500).json({ message: error.message || "Internal server error" });
  }
}
</file>

<file path="src/pages/api/salons/nearby.js">
import { connectToDatabase } from "../../../lib/mongodb";

export default async function handler(req, res) {
  if (req.method !== "GET") {
    return res.status(405).json({ message: "Method Not Allowed" });
  }

  const { latitude, longitude, radius = 30 } = req.query;

  if (!latitude || !longitude) {
    return res.status(400).json({ message: "latitude and longitude required" });
  }

  const lat = parseFloat(latitude);
  const lng = parseFloat(longitude);
  const radiusKm = parseFloat(radius);

  let retryCount = 0;
  const maxRetries = 3;

  while (retryCount < maxRetries) {
    try {
      const { db } = await connectToDatabase();

      console.log("=== DEBUGGING SALON SEARCH ===");
      console.log("Search coordinates:", { lat, lng });
      console.log("Search radius:", radiusKm, "km");

      // Get all salons with timeout
      const allSalons = await db
        .collection("salons")
        .find({})
        .maxTimeMS(30000)
        .toArray();

      console.log(`Found ${allSalons.length} total salons in database`);

      // Filter salons by distance
      const nearbySalons = [];

      for (const salon of allSalons) {
        if (
          !salon.location?.coordinates ||
          salon.location.coordinates.length !== 2
        ) {
          continue;
        }

        const [salonLng, salonLat] = salon.location.coordinates;

        if (isNaN(salonLat) || isNaN(salonLng)) {
          continue;
        }

        const distance = calculateDistance(lat, lng, salonLat, salonLng);

        if (distance <= radiusKm) {
          nearbySalons.push({
            ...salon,
            calculatedDistance: distance,
          });
        }
      }

      // Process salon data
      const processedSalons = nearbySalons.map((salon) => ({
        ...salon,
        id: salon._id.toString(),
        distance: Number(salon.calculatedDistance.toFixed(2)),
        topServices: salon.services
          ? Object.entries(salon.services)
              .filter(([key, service]) => service.enabled)
              .slice(0, 3)
              .map(([key, service]) => ({
                name: key,
                price: Number(service.price || 0),
              }))
          : [],
        stats: {
          ...salon.stats,
          totalBookings: Number(salon.stats?.totalBookings || 0),
          rating: Number(salon.stats?.rating || 4.5),
          totalRatings: Number(salon.stats?.totalRatings || 0),
        },
      }));

      processedSalons.sort((a, b) => a.distance - b.distance);

      return res.status(200).json({
        success: true,
        salons: processedSalons,
      });
    } catch (err) {
      console.error(`Attempt ${retryCount + 1} failed:`, err.message);
      retryCount++;

      if (retryCount >= maxRetries) {
        console.error("Max retries reached. Final error:", err);
        return res.status(500).json({
          message: "Database connection failed after retries",
          error: err.message,
        });
      }

      // Wait before retrying
      await new Promise((resolve) => setTimeout(resolve, 1000 * retryCount));
    }
  }
}

function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = ((lat2 - lat1) * Math.PI) / 180;
  const dLon = ((lon2 - lon1) * Math.PI) / 180;
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos((lat1 * Math.PI) / 180) *
      Math.cos((lat2 * Math.PI) / 180) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}
</file>

<file path="src/pages/salons/[id].js">
// pages/salons/[id].js
import { useState, useEffect, useCallback } from "react";
import { useRouter } from "next/router";
import { motion } from "framer-motion";
import dynamic from "next/dynamic";
import styles from "../../styles/SalonDetail.module.css";
import Image from "next/image";

// Dynamic map import to avoid SSR issues
const MapContainer = dynamic(
  () => import("react-leaflet").then((mod) => mod.MapContainer),
  { ssr: false }
);
const TileLayer = dynamic(
  () => import("react-leaflet").then((mod) => mod.TileLayer),
  { ssr: false }
);
const Marker = dynamic(
  () => import("react-leaflet").then((mod) => mod.Marker),
  { ssr: false }
);

export default function SalonDetail({ initialSalon }) {
  const router = useRouter();
  const { id } = router.query;
  const [userInfo, setUserInfo] = useState(null);
  const [salon, setSalon] = useState(initialSalon || null);
  const [isLoading, setIsLoading] = useState(!initialSalon);
  const [selectedServices, setSelectedServices] = useState([]);
  const [selectedTime, setSelectedTime] = useState(null);
  const [availableBarbers, setAvailableBarbers] = useState([]);
  const [selectedBarber, setSelectedBarber] = useState(null);
  const [selectedDate, setSelectedDate] = useState("");
  const [selectedSlot, setSelectedSlot] = useState("");
  const [timeSlots, setTimeSlots] = useState([]); // ‚úÖ added this
  const [userOnboarding, setUserOnboarding] = useState(null);
  const [showRegistrationModal, setShowRegistrationModal] = useState(false);
  const [isBooking, setIsBooking] = useState(false);
  const [otpSent, setOtpSent] = useState(false);
  const [otpCode, setOtpCode] = useState("");
  const [otpMobile, setOtpMobile] = useState("");
  const [sseMessages, setSseMessages] = useState([]);
  const [regName, setRegName] = useState("");
  const [regMobile, setRegMobile] = useState("");
  const [regEmail, setRegEmail] = useState("");

  // In your [id].js file - ADD THIS CORRECTLY
  useEffect(() => {
    if (typeof window !== "undefined") {
      const interval = setInterval(() => {
        // Your refresh logic here
        console.log("Refreshing slots...");
      }, 30000);

      return () => {
        if (typeof window !== "undefined") {
          clearInterval(interval);
        }
      };
    }
  }, []);

  useEffect(() => {
    const stored = localStorage.getItem("userOnboardingData");
    if (stored) {
      try {
        const parsed = JSON.parse(stored);
        setUserInfo(parsed);
        console.log("Loaded userInfo from onboarding:", parsed);
      } catch (err) {
        console.error("Failed to parse onboarding data:", err);
      }
    }
  }, []);

  useEffect(() => {
    console.log(
      "üîé Button enable check ‚Üí Services:",
      selectedServices,
      "Time:",
      selectedTime
    );
  }, [selectedServices, selectedTime]);
  useEffect(() => {
    if (selectedServices.length > 0 && salon?._id) {
      const fetchAvailableBarbers = async () => {
        try {
          const serviceNames = selectedServices.map((s) => s.name);
          console.log("Fetching barbers for services:", serviceNames);

          // Fetch barbers who can perform the selected services
          const res = await fetch(
            `/api/salons/barbers/available?salonId=${salon._id}&service=${serviceNames[0]}`
          );
          const barbers = await res.json();

          console.log("Available barbers:", barbers);
          setAvailableBarbers(barbers);
        } catch (err) {
          console.error("Error fetching barbers:", err);
          setAvailableBarbers([]);
        }
      };

      fetchAvailableBarbers();
    } else {
      setAvailableBarbers([]);
      setSelectedBarber(null);
    }
  }, [selectedServices, salon?._id]);

  const chosenService =
    salon?.services && selectedServices
      ? { name: selectedServices, ...(salon.services[selectedServices] || {}) }
      : null;
  const chosenBarber =
    salon?.barbers && selectedBarber
      ? salon.barbers.find(
          (b) => (b.id || b._id || b.name) === selectedBarber
        ) || null
      : null;
  const [showBookingModal, setShowBookingModal] = useState(false);

  // Client re-fetch (optional, keeps data fresh if user navigates without reload)
  const computeTimeSlotsForDate = useCallback(
    (dateStr) => {
      if (!dateStr) return [];
      const slots = [];
      const today = new Date();
      const selectedDateObj = new Date(dateStr);
      const startHour =
        selectedDateObj.toDateString() === today.toDateString()
          ? Math.max(9, today.getHours() + 1)
          : 9;
      const endHour = 20;

      const bookedSet = new Set(
        (salon.bookings || [])
          .filter((b) => {
            try {
              const bd = new Date(b.date);
              return bd.toDateString() === selectedDateObj.toDateString();
            } catch {
              return false;
            }
          })
          .map((b) => b.date === selectedDate)
      );

      for (let hour = startHour; hour < endHour; hour++) {
        for (let minute = 0; minute < 60; minute += 30) {
          const hh = String(hour).padStart(2, "0");
          const mm = String(minute).padStart(2, "0");
          const timeString = `${hh}:${mm}`;
          slots.push({
            time: timeString,
            available: !bookedSet.has(timeString),
          });
        }
      }

      return slots;
    },
    [salon]
  );

  useEffect(() => {
    if (!selectedDate) {
      setTimeSlots([]);
      setSelectedSlot("");
      return;
    }
    const slots = computeTimeSlotsForDate(selectedDate);
    setTimeSlots(slots);
  }, [selectedDate, computeTimeSlotsForDate]);

  const getFilteredServices = () => {
    if (!salon) return [];

    // Convert object ‚Üí array
    const servicesArray = Object.entries(salon.services || {}).map(
      ([key, value]) => ({
        name: key,
        price: Number(value.price) || 0,
        enabled: value.enabled,
        duration: value.duration || 30, // fallback if not stored
        gender: value.gender || ["All"], // fallback if not stored
      })
    );

    if (!userOnboarding) return servicesArray;

    return servicesArray.filter(
      (service) =>
        service.gender.includes(userOnboarding.gender) ||
        service.gender.includes("All")
    );
  };

  if (isLoading) {
    return (
      <div className={styles.loadingContainer}>
        <div className={styles.spinner}></div>
        <p>Loading salon details...</p>
      </div>
    );
  }

  if (!salon) {
    return (
      <div className={styles.errorContainer}>
        <h2>Salon not found</h2>
        <button onClick={() => router.push("/")} className={styles.backButton}>
          ‚Üê Back to Home
        </button>
      </div>
    );
  }

  const handleServiceClick = (service) => {
    setSelectedServices((prev) => {
      const exists = prev.find((s) => s.name === service.name);
      if (exists) {
        return prev.filter((s) => s.name !== service.name);
      } else {
        return [...prev, service];
      }
    });
  };

  const handleTimeClick = (time) => {
    console.log("Time selected:", time);
    setSelectedTime(time);
    setSelectedSlot(time); // optional: keep both in sync
  };

  const handleBooking = async () => {
    if (selectedServices.length === 0) {
      alert("Please select at least one service");
      return;
    }

    if (!selectedBarber) {
      alert("Please select a barber");
      return;
    }

    if (!selectedDate) {
      alert("Please select a date");
      return;
    }

    if (!selectedSlot) {
      alert("Please select a time slot");
      return;
    }
    try {
      console.log("Available variables:", {
        selectedServices, // ‚Üê Use the PLURAL version
        selectedSlot,
        selectedBarber,
        userInfo,
      });
      const selectedBarberDetails = availableBarbers.find(
        (b) => b._id === selectedBarber
      );

      // Since you have multiple services selected, you can:
      // Option 1: Use all services
      const allServices = selectedServices
        .map((service) => service.name)
        .join(", ");
      const totalPrice = selectedServices.reduce(
        (sum, service) => sum + service.price,
        0
      );

      // Option 2: Use just the first service
      const firstService = selectedServices[0];

      const payload = {
        salonId: salon._id,
        service: allServices, // or firstService.name
        barber: selectedBarberDetails?.name || selectedBarber,
        barberId: selectedBarber,
        date: selectedDate,
        time: selectedSlot,
        price: totalPrice, // or firstService.price
        customerName: userInfo?.name || "Anonymous",
        customerPhone: userInfo?.phone || "",
        user: userInfo,
      };

      console.log("Booking data to send:", payload);

      const response = await fetch("/api/bookings/create", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(payload),
      });

      // FIX 1: Handle 409 conflict BEFORE checking response.ok
      if (response.status === 409) {
        const errorData = await response.json();
        alert(
          "‚ö†Ô∏è Sorry! This time slot was just booked by another customer. Please select a different time."
        );
        // Refresh the page to show updated available slots
        window.location.reload();
        return; // Exit early, don't continue
      }

      // FIX 2: Use 'response' instead of 'res'
      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(
          errorData.error || `Booking failed: ${response.status}`
        );
      }

      const data = await response.json(); // ‚Üê FIX: 'response' not 'res'
      console.log("‚úÖ Booking confirmed with:", data);

      alert("‚úÖ Booking confirmed successfully!");
      setSelectedServices([]);
      setSelectedBarber(null);
      setSelectedDate("");
      setSelectedSlot("");

      // Redirect to booking confirmation page
      router.push(`/booking/confirmed?id=${data.bookingId || data._id}`);
    } catch (error) {
      console.error("‚ùå Booking error:", error);
      alert(`Booking failed: ${error.message}`);
    }
  };

  const handleRegisterAndLink = async () => {
    // call registration API
    if (!regName || !regMobile) return alert("Please enter name and mobile");
    try {
      const res = await fetch("/api/users/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name: regName,
          mobile: regMobile,
          email: regEmail,
        }),
      });
      const data = await res.json();
      if (!res.ok) {
        setIsBooking(false);
        return alert(
          "Registration failed: " + (data.message || res.statusText)
        );
      }
      // set onboarding and close modal
      setUserOnboarding({ name: regName, mobile: regMobile, email: regEmail });
      setShowRegistrationModal(false);
      alert("Account created! You are now registered.");
    } catch (e) {
      console.error(e);
      alert("Registration failed: " + e.message);
    }
  };

  const sendOtpForRegistration = async (mobile) => {
    try {
      const res = await fetch("/api/auth/send-otp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobile }),
      });
      const data = await res.json();
      if (res.ok) {
        setOtpSent(true);
        setOtpMobile(mobile);
        // For dev we get OTP in response; in prod SMS is sent.
        setOtpCode(data.otp || "");
        alert("OTP sent (dev): " + (data.otp || "---"));
      } else {
        alert("OTP send failed: " + (data.message || res.statusText));
      }
    } catch (e) {
      console.error(e);
      alert("OTP send failed");
    }
  };

  const verifyOtpAndRegister = async (mobile, otp) => {
    try {
      const res = await fetch("/api/auth/verify-otp", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ mobile, otp }),
      });
      const data = await res.json();
      if (!res.ok)
        return alert("OTP verify failed: " + (data.message || res.statusText));
      // if user present, set onboarding; else open registration form
      if (data.user) {
        setUserOnboarding({
          name: data.user.name,
          mobile: data.user.mobile,
          email: data.user.email,
        });
        alert("Verified and signed in");
        setShowRegistrationModal(false);
      } else {
        // No existing user: fill registration modal fields
        setRegName(regName || "");
        setRegMobile(mobile);
        setShowRegistrationModal(true);
      }
      setOtpSent(false);
      setOtpCode("");
    } catch (e) {
      console.error(e);
      alert("OTP verify failed");
    }
  };

  return (
    <div className={styles.container}>
      {/* Header */}
      <header className={styles.header}>
        <button onClick={() => router.back()} className={styles.backButton}>
          ‚Üê Back
        </button>
        <h1 className={styles.salonName}>{salon.salonName}</h1>
        <div className={styles.headerActions}>
          <button className={styles.shareButton}>üì§</button>
          <button className={styles.favoriteButton}>‚ù§Ô∏è</button>
        </div>
      </header>

      {/* Hero Section */}
      <motion.section
        className={styles.heroSection}
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ duration: 0.8 }}
      >
        <div className={styles.imageGallery}>
          {salon.salonImages && salon.salonImages.length > 0 ? (
            <Image
              src={salon.salonImages[0]}
              alt={salon.salonName}
              className={styles.mainImage}
            />
          ) : (
            <div className={styles.placeholderImage}>
              <span>üì∏</span>
              <p>No images available</p>
            </div>
          )}
        </div>

        <div className={styles.salonBasicInfo}>
          <div className={styles.ratingSection}>
            <div className={styles.mainRating}>
              ‚≠ê {salon.ratings.overall.toFixed(1)}
            </div>
            <div className={styles.reviewCount}>
              ({salon.ratings.totalReviews} reviews)
            </div>
          </div>

          <div className={styles.locationInfo}>
            <p>üìç {salon.location.address}</p>
            <p>üìû {salon.phone}</p>
          </div>

          <div className={styles.quickStats}>
            <div className={styles.stat}>
              <span className={styles.statNumber}>
                {salon.stats.totalBookings}
              </span>
              <span className={styles.statLabel}>Total Bookings</span>
            </div>
            <div className={styles.stat}>
              <span className={styles.statNumber}>
                {salon.stats.averageWaitTime}min
              </span>
              <span className={styles.statLabel}>Avg Wait Time</span>
            </div>
            <div className={styles.stat}>
              <span className={styles.statNumber}>
                {salon.stats.repeatCustomers}
              </span>
              <span className={styles.statLabel}>Repeat Customers</span>
            </div>
          </div>
        </div>
      </motion.section>

      {/* Services Section */}
      <motion.section
        className={styles.servicesSection}
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.2 }}
      >
        <h3 className={styles.sectionTitle}>Services & Pricing</h3>
        <div className={styles.servicesGrid}>
          {getFilteredServices().map((service, index) => (
            <motion.div
              key={index}
              className={`${styles.serviceCard} ${
                selectedServices.find((s) => s.name === service.name)
                  ? styles.selected
                  : ""
              }`}
              onClick={() => {
                console.log("Service clicked:", service.name);
                handleServiceClick(service);
                console.log("Current selectedServices:", service);
              }}
              whileHover={{ scale: 1.02 }}
              whileTap={{ scale: 0.98 }}
            >
              <h4 className={styles.serviceName}>{service.name}</h4>
              <p className={styles.servicePrice}>‚Çπ{service.price}</p>
              <p className={styles.serviceDuration}>{service.duration} min</p>
              <p className={styles.serviceGender}>
                {service.gender.join(", ")}
              </p>
            </motion.div>
          ))}
        </div>
      </motion.section>

      {/* Barber Selection Section */}
      {selectedServices.length > 0 && availableBarbers.length > 0 && (
        <motion.section
          className={styles.barbersSection}
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.4 }}
        >
          <h3 className={styles.sectionTitle}>Choose Your Barber</h3>
          <div className={styles.barbersGrid}>
            {availableBarbers.map((barber, index) => (
              <motion.div
                key={barber._id || index}
                className={`${styles.barberCard} ${
                  selectedBarber === barber._id ? styles.selected : ""
                }`}
                onClick={() => setSelectedBarber(barber._id)}
                whileHover={{ scale: 1.02 }}
                whileTap={{ scale: 0.98 }}
              >
                <div className={styles.barberImage}>
                  {barber.photo ? (
                    <img
                      src={barber.photo}
                      alt={barber.name}
                      className={styles.barberPhoto}
                    />
                  ) : (
                    <div className={styles.defaultBarberImage}>üë®‚Äçüíº</div>
                  )}
                </div>
                <h4 className={styles.barberName}>{barber.name}</h4>
                <p className={styles.barberExperience}>
                  {barber.experience} yrs experience
                </p>
                <div className={styles.barberRating}>
                  <span className="text-yellow-500">‚≠ê</span>
                  <span>{barber.rating}/5</span>
                  <span className="text-gray-500 ml-2">
                    ({barber.totalBookings} bookings)
                  </span>
                </div>
                <div className={styles.barberSkills}>
                  {barber.skills.slice(0, 3).map((skill) => (
                    <span key={skill} className={styles.skillChip}>
                      {skill}
                    </span>
                  ))}
                </div>
                {barber.bio && (
                  <p className={styles.barberBio}>
                    {barber.bio.length > 80
                      ? `${barber.bio.substring(0, 80)}...`
                      : barber.bio}
                  </p>
                )}
              </motion.div>
            ))}
          </div>
        </motion.section>
      )}
      {selectedServices.length > 0 && availableBarbers.length === 0 && (
        <motion.section
          className={styles.noBarbersSection}
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.4 }}
        >
          <div className="text-center py-8 bg-yellow-50 rounded-lg">
            <h3 className="text-lg font-semibold text-yellow-800 mb-2">
              No Specialized Barbers Available
            </h3>
            <p className="text-yellow-600">
              Sorry, no barbers are currently available for the selected
              services. Please try different services or contact the salon
              directly.
            </p>
          </div>
        </motion.section>
      )}

      {/* Date & Time Selection */}
      <motion.section
        className={styles.bookingSection}
        initial={{ opacity: 0, y: 30 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.8, delay: 0.6 }}
      >
        <h3 className={styles.sectionTitle}>Select Date & Time</h3>
        <div className={styles.dateTimePicker}>
          <input
            type="date"
            value={selectedDate}
            onChange={(e) => setSelectedDate(e.target.value)}
            className={styles.dateInput}
          />
          <div className={styles.timeSlots}>
            {selectedDate ? (
              timeSlots.length === 0 ? (
                <div>No slots available for selected date</div>
              ) : (
                <div className={styles.timeSlotsWrapper}>
                  {timeSlots.map((slot, idx) => (
                    <button
                      key={idx}
                      className={`${styles.timeSlot} ${
                        selectedSlot === slot.time ? styles.selected : ""
                      } ${!slot.available ? styles.disabled : ""}`}
                      onClick={() => {
                        console.log("Slot clicked:", slot.time);
                        handleTimeClick(slot.time);
                        console.log("Current selectedSlot:", slot.time);
                      }}
                      disabled={!slot.available} // ‚úÖ ensure unavailable slots can‚Äôt be clicked
                    >
                      {slot.time}
                    </button>
                  ))}
                </div>
              )
            ) : (
              <p>Please select a date</p>
            )}
          </div>
        </div>
      </motion.section>

      {/* Map Section */}
      {salon.location.latitude && salon.location.longitude && (
        <motion.section
          className={styles.mapSection}
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8, delay: 0.8 }}
        >
          <h3 className={styles.sectionTitle}>Location</h3>
          <MapContainer
            center={[salon.location.latitude, salon.location.longitude]}
            zoom={15}
            style={{ height: "300px", width: "100%" }}
          >
            <TileLayer
              url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
              attribution="&copy; OpenStreetMap contributors"
            />
            <Marker
              position={[salon.location.latitude, salon.location.longitude]}
            />
          </MapContainer>
        </motion.section>
      )}

      {/* Book Appointment Button */}
      <div className={styles.bookButtonContainer}>
        <button
          onClick={() => {
            console.log("Book Appointment clicked");
            console.log("Selected Service:", selectedServices);
            console.log("Selected Slot:", selectedTime);
            console.log("Selected Barber:", selectedBarber);
            console.log("User Details:", userInfo);
            handleBooking();
          }}
          disabled={selectedServices.length === 0 || !selectedSlot}
        >
          Book Appointment
        </button>
      </div>

      {/* Booking Modal */}
      {/* Registration Modal - shown after booking if user not onboarded */}
      {showRegistrationModal && (
        <div className={styles.modalOverlay}>
          <div className={styles.modalContent}>
            <h3>Create your account</h3>
            <p>
              We prefilled your booking info ‚Äî just confirm to create an
              account.
            </p>
            <input
              placeholder="Name"
              value={regName}
              onChange={(e) => setRegName(e.target.value)}
            />
            <input
              placeholder="Mobile"
              value={regMobile}
              onChange={(e) => setRegMobile(e.target.value)}
            />
            <input
              placeholder="Email (optional)"
              value={regEmail}
              onChange={(e) => setRegEmail(e.target.value)}
            />
            <div style={{ marginTop: "12px" }}>
              <button
                className={styles.confirmButton}
                onClick={handleRegisterAndLink}
              >
                Create Account
              </button>
              <button
                className={styles.cancelButton}
                onClick={() => setShowRegistrationModal(false)}
              >
                Skip
              </button>
            </div>
          </div>
        </div>
      )}

      {showBookingModal && (
        <div className={styles.modalOverlay}>
          <div className={styles.modalContent}>
            <h3>Confirm Your Booking</h3>
            <p>
              <strong>Service:</strong> {chosenService?.name}
            </p>
            <p>
              <strong>Barber:</strong> {chosenBarber?.name}
            </p>
            <p>
              <strong>Date:</strong> {selectedDate}
            </p>
            <p>
              <strong>Time:</strong> {selectedSlot}
            </p>
            <div className={styles.modalActions}>
              <button
                className={styles.confirmButton}
                onClick={async () => {
                  setIsBooking(true);
                  // build payload
                  const payload = {
                    salonId: id,
                    service: chosenService
                      ? chosenService.name
                      : selectedServices,
                    barber: chosenBarber
                      ? chosenBarber._id ||
                        chosenBarber._id ||
                        chosenBarber.name
                      : selectedBarber,
                    date: selectedDate,
                    time: selectedSlot,
                    user: userOnboarding || null,
                  };
                  try {
                    const res = await fetch("/api/bookings", {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify(payload),
                    });
                    if (!res.ok) {
                      setIsBooking(false);
                      const err = await res
                        .json()
                        .catch(() => ({ message: "Unknown error" }));
                      alert(
                        "Booking failed: " + (err.message || res.statusText)
                      );
                      return;
                    }
                    const data = await res.json();
                    alert(
                      "Booking confirmed! Booking ID: " +
                        (data.bookingId || data.id || "N/A")
                    );
                    if (!userOnboarding) {
                      setRegName(payload.user?.name || "");
                      setRegMobile(payload.user?.mobile || "");
                      setShowRegistrationModal(true);
                    }
                    setShowBookingModal(false);
                    setIsBooking(false);
                    // lock selected slot locally
                    setTimeSlots((prev) =>
                      prev.map((s) =>
                        s.time === selectedSlot ? { ...s, available: false } : s
                      )
                    );
                    // optionally navigate to confirmation page
                    router.push(
                      "/booking/confirmed?id=" + (data.bookingId || data.id)
                    );
                  } catch (e) {
                    console.error(e);
                    alert("Booking failed: " + e.message);
                  }
                }}
              >
                Confirm
              </button>
              <button
                className={styles.cancelButton}
                onClick={() => setShowBookingModal(false)}
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
export async function getServerSideProps(context) {
  const { id } = context.params;

  try {
    const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || "http://localhost:3000";
    const response = await fetch(`${baseUrl}/api/salons/${id}`);
    const data = await response.json();

    if (!response.ok) {
      return { notFound: true };
    }

    return {
      props: {
        initialSalon: data.salon,
      },
    };
  } catch (error) {
    console.error("SSR fetch error:", error);
    return { notFound: true };
  }
}
</file>

<file path="src/pages/salons/dashboard.js">
import React, { useEffect, useState, useCallback } from "react";
import { useRouter } from "next/router";
import Layout from "../../components/Layout";
import OwnerSidebar from "../../components/OwnerSidebar";

export default function DashboardPage() {
  const router = useRouter();
  const [loading, setLoading] = useState(true);
  const [salon, setSalon] = useState(null);
  const [bookings, setBookings] = useState([]);
  const [error, setError] = useState(null);
  const [sidebarOpen, setSidebarOpen] = useState(false); // <-- control mobile sidebar

  const loadTodayBookings = useCallback(async (salonId) => {
    try {
      setLoading(true);
      const now = new Date();
      const istOffset = 5.5 * 60 * 60 * 1000;
      const istDate = new Date(now.getTime() + istOffset);
      const today = istDate.toISOString().split("T")[0];

      const response = await fetch(
        `/api/salons/bookings?salonId=${salonId}&date=${today}`,
        { cache: "no-store", headers: { "Content-Type": "application/json" } }
      );

      if (!response.ok) throw new Error("Failed to fetch bookings");

      const data = await response.json();
      setBookings(Array.isArray(data) ? data : []);
    } catch (err) {
      setError("Error loading bookings: " + err.message);
      setBookings([]);
    } finally {
      setLoading(false);
    }
  }, []);

  useEffect(() => {
    if (!router.isReady) return;
    const salonSession = localStorage.getItem("salonSession");
    if (!salonSession) {
      router.push("/auth/salon/login");
      return;
    }
    const salonData = JSON.parse(salonSession);
    setSalon(salonData);
    loadTodayBookings(salonData._id);
  }, [router, router.isReady, loadTodayBookings]);

  const updateBookingStatus = async (bookingId, status) => {
    try {
      const response = await fetch("/api/bookings/update-status", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ bookingId, status }),
      });

      if (response.ok) {
        setBookings((prev) =>
          prev.map((b) =>
            (b._id || b.id) === bookingId
              ? { ...b, status, updatedAt: new Date() }
              : b
          )
        );
      } else {
        alert("Failed to update booking");
      }
    } catch {
      alert("Error updating booking");
    }
  };

  const getCurrentDate = () =>
    new Date().toLocaleDateString("en-IN", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric",
    });

  if (loading)
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="spinner"></div>
        <p className="ml-2">Loading dashboard...</p>
      </div>
    );

  return (
    <Layout>
      <div className="flex min-h-screen bg-background-primary">
        {/* Sidebar Desktop */}
        <aside className="hidden md:block w-64 border-r">
          <OwnerSidebar />
        </aside>

        {/* Sidebar Mobile (slide-in) */}
        {sidebarOpen && (
          <div className="fixed inset-0 z-40 flex md:hidden">
            {/* Overlay */}
            <div
              className="fixed inset-0 bg-black bg-opacity-40"
              onClick={() => setSidebarOpen(false)}
            ></div>
            {/* Drawer */}
            <div className="relative flex-1 flex flex-col max-w-xs w-full bg-white shadow-xl animate-slideIn">
              <OwnerSidebar closeSidebar={() => setSidebarOpen(false)} />
            </div>
          </div>
        )}

        {/* Main Content */}
        <main className="flex-1 p-4 md:p-6">
          <div className="max-w-6xl mx-auto space-y-6 animate-slideIn">
            {/* Top Bar for mobile */}
            <div className="md:hidden flex items-center justify-between bg-white p-3 rounded-lg shadow-sm sticky top-0 z-30">
              <button
                onClick={() => setSidebarOpen(true)}
                className="p-2 rounded-md hover:bg-gray-100"
              >
                ‚ò∞
              </button>
              <h1 className="font-bold text-lg gold-gradient-text">
                {salon?.salonName || "Dashboard"}
              </h1>
            </div>

            {/* Salon Info */}
            <div className="card">
              <h1 className="text-2xl font-bold gold-gradient-text">
                {salon?.salonName}
              </h1>
              <p className="text-text-secondary">Owner: {salon?.ownerName}</p>
            </div>

            {/* Bookings */}
            <div className="card">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-xl font-semibold">
                  Today‚Äôs Bookings ({bookings.length})
                </h2>
                <span className="text-sm text-text-secondary">
                  {getCurrentDate()}
                </span>
              </div>

              {error && (
                <div className="bg-error/10 border border-error text-error px-4 py-3 rounded mb-4">
                  {error}
                </div>
              )}

              {bookings.length === 0 ? (
                <p className="text-text-secondary">No bookings today</p>
              ) : (
                <div className="grid gap-4">
                  {bookings.map((b) => (
                    <div
                      key={b._id || b.id}
                      className="flex flex-col md:flex-row justify-between md:items-center card p-4"
                    >
                      <div className="space-y-1">
                        <h3 className="font-semibold text-lg">
                          {b.customerName}
                        </h3>
                        <p className="text-text-secondary">
                          üìû {b.customerPhone}
                        </p>
                        <p className="text-text-secondary">‚úÇÔ∏è {b.service}</p>
                        {b.barber && (
                          <p className="text-text-secondary">üë§ {b.barber}</p>
                        )}
                        <p className="text-text-secondary">
                          üìÖ {b.date} at {b.time}
                        </p>
                        <p className="text-text-secondary">üí∞ ‚Çπ{b.price}</p>
                      </div>

                      {/* Actions */}
                      <div className="mt-3 md:mt-0 flex flex-col space-y-2">
                        <span
                          className={`px-3 py-1 rounded-full text-sm font-medium self-start md:self-end ${getStatusColor(
                            b.status
                          )}`}
                        >
                          {b.status}
                        </span>

                        <div className="flex flex-wrap gap-2">
                          {b.status === "confirmed" && (
                            <button
                              onClick={() =>
                                updateBookingStatus(b._id, "started")
                              }
                              className="btn btn-primary text-sm"
                            >
                              Start Service
                            </button>
                          )}
                          {b.status === "started" && (
                            <button
                              onClick={() =>
                                updateBookingStatus(b._id, "completed")
                              }
                              className="btn btn-primary text-sm"
                            >
                              Mark Done
                            </button>
                          )}
                          {b.status !== "cancelled" &&
                            b.status !== "completed" && (
                              <button
                                onClick={() =>
                                  updateBookingStatus(b._id, "cancelled")
                                }
                                className="btn btn-secondary text-sm"
                              >
                                Cancel
                              </button>
                            )}
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </main>
      </div>
    </Layout>
  );
}

function getStatusColor(status) {
  switch (status) {
    case "confirmed":
      return "bg-blue-100 text-blue-800";
    case "started":
      return "bg-yellow-100 text-yellow-800";
    case "completed":
      return "bg-success/20 text-success";
    case "cancelled":
      return "bg-error/20 text-error";
    default:
      return "bg-gray-100 text-gray-800";
  }
}
</file>

</files>
